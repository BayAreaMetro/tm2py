
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://bayareametro.github.io/tm2py/api/">
      
      
        <link rel="prev" href="../architecture/">
      
      
        <link rel="next" href="../inputs/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.17">
    
    
      
        <title>API Documentation - Travel Model Two Python Package: tm2py</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.bcfcd587.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.13.0/css/all.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="grey">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#api-documentation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Travel Model Two Python Package: tm2py" class="md-header__button md-logo" aria-label="Travel Model Two Python Package: tm2py" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Travel Model Two Python Package: tm2py
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API Documentation
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="grey"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="grey"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/bayareametro/tm2py" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../server-setup/" class="md-tabs__link">
          
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../architecture/" class="md-tabs__link">
          
  
  Codebase

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../inputs/" class="md-tabs__link">
          
  
  Input & Output

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../contributing/development/" class="md-tabs__link">
          
  
  Contributing

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Travel Model Two Python Package: tm2py" class="md-nav__button md-logo" aria-label="Travel Model Two Python Package: tm2py" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Travel Model Two Python Package: tm2py
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/bayareametro/tm2py" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../server-setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Server Setup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installing tm2py
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../run/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Running tm2
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Codebase
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Codebase
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Architecture
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    API Documentation
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    API Documentation
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#setting-up-the-model-to-run" class="md-nav__link">
    <span class="md-ellipsis">
      Setting up the model to run
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.SetupModel" class="md-nav__link">
    <span class="md-ellipsis">
      SetupModel
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.SetupModel.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.SetupModel.run_setup" class="md-nav__link">
    <span class="md-ellipsis">
      run_setup
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#controller" class="md-nav__link">
    <span class="md-ellipsis">
      Controller
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.controller" class="md-nav__link">
    <span class="md-ellipsis">
      controller
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.controller.RunController" class="md-nav__link">
    <span class="md-ellipsis">
      RunController
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RunController">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.component_name" class="md-nav__link">
    <span class="md-ellipsis">
      component_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.congested_transit_assn_max_iteration" class="md-nav__link">
    <span class="md-ellipsis">
      congested_transit_assn_max_iteration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.emme_manager" class="md-nav__link">
    <span class="md-ellipsis">
      emme_manager
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.iter_component" class="md-nav__link">
    <span class="md-ellipsis">
      iter_component
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.iteration" class="md-nav__link">
    <span class="md-ellipsis">
      iteration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.run_dir" class="md-nav__link">
    <span class="md-ellipsis">
      run_dir
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.run_iterations" class="md-nav__link">
    <span class="md-ellipsis">
      run_iterations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.time_period_durations" class="md-nav__link">
    <span class="md-ellipsis">
      time_period_durations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.time_period_names" class="md-nav__link">
    <span class="md-ellipsis">
      time_period_names
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      __repr__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.component" class="md-nav__link">
    <span class="md-ellipsis">
      component
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.get_abs_path" class="md-nav__link">
    <span class="md-ellipsis">
      get_abs_path
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.run_next" class="md-nav__link">
    <span class="md-ellipsis">
      run_next
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config" class="md-nav__link">
    <span class="md-ellipsis">
      config
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.ActiveModeShortestPathSkimConfig" class="md-nav__link">
    <span class="md-ellipsis">
      ActiveModeShortestPathSkimConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.ActiveModesConfig" class="md-nav__link">
    <span class="md-ellipsis">
      ActiveModesConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.AirPassengerConfig" class="md-nav__link">
    <span class="md-ellipsis">
      AirPassengerConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AirPassengerConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.AirPassengerConfig.valid_input_demand_filename_tmpl" class="md-nav__link">
    <span class="md-ellipsis">
      valid_input_demand_filename_tmpl
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.AirPassengerDemandAggregationConfig" class="md-nav__link">
    <span class="md-ellipsis">
      AirPassengerDemandAggregationConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.AssignmentStoppingCriteriaConfig" class="md-nav__link">
    <span class="md-ellipsis">
      AssignmentStoppingCriteriaConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.CcrWeightsConfig" class="md-nav__link">
    <span class="md-ellipsis">
      CcrWeightsConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.ChoiceClassConfig" class="md-nav__link">
    <span class="md-ellipsis">
      ChoiceClassConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.ClassDemandConfig" class="md-nav__link">
    <span class="md-ellipsis">
      ClassDemandConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.CoefficientConfig" class="md-nav__link">
    <span class="md-ellipsis">
      CoefficientConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.ConfigItem" class="md-nav__link">
    <span class="md-ellipsis">
      ConfigItem
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ConfigItem">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.ConfigItem.__getitem__" class="md-nav__link">
    <span class="md-ellipsis">
      __getitem__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.ConfigItem.get" class="md-nav__link">
    <span class="md-ellipsis">
      get
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.ConfigItem.items" class="md-nav__link">
    <span class="md-ellipsis">
      items
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.Configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.Configuration.load_toml" class="md-nav__link">
    <span class="md-ellipsis">
      load_toml
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.Configuration.maz_skim_period_exists" class="md-nav__link">
    <span class="md-ellipsis">
      maz_skim_period_exists
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.Configuration.relative_gap_length" class="md-nav__link">
    <span class="md-ellipsis">
      relative_gap_length
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.Configuration.sample_rate_length" class="md-nav__link">
    <span class="md-ellipsis">
      sample_rate_length
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.Configuration.transit_stop_criteria_length" class="md-nav__link">
    <span class="md-ellipsis">
      transit_stop_criteria_length
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.CongestedAssnConfig" class="md-nav__link">
    <span class="md-ellipsis">
      CongestedAssnConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.CongestedTransitMaxIteration" class="md-nav__link">
    <span class="md-ellipsis">
      CongestedTransitMaxIteration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.CongestedTransitStopCriteria" class="md-nav__link">
    <span class="md-ellipsis">
      CongestedTransitStopCriteria
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.CongestedWeightsConfig" class="md-nav__link">
    <span class="md-ellipsis">
      CongestedWeightsConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.DemandCountyGroupConfig" class="md-nav__link">
    <span class="md-ellipsis">
      DemandCountyGroupConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.EawtWeightsConfig" class="md-nav__link">
    <span class="md-ellipsis">
      EawtWeightsConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.EmmeConfig" class="md-nav__link">
    <span class="md-ellipsis">
      EmmeConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.HighwayCapClassConfig" class="md-nav__link">
    <span class="md-ellipsis">
      HighwayCapClassConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.HighwayClassConfig" class="md-nav__link">
    <span class="md-ellipsis">
      HighwayClassConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig" class="md-nav__link">
    <span class="md-ellipsis">
      HighwayConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HighwayConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.unique_capclass_numbers" class="md-nav__link">
    <span class="md-ellipsis">
      unique_capclass_numbers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.unique_class_names" class="md-nav__link">
    <span class="md-ellipsis">
      unique_class_names
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.valid_skim_matrix_name_template" class="md-nav__link">
    <span class="md-ellipsis">
      valid_skim_matrix_name_template
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.valid_skim_template" class="md-nav__link">
    <span class="md-ellipsis">
      valid_skim_template
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.validate_class_keyword_lists" class="md-nav__link">
    <span class="md-ellipsis">
      validate_class_keyword_lists
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.validate_class_mode_excluded_links" class="md-nav__link">
    <span class="md-ellipsis">
      validate_class_mode_excluded_links
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.HighwayDistribution" class="md-nav__link">
    <span class="md-ellipsis">
      HighwayDistribution
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.HighwayMazToMazConfig" class="md-nav__link">
    <span class="md-ellipsis">
      HighwayMazToMazConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HighwayMazToMazConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayMazToMazConfig.unique_group_numbers" class="md-nav__link">
    <span class="md-ellipsis">
      unique_group_numbers
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.HighwayRelativeGapConfig" class="md-nav__link">
    <span class="md-ellipsis">
      HighwayRelativeGapConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.HighwayTollsConfig" class="md-nav__link">
    <span class="md-ellipsis">
      HighwayTollsConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HighwayTollsConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayTollsConfig.dst_vehicle_group_names_length" class="md-nav__link">
    <span class="md-ellipsis">
      dst_vehicle_group_names_length
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.HouseholdConfig" class="md-nav__link">
    <span class="md-ellipsis">
      HouseholdConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.HouseholdModeAgg" class="md-nav__link">
    <span class="md-ellipsis">
      HouseholdModeAgg
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.ImpedanceConfig" class="md-nav__link">
    <span class="md-ellipsis">
      ImpedanceConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ImpedanceConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.ImpedanceConfig.sums_to_one" class="md-nav__link">
    <span class="md-ellipsis">
      sums_to_one
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.InternalExternalConfig" class="md-nav__link">
    <span class="md-ellipsis">
      InternalExternalConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.LoggingConfig" class="md-nav__link">
    <span class="md-ellipsis">
      LoggingConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.ManualJourneyLevelsConfig" class="md-nav__link">
    <span class="md-ellipsis">
      ManualJourneyLevelsConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.MatrixFactorConfig" class="md-nav__link">
    <span class="md-ellipsis">
      MatrixFactorConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MatrixFactorConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.MatrixFactorConfig.valid_zone_index" class="md-nav__link">
    <span class="md-ellipsis">
      valid_zone_index
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.PostProcessorConfig" class="md-nav__link">
    <span class="md-ellipsis">
      PostProcessorConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.RunConfig" class="md-nav__link">
    <span class="md-ellipsis">
      RunConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RunConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.RunConfig.end_iteration_gt_start" class="md-nav__link">
    <span class="md-ellipsis">
      end_iteration_gt_start
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.RunConfig.start_component_used" class="md-nav__link">
    <span class="md-ellipsis">
      start_component_used
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.ScenarioConfig" class="md-nav__link">
    <span class="md-ellipsis">
      ScenarioConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TimeOfDayClassConfig" class="md-nav__link">
    <span class="md-ellipsis">
      TimeOfDayClassConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TimeOfDayConfig" class="md-nav__link">
    <span class="md-ellipsis">
      TimeOfDayConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TimePeriodConfig" class="md-nav__link">
    <span class="md-ellipsis">
      TimePeriodConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TimeSplitConfig" class="md-nav__link">
    <span class="md-ellipsis">
      TimeSplitConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TollChoiceConfig" class="md-nav__link">
    <span class="md-ellipsis">
      TollChoiceConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TransitClassConfig" class="md-nav__link">
    <span class="md-ellipsis">
      TransitClassConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TransitConfig" class="md-nav__link">
    <span class="md-ellipsis">
      TransitConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TransitJourneyLevelsConfig" class="md-nav__link">
    <span class="md-ellipsis">
      TransitJourneyLevelsConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TransitJourneyLevelsConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitJourneyLevelsConfig.manual" class="md-nav__link">
    <span class="md-ellipsis">
      manual
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitJourneyLevelsConfig.specify_manually" class="md-nav__link">
    <span class="md-ellipsis">
      specify_manually
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitJourneyLevelsConfig.use_algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      use_algorithm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitJourneyLevelsConfig.check_exclusivity" class="md-nav__link">
    <span class="md-ellipsis">
      check_exclusivity
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig" class="md-nav__link">
    <span class="md-ellipsis">
      TransitModeConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TransitModeConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.headway_fraction_valid" class="md-nav__link">
    <span class="md-ellipsis">
      headway_fraction_valid
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.in_vehicle_perception_factor_valid" class="md-nav__link">
    <span class="md-ellipsis">
      in_vehicle_perception_factor_valid
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.initial_boarding_penalty_valid" class="md-nav__link">
    <span class="md-ellipsis">
      initial_boarding_penalty_valid
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.mode_id_valid" class="md-nav__link">
    <span class="md-ellipsis">
      mode_id_valid
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.speed_or_time_factor_valid" class="md-nav__link">
    <span class="md-ellipsis">
      speed_or_time_factor_valid
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.transfer_boarding_penalty_valid" class="md-nav__link">
    <span class="md-ellipsis">
      transfer_boarding_penalty_valid
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.transfer_wait_perception_factor_valid" class="md-nav__link">
    <span class="md-ellipsis">
      transfer_wait_perception_factor_valid
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TransitVehicleConfig" class="md-nav__link">
    <span class="md-ellipsis">
      TransitVehicleConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TripDistributionClassConfig" class="md-nav__link">
    <span class="md-ellipsis">
      TripDistributionClassConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TripDistributionConfig" class="md-nav__link">
    <span class="md-ellipsis">
      TripDistributionConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TripGenerationClassConfig" class="md-nav__link">
    <span class="md-ellipsis">
      TripGenerationClassConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TripGenerationConfig" class="md-nav__link">
    <span class="md-ellipsis">
      TripGenerationConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TripGenerationFormulaConfig" class="md-nav__link">
    <span class="md-ellipsis">
      TripGenerationFormulaConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TruckClassConfig" class="md-nav__link">
    <span class="md-ellipsis">
      TruckClassConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TruckConfig" class="md-nav__link">
    <span class="md-ellipsis">
      TruckConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TruckConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TruckConfig.highway_demand_file" class="md-nav__link">
    <span class="md-ellipsis">
      highway_demand_file
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.WarmStartConfig" class="md-nav__link">
    <span class="md-ellipsis">
      WarmStartConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="WarmStartConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.WarmStartConfig.check_warmstart_method" class="md-nav__link">
    <span class="md-ellipsis">
      check_warmstart_method
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#components" class="md-nav__link">
    <span class="md-ellipsis">
      Components
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#base-component" class="md-nav__link">
    <span class="md-ellipsis">
      Base Component
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.component" class="md-nav__link">
    <span class="md-ellipsis">
      component
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.component.Component" class="md-nav__link">
    <span class="md-ellipsis">
      Component
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Component">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.congested_transit_assn_max_iteration" class="md-nav__link">
    <span class="md-ellipsis">
      congested_transit_assn_max_iteration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.controller" class="md-nav__link">
    <span class="md-ellipsis">
      controller
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.logger" class="md-nav__link">
    <span class="md-ellipsis">
      logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.time_period_durations" class="md-nav__link">
    <span class="md-ellipsis">
      time_period_durations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.time_period_names" class="md-nav__link">
    <span class="md-ellipsis">
      time_period_names
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.top_sheet" class="md-nav__link">
    <span class="md-ellipsis">
      top_sheet
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.trace" class="md-nav__link">
    <span class="md-ellipsis">
      trace
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.get_abs_path" class="md-nav__link">
    <span class="md-ellipsis">
      get_abs_path
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.report_progress" class="md-nav__link">
    <span class="md-ellipsis">
      report_progress
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.validate_inputs" class="md-nav__link">
    <span class="md-ellipsis">
      validate_inputs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.verify" class="md-nav__link">
    <span class="md-ellipsis">
      verify
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.write_top_sheet" class="md-nav__link">
    <span class="md-ellipsis">
      write_top_sheet
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.component.FileFormatError" class="md-nav__link">
    <span class="md-ellipsis">
      FileFormatError
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FileFormatError">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.FileFormatError.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.FileFormatError.__str__" class="md-nav__link">
    <span class="md-ellipsis">
      __str__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.component.Subcomponent" class="md-nav__link">
    <span class="md-ellipsis">
      Subcomponent
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Subcomponent">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Subcomponent.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Subcomponent.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#demand-components" class="md-nav__link">
    <span class="md-ellipsis">
      Demand Components
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.demand.prepare_demand" class="md-nav__link">
    <span class="md-ellipsis">
      prepare_demand
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.demand.prepare_demand.EmmeDemand" class="md-nav__link">
    <span class="md-ellipsis">
      EmmeDemand
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EmmeDemand">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.prepare_demand.EmmeDemand.logger" class="md-nav__link">
    <span class="md-ellipsis">
      logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.prepare_demand.EmmeDemand.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.demand.prepare_demand.PrepareHighwayDemand" class="md-nav__link">
    <span class="md-ellipsis">
      PrepareHighwayDemand
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PrepareHighwayDemand">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.prepare_demand.PrepareHighwayDemand.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.prepare_demand.PrepareHighwayDemand.prepare_household_demand" class="md-nav__link">
    <span class="md-ellipsis">
      prepare_household_demand
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.prepare_demand.PrepareHighwayDemand.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.demand.prepare_demand.PrepareTransitDemand" class="md-nav__link">
    <span class="md-ellipsis">
      PrepareTransitDemand
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PrepareTransitDemand">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.prepare_demand.PrepareTransitDemand.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.prepare_demand.PrepareTransitDemand.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.prepare_demand.PrepareTransitDemand.validate_inputs" class="md-nav__link">
    <span class="md-ellipsis">
      validate_inputs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.demand.prepare_demand.avg_matrix_msa" class="md-nav__link">
    <span class="md-ellipsis">
      avg_matrix_msa
    </span>
  </a>
  
    <nav class="md-nav" aria-label="avg_matrix_msa">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#household-demand" class="md-nav__link">
    <span class="md-ellipsis">
      Household Demand
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.demand.household" class="md-nav__link">
    <span class="md-ellipsis">
      household
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.demand.household.HouseholdModel" class="md-nav__link">
    <span class="md-ellipsis">
      HouseholdModel
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HouseholdModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.household.HouseholdModel.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.household.HouseholdModel.validate_inputs" class="md-nav__link">
    <span class="md-ellipsis">
      validate_inputs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.HouseholdConfig" class="md-nav__link">
    <span class="md-ellipsis">
      HouseholdConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HouseholdConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#air-passenger-demand" class="md-nav__link">
    <span class="md-ellipsis">
      Air Passenger Demand
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.demand.air_passenger" class="md-nav__link">
    <span class="md-ellipsis">
      air_passenger
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.demand.air_passenger.AirPassenger" class="md-nav__link">
    <span class="md-ellipsis">
      AirPassenger
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AirPassenger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.air_passenger.AirPassenger.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.air_passenger.AirPassenger.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.air_passenger.AirPassenger.validate_inputs" class="md-nav__link">
    <span class="md-ellipsis">
      validate_inputs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.AirPassengerDemandAggregationConfig" class="md-nav__link">
    <span class="md-ellipsis">
      AirPassengerDemandAggregationConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AirPassengerDemandAggregationConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#commercial-demand" class="md-nav__link">
    <span class="md-ellipsis">
      Commercial Demand
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial" class="md-nav__link">
    <span class="md-ellipsis">
      commercial
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleModel" class="md-nav__link">
    <span class="md-ellipsis">
      CommercialVehicleModel
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CommercialVehicleModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleModel.emme_scenario" class="md-nav__link">
    <span class="md-ellipsis">
      emme_scenario
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleModel.emmebank" class="md-nav__link">
    <span class="md-ellipsis">
      emmebank
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleModel.matrix_cache" class="md-nav__link">
    <span class="md-ellipsis">
      matrix_cache
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleModel.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleModel.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleModel.validate_inputs" class="md-nav__link">
    <span class="md-ellipsis">
      validate_inputs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTimeOfDay" class="md-nav__link">
    <span class="md-ellipsis">
      CommercialVehicleTimeOfDay
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CommercialVehicleTimeOfDay">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTimeOfDay.class_period_splits" class="md-nav__link">
    <span class="md-ellipsis">
      class_period_splits
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTimeOfDay.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTimeOfDay.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
    <nav class="md-nav" aria-label="run">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTimeOfDay.run--todo-use-timeperiodsplit" class="md-nav__link">
    <span class="md-ellipsis">
      TODO use TimePeriodSplit
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTimeOfDay.validate_inputs" class="md-nav__link">
    <span class="md-ellipsis">
      validate_inputs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTollChoice" class="md-nav__link">
    <span class="md-ellipsis">
      CommercialVehicleTollChoice
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CommercialVehicleTollChoice">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTollChoice.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTollChoice.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTollChoice.validate_inputs" class="md-nav__link">
    <span class="md-ellipsis">
      validate_inputs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripDistribution" class="md-nav__link">
    <span class="md-ellipsis">
      CommercialVehicleTripDistribution
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CommercialVehicleTripDistribution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripDistribution.friction_factors" class="md-nav__link">
    <span class="md-ellipsis">
      friction_factors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripDistribution.k_factors" class="md-nav__link">
    <span class="md-ellipsis">
      k_factors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripDistribution.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripDistribution.blended_skims" class="md-nav__link">
    <span class="md-ellipsis">
      blended_skims
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripDistribution.friction_factor_matrices" class="md-nav__link">
    <span class="md-ellipsis">
      friction_factor_matrices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripDistribution.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripDistribution.validate_inputs" class="md-nav__link">
    <span class="md-ellipsis">
      validate_inputs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripGeneration" class="md-nav__link">
    <span class="md-ellipsis">
      CommercialVehicleTripGeneration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CommercialVehicleTripGeneration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripGeneration--trip-generation" class="md-nav__link">
    <span class="md-ellipsis">
      Trip generation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripGeneration.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripGeneration.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripGeneration.validate_inputs" class="md-nav__link">
    <span class="md-ellipsis">
      validate_inputs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TruckConfig" class="md-nav__link">
    <span class="md-ellipsis">
      TruckConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TruckConfig.highway_demand_file" class="md-nav__link">
    <span class="md-ellipsis">
      highway_demand_file
    </span>
  </a>
  
    <nav class="md-nav" aria-label="highway_demand_file">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inter-regional-demand" class="md-nav__link">
    <span class="md-ellipsis">
      Inter-regional Demand
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.demand.internal_external" class="md-nav__link">
    <span class="md-ellipsis">
      internal_external
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.demand.internal_external.ExternalDemand" class="md-nav__link">
    <span class="md-ellipsis">
      ExternalDemand
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ExternalDemand">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.internal_external.ExternalDemand.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.demand.internal_external.ExternalTollChoice" class="md-nav__link">
    <span class="md-ellipsis">
      ExternalTollChoice
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ExternalTollChoice">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.internal_external.ExternalTollChoice--toll-choice" class="md-nav__link">
    <span class="md-ellipsis">
      Toll choice
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.internal_external.ExternalTollChoice.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.demand.internal_external.InternalExternal" class="md-nav__link">
    <span class="md-ellipsis">
      InternalExternal
    </span>
  </a>
  
    <nav class="md-nav" aria-label="InternalExternal">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.internal_external.InternalExternal.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.internal_external.InternalExternal.validate_inputs" class="md-nav__link">
    <span class="md-ellipsis">
      validate_inputs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.InternalExternalConfig" class="md-nav__link">
    <span class="md-ellipsis">
      InternalExternalConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="InternalExternalConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#visitor-demand" class="md-nav__link">
    <span class="md-ellipsis">
      Visitor Demand
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.demand.visitor" class="md-nav__link">
    <span class="md-ellipsis">
      visitor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="visitor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#highway-network-components" class="md-nav__link">
    <span class="md-ellipsis">
      Highway Network Components
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_network" class="md-nav__link">
    <span class="md-ellipsis">
      highway_network
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_network.PrepareNetwork" class="md-nav__link">
    <span class="md-ellipsis">
      PrepareNetwork
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PrepareNetwork">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_network.PrepareNetwork.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_network.PrepareNetwork.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_network.PrepareNetwork.validate_inputs" class="md-nav__link">
    <span class="md-ellipsis">
      validate_inputs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign" class="md-nav__link">
    <span class="md-ellipsis">
      highway_assign
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.AssignmentLauncher" class="md-nav__link">
    <span class="md-ellipsis">
      AssignmentLauncher
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.AssignmentRunner" class="md-nav__link">
    <span class="md-ellipsis">
      AssignmentRunner
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AssignmentRunner">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.AssignmentRunner.assign_spec_no_analysis" class="md-nav__link">
    <span class="md-ellipsis">
      assign_spec_no_analysis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.AssignmentRunner.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.AssignmentRunner.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.HighwayAssignment" class="md-nav__link">
    <span class="md-ellipsis">
      HighwayAssignment
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HighwayAssignment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.HighwayAssignment.class_config" class="md-nav__link">
    <span class="md-ellipsis">
      class_config
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.HighwayAssignment.classes" class="md-nav__link">
    <span class="md-ellipsis">
      classes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.HighwayAssignment.highway_emmebank" class="md-nav__link">
    <span class="md-ellipsis">
      highway_emmebank
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.HighwayAssignment.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.HighwayAssignment.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.HighwayAssignment.run_in_process" class="md-nav__link">
    <span class="md-ellipsis">
      run_in_process
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.HighwayAssignment.setup_process_launchers" class="md-nav__link">
    <span class="md-ellipsis">
      setup_process_launchers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.HighwayAssignment.start_proccesses" class="md-nav__link">
    <span class="md-ellipsis">
      start_proccesses
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.HighwayAssignment.validate_inputs" class="md-nav__link">
    <span class="md-ellipsis">
      validate_inputs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig" class="md-nav__link">
    <span class="md-ellipsis">
      HighwayConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.unique_capclass_numbers" class="md-nav__link">
    <span class="md-ellipsis">
      unique_capclass_numbers
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.unique_class_names" class="md-nav__link">
    <span class="md-ellipsis">
      unique_class_names
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.valid_skim_matrix_name_template" class="md-nav__link">
    <span class="md-ellipsis">
      valid_skim_matrix_name_template
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.valid_skim_template" class="md-nav__link">
    <span class="md-ellipsis">
      valid_skim_template
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.validate_class_keyword_lists" class="md-nav__link">
    <span class="md-ellipsis">
      validate_class_keyword_lists
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.validate_class_mode_excluded_links" class="md-nav__link">
    <span class="md-ellipsis">
      validate_class_mode_excluded_links
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.HighwayClassConfig" class="md-nav__link">
    <span class="md-ellipsis">
      HighwayClassConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.HighwayTollsConfig" class="md-nav__link">
    <span class="md-ellipsis">
      HighwayTollsConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.HighwayTollsConfig.dst_vehicle_group_names_length" class="md-nav__link">
    <span class="md-ellipsis">
      dst_vehicle_group_names_length
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.DemandCountyGroupConfig" class="md-nav__link">
    <span class="md-ellipsis">
      DemandCountyGroupConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_maz" class="md-nav__link">
    <span class="md-ellipsis">
      highway_maz
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_maz.AssignMAZSPDemand" class="md-nav__link">
    <span class="md-ellipsis">
      AssignMAZSPDemand
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AssignMAZSPDemand">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_maz.AssignMAZSPDemand.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_maz.AssignMAZSPDemand.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_maz.AssignMAZSPDemand.validate_inputs" class="md-nav__link">
    <span class="md-ellipsis">
      validate_inputs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_maz.SkimMAZCosts" class="md-nav__link">
    <span class="md-ellipsis">
      SkimMAZCosts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SkimMAZCosts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_maz.SkimMAZCosts.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_maz.SkimMAZCosts.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_maz.SkimMAZCosts.validate_inputs" class="md-nav__link">
    <span class="md-ellipsis">
      validate_inputs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.HighwayMazToMazConfig" class="md-nav__link">
    <span class="md-ellipsis">
      HighwayMazToMazConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.HighwayMazToMazConfig.unique_group_numbers" class="md-nav__link">
    <span class="md-ellipsis">
      unique_group_numbers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="unique_group_numbers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#transit-network-components" class="md-nav__link">
    <span class="md-ellipsis">
      Transit Network Components
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_assign" class="md-nav__link">
    <span class="md-ellipsis">
      transit_assign
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_assign.TransitAssignment" class="md-nav__link">
    <span class="md-ellipsis">
      TransitAssignment
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TransitAssignment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_assign.TransitAssignment.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_assign.TransitAssignment.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_assign.TransitAssignment.validate_inputs" class="md-nav__link">
    <span class="md-ellipsis">
      validate_inputs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_assign.TransitAssignmentClass" class="md-nav__link">
    <span class="md-ellipsis">
      TransitAssignmentClass
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TransitAssignmentClass">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_assign.TransitAssignmentClass.emme_transit_spec" class="md-nav__link">
    <span class="md-ellipsis">
      emme_transit_spec
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_assign.TransitAssignmentClass.name" class="md-nav__link">
    <span class="md-ellipsis">
      name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_assign.TransitAssignmentClass.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_assign.calc_adjusted_headway" class="md-nav__link">
    <span class="md-ellipsis">
      calc_adjusted_headway
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_assign.calc_extra_wait_time" class="md-nav__link">
    <span class="md-ellipsis">
      calc_extra_wait_time
    </span>
  </a>
  
    <nav class="md-nav" aria-label="calc_extra_wait_time">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_assign.calc_extra_wait_time--todo-document-fully" class="md-nav__link">
    <span class="md-ellipsis">
      TODO document fully.
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_assign.calc_offs_thru_segment" class="md-nav__link">
    <span class="md-ellipsis">
      calc_offs_thru_segment
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_assign.calc_total_offs" class="md-nav__link">
    <span class="md-ellipsis">
      calc_total_offs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_assign.func_returns_calc_updated_perceived_headway" class="md-nav__link">
    <span class="md-ellipsis">
      func_returns_calc_updated_perceived_headway
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_assign.func_returns_crowded_segment_cost" class="md-nav__link">
    <span class="md-ellipsis">
      func_returns_crowded_segment_cost
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_assign.func_returns_segment_congestion" class="md-nav__link">
    <span class="md-ellipsis">
      func_returns_segment_congestion
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_assign.time_period_capacity" class="md-nav__link">
    <span class="md-ellipsis">
      time_period_capacity
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_skim" class="md-nav__link">
    <span class="md-ellipsis">
      transit_skim
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_skim.TransitSkim" class="md-nav__link">
    <span class="md-ellipsis">
      TransitSkim
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TransitSkim">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_skim.TransitSkim.skim_outputs" class="md-nav__link">
    <span class="md-ellipsis">
      skim_outputs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_skim.TransitSkim.skim_properties" class="md-nav__link">
    <span class="md-ellipsis">
      skim_properties
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_skim.TransitSkim.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_skim.TransitSkim.emmebank_skim_matrices" class="md-nav__link">
    <span class="md-ellipsis">
      emmebank_skim_matrices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_skim.TransitSkim.mask_above_max_transfers" class="md-nav__link">
    <span class="md-ellipsis">
      mask_above_max_transfers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_skim.TransitSkim.mask_if_not_required_modes" class="md-nav__link">
    <span class="md-ellipsis">
      mask_if_not_required_modes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_skim.TransitSkim.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_skim.TransitSkim.run_skim_set" class="md-nav__link">
    <span class="md-ellipsis">
      run_skim_set
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_skim.TransitSkim.skim_crowding" class="md-nav__link">
    <span class="md-ellipsis">
      skim_crowding
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_skim.TransitSkim.skim_drive_walk" class="md-nav__link">
    <span class="md-ellipsis">
      skim_drive_walk
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_skim.TransitSkim.skim_invehicle_time_by_mode" class="md-nav__link">
    <span class="md-ellipsis">
      skim_invehicle_time_by_mode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_skim.TransitSkim.skim_penalty_toll" class="md-nav__link">
    <span class="md-ellipsis">
      skim_penalty_toll
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_skim.TransitSkim.skim_reliability_crowding_capacity" class="md-nav__link">
    <span class="md-ellipsis">
      skim_reliability_crowding_capacity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_skim.TransitSkim.skim_walk_wait_boards_fares" class="md-nav__link">
    <span class="md-ellipsis">
      skim_walk_wait_boards_fares
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_skim.TransitSkim.validate_inputs" class="md-nav__link">
    <span class="md-ellipsis">
      validate_inputs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig" class="md-nav__link">
    <span class="md-ellipsis">
      TransitModeConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.headway_fraction_valid" class="md-nav__link">
    <span class="md-ellipsis">
      headway_fraction_valid
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.in_vehicle_perception_factor_valid" class="md-nav__link">
    <span class="md-ellipsis">
      in_vehicle_perception_factor_valid
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.initial_boarding_penalty_valid" class="md-nav__link">
    <span class="md-ellipsis">
      initial_boarding_penalty_valid
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.mode_id_valid" class="md-nav__link">
    <span class="md-ellipsis">
      mode_id_valid
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.speed_or_time_factor_valid" class="md-nav__link">
    <span class="md-ellipsis">
      speed_or_time_factor_valid
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.transfer_boarding_penalty_valid" class="md-nav__link">
    <span class="md-ellipsis">
      transfer_boarding_penalty_valid
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.transfer_wait_perception_factor_valid" class="md-nav__link">
    <span class="md-ellipsis">
      transfer_wait_perception_factor_valid
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TransitConfig" class="md-nav__link">
    <span class="md-ellipsis">
      TransitConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TransitConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#active-network-components" class="md-nav__link">
    <span class="md-ellipsis">
      Active Network Components
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#emme-wrappers" class="md-nav__link">
    <span class="md-ellipsis">
      Emme Wrappers
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.emme" class="md-nav__link">
    <span class="md-ellipsis">
      emme
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.EmmeConfig" class="md-nav__link">
    <span class="md-ellipsis">
      EmmeConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#errata" class="md-nav__link">
    <span class="md-ellipsis">
      Errata
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.logger" class="md-nav__link">
    <span class="md-ellipsis">
      logger
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.logger.BaseLogger" class="md-nav__link">
    <span class="md-ellipsis">
      BaseLogger
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BaseLogger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.BaseLogger.debug_enabled" class="md-nav__link">
    <span class="md-ellipsis">
      debug_enabled
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.BaseLogger.trace_enabled" class="md-nav__link">
    <span class="md-ellipsis">
      trace_enabled
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.BaseLogger.__del__" class="md-nav__link">
    <span class="md-ellipsis">
      __del__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.BaseLogger.clear_msg_cache" class="md-nav__link">
    <span class="md-ellipsis">
      clear_msg_cache
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.BaseLogger.debug" class="md-nav__link">
    <span class="md-ellipsis">
      debug
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.BaseLogger.detail" class="md-nav__link">
    <span class="md-ellipsis">
      detail
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.BaseLogger.error" class="md-nav__link">
    <span class="md-ellipsis">
      error
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.BaseLogger.fatal" class="md-nav__link">
    <span class="md-ellipsis">
      fatal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.BaseLogger.info" class="md-nav__link">
    <span class="md-ellipsis">
      info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.BaseLogger.log" class="md-nav__link">
    <span class="md-ellipsis">
      log
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.BaseLogger.log_dict" class="md-nav__link">
    <span class="md-ellipsis">
      log_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.BaseLogger.log_start_end" class="md-nav__link">
    <span class="md-ellipsis">
      log_start_end
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.BaseLogger.log_time" class="md-nav__link">
    <span class="md-ellipsis">
      log_time
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.BaseLogger.status" class="md-nav__link">
    <span class="md-ellipsis">
      status
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.BaseLogger.trace" class="md-nav__link">
    <span class="md-ellipsis">
      trace
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.BaseLogger.warn" class="md-nav__link">
    <span class="md-ellipsis">
      warn
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.logger.LogCache" class="md-nav__link">
    <span class="md-ellipsis">
      LogCache
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LogCache">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogCache.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogCache.clear" class="md-nav__link">
    <span class="md-ellipsis">
      clear
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogCache.log" class="md-nav__link">
    <span class="md-ellipsis">
      log
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogCache.open" class="md-nav__link">
    <span class="md-ellipsis">
      open
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogCache.write_cache" class="md-nav__link">
    <span class="md-ellipsis">
      write_cache
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.logger.LogDisplay" class="md-nav__link">
    <span class="md-ellipsis">
      LogDisplay
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LogDisplay">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogDisplay.log" class="md-nav__link">
    <span class="md-ellipsis">
      log
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.logger.LogFile" class="md-nav__link">
    <span class="md-ellipsis">
      LogFile
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LogFile">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFile.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFile.close" class="md-nav__link">
    <span class="md-ellipsis">
      close
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFile.log" class="md-nav__link">
    <span class="md-ellipsis">
      log
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFile.open" class="md-nav__link">
    <span class="md-ellipsis">
      open
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.logger.LogFileLevelOverride" class="md-nav__link">
    <span class="md-ellipsis">
      LogFileLevelOverride
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LogFileLevelOverride">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFileLevelOverride.level" class="md-nav__link">
    <span class="md-ellipsis">
      level
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFileLevelOverride.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.logger.LogFormatter" class="md-nav__link">
    <span class="md-ellipsis">
      LogFormatter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LogFormatter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFormatter.level" class="md-nav__link">
    <span class="md-ellipsis">
      level
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFormatter.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFormatter.decrease_indent" class="md-nav__link">
    <span class="md-ellipsis">
      decrease_indent
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFormatter.increase_indent" class="md-nav__link">
    <span class="md-ellipsis">
      increase_indent
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFormatter.log" class="md-nav__link">
    <span class="md-ellipsis">
      log
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.logger.LogStartEnd" class="md-nav__link">
    <span class="md-ellipsis">
      LogStartEnd
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LogStartEnd">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogStartEnd.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogStartEnd.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.logger.Logger" class="md-nav__link">
    <span class="md-ellipsis">
      Logger
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Logger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.__new__" class="md-nav__link">
    <span class="md-ellipsis">
      __new__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.get_logger" class="md-nav__link">
    <span class="md-ellipsis">
      get_logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.notify_slack" class="md-nav__link">
    <span class="md-ellipsis">
      notify_slack
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.logger.ProcessLogger" class="md-nav__link">
    <span class="md-ellipsis">
      ProcessLogger
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ProcessLogger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.ProcessLogger.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.logger.SlackNotifier" class="md-nav__link">
    <span class="md-ellipsis">
      SlackNotifier
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SlackNotifier">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.SlackNotifier.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.SlackNotifier.post_message" class="md-nav__link">
    <span class="md-ellipsis">
      post_message
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.tools" class="md-nav__link">
    <span class="md-ellipsis">
      tools
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.tools.SpatialGridIndex" class="md-nav__link">
    <span class="md-ellipsis">
      SpatialGridIndex
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SpatialGridIndex">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.tools.SpatialGridIndex.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.tools.SpatialGridIndex.insert" class="md-nav__link">
    <span class="md-ellipsis">
      insert
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.tools.SpatialGridIndex.nearest" class="md-nav__link">
    <span class="md-ellipsis">
      nearest
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.tools.SpatialGridIndex.within_distance" class="md-nav__link">
    <span class="md-ellipsis">
      within_distance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.tools.SpatialGridIndex.within_square" class="md-nav__link">
    <span class="md-ellipsis">
      within_square
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.tools.download_unzip" class="md-nav__link">
    <span class="md-ellipsis">
      download_unzip
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.tools.emme_context" class="md-nav__link">
    <span class="md-ellipsis">
      emme_context
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.tools.interpolate_dfs" class="md-nav__link">
    <span class="md-ellipsis">
      interpolate_dfs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.tools.mocked_inro_context" class="md-nav__link">
    <span class="md-ellipsis">
      mocked_inro_context
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.tools.run_process" class="md-nav__link">
    <span class="md-ellipsis">
      run_process
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.tools.temp_file" class="md-nav__link">
    <span class="md-ellipsis">
      temp_file
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.tools.zonal_csv_to_matrices" class="md-nav__link">
    <span class="md-ellipsis">
      zonal_csv_to_matrices
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.examples" class="md-nav__link">
    <span class="md-ellipsis">
      examples
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.examples.get_example" class="md-nav__link">
    <span class="md-ellipsis">
      get_example
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Input & Output
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Input & Output
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../inputs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Input
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../outputs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Output
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Contributing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/development/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Development
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/documentation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Documentation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#setting-up-the-model-to-run" class="md-nav__link">
    <span class="md-ellipsis">
      Setting up the model to run
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.SetupModel" class="md-nav__link">
    <span class="md-ellipsis">
      SetupModel
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.SetupModel.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.SetupModel.run_setup" class="md-nav__link">
    <span class="md-ellipsis">
      run_setup
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#controller" class="md-nav__link">
    <span class="md-ellipsis">
      Controller
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.controller" class="md-nav__link">
    <span class="md-ellipsis">
      controller
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.controller.RunController" class="md-nav__link">
    <span class="md-ellipsis">
      RunController
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RunController">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.component_name" class="md-nav__link">
    <span class="md-ellipsis">
      component_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.congested_transit_assn_max_iteration" class="md-nav__link">
    <span class="md-ellipsis">
      congested_transit_assn_max_iteration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.emme_manager" class="md-nav__link">
    <span class="md-ellipsis">
      emme_manager
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.iter_component" class="md-nav__link">
    <span class="md-ellipsis">
      iter_component
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.iteration" class="md-nav__link">
    <span class="md-ellipsis">
      iteration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.run_dir" class="md-nav__link">
    <span class="md-ellipsis">
      run_dir
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.run_iterations" class="md-nav__link">
    <span class="md-ellipsis">
      run_iterations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.time_period_durations" class="md-nav__link">
    <span class="md-ellipsis">
      time_period_durations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.time_period_names" class="md-nav__link">
    <span class="md-ellipsis">
      time_period_names
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      __repr__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.component" class="md-nav__link">
    <span class="md-ellipsis">
      component
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.get_abs_path" class="md-nav__link">
    <span class="md-ellipsis">
      get_abs_path
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.run_next" class="md-nav__link">
    <span class="md-ellipsis">
      run_next
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config" class="md-nav__link">
    <span class="md-ellipsis">
      config
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.ActiveModeShortestPathSkimConfig" class="md-nav__link">
    <span class="md-ellipsis">
      ActiveModeShortestPathSkimConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.ActiveModesConfig" class="md-nav__link">
    <span class="md-ellipsis">
      ActiveModesConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.AirPassengerConfig" class="md-nav__link">
    <span class="md-ellipsis">
      AirPassengerConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AirPassengerConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.AirPassengerConfig.valid_input_demand_filename_tmpl" class="md-nav__link">
    <span class="md-ellipsis">
      valid_input_demand_filename_tmpl
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.AirPassengerDemandAggregationConfig" class="md-nav__link">
    <span class="md-ellipsis">
      AirPassengerDemandAggregationConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.AssignmentStoppingCriteriaConfig" class="md-nav__link">
    <span class="md-ellipsis">
      AssignmentStoppingCriteriaConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.CcrWeightsConfig" class="md-nav__link">
    <span class="md-ellipsis">
      CcrWeightsConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.ChoiceClassConfig" class="md-nav__link">
    <span class="md-ellipsis">
      ChoiceClassConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.ClassDemandConfig" class="md-nav__link">
    <span class="md-ellipsis">
      ClassDemandConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.CoefficientConfig" class="md-nav__link">
    <span class="md-ellipsis">
      CoefficientConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.ConfigItem" class="md-nav__link">
    <span class="md-ellipsis">
      ConfigItem
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ConfigItem">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.ConfigItem.__getitem__" class="md-nav__link">
    <span class="md-ellipsis">
      __getitem__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.ConfigItem.get" class="md-nav__link">
    <span class="md-ellipsis">
      get
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.ConfigItem.items" class="md-nav__link">
    <span class="md-ellipsis">
      items
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.Configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.Configuration.load_toml" class="md-nav__link">
    <span class="md-ellipsis">
      load_toml
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.Configuration.maz_skim_period_exists" class="md-nav__link">
    <span class="md-ellipsis">
      maz_skim_period_exists
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.Configuration.relative_gap_length" class="md-nav__link">
    <span class="md-ellipsis">
      relative_gap_length
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.Configuration.sample_rate_length" class="md-nav__link">
    <span class="md-ellipsis">
      sample_rate_length
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.Configuration.transit_stop_criteria_length" class="md-nav__link">
    <span class="md-ellipsis">
      transit_stop_criteria_length
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.CongestedAssnConfig" class="md-nav__link">
    <span class="md-ellipsis">
      CongestedAssnConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.CongestedTransitMaxIteration" class="md-nav__link">
    <span class="md-ellipsis">
      CongestedTransitMaxIteration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.CongestedTransitStopCriteria" class="md-nav__link">
    <span class="md-ellipsis">
      CongestedTransitStopCriteria
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.CongestedWeightsConfig" class="md-nav__link">
    <span class="md-ellipsis">
      CongestedWeightsConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.DemandCountyGroupConfig" class="md-nav__link">
    <span class="md-ellipsis">
      DemandCountyGroupConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.EawtWeightsConfig" class="md-nav__link">
    <span class="md-ellipsis">
      EawtWeightsConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.EmmeConfig" class="md-nav__link">
    <span class="md-ellipsis">
      EmmeConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.HighwayCapClassConfig" class="md-nav__link">
    <span class="md-ellipsis">
      HighwayCapClassConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.HighwayClassConfig" class="md-nav__link">
    <span class="md-ellipsis">
      HighwayClassConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig" class="md-nav__link">
    <span class="md-ellipsis">
      HighwayConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HighwayConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.unique_capclass_numbers" class="md-nav__link">
    <span class="md-ellipsis">
      unique_capclass_numbers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.unique_class_names" class="md-nav__link">
    <span class="md-ellipsis">
      unique_class_names
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.valid_skim_matrix_name_template" class="md-nav__link">
    <span class="md-ellipsis">
      valid_skim_matrix_name_template
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.valid_skim_template" class="md-nav__link">
    <span class="md-ellipsis">
      valid_skim_template
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.validate_class_keyword_lists" class="md-nav__link">
    <span class="md-ellipsis">
      validate_class_keyword_lists
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.validate_class_mode_excluded_links" class="md-nav__link">
    <span class="md-ellipsis">
      validate_class_mode_excluded_links
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.HighwayDistribution" class="md-nav__link">
    <span class="md-ellipsis">
      HighwayDistribution
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.HighwayMazToMazConfig" class="md-nav__link">
    <span class="md-ellipsis">
      HighwayMazToMazConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HighwayMazToMazConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayMazToMazConfig.unique_group_numbers" class="md-nav__link">
    <span class="md-ellipsis">
      unique_group_numbers
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.HighwayRelativeGapConfig" class="md-nav__link">
    <span class="md-ellipsis">
      HighwayRelativeGapConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.HighwayTollsConfig" class="md-nav__link">
    <span class="md-ellipsis">
      HighwayTollsConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HighwayTollsConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayTollsConfig.dst_vehicle_group_names_length" class="md-nav__link">
    <span class="md-ellipsis">
      dst_vehicle_group_names_length
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.HouseholdConfig" class="md-nav__link">
    <span class="md-ellipsis">
      HouseholdConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.HouseholdModeAgg" class="md-nav__link">
    <span class="md-ellipsis">
      HouseholdModeAgg
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.ImpedanceConfig" class="md-nav__link">
    <span class="md-ellipsis">
      ImpedanceConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ImpedanceConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.ImpedanceConfig.sums_to_one" class="md-nav__link">
    <span class="md-ellipsis">
      sums_to_one
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.InternalExternalConfig" class="md-nav__link">
    <span class="md-ellipsis">
      InternalExternalConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.LoggingConfig" class="md-nav__link">
    <span class="md-ellipsis">
      LoggingConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.ManualJourneyLevelsConfig" class="md-nav__link">
    <span class="md-ellipsis">
      ManualJourneyLevelsConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.MatrixFactorConfig" class="md-nav__link">
    <span class="md-ellipsis">
      MatrixFactorConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MatrixFactorConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.MatrixFactorConfig.valid_zone_index" class="md-nav__link">
    <span class="md-ellipsis">
      valid_zone_index
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.PostProcessorConfig" class="md-nav__link">
    <span class="md-ellipsis">
      PostProcessorConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.RunConfig" class="md-nav__link">
    <span class="md-ellipsis">
      RunConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RunConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.RunConfig.end_iteration_gt_start" class="md-nav__link">
    <span class="md-ellipsis">
      end_iteration_gt_start
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.RunConfig.start_component_used" class="md-nav__link">
    <span class="md-ellipsis">
      start_component_used
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.ScenarioConfig" class="md-nav__link">
    <span class="md-ellipsis">
      ScenarioConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TimeOfDayClassConfig" class="md-nav__link">
    <span class="md-ellipsis">
      TimeOfDayClassConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TimeOfDayConfig" class="md-nav__link">
    <span class="md-ellipsis">
      TimeOfDayConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TimePeriodConfig" class="md-nav__link">
    <span class="md-ellipsis">
      TimePeriodConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TimeSplitConfig" class="md-nav__link">
    <span class="md-ellipsis">
      TimeSplitConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TollChoiceConfig" class="md-nav__link">
    <span class="md-ellipsis">
      TollChoiceConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TransitClassConfig" class="md-nav__link">
    <span class="md-ellipsis">
      TransitClassConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TransitConfig" class="md-nav__link">
    <span class="md-ellipsis">
      TransitConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TransitJourneyLevelsConfig" class="md-nav__link">
    <span class="md-ellipsis">
      TransitJourneyLevelsConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TransitJourneyLevelsConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitJourneyLevelsConfig.manual" class="md-nav__link">
    <span class="md-ellipsis">
      manual
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitJourneyLevelsConfig.specify_manually" class="md-nav__link">
    <span class="md-ellipsis">
      specify_manually
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitJourneyLevelsConfig.use_algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      use_algorithm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitJourneyLevelsConfig.check_exclusivity" class="md-nav__link">
    <span class="md-ellipsis">
      check_exclusivity
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig" class="md-nav__link">
    <span class="md-ellipsis">
      TransitModeConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TransitModeConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.headway_fraction_valid" class="md-nav__link">
    <span class="md-ellipsis">
      headway_fraction_valid
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.in_vehicle_perception_factor_valid" class="md-nav__link">
    <span class="md-ellipsis">
      in_vehicle_perception_factor_valid
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.initial_boarding_penalty_valid" class="md-nav__link">
    <span class="md-ellipsis">
      initial_boarding_penalty_valid
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.mode_id_valid" class="md-nav__link">
    <span class="md-ellipsis">
      mode_id_valid
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.speed_or_time_factor_valid" class="md-nav__link">
    <span class="md-ellipsis">
      speed_or_time_factor_valid
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.transfer_boarding_penalty_valid" class="md-nav__link">
    <span class="md-ellipsis">
      transfer_boarding_penalty_valid
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.transfer_wait_perception_factor_valid" class="md-nav__link">
    <span class="md-ellipsis">
      transfer_wait_perception_factor_valid
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TransitVehicleConfig" class="md-nav__link">
    <span class="md-ellipsis">
      TransitVehicleConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TripDistributionClassConfig" class="md-nav__link">
    <span class="md-ellipsis">
      TripDistributionClassConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TripDistributionConfig" class="md-nav__link">
    <span class="md-ellipsis">
      TripDistributionConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TripGenerationClassConfig" class="md-nav__link">
    <span class="md-ellipsis">
      TripGenerationClassConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TripGenerationConfig" class="md-nav__link">
    <span class="md-ellipsis">
      TripGenerationConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TripGenerationFormulaConfig" class="md-nav__link">
    <span class="md-ellipsis">
      TripGenerationFormulaConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TruckClassConfig" class="md-nav__link">
    <span class="md-ellipsis">
      TruckClassConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TruckConfig" class="md-nav__link">
    <span class="md-ellipsis">
      TruckConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TruckConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TruckConfig.highway_demand_file" class="md-nav__link">
    <span class="md-ellipsis">
      highway_demand_file
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.WarmStartConfig" class="md-nav__link">
    <span class="md-ellipsis">
      WarmStartConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="WarmStartConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.WarmStartConfig.check_warmstart_method" class="md-nav__link">
    <span class="md-ellipsis">
      check_warmstart_method
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#components" class="md-nav__link">
    <span class="md-ellipsis">
      Components
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#base-component" class="md-nav__link">
    <span class="md-ellipsis">
      Base Component
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.component" class="md-nav__link">
    <span class="md-ellipsis">
      component
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.component.Component" class="md-nav__link">
    <span class="md-ellipsis">
      Component
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Component">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.congested_transit_assn_max_iteration" class="md-nav__link">
    <span class="md-ellipsis">
      congested_transit_assn_max_iteration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.controller" class="md-nav__link">
    <span class="md-ellipsis">
      controller
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.logger" class="md-nav__link">
    <span class="md-ellipsis">
      logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.time_period_durations" class="md-nav__link">
    <span class="md-ellipsis">
      time_period_durations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.time_period_names" class="md-nav__link">
    <span class="md-ellipsis">
      time_period_names
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.top_sheet" class="md-nav__link">
    <span class="md-ellipsis">
      top_sheet
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.trace" class="md-nav__link">
    <span class="md-ellipsis">
      trace
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.get_abs_path" class="md-nav__link">
    <span class="md-ellipsis">
      get_abs_path
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.report_progress" class="md-nav__link">
    <span class="md-ellipsis">
      report_progress
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.validate_inputs" class="md-nav__link">
    <span class="md-ellipsis">
      validate_inputs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.verify" class="md-nav__link">
    <span class="md-ellipsis">
      verify
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.write_top_sheet" class="md-nav__link">
    <span class="md-ellipsis">
      write_top_sheet
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.component.FileFormatError" class="md-nav__link">
    <span class="md-ellipsis">
      FileFormatError
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FileFormatError">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.FileFormatError.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.FileFormatError.__str__" class="md-nav__link">
    <span class="md-ellipsis">
      __str__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.component.Subcomponent" class="md-nav__link">
    <span class="md-ellipsis">
      Subcomponent
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Subcomponent">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Subcomponent.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Subcomponent.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#demand-components" class="md-nav__link">
    <span class="md-ellipsis">
      Demand Components
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.demand.prepare_demand" class="md-nav__link">
    <span class="md-ellipsis">
      prepare_demand
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.demand.prepare_demand.EmmeDemand" class="md-nav__link">
    <span class="md-ellipsis">
      EmmeDemand
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EmmeDemand">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.prepare_demand.EmmeDemand.logger" class="md-nav__link">
    <span class="md-ellipsis">
      logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.prepare_demand.EmmeDemand.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.demand.prepare_demand.PrepareHighwayDemand" class="md-nav__link">
    <span class="md-ellipsis">
      PrepareHighwayDemand
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PrepareHighwayDemand">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.prepare_demand.PrepareHighwayDemand.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.prepare_demand.PrepareHighwayDemand.prepare_household_demand" class="md-nav__link">
    <span class="md-ellipsis">
      prepare_household_demand
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.prepare_demand.PrepareHighwayDemand.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.demand.prepare_demand.PrepareTransitDemand" class="md-nav__link">
    <span class="md-ellipsis">
      PrepareTransitDemand
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PrepareTransitDemand">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.prepare_demand.PrepareTransitDemand.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.prepare_demand.PrepareTransitDemand.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.prepare_demand.PrepareTransitDemand.validate_inputs" class="md-nav__link">
    <span class="md-ellipsis">
      validate_inputs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.demand.prepare_demand.avg_matrix_msa" class="md-nav__link">
    <span class="md-ellipsis">
      avg_matrix_msa
    </span>
  </a>
  
    <nav class="md-nav" aria-label="avg_matrix_msa">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#household-demand" class="md-nav__link">
    <span class="md-ellipsis">
      Household Demand
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.demand.household" class="md-nav__link">
    <span class="md-ellipsis">
      household
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.demand.household.HouseholdModel" class="md-nav__link">
    <span class="md-ellipsis">
      HouseholdModel
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HouseholdModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.household.HouseholdModel.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.household.HouseholdModel.validate_inputs" class="md-nav__link">
    <span class="md-ellipsis">
      validate_inputs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.HouseholdConfig" class="md-nav__link">
    <span class="md-ellipsis">
      HouseholdConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HouseholdConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#air-passenger-demand" class="md-nav__link">
    <span class="md-ellipsis">
      Air Passenger Demand
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.demand.air_passenger" class="md-nav__link">
    <span class="md-ellipsis">
      air_passenger
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.demand.air_passenger.AirPassenger" class="md-nav__link">
    <span class="md-ellipsis">
      AirPassenger
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AirPassenger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.air_passenger.AirPassenger.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.air_passenger.AirPassenger.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.air_passenger.AirPassenger.validate_inputs" class="md-nav__link">
    <span class="md-ellipsis">
      validate_inputs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.AirPassengerDemandAggregationConfig" class="md-nav__link">
    <span class="md-ellipsis">
      AirPassengerDemandAggregationConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AirPassengerDemandAggregationConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#commercial-demand" class="md-nav__link">
    <span class="md-ellipsis">
      Commercial Demand
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial" class="md-nav__link">
    <span class="md-ellipsis">
      commercial
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleModel" class="md-nav__link">
    <span class="md-ellipsis">
      CommercialVehicleModel
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CommercialVehicleModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleModel.emme_scenario" class="md-nav__link">
    <span class="md-ellipsis">
      emme_scenario
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleModel.emmebank" class="md-nav__link">
    <span class="md-ellipsis">
      emmebank
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleModel.matrix_cache" class="md-nav__link">
    <span class="md-ellipsis">
      matrix_cache
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleModel.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleModel.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleModel.validate_inputs" class="md-nav__link">
    <span class="md-ellipsis">
      validate_inputs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTimeOfDay" class="md-nav__link">
    <span class="md-ellipsis">
      CommercialVehicleTimeOfDay
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CommercialVehicleTimeOfDay">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTimeOfDay.class_period_splits" class="md-nav__link">
    <span class="md-ellipsis">
      class_period_splits
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTimeOfDay.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTimeOfDay.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
    <nav class="md-nav" aria-label="run">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTimeOfDay.run--todo-use-timeperiodsplit" class="md-nav__link">
    <span class="md-ellipsis">
      TODO use TimePeriodSplit
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTimeOfDay.validate_inputs" class="md-nav__link">
    <span class="md-ellipsis">
      validate_inputs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTollChoice" class="md-nav__link">
    <span class="md-ellipsis">
      CommercialVehicleTollChoice
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CommercialVehicleTollChoice">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTollChoice.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTollChoice.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTollChoice.validate_inputs" class="md-nav__link">
    <span class="md-ellipsis">
      validate_inputs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripDistribution" class="md-nav__link">
    <span class="md-ellipsis">
      CommercialVehicleTripDistribution
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CommercialVehicleTripDistribution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripDistribution.friction_factors" class="md-nav__link">
    <span class="md-ellipsis">
      friction_factors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripDistribution.k_factors" class="md-nav__link">
    <span class="md-ellipsis">
      k_factors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripDistribution.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripDistribution.blended_skims" class="md-nav__link">
    <span class="md-ellipsis">
      blended_skims
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripDistribution.friction_factor_matrices" class="md-nav__link">
    <span class="md-ellipsis">
      friction_factor_matrices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripDistribution.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripDistribution.validate_inputs" class="md-nav__link">
    <span class="md-ellipsis">
      validate_inputs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripGeneration" class="md-nav__link">
    <span class="md-ellipsis">
      CommercialVehicleTripGeneration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CommercialVehicleTripGeneration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripGeneration--trip-generation" class="md-nav__link">
    <span class="md-ellipsis">
      Trip generation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripGeneration.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripGeneration.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripGeneration.validate_inputs" class="md-nav__link">
    <span class="md-ellipsis">
      validate_inputs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TruckConfig" class="md-nav__link">
    <span class="md-ellipsis">
      TruckConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TruckConfig.highway_demand_file" class="md-nav__link">
    <span class="md-ellipsis">
      highway_demand_file
    </span>
  </a>
  
    <nav class="md-nav" aria-label="highway_demand_file">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inter-regional-demand" class="md-nav__link">
    <span class="md-ellipsis">
      Inter-regional Demand
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.demand.internal_external" class="md-nav__link">
    <span class="md-ellipsis">
      internal_external
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.demand.internal_external.ExternalDemand" class="md-nav__link">
    <span class="md-ellipsis">
      ExternalDemand
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ExternalDemand">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.internal_external.ExternalDemand.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.demand.internal_external.ExternalTollChoice" class="md-nav__link">
    <span class="md-ellipsis">
      ExternalTollChoice
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ExternalTollChoice">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.internal_external.ExternalTollChoice--toll-choice" class="md-nav__link">
    <span class="md-ellipsis">
      Toll choice
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.internal_external.ExternalTollChoice.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.demand.internal_external.InternalExternal" class="md-nav__link">
    <span class="md-ellipsis">
      InternalExternal
    </span>
  </a>
  
    <nav class="md-nav" aria-label="InternalExternal">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.internal_external.InternalExternal.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.internal_external.InternalExternal.validate_inputs" class="md-nav__link">
    <span class="md-ellipsis">
      validate_inputs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.InternalExternalConfig" class="md-nav__link">
    <span class="md-ellipsis">
      InternalExternalConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="InternalExternalConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#visitor-demand" class="md-nav__link">
    <span class="md-ellipsis">
      Visitor Demand
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.demand.visitor" class="md-nav__link">
    <span class="md-ellipsis">
      visitor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="visitor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#highway-network-components" class="md-nav__link">
    <span class="md-ellipsis">
      Highway Network Components
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_network" class="md-nav__link">
    <span class="md-ellipsis">
      highway_network
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_network.PrepareNetwork" class="md-nav__link">
    <span class="md-ellipsis">
      PrepareNetwork
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PrepareNetwork">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_network.PrepareNetwork.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_network.PrepareNetwork.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_network.PrepareNetwork.validate_inputs" class="md-nav__link">
    <span class="md-ellipsis">
      validate_inputs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign" class="md-nav__link">
    <span class="md-ellipsis">
      highway_assign
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.AssignmentLauncher" class="md-nav__link">
    <span class="md-ellipsis">
      AssignmentLauncher
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.AssignmentRunner" class="md-nav__link">
    <span class="md-ellipsis">
      AssignmentRunner
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AssignmentRunner">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.AssignmentRunner.assign_spec_no_analysis" class="md-nav__link">
    <span class="md-ellipsis">
      assign_spec_no_analysis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.AssignmentRunner.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.AssignmentRunner.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.HighwayAssignment" class="md-nav__link">
    <span class="md-ellipsis">
      HighwayAssignment
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HighwayAssignment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.HighwayAssignment.class_config" class="md-nav__link">
    <span class="md-ellipsis">
      class_config
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.HighwayAssignment.classes" class="md-nav__link">
    <span class="md-ellipsis">
      classes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.HighwayAssignment.highway_emmebank" class="md-nav__link">
    <span class="md-ellipsis">
      highway_emmebank
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.HighwayAssignment.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.HighwayAssignment.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.HighwayAssignment.run_in_process" class="md-nav__link">
    <span class="md-ellipsis">
      run_in_process
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.HighwayAssignment.setup_process_launchers" class="md-nav__link">
    <span class="md-ellipsis">
      setup_process_launchers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.HighwayAssignment.start_proccesses" class="md-nav__link">
    <span class="md-ellipsis">
      start_proccesses
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.HighwayAssignment.validate_inputs" class="md-nav__link">
    <span class="md-ellipsis">
      validate_inputs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig" class="md-nav__link">
    <span class="md-ellipsis">
      HighwayConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.unique_capclass_numbers" class="md-nav__link">
    <span class="md-ellipsis">
      unique_capclass_numbers
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.unique_class_names" class="md-nav__link">
    <span class="md-ellipsis">
      unique_class_names
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.valid_skim_matrix_name_template" class="md-nav__link">
    <span class="md-ellipsis">
      valid_skim_matrix_name_template
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.valid_skim_template" class="md-nav__link">
    <span class="md-ellipsis">
      valid_skim_template
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.validate_class_keyword_lists" class="md-nav__link">
    <span class="md-ellipsis">
      validate_class_keyword_lists
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.validate_class_mode_excluded_links" class="md-nav__link">
    <span class="md-ellipsis">
      validate_class_mode_excluded_links
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.HighwayClassConfig" class="md-nav__link">
    <span class="md-ellipsis">
      HighwayClassConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.HighwayTollsConfig" class="md-nav__link">
    <span class="md-ellipsis">
      HighwayTollsConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.HighwayTollsConfig.dst_vehicle_group_names_length" class="md-nav__link">
    <span class="md-ellipsis">
      dst_vehicle_group_names_length
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.DemandCountyGroupConfig" class="md-nav__link">
    <span class="md-ellipsis">
      DemandCountyGroupConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_maz" class="md-nav__link">
    <span class="md-ellipsis">
      highway_maz
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_maz.AssignMAZSPDemand" class="md-nav__link">
    <span class="md-ellipsis">
      AssignMAZSPDemand
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AssignMAZSPDemand">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_maz.AssignMAZSPDemand.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_maz.AssignMAZSPDemand.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_maz.AssignMAZSPDemand.validate_inputs" class="md-nav__link">
    <span class="md-ellipsis">
      validate_inputs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_maz.SkimMAZCosts" class="md-nav__link">
    <span class="md-ellipsis">
      SkimMAZCosts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SkimMAZCosts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_maz.SkimMAZCosts.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_maz.SkimMAZCosts.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_maz.SkimMAZCosts.validate_inputs" class="md-nav__link">
    <span class="md-ellipsis">
      validate_inputs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.HighwayMazToMazConfig" class="md-nav__link">
    <span class="md-ellipsis">
      HighwayMazToMazConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.HighwayMazToMazConfig.unique_group_numbers" class="md-nav__link">
    <span class="md-ellipsis">
      unique_group_numbers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="unique_group_numbers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#transit-network-components" class="md-nav__link">
    <span class="md-ellipsis">
      Transit Network Components
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_assign" class="md-nav__link">
    <span class="md-ellipsis">
      transit_assign
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_assign.TransitAssignment" class="md-nav__link">
    <span class="md-ellipsis">
      TransitAssignment
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TransitAssignment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_assign.TransitAssignment.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_assign.TransitAssignment.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_assign.TransitAssignment.validate_inputs" class="md-nav__link">
    <span class="md-ellipsis">
      validate_inputs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_assign.TransitAssignmentClass" class="md-nav__link">
    <span class="md-ellipsis">
      TransitAssignmentClass
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TransitAssignmentClass">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_assign.TransitAssignmentClass.emme_transit_spec" class="md-nav__link">
    <span class="md-ellipsis">
      emme_transit_spec
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_assign.TransitAssignmentClass.name" class="md-nav__link">
    <span class="md-ellipsis">
      name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_assign.TransitAssignmentClass.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_assign.calc_adjusted_headway" class="md-nav__link">
    <span class="md-ellipsis">
      calc_adjusted_headway
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_assign.calc_extra_wait_time" class="md-nav__link">
    <span class="md-ellipsis">
      calc_extra_wait_time
    </span>
  </a>
  
    <nav class="md-nav" aria-label="calc_extra_wait_time">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_assign.calc_extra_wait_time--todo-document-fully" class="md-nav__link">
    <span class="md-ellipsis">
      TODO document fully.
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_assign.calc_offs_thru_segment" class="md-nav__link">
    <span class="md-ellipsis">
      calc_offs_thru_segment
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_assign.calc_total_offs" class="md-nav__link">
    <span class="md-ellipsis">
      calc_total_offs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_assign.func_returns_calc_updated_perceived_headway" class="md-nav__link">
    <span class="md-ellipsis">
      func_returns_calc_updated_perceived_headway
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_assign.func_returns_crowded_segment_cost" class="md-nav__link">
    <span class="md-ellipsis">
      func_returns_crowded_segment_cost
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_assign.func_returns_segment_congestion" class="md-nav__link">
    <span class="md-ellipsis">
      func_returns_segment_congestion
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_assign.time_period_capacity" class="md-nav__link">
    <span class="md-ellipsis">
      time_period_capacity
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_skim" class="md-nav__link">
    <span class="md-ellipsis">
      transit_skim
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_skim.TransitSkim" class="md-nav__link">
    <span class="md-ellipsis">
      TransitSkim
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TransitSkim">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_skim.TransitSkim.skim_outputs" class="md-nav__link">
    <span class="md-ellipsis">
      skim_outputs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_skim.TransitSkim.skim_properties" class="md-nav__link">
    <span class="md-ellipsis">
      skim_properties
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_skim.TransitSkim.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_skim.TransitSkim.emmebank_skim_matrices" class="md-nav__link">
    <span class="md-ellipsis">
      emmebank_skim_matrices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_skim.TransitSkim.mask_above_max_transfers" class="md-nav__link">
    <span class="md-ellipsis">
      mask_above_max_transfers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_skim.TransitSkim.mask_if_not_required_modes" class="md-nav__link">
    <span class="md-ellipsis">
      mask_if_not_required_modes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_skim.TransitSkim.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_skim.TransitSkim.run_skim_set" class="md-nav__link">
    <span class="md-ellipsis">
      run_skim_set
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_skim.TransitSkim.skim_crowding" class="md-nav__link">
    <span class="md-ellipsis">
      skim_crowding
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_skim.TransitSkim.skim_drive_walk" class="md-nav__link">
    <span class="md-ellipsis">
      skim_drive_walk
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_skim.TransitSkim.skim_invehicle_time_by_mode" class="md-nav__link">
    <span class="md-ellipsis">
      skim_invehicle_time_by_mode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_skim.TransitSkim.skim_penalty_toll" class="md-nav__link">
    <span class="md-ellipsis">
      skim_penalty_toll
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_skim.TransitSkim.skim_reliability_crowding_capacity" class="md-nav__link">
    <span class="md-ellipsis">
      skim_reliability_crowding_capacity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_skim.TransitSkim.skim_walk_wait_boards_fares" class="md-nav__link">
    <span class="md-ellipsis">
      skim_walk_wait_boards_fares
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_skim.TransitSkim.validate_inputs" class="md-nav__link">
    <span class="md-ellipsis">
      validate_inputs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig" class="md-nav__link">
    <span class="md-ellipsis">
      TransitModeConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.headway_fraction_valid" class="md-nav__link">
    <span class="md-ellipsis">
      headway_fraction_valid
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.in_vehicle_perception_factor_valid" class="md-nav__link">
    <span class="md-ellipsis">
      in_vehicle_perception_factor_valid
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.initial_boarding_penalty_valid" class="md-nav__link">
    <span class="md-ellipsis">
      initial_boarding_penalty_valid
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.mode_id_valid" class="md-nav__link">
    <span class="md-ellipsis">
      mode_id_valid
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.speed_or_time_factor_valid" class="md-nav__link">
    <span class="md-ellipsis">
      speed_or_time_factor_valid
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.transfer_boarding_penalty_valid" class="md-nav__link">
    <span class="md-ellipsis">
      transfer_boarding_penalty_valid
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.transfer_wait_perception_factor_valid" class="md-nav__link">
    <span class="md-ellipsis">
      transfer_wait_perception_factor_valid
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.TransitConfig" class="md-nav__link">
    <span class="md-ellipsis">
      TransitConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TransitConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#active-network-components" class="md-nav__link">
    <span class="md-ellipsis">
      Active Network Components
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#emme-wrappers" class="md-nav__link">
    <span class="md-ellipsis">
      Emme Wrappers
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.emme" class="md-nav__link">
    <span class="md-ellipsis">
      emme
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.config.EmmeConfig" class="md-nav__link">
    <span class="md-ellipsis">
      EmmeConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#errata" class="md-nav__link">
    <span class="md-ellipsis">
      Errata
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.logger" class="md-nav__link">
    <span class="md-ellipsis">
      logger
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.logger.BaseLogger" class="md-nav__link">
    <span class="md-ellipsis">
      BaseLogger
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BaseLogger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.BaseLogger.debug_enabled" class="md-nav__link">
    <span class="md-ellipsis">
      debug_enabled
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.BaseLogger.trace_enabled" class="md-nav__link">
    <span class="md-ellipsis">
      trace_enabled
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.BaseLogger.__del__" class="md-nav__link">
    <span class="md-ellipsis">
      __del__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.BaseLogger.clear_msg_cache" class="md-nav__link">
    <span class="md-ellipsis">
      clear_msg_cache
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.BaseLogger.debug" class="md-nav__link">
    <span class="md-ellipsis">
      debug
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.BaseLogger.detail" class="md-nav__link">
    <span class="md-ellipsis">
      detail
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.BaseLogger.error" class="md-nav__link">
    <span class="md-ellipsis">
      error
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.BaseLogger.fatal" class="md-nav__link">
    <span class="md-ellipsis">
      fatal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.BaseLogger.info" class="md-nav__link">
    <span class="md-ellipsis">
      info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.BaseLogger.log" class="md-nav__link">
    <span class="md-ellipsis">
      log
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.BaseLogger.log_dict" class="md-nav__link">
    <span class="md-ellipsis">
      log_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.BaseLogger.log_start_end" class="md-nav__link">
    <span class="md-ellipsis">
      log_start_end
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.BaseLogger.log_time" class="md-nav__link">
    <span class="md-ellipsis">
      log_time
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.BaseLogger.status" class="md-nav__link">
    <span class="md-ellipsis">
      status
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.BaseLogger.trace" class="md-nav__link">
    <span class="md-ellipsis">
      trace
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.BaseLogger.warn" class="md-nav__link">
    <span class="md-ellipsis">
      warn
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.logger.LogCache" class="md-nav__link">
    <span class="md-ellipsis">
      LogCache
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LogCache">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogCache.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogCache.clear" class="md-nav__link">
    <span class="md-ellipsis">
      clear
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogCache.log" class="md-nav__link">
    <span class="md-ellipsis">
      log
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogCache.open" class="md-nav__link">
    <span class="md-ellipsis">
      open
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogCache.write_cache" class="md-nav__link">
    <span class="md-ellipsis">
      write_cache
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.logger.LogDisplay" class="md-nav__link">
    <span class="md-ellipsis">
      LogDisplay
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LogDisplay">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogDisplay.log" class="md-nav__link">
    <span class="md-ellipsis">
      log
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.logger.LogFile" class="md-nav__link">
    <span class="md-ellipsis">
      LogFile
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LogFile">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFile.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFile.close" class="md-nav__link">
    <span class="md-ellipsis">
      close
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFile.log" class="md-nav__link">
    <span class="md-ellipsis">
      log
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFile.open" class="md-nav__link">
    <span class="md-ellipsis">
      open
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.logger.LogFileLevelOverride" class="md-nav__link">
    <span class="md-ellipsis">
      LogFileLevelOverride
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LogFileLevelOverride">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFileLevelOverride.level" class="md-nav__link">
    <span class="md-ellipsis">
      level
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFileLevelOverride.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.logger.LogFormatter" class="md-nav__link">
    <span class="md-ellipsis">
      LogFormatter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LogFormatter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFormatter.level" class="md-nav__link">
    <span class="md-ellipsis">
      level
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFormatter.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFormatter.decrease_indent" class="md-nav__link">
    <span class="md-ellipsis">
      decrease_indent
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFormatter.increase_indent" class="md-nav__link">
    <span class="md-ellipsis">
      increase_indent
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFormatter.log" class="md-nav__link">
    <span class="md-ellipsis">
      log
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.logger.LogStartEnd" class="md-nav__link">
    <span class="md-ellipsis">
      LogStartEnd
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LogStartEnd">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogStartEnd.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogStartEnd.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.logger.Logger" class="md-nav__link">
    <span class="md-ellipsis">
      Logger
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Logger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.__new__" class="md-nav__link">
    <span class="md-ellipsis">
      __new__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.get_logger" class="md-nav__link">
    <span class="md-ellipsis">
      get_logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.notify_slack" class="md-nav__link">
    <span class="md-ellipsis">
      notify_slack
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.logger.ProcessLogger" class="md-nav__link">
    <span class="md-ellipsis">
      ProcessLogger
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ProcessLogger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.ProcessLogger.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.logger.SlackNotifier" class="md-nav__link">
    <span class="md-ellipsis">
      SlackNotifier
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SlackNotifier">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.SlackNotifier.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.SlackNotifier.post_message" class="md-nav__link">
    <span class="md-ellipsis">
      post_message
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.tools" class="md-nav__link">
    <span class="md-ellipsis">
      tools
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.tools.SpatialGridIndex" class="md-nav__link">
    <span class="md-ellipsis">
      SpatialGridIndex
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SpatialGridIndex">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.tools.SpatialGridIndex.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.tools.SpatialGridIndex.insert" class="md-nav__link">
    <span class="md-ellipsis">
      insert
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.tools.SpatialGridIndex.nearest" class="md-nav__link">
    <span class="md-ellipsis">
      nearest
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.tools.SpatialGridIndex.within_distance" class="md-nav__link">
    <span class="md-ellipsis">
      within_distance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.tools.SpatialGridIndex.within_square" class="md-nav__link">
    <span class="md-ellipsis">
      within_square
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.tools.download_unzip" class="md-nav__link">
    <span class="md-ellipsis">
      download_unzip
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.tools.emme_context" class="md-nav__link">
    <span class="md-ellipsis">
      emme_context
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.tools.interpolate_dfs" class="md-nav__link">
    <span class="md-ellipsis">
      interpolate_dfs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.tools.mocked_inro_context" class="md-nav__link">
    <span class="md-ellipsis">
      mocked_inro_context
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.tools.run_process" class="md-nav__link">
    <span class="md-ellipsis">
      run_process
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.tools.temp_file" class="md-nav__link">
    <span class="md-ellipsis">
      temp_file
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.tools.zonal_csv_to_matrices" class="md-nav__link">
    <span class="md-ellipsis">
      zonal_csv_to_matrices
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.examples" class="md-nav__link">
    <span class="md-ellipsis">
      examples
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tm2py.examples.get_example" class="md-nav__link">
    <span class="md-ellipsis">
      get_example
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="api-documentation">API Documentation<a class="headerlink" href="#api-documentation" title="Permanent link"> </a></h1>
<h2 id="setting-up-the-model-to-run">Setting up the model to run<a class="headerlink" href="#setting-up-the-model-to-run" title="Permanent link"> </a></h2>


<div class="doc doc-object doc-class">



<a id="tm2py.SetupModel"></a>
    <div class="doc doc-contents first">


      <p>Main operational interface for setup model process.</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/setup_model/setup.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SetupModel</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main operational interface for setup model process.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_file</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="n">model_dir</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes an instance of the SetupModel class.</span>

<span class="sd">        Args:</span>
<span class="sd">            config_file (pathlib.Path): The TOML file with the model setup attributes.</span>
<span class="sd">            model_dir (pathlib.Path): The directory which to setup for a TM2 model run.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config_file</span> <span class="o">=</span> <span class="n">config_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup_config</span> <span class="o">=</span> <span class="n">SetupConfig</span><span class="p">(</span><span class="nb">dict</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span> <span class="o">=</span> <span class="n">model_dir</span>

    <span class="k">def</span> <span class="nf">_setup_logging</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log_file</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Setup a logger that logs to both the console and to the given log file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
        <span class="c1"># console handler</span>
        <span class="n">ch</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>
        <span class="n">ch</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
        <span class="n">ch</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> - </span><span class="si">%(levelname)s</span><span class="s1"> - </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">datefmt</span><span class="o">=</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y %I:%M:%S %p&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span>

        <span class="c1"># file handler</span>
        <span class="n">fh</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">FileHandler</span><span class="p">(</span><span class="n">log_file</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> - </span><span class="si">%(levelname)s</span><span class="s1"> - </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">datefmt</span><span class="o">=</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y %I:%M:%S %p&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_load_toml</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load SetupConfig from toml file.</span>

<span class="sd">        Args:</span>
<span class="sd">            toml_path: path for toml file to read</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">toml_file</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">toml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">toml_file</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">run_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Does the work of setting up the model.  </span>

<span class="sd">        This step will do the following within the model directory.</span>

<span class="sd">        1. Intialize logging to write to `setup.log`</span>
<span class="sd">        2. Copy the setup config file to `setupmodel_config.toml`</span>
<span class="sd">        3. Create the required folder structure</span>
<span class="sd">        4. Copy the input from the locations specified:</span>
<span class="sd">           a. hwy and trn networks</span>
<span class="sd">           b. popsyn and landuse inputs</span>
<span class="sd">           c. nonres inputs</span>
<span class="sd">           d. warmstart demand matrices</span>
<span class="sd">           e. warmstart skims</span>
<span class="sd">        5. Copy the Emme template project and Emme network databases </span>
<span class="sd">           (based on the EMME version in sys.path)</span>
<span class="sd">        6. Download the travel model CTRAMP core code (runtime, uec) from the </span>
<span class="sd">           [travel-model-two repository](https://github.com/BayAreaMetro/travel-model-two)</span>
<span class="sd">        7. Updates the IP address in the CTRAMP runtime properties files</span>
<span class="sd">        8. Creates `RunModel.py` for running the model</span>

<span class="sd">        Raises:</span>
<span class="sd">            FileExistsError: If the model directory to setup already exists.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Read setup setup_config</span>
        <span class="n">config_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_toml</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup_config</span> <span class="o">=</span> <span class="n">SetupConfig</span><span class="p">(</span><span class="n">config_dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup_config</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>

        <span class="c1"># if the directory already exists - error and quit</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="si">}</span><span class="s2"> already exists! Setup terminated.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>

        <span class="c1"># Initialize logging</span>
        <span class="n">log_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span> <span class="o">/</span> <span class="s2">&quot;setup.log&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_logging</span><span class="p">(</span><span class="n">log_file</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Starting process to setup MTC model in directory: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Save setup config into model dir as setupmodel_config.toml</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span> <span class="o">/</span> <span class="s2">&quot;setupmodel_config.toml&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Copied </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="s1">&#39;setupmodel_config.toml&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># List of folders to create</span>
        <span class="n">folders_to_create</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;acceptance&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CTRAMP&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ctramp_output&quot;</span><span class="p">,</span>
            <span class="s2">&quot;demand_matrices&quot;</span><span class="p">,</span>
            <span class="s2">&quot;demand_matrices/highway&quot;</span><span class="p">,</span>
            <span class="s2">&quot;demand_matrices/highway/air_passenger&quot;</span><span class="p">,</span>
            <span class="s2">&quot;demand_matrices/highway/household&quot;</span><span class="p">,</span>
            <span class="s2">&quot;demand_matrices/highway/maz_demand&quot;</span><span class="p">,</span>
            <span class="s2">&quot;demand_matrices/highway/internal_external&quot;</span><span class="p">,</span>
            <span class="s2">&quot;demand_matrices/highway/commercial&quot;</span><span class="p">,</span>
            <span class="s2">&quot;demand_matrices/transit&quot;</span><span class="p">,</span>
            <span class="s2">&quot;emme_project&quot;</span><span class="p">,</span>
            <span class="s2">&quot;inputs&quot;</span><span class="p">,</span>
            <span class="s2">&quot;logs&quot;</span><span class="p">,</span>
            <span class="s2">&quot;notebooks&quot;</span><span class="p">,</span>
            <span class="s2">&quot;output_summaries&quot;</span><span class="p">,</span>
            <span class="s2">&quot;skim_matrices&quot;</span><span class="p">,</span>
            <span class="s2">&quot;skim_matrices/highway&quot;</span><span class="p">,</span>
            <span class="s2">&quot;skim_matrices/transit&quot;</span><span class="p">,</span>
            <span class="s2">&quot;skim_matrices/non_motorized&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="c1"># Create folder structure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_folder_structure</span><span class="p">(</span><span class="n">folders_to_create</span><span class="p">)</span>

        <span class="c1"># Copy model inputs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_copy_model_inputs</span><span class="p">()</span>

        <span class="c1"># Copy emme project and database</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_copy_emme_project_and_database</span><span class="p">()</span>

        <span class="c1"># Download toml SetupConfig files from GitHub</span>
        <span class="n">config_files_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;observed_data.toml&quot;</span><span class="p">,</span>
            <span class="s2">&quot;canonical_crosswalk.toml&quot;</span><span class="p">,</span>
            <span class="s2">&quot;model_config.toml&quot;</span><span class="p">,</span>
            <span class="s2">&quot;scenario_config.toml&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">acceptance_config_files_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;observed_data.toml&quot;</span><span class="p">,</span>
            <span class="s2">&quot;canonical_crosswalk.toml&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">config_files_list</span><span class="p">:</span>
            <span class="n">github_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setup_config</span><span class="o">.</span><span class="n">CONFIGS_GITHUB_PATH</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">file</span>

            <span class="n">local_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span> <span class="o">/</span> <span class="n">file</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_download_file_from_github</span><span class="p">(</span><span class="n">github_url</span><span class="p">,</span> <span class="n">local_file</span><span class="p">)</span>

        <span class="c1"># Fetch required folders from travel model two github release (zip file)</span>
        <span class="n">org</span> <span class="o">=</span> <span class="s2">&quot;BayAreaMetro&quot;</span>
        <span class="n">repo</span> <span class="o">=</span> <span class="s2">&quot;travel-model-two&quot;</span>
        <span class="n">tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setup_config</span><span class="o">.</span><span class="n">TRAVEL_MODEL_TWO_RELEASE_TAG</span>
        <span class="n">folders_to_extract</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;runtime&quot;</span><span class="p">,</span> <span class="s2">&quot;uec&quot;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_download_github_release</span><span class="p">(</span>
            <span class="n">org</span><span class="p">,</span>
            <span class="n">repo</span><span class="p">,</span>
            <span class="n">tag</span><span class="p">,</span>
            <span class="n">folders_to_extract</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span> <span class="o">/</span> <span class="s2">&quot;CTRAMP&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Rename &#39;uec&#39; folder to &#39;model&#39;</span>
        <span class="n">old_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span> <span class="o">/</span> <span class="s2">&quot;CTRAMP&quot;</span> <span class="o">/</span> <span class="s2">&quot;uec&quot;</span>
        <span class="n">old_path</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span> <span class="o">/</span> <span class="s2">&quot;CTRAMP&quot;</span> <span class="o">/</span> <span class="s2">&quot;model&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_create_run_model_batch</span><span class="p">()</span>

        <span class="c1"># update IP addresses in config files</span>
        <span class="n">ips_here</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostbyname_ex</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">())[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found the following IPs for this server: </span><span class="si">{</span><span class="n">ips_here</span><span class="si">}</span><span class="s2">; using the first one: </span><span class="si">{</span><span class="n">ips_here</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># add IP address to mtctm2.properties</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_replace_in_file</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span> <span class="o">/</span> <span class="s1">&#39;CTRAMP&#39;</span> <span class="o">/</span> <span class="s1">&#39;runtime&#39;</span> <span class="o">/</span> <span class="s1">&#39;mtctm2.properties&#39;</span><span class="p">,</span> <span class="p">{</span>
                <span class="s2">&quot;(</span><span class="se">\n</span><span class="s2">RunModel.MatrixServerAddress[ </span><span class="se">\t</span><span class="s2">]*=[ </span><span class="se">\t</span><span class="s2">]*)(\S*)&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;\g&lt;1&gt;</span><span class="si">{</span><span class="n">ips_here</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;(</span><span class="se">\n</span><span class="s2">RunModel.HouseholdServerAddress[ </span><span class="se">\t</span><span class="s2">]*=[ </span><span class="se">\t</span><span class="s2">]*)(\S*)&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;\g&lt;1&gt;</span><span class="si">{</span><span class="n">ips_here</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="c1"># add IP address to logsum.properties</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_replace_in_file</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span> <span class="o">/</span> <span class="s1">&#39;CTRAMP&#39;</span> <span class="o">/</span> <span class="s1">&#39;runtime&#39;</span> <span class="o">/</span> <span class="s1">&#39;logsum.properties&#39;</span><span class="p">,</span> <span class="p">{</span>
                <span class="s2">&quot;(</span><span class="se">\n</span><span class="s2">RunModel.MatrixServerAddress[ </span><span class="se">\t</span><span class="s2">]*=[ </span><span class="se">\t</span><span class="s2">]*)(\S*)&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;\g&lt;1&gt;</span><span class="si">{</span><span class="n">ips_here</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;(</span><span class="se">\n</span><span class="s2">RunModel.HouseholdServerAddress[ </span><span class="se">\t</span><span class="s2">]*=[ </span><span class="se">\t</span><span class="s2">]*)(\S*)&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;\g&lt;1&gt;</span><span class="si">{</span><span class="n">ips_here</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Setup process completed successfully!&quot;</span><span class="p">)</span>

        <span class="c1"># Close logging</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">_create_run_model_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates the RunModel.bat and RunModel.py in the root directory</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Directory </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span><span class="si">}</span><span class="s2"> does not exists.&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Directory </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span><span class="si">}</span><span class="s2"> does not exists.&quot;</span><span class="p">)</span>

        <span class="c1"># create RunModel.py</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span> <span class="o">/</span> <span class="s1">&#39;RunModel.py&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating RunModel.py in directory </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">_RUN_MODEL_PY_CONTENT</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_create_folder_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates empty folder structure in the root directory</span>

<span class="sd">        Args:</span>
<span class="sd">            folder_names: list of folders to create</span>
<span class="sd">            self.model_dir: root directory for the model</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating folder structure in directory </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">error_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Directory </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span><span class="si">}</span><span class="s2"> does not exist.&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_str</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="n">error_str</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">folder_names</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span> <span class="o">/</span> <span class="n">folder</span>
            <span class="n">path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Created Empty Folder: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_copy_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src_dir</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="n">dest_dir</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Copies a folder from the source directory to the destination directory.</span>

<span class="sd">        Args:</span>
<span class="sd">            src: source folder</span>
<span class="sd">            dest: destination folder</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">src_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">error_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Source directory </span><span class="si">{</span><span class="n">src_dir</span><span class="si">}</span><span class="s2"> to copy from does not exist&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_str</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="n">error_str</span><span class="p">)</span>

        <span class="c1"># Copy the entire folder and its contents</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Check if the destination directory exists</span>
            <span class="k">if</span> <span class="n">dest_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="c1"># delete the existing destination directory</span>
                <span class="c1"># Newer versions supports `dirs_exist_ok` but with this version,</span>
                <span class="c1"># the destination directory must not already exist</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">dest_dir</span><span class="p">)</span>

            <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="n">src_dir</span><span class="p">,</span> <span class="n">dest_dir</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Copied folder from </span><span class="si">{</span><span class="n">src_dir</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">dest_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">error_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Failed to copy </span><span class="si">{</span><span class="n">src_dir</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">dest_dir</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_str</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">error_str</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_download_file_from_github</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">github_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">local_file</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Downloads a file from a GitHub URL.</span>

<span class="sd">        Args:</span>
<span class="sd">            github_url: raw github link for the file to download</span>
<span class="sd">            local_file: local path for the file to download</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">github_url</span><span class="p">)</span>
            <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloading file from </span><span class="si">{</span><span class="n">github_url</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">local_file</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">local_file</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="c1"># write the content of the response (file content) to the local file</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">error_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Failed to download file </span><span class="si">{</span><span class="n">github_url</span><span class="si">}</span><span class="s2"> from GitHub to </span><span class="si">{</span><span class="n">local_file</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_str</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">error_str</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_download_github_release</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">org_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">repo_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">release_tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">folders_to_extract</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">local_dir</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        download a release ZIP from a GitHub repository and extract specified sub-folders to a local directory.</span>

<span class="sd">        Args:</span>
<span class="sd">            org_name: github organization name</span>
<span class="sd">            repo_name: github repository name</span>
<span class="sd">            release_tag: release tag</span>
<span class="sd">            folders_to_extract: list of sub-folders to extract from the ZIP file</span>
<span class="sd">            local_dir: local directory to save extracted folders</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">release_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://github.com/</span><span class="si">{</span><span class="n">org_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">repo_name</span><span class="si">}</span><span class="s2">/archive/refs/tags/</span><span class="si">{</span><span class="n">release_tag</span><span class="si">}</span><span class="s2">.zip&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">release_url</span><span class="p">)</span>
            <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

            <span class="n">root_folder</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">repo_name</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">release_tag</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">copied_folder</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>

            <span class="n">z</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">file_info</span> <span class="ow">in</span> <span class="n">z</span><span class="o">.</span><span class="n">infolist</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">file_info</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">file_info</span><span class="o">.</span><span class="n">filename</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">root_folder</span><span class="p">):</span>
                        <span class="n">file_path</span> <span class="o">=</span> <span class="n">file_info</span><span class="o">.</span><span class="n">filename</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">root_folder</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">file_path</span> <span class="o">=</span> <span class="n">file_info</span><span class="o">.</span><span class="n">filename</span>

                    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
                        <span class="n">file_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span> <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">folders_to_extract</span>
                    <span class="p">):</span>
                        <span class="c1"># create the local path to extract the file</span>
                        <span class="n">extract_path</span> <span class="o">=</span> <span class="n">local_dir</span> <span class="o">/</span> <span class="n">file_path</span>

                        <span class="c1"># ensure the directory exists</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">extract_path</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                        <span class="c1"># extract the file</span>
                        <span class="k">with</span> <span class="n">z</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_info</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">source</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span>
                            <span class="n">extract_path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span>
                        <span class="p">)</span> <span class="k">as</span> <span class="n">target</span><span class="p">:</span>
                            <span class="n">target</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">source</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

                        <span class="n">copied_folder</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">file_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">copied_folder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Extracted folders </span><span class="si">{</span><span class="n">copied_folder</span><span class="si">}</span><span class="s2"> from GitHub release </span><span class="si">{</span><span class="n">release_url</span><span class="si">}</span><span class="s2"> and to directory </span><span class="si">{</span><span class="n">local_dir</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">error_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Failed to download GitHub release </span><span class="si">{</span><span class="n">release_url</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_str</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">error_str</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_copy_model_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        copy required model inputs into their respective directories.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Copy hwy and trn networks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_copy_folder</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setup_config</span><span class="o">.</span><span class="n">INPUT_NETWORK_DIR</span> <span class="o">/</span> <span class="s2">&quot;hwy&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span> <span class="o">/</span> <span class="s2">&quot;inputs&quot;</span> <span class="o">/</span> <span class="s2">&quot;hwy&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_copy_folder</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setup_config</span><span class="o">.</span><span class="n">INPUT_NETWORK_DIR</span> <span class="o">/</span> <span class="s2">&quot;trn&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span> <span class="o">/</span> <span class="s2">&quot;inputs&quot;</span> <span class="o">/</span> <span class="s2">&quot;trn&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Copy popsyn and landuse inputs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_copy_folder</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setup_config</span><span class="o">.</span><span class="n">INPUT_POPLU_DIR</span> <span class="o">/</span> <span class="s2">&quot;popsyn&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span> <span class="o">/</span> <span class="s2">&quot;inputs&quot;</span> <span class="o">/</span> <span class="s2">&quot;popsyn&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_copy_folder</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setup_config</span><span class="o">.</span><span class="n">INPUT_POPLU_DIR</span> <span class="o">/</span><span class="s2">&quot;landuse&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span> <span class="o">/</span> <span class="s2">&quot;inputs&quot;</span> <span class="o">/</span> <span class="s2">&quot;landuse&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Copy nonres inputs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_copy_folder</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setup_config</span><span class="o">.</span><span class="n">INPUT_NONRES_DIR</span> <span class="o">/</span> <span class="s2">&quot;nonres&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span> <span class="o">/</span> <span class="s2">&quot;inputs&quot;</span> <span class="o">/</span> <span class="s2">&quot;nonres&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Copy warmstart demand if exists</span>
        <span class="n">warmstart_demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setup_config</span><span class="o">.</span><span class="n">WARMSTART_FILES_DIR</span> <span class="o">/</span> <span class="s2">&quot;demand_matrices&quot;</span>
        <span class="k">if</span> <span class="n">warmstart_demand</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_copy_folder</span><span class="p">(</span>
                <span class="n">warmstart_demand</span><span class="p">,</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span> <span class="o">/</span> <span class="s2">&quot;demand_matrices&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Copy warmstart skims</span>
        <span class="n">warmstart_skims</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setup_config</span><span class="o">.</span><span class="n">WARMSTART_FILES_DIR</span> <span class="o">/</span> <span class="s2">&quot;skim_matrices&quot;</span>
        <span class="k">if</span> <span class="n">warmstart_skims</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_copy_folder</span><span class="p">(</span>
                <span class="n">warmstart_skims</span><span class="p">,</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span> <span class="o">/</span><span class="s2">&quot;skim_matrices&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_copy_emme_project_and_database</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Copy EMME project from template project and then copy the emme networks databases based</span>
<span class="sd">        on the EMME version found in the sys.path.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># copy template emme project</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_copy_folder</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setup_config</span><span class="o">.</span><span class="n">EMME_TEMPLATE_PROJECT_DIR</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span> <span class="o">/</span> <span class="s2">&quot;emme_project&quot;</span>
        <span class="p">)</span>

        <span class="c1"># get emme version from sys.path</span>
        <span class="n">sys_paths</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span>
        <span class="n">emme_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">sys_path</span> <span class="ow">in</span> <span class="n">sys_paths</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sys_path</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;EMME&quot;</span><span class="p">)</span> <span class="o">&gt;=</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">sys_path</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;Bentley&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">emme_path</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">sys_path</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found EMME path: </span><span class="si">{</span><span class="n">emme_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">emme_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">error_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;emme_path not found in sys.path </span><span class="si">{</span><span class="n">sys_paths</span><span class="si">}</span><span class="s2">. Please run setup from EMME command prompt&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_str</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">error_str</span><span class="p">)</span> 

        <span class="n">EMME_VERSION</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">emme_path</span><span class="o">.</span><span class="n">parts</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">part</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;EMME&quot;</span><span class="p">):</span>
                <span class="n">EMME_VERSION</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>  <span class="c1"># replace spaces with underscores</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found EMME version in emme_path: </span><span class="si">{</span><span class="n">EMME_VERSION</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="n">EMME_VERSION</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">error_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;EMME version not found in emme_path </span><span class="si">{</span><span class="n">emme_path</span><span class="si">}</span><span class="s2">. Please run setup from EMME command prompt&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_str</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">error_str</span><span class="p">)</span> 

        <span class="c1"># copy versioned, zipped emme network database, falling back to unversioned if necessary</span>
        <span class="n">DATABASE_TO_SOURCE</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;highway&#39;</span><span class="p">:</span> <span class="s1">&#39;emme_drive_network&#39;</span><span class="p">,</span>
            <span class="s1">&#39;transit&#39;</span><span class="p">:</span> <span class="s1">&#39;emme_taz_transit_network&#39;</span><span class="p">,</span>
            <span class="s1">&#39;active_north&#39;</span><span class="p">:</span> <span class="s1">&#39;emme_maz_active_modes_network_subregion_north&#39;</span><span class="p">,</span>
            <span class="s1">&#39;active_south&#39;</span><span class="p">:</span> <span class="s1">&#39;emme_maz_active_modes_network_subregion_south&#39;</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">network_type</span> <span class="ow">in</span> <span class="n">DATABASE_TO_SOURCE</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">source_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setup_config</span><span class="o">.</span><span class="n">INPUT_EMME_NETWORK_DIR</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;Database_</span><span class="si">{</span><span class="n">network_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">EMME_VERSION</span><span class="si">}</span><span class="s2">.zip&quot;</span>
            <span class="n">dest_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span> <span class="o">/</span> <span class="s2">&quot;emme_project&quot;</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;Database_</span><span class="si">{</span><span class="n">network_type</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">source_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="c1"># remove what was there before</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">dest_dir</span><span class="p">)</span>
                <span class="c1"># unzip the EMME version of the ntework</span>
                <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">source_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zf</span><span class="p">:</span>
                    <span class="n">zf</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">dest_dir</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unzipped </span><span class="si">{</span><span class="n">source_file</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">dest_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># otherwise, copy folder</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_copy_folder</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setup_config</span><span class="o">.</span><span class="n">INPUT_EMME_NETWORK_DIR</span> <span class="o">/</span> <span class="n">DATABASE_TO_SOURCE</span><span class="p">[</span><span class="n">network_type</span><span class="p">]</span> <span class="o">/</span> <span class="s2">&quot;Database&quot;</span><span class="p">,</span>
                    <span class="n">dest_dir</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_replace_in_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="n">regex_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Copies `filepath` to `filepath.original`</span>
<span class="sd">        Opens `filepath.original` and reads it, writing a new version to `filepath`.</span>
<span class="sd">        The new version is the same as the old, except that the regexes in the regex_dict keys</span>
<span class="sd">        are replaced by the corresponding values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">original_copy</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">filepath</span><span class="o">.</span><span class="n">absolute</span><span class="p">())</span><span class="si">}</span><span class="s2">.original&quot;</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">original_copy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_replace_in_file: Updating </span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s2"> via </span><span class="si">{</span><span class="n">original_copy</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># read the contents</span>
        <span class="n">myfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">original_copy</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">file_contents</span> <span class="o">=</span> <span class="n">myfile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">myfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># do the regex subs</span>
        <span class="k">for</span> <span class="n">pattern</span><span class="p">,</span><span class="n">newstr</span> <span class="ow">in</span> <span class="n">regex_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="p">(</span><span class="n">file_contents</span><span class="p">,</span> <span class="n">numsubs</span><span class="p">)</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">subn</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span><span class="n">newstr</span><span class="p">,</span><span class="n">file_contents</span><span class="p">,</span><span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Made </span><span class="si">{</span><span class="n">numsubs</span><span class="si">}</span><span class="s2"> sub for </span><span class="si">{</span><span class="n">newstr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

           <span class="c1"># Raise exception on failure</span>
            <span class="k">if</span> <span class="n">numsubs</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">error_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;  SUBSITUTION FOR PATTERN </span><span class="si">{</span><span class="n">pattern</span><span class="si">}</span><span class="s2"> NOT MADE -- Fatal error&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="n">error_str</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">error_str</span><span class="p">)</span>

        <span class="c1"># write the result</span>
        <span class="n">myfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">myfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">file_contents</span><span class="p">)</span>
        <span class="n">myfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="tm2py.SetupModel.__init__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">config_file</span><span class="p">,</span> <span class="n">model_dir</span><span class="p">)</span></code>

<a href="#tm2py.SetupModel.__init__" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">

      <p>Initializes an instance of the SetupModel class.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>config_file</code></td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The TOML file with the model setup attributes.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>model_dir</code></td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The directory which to setup for a TM2 model run.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/setup_model/setup.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_file</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="n">model_dir</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initializes an instance of the SetupModel class.</span>

<span class="sd">    Args:</span>
<span class="sd">        config_file (pathlib.Path): The TOML file with the model setup attributes.</span>
<span class="sd">        model_dir (pathlib.Path): The directory which to setup for a TM2 model run.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config_file</span> <span class="o">=</span> <span class="n">config_file</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setup_config</span> <span class="o">=</span> <span class="n">SetupConfig</span><span class="p">(</span><span class="nb">dict</span><span class="p">())</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span> <span class="o">=</span> <span class="n">model_dir</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tm2py.SetupModel.run_setup" class="doc doc-heading">
            <code class=" language-python"><span class="n">run_setup</span><span class="p">()</span></code>

<a href="#tm2py.SetupModel.run_setup" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">

      <p>Does the work of setting up the model.  </p>
<p>This step will do the following within the model directory.</p>
<ol>
<li>Intialize logging to write to <code>setup.log</code></li>
<li>Copy the setup config file to <code>setupmodel_config.toml</code></li>
<li>Create the required folder structure</li>
<li>Copy the input from the locations specified:
   a. hwy and trn networks
   b. popsyn and landuse inputs
   c. nonres inputs
   d. warmstart demand matrices
   e. warmstart skims</li>
<li>Copy the Emme template project and Emme network databases 
   (based on the EMME version in sys.path)</li>
<li>Download the travel model CTRAMP core code (runtime, uec) from the 
   <a href="https://github.com/BayAreaMetro/travel-model-two">travel-model-two repository</a></li>
<li>Updates the IP address in the CTRAMP runtime properties files</li>
<li>Creates <code>RunModel.py</code> for running the model</li>
</ol>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="FileExistsError">FileExistsError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the model directory to setup already exists.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/setup_model/setup.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Does the work of setting up the model.  </span>

<span class="sd">    This step will do the following within the model directory.</span>

<span class="sd">    1. Intialize logging to write to `setup.log`</span>
<span class="sd">    2. Copy the setup config file to `setupmodel_config.toml`</span>
<span class="sd">    3. Create the required folder structure</span>
<span class="sd">    4. Copy the input from the locations specified:</span>
<span class="sd">       a. hwy and trn networks</span>
<span class="sd">       b. popsyn and landuse inputs</span>
<span class="sd">       c. nonres inputs</span>
<span class="sd">       d. warmstart demand matrices</span>
<span class="sd">       e. warmstart skims</span>
<span class="sd">    5. Copy the Emme template project and Emme network databases </span>
<span class="sd">       (based on the EMME version in sys.path)</span>
<span class="sd">    6. Download the travel model CTRAMP core code (runtime, uec) from the </span>
<span class="sd">       [travel-model-two repository](https://github.com/BayAreaMetro/travel-model-two)</span>
<span class="sd">    7. Updates the IP address in the CTRAMP runtime properties files</span>
<span class="sd">    8. Creates `RunModel.py` for running the model</span>

<span class="sd">    Raises:</span>
<span class="sd">        FileExistsError: If the model directory to setup already exists.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Read setup setup_config</span>
    <span class="n">config_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_toml</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setup_config</span> <span class="o">=</span> <span class="n">SetupConfig</span><span class="p">(</span><span class="n">config_dict</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setup_config</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>

    <span class="c1"># if the directory already exists - error and quit</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="si">}</span><span class="s2"> already exists! Setup terminated.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>

    <span class="c1"># Initialize logging</span>
    <span class="n">log_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span> <span class="o">/</span> <span class="s2">&quot;setup.log&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_setup_logging</span><span class="p">(</span><span class="n">log_file</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Starting process to setup MTC model in directory: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Save setup config into model dir as setupmodel_config.toml</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span> <span class="o">/</span> <span class="s2">&quot;setupmodel_config.toml&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Copied </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="s1">&#39;setupmodel_config.toml&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># List of folders to create</span>
    <span class="n">folders_to_create</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;acceptance&quot;</span><span class="p">,</span>
        <span class="s2">&quot;CTRAMP&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ctramp_output&quot;</span><span class="p">,</span>
        <span class="s2">&quot;demand_matrices&quot;</span><span class="p">,</span>
        <span class="s2">&quot;demand_matrices/highway&quot;</span><span class="p">,</span>
        <span class="s2">&quot;demand_matrices/highway/air_passenger&quot;</span><span class="p">,</span>
        <span class="s2">&quot;demand_matrices/highway/household&quot;</span><span class="p">,</span>
        <span class="s2">&quot;demand_matrices/highway/maz_demand&quot;</span><span class="p">,</span>
        <span class="s2">&quot;demand_matrices/highway/internal_external&quot;</span><span class="p">,</span>
        <span class="s2">&quot;demand_matrices/highway/commercial&quot;</span><span class="p">,</span>
        <span class="s2">&quot;demand_matrices/transit&quot;</span><span class="p">,</span>
        <span class="s2">&quot;emme_project&quot;</span><span class="p">,</span>
        <span class="s2">&quot;inputs&quot;</span><span class="p">,</span>
        <span class="s2">&quot;logs&quot;</span><span class="p">,</span>
        <span class="s2">&quot;notebooks&quot;</span><span class="p">,</span>
        <span class="s2">&quot;output_summaries&quot;</span><span class="p">,</span>
        <span class="s2">&quot;skim_matrices&quot;</span><span class="p">,</span>
        <span class="s2">&quot;skim_matrices/highway&quot;</span><span class="p">,</span>
        <span class="s2">&quot;skim_matrices/transit&quot;</span><span class="p">,</span>
        <span class="s2">&quot;skim_matrices/non_motorized&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="c1"># Create folder structure</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_create_folder_structure</span><span class="p">(</span><span class="n">folders_to_create</span><span class="p">)</span>

    <span class="c1"># Copy model inputs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_copy_model_inputs</span><span class="p">()</span>

    <span class="c1"># Copy emme project and database</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_copy_emme_project_and_database</span><span class="p">()</span>

    <span class="c1"># Download toml SetupConfig files from GitHub</span>
    <span class="n">config_files_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;observed_data.toml&quot;</span><span class="p">,</span>
        <span class="s2">&quot;canonical_crosswalk.toml&quot;</span><span class="p">,</span>
        <span class="s2">&quot;model_config.toml&quot;</span><span class="p">,</span>
        <span class="s2">&quot;scenario_config.toml&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">acceptance_config_files_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;observed_data.toml&quot;</span><span class="p">,</span>
        <span class="s2">&quot;canonical_crosswalk.toml&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">config_files_list</span><span class="p">:</span>
        <span class="n">github_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setup_config</span><span class="o">.</span><span class="n">CONFIGS_GITHUB_PATH</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">file</span>

        <span class="n">local_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span> <span class="o">/</span> <span class="n">file</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_download_file_from_github</span><span class="p">(</span><span class="n">github_url</span><span class="p">,</span> <span class="n">local_file</span><span class="p">)</span>

    <span class="c1"># Fetch required folders from travel model two github release (zip file)</span>
    <span class="n">org</span> <span class="o">=</span> <span class="s2">&quot;BayAreaMetro&quot;</span>
    <span class="n">repo</span> <span class="o">=</span> <span class="s2">&quot;travel-model-two&quot;</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setup_config</span><span class="o">.</span><span class="n">TRAVEL_MODEL_TWO_RELEASE_TAG</span>
    <span class="n">folders_to_extract</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;runtime&quot;</span><span class="p">,</span> <span class="s2">&quot;uec&quot;</span><span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_download_github_release</span><span class="p">(</span>
        <span class="n">org</span><span class="p">,</span>
        <span class="n">repo</span><span class="p">,</span>
        <span class="n">tag</span><span class="p">,</span>
        <span class="n">folders_to_extract</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span> <span class="o">/</span> <span class="s2">&quot;CTRAMP&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Rename &#39;uec&#39; folder to &#39;model&#39;</span>
    <span class="n">old_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span> <span class="o">/</span> <span class="s2">&quot;CTRAMP&quot;</span> <span class="o">/</span> <span class="s2">&quot;uec&quot;</span>
    <span class="n">old_path</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span> <span class="o">/</span> <span class="s2">&quot;CTRAMP&quot;</span> <span class="o">/</span> <span class="s2">&quot;model&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_create_run_model_batch</span><span class="p">()</span>

    <span class="c1"># update IP addresses in config files</span>
    <span class="n">ips_here</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostbyname_ex</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">())[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found the following IPs for this server: </span><span class="si">{</span><span class="n">ips_here</span><span class="si">}</span><span class="s2">; using the first one: </span><span class="si">{</span><span class="n">ips_here</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># add IP address to mtctm2.properties</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_replace_in_file</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span> <span class="o">/</span> <span class="s1">&#39;CTRAMP&#39;</span> <span class="o">/</span> <span class="s1">&#39;runtime&#39;</span> <span class="o">/</span> <span class="s1">&#39;mtctm2.properties&#39;</span><span class="p">,</span> <span class="p">{</span>
            <span class="s2">&quot;(</span><span class="se">\n</span><span class="s2">RunModel.MatrixServerAddress[ </span><span class="se">\t</span><span class="s2">]*=[ </span><span class="se">\t</span><span class="s2">]*)(\S*)&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;\g&lt;1&gt;</span><span class="si">{</span><span class="n">ips_here</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;(</span><span class="se">\n</span><span class="s2">RunModel.HouseholdServerAddress[ </span><span class="se">\t</span><span class="s2">]*=[ </span><span class="se">\t</span><span class="s2">]*)(\S*)&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;\g&lt;1&gt;</span><span class="si">{</span><span class="n">ips_here</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}</span>
    <span class="p">)</span>
    <span class="c1"># add IP address to logsum.properties</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_replace_in_file</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span> <span class="o">/</span> <span class="s1">&#39;CTRAMP&#39;</span> <span class="o">/</span> <span class="s1">&#39;runtime&#39;</span> <span class="o">/</span> <span class="s1">&#39;logsum.properties&#39;</span><span class="p">,</span> <span class="p">{</span>
            <span class="s2">&quot;(</span><span class="se">\n</span><span class="s2">RunModel.MatrixServerAddress[ </span><span class="se">\t</span><span class="s2">]*=[ </span><span class="se">\t</span><span class="s2">]*)(\S*)&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;\g&lt;1&gt;</span><span class="si">{</span><span class="n">ips_here</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;(</span><span class="se">\n</span><span class="s2">RunModel.HouseholdServerAddress[ </span><span class="se">\t</span><span class="s2">]*=[ </span><span class="se">\t</span><span class="s2">]*)(\S*)&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;\g&lt;1&gt;</span><span class="si">{</span><span class="n">ips_here</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Setup process completed successfully!&quot;</span><span class="p">)</span>

    <span class="c1"># Close logging</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="controller">Controller<a class="headerlink" href="#controller" title="Permanent link"> </a></h2>


<div class="doc doc-object doc-module">



<a id="tm2py.controller"></a>
    <div class="doc doc-contents first">

      <p>RunController - model operation controller.</p>
<p>Main interface to start a TM2PY model run. Provide one or more configuration
files in .toml format (by convention a scenario.toml and a model.toml)</p>
<p>Typical usage example:
  from tm2py.controller import RunController
  controller = RunController(
    [&ldquo;scenario.toml&rdquo;, &ldquo;model.toml&rdquo;])
  controller.run()</p>
<p>Or from the command-line:
  <code>python &lt;path&gt;/tm2py/tm2py/controller.py s scenario.toml m model.toml</code></p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="tm2py.controller.RunController" class="doc doc-heading">
            <code>RunController</code>


<a href="#tm2py.controller.RunController" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">


      <p>Main operational interface for model runs.</p>
<p>Provide one or more config files in TOML (*.toml) format, and a run directory.
If the run directory is not provided the root directory of the first config_file is used.</p>


<details class="properties" open>
  <summary>Properties</summary>
  
</details>

<details class="internal-properties" open>
  <summary>Internal properties</summary>
  
</details>
              <details class="quote">
                <summary>Source code in <code>tm2py/controller.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">RunController</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Main operational interface for model runs.</span>

<span class="sd">    Provide one or more config files in TOML (*.toml) format, and a run directory.</span>
<span class="sd">    If the run directory is not provided the root directory of the first config_file is used.</span>

<span class="sd">    Properties:</span>
<span class="sd">        config: root Configuration object</span>
<span class="sd">        logger: logger object</span>
<span class="sd">        top_sheet: placeholder for top sheet functionality (not implemented yet)</span>
<span class="sd">        trace: placeholder for trace functionality (not implemented yet)</span>
<span class="sd">        run_dir: root run directory for the model run</span>
<span class="sd">        iteration: current running (or last started) iteration</span>
<span class="sd">        component: current running (or last started) Component object</span>
<span class="sd">        emme_manager: EmmeManager object for centralized Emme-related (highway and</span>
<span class="sd">            transit assignments and skims) utilities.</span>
<span class="sd">        complete_components: list of components which have completed, tuple of</span>
<span class="sd">            (iteration, name, Component object)</span>

<span class="sd">    Internal properties:</span>
<span class="sd">        _emme_manager: EmmeManager object, cached on first access</span>
<span class="sd">        _iteration: current iteration</span>
<span class="sd">        _component: current running / last run Component</span>
<span class="sd">        _component_name: name of the current / last run component</span>
<span class="sd">        _queued_components: list of iteration, name, Component</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">config_file</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Collection</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">]],</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">run_dir</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">run_components</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">component_cls_map</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor for RunController class.</span>

<span class="sd">        Args:</span>
<span class="sd">            config_file: Single or list of config file locations as strings or Path objects.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            run_dir: Model run directory as a Path object or string. If not provided, defaults</span>
<span class="sd">                to the directory of the first config_file.</span>
<span class="sd">            run_components: List of component names to run. Defaults to all components.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">run_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">run_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">config_file</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_run_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">run_dir</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">Configuration</span><span class="o">.</span><span class="n">load_toml</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_emme</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">emme_context</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top_sheet</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">completed_components</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_validated_components</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_emme_manager</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_iteration</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_component</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_component_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_queued_components</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>

        <span class="c1"># create logger before creating components so we can log if issues arise in the component creation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;initialize_log(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">runtime_log_file</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">runtime_log_headers</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">runtime_log_col_width</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="n">initialize_log</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">runtime_log_file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">runtime_log_headers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">runtime_log_col_width</span>
        <span class="p">)</span>

        <span class="c1"># mapping from defined names referenced in config to Component objects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_component_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">component_cls_map</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">run_components</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">set_emme_manager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">emme_manager</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_queue_components</span><span class="p">(</span><span class="n">run_components</span><span class="o">=</span><span class="n">run_components</span><span class="p">)</span>



    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Legible representation.&quot;&quot;&quot;</span>
        <span class="n">_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;RunController</span>
<span class="s2">            Run Directory: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">run_dir</span><span class="si">}</span>
<span class="s2">            Iteration: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">iteration</span><span class="si">}</span><span class="s2"> of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">run_iterations</span><span class="si">}</span>
<span class="s2">            Component: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">component_name</span><span class="si">}</span>
<span class="s2">            Completed: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">completed_components</span><span class="si">}</span>
<span class="s2">            Queued: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_queued_components</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_str</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">run_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The root run directory of the model run.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_dir</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">run_iterations</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List of iterations for this model run.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">range</span><span class="p">(</span>
            <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">start_iteration</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">end_iteration</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">time_period_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return input time_period name or names and return list of time_period names.</span>

<span class="sd">        Implemented here for easy access for all components.</span>

<span class="sd">        Returns: list of uppercased string names of time periods</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">time</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">time_periods</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">time_period_durations</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return mapping of time periods to durations in hours.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">((</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">length_hours</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">time_periods</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">congested_transit_assn_max_iteration</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return mapping of time periods to max iteration in congested transit assignment.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">congested_transit_assn_max_iteration</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">time_periods</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">num_processors</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">num_processors</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">num_processors_transit_skim</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">num_processors_transit_skim</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">iteration</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Current iteration of model run.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iteration</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">component_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Name of current component of model run.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_component_name</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">iter_component</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Tuple of the current iteration and component name.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iteration</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_component_name</span>

    <span class="k">def</span> <span class="nf">component</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Component</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Current component of model.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_component</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">emme_manager</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EmmeManager</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Cached Emme Manager object.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emme_manager</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_emme</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_emme_manager</span> <span class="o">=</span> <span class="n">EmmeManager</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">emme</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Emme not found, skipping Emme-related components&quot;</span><span class="p">)</span>
                <span class="c1"># TODO: All of the Emme-related components need to be handled &quot;in place&quot; rather</span>
                <span class="c1"># than skippping using a Mock</span>
                <span class="kn">from</span> <span class="nn">unittest.mock</span> <span class="kn">import</span> <span class="n">MagicMock</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_emme_manager</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emme_manager</span>

    <span class="k">def</span> <span class="nf">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rel_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the absolute path from the root run directory given a relative path.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rel_path</span><span class="p">,</span> <span class="n">Path</span><span class="p">):</span>
            <span class="n">rel_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">rel_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">run_dir</span><span class="p">,</span> <span class="n">rel_path</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">runtime_log_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="s2">&quot;logs/runtime_log.txt&quot;</span><span class="p">)</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">runtime_log_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;LOOP&quot;</span><span class="p">,</span> <span class="s2">&quot;STEP&quot;</span><span class="p">,</span> <span class="s2">&quot;START_TIME&quot;</span><span class="p">,</span> <span class="s2">&quot;END_TIME&quot;</span><span class="p">,</span> <span class="s2">&quot;STEP_TIME (MINS)&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">runtime_log_col_width</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Main interface to run model.</span>

<span class="sd">        Iterates through the self._queued_components and runs them.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_iteration</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_queued_components</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_next</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">run_next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run next component in the queue.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_queued_components</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No components in queue&quot;</span><span class="p">)</span>
        <span class="n">iteration</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">component</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_queued_components</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iteration</span> <span class="o">!=</span> <span class="n">iteration</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Start iteration </span><span class="si">{</span><span class="n">iteration</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_iteration</span> <span class="o">=</span> <span class="n">iteration</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Running iteration </span><span class="si">{</span><span class="n">iteration</span><span class="si">}</span><span class="s2"> component </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">component_start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

        <span class="c1"># check wamrstart files exist</span>
        <span class="k">if</span> <span class="n">iteration</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">warmstart</span><span class="o">.</span><span class="n">warmstart</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">warmstart</span><span class="o">.</span><span class="n">use_warmstart_demand</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">source</span> <span class="ow">in</span> <span class="p">[</span>
                        <span class="s2">&quot;household&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;truck&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;air_passenger&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;internal_external&quot;</span><span class="p">,</span>
                    <span class="p">]:</span>
                        <span class="n">highway_demand_file</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">source</span><span class="p">]</span><span class="o">.</span><span class="n">highway_demand_file</span><span class="p">)</span>
                        <span class="p">)</span>
                        <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;time_periods&quot;</span><span class="p">]:</span>
                            <span class="n">path</span> <span class="o">=</span> <span class="n">highway_demand_file</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="n">period</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">iter</span><span class="o">=</span><span class="n">iteration</span>
                            <span class="p">)</span>
                            <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span>
                                <span class="n">path</span>
                            <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2"> required as warmstart demand does not exist&quot;</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">warmstart</span><span class="o">.</span><span class="n">use_warmstart_skim</span><span class="p">:</span>
                    <span class="n">highway_skim_file</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;highway&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">output_skim_path</span>
                            <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;highway&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">output_skim_filename_tmpl</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                    <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;time_periods&quot;</span><span class="p">]:</span>
                        <span class="n">path</span> <span class="o">=</span> <span class="n">highway_skim_file</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time_period</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span>
                            <span class="n">path</span>
                        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2"> required as warmstart skim does not exist&quot;</span>
                    <span class="n">transit_skim_file</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;transit&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">output_skim_path</span>
                            <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;transit&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">output_skim_filename_tmpl</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                    <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;time_periods&quot;</span><span class="p">]:</span>
                        <span class="k">for</span> <span class="n">tclass</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;transit&quot;</span><span class="p">][</span><span class="s2">&quot;classes&quot;</span><span class="p">]:</span>
                            <span class="n">path</span> <span class="o">=</span> <span class="n">transit_skim_file</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="n">time_period</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">tclass</span><span class="o">=</span><span class="n">tclass</span><span class="o">.</span><span class="n">name</span>
                            <span class="p">)</span>
                            <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span>
                                <span class="n">path</span>
                            <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2"> required as warmstart skim does not exist&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_component</span> <span class="o">=</span> <span class="n">component</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">component</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
            <span class="n">component_end_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="n">add_run_log</span><span class="p">(</span>
                <span class="n">iteration</span><span class="p">,</span>
                <span class="n">name</span><span class="p">,</span>
                <span class="n">component_start_time</span><span class="p">,</span>
                <span class="n">component_end_time</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">runtime_log_file</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">runtime_log_col_width</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="c1"># re-insert failed component on error</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_queued_components</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">iteration</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">component</span><span class="p">))</span>
            <span class="k">raise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">completed_components</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">iteration</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">component</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_queue_components</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run_components</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add components per iteration to queue according to input Config.</span>

<span class="sd">        Args:</span>
<span class="sd">            run_components: if provided, only run these components</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_queued_components</span>
        <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Components already queued, returning without re-queuing.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">_initial_components</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">initial_components</span>
        <span class="n">_global_iter_components</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">global_iteration_components</span>
        <span class="n">_final_components</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">final_components</span>

        <span class="k">if</span> <span class="n">run_components</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_initial_components</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">_initial_components</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">run_components</span>
            <span class="p">]</span>
            <span class="n">_global_iter_components</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">_global_iter_components</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">run_components</span>
            <span class="p">]</span>
            <span class="n">_final_components</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">_final_components</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">run_components</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">start_iteration</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">warmstart</span><span class="o">.</span><span class="n">warmstart</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">warmstart</span><span class="o">.</span><span class="n">use_warmstart_skim</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s2">&quot;highway&quot;</span> <span class="ow">in</span> <span class="n">_initial_components</span><span class="p">:</span>
                        <span class="n">_initial_components</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;highway&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="s2">&quot;transit_assign&quot;</span> <span class="ow">in</span> <span class="n">_initial_components</span><span class="p">:</span>
                        <span class="n">_initial_components</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;transit_assign&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="s2">&quot;transit_skim&quot;</span> <span class="ow">in</span> <span class="n">_initial_components</span><span class="p">:</span>
                        <span class="n">_initial_components</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;transit_skim&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">_c_name</span> <span class="ow">in</span> <span class="n">_initial_components</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_add_component_to_queue</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">_c_name</span><span class="p">)</span>

        <span class="c1"># Queue components which are run for each iteration</span>

        <span class="n">_iteration_x_components</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_iterations</span><span class="p">,</span> <span class="n">_global_iter_components</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">_iteration</span><span class="p">,</span> <span class="n">_c_name</span> <span class="ow">in</span> <span class="n">_iteration_x_components</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_component_to_queue</span><span class="p">(</span><span class="n">_iteration</span><span class="p">,</span> <span class="n">_c_name</span><span class="p">)</span>

        <span class="c1"># Queue components which are run after final iteration</span>
        <span class="n">_finalizer_iteration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">end_iteration</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">for</span> <span class="n">_c_name</span> <span class="ow">in</span> <span class="n">_final_components</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_component_to_queue</span><span class="p">(</span><span class="n">_finalizer_iteration</span><span class="p">,</span> <span class="n">_c_name</span><span class="p">)</span>

        <span class="c1"># If start_component specified, remove things before its first occurance</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">start_component</span><span class="p">:</span>
            <span class="n">_queued_c_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_queued_components</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">start_component</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_queued_c_names</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Start component </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">start_component</span><span class="si">}</span><span class="s2"> not found in queued </span><span class="se">\</span>
<span class="s2">                    components </span><span class="si">{</span><span class="n">_queued_c_names</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="n">_start_c_index</span> <span class="o">=</span> <span class="n">_queued_c_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">start_component</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_queued_components</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_queued_components</span><span class="p">[</span><span class="n">_start_c_index</span><span class="p">:]</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RUN COMPOMENTS:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">_queued_component</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_queued_components</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Global iteration </span><span class="si">{</span><span class="n">_queued_component</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">_queued_component</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_add_component_to_queue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iteration</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">component_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add component to queue (self._queued_components), first validating its inputs.</span>

<span class="sd">        Args:</span>
<span class="sd">            iteration (int): iteration to add component to.</span>
<span class="sd">            component_name (Component): Component to add to queue.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_component</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_component_map</span><span class="p">[</span><span class="n">component_name</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">component_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validated_components</span><span class="p">:</span>
            <span class="n">_component</span><span class="o">.</span><span class="n">validate_inputs</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_validated_components</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">component_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_queued_components</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">iteration</span><span class="p">,</span> <span class="n">component_name</span><span class="p">,</span> <span class="n">_component</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="tm2py.controller.RunController.component_name" class="doc doc-heading">
            <code class=" language-python"><span class="n">component_name</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.controller.RunController.component_name" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Name of current component of model run.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tm2py.controller.RunController.congested_transit_assn_max_iteration" class="doc doc-heading">
            <code class=" language-python"><span class="n">congested_transit_assn_max_iteration</span><span class="p">:</span> <span class="nb">dict</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.controller.RunController.congested_transit_assn_max_iteration" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Return mapping of time periods to max iteration in congested transit assignment.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tm2py.controller.RunController.emme_manager" class="doc doc-heading">
            <code class=" language-python"><span class="n">emme_manager</span><span class="p">:</span> <span class="n">EmmeManager</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.controller.RunController.emme_manager" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Cached Emme Manager object.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tm2py.controller.RunController.iter_component" class="doc doc-heading">
            <code class=" language-python"><span class="n">iter_component</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.controller.RunController.iter_component" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Tuple of the current iteration and component name.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tm2py.controller.RunController.iteration" class="doc doc-heading">
            <code class=" language-python"><span class="n">iteration</span><span class="p">:</span> <span class="nb">int</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.controller.RunController.iteration" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Current iteration of model run.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tm2py.controller.RunController.run_dir" class="doc doc-heading">
            <code class=" language-python"><span class="n">run_dir</span><span class="p">:</span> <span class="n">Path</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.controller.RunController.run_dir" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>The root run directory of the model run.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tm2py.controller.RunController.run_iterations" class="doc doc-heading">
            <code class=" language-python"><span class="n">run_iterations</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.controller.RunController.run_iterations" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>List of iterations for this model run.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tm2py.controller.RunController.time_period_durations" class="doc doc-heading">
            <code class=" language-python"><span class="n">time_period_durations</span><span class="p">:</span> <span class="nb">dict</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.controller.RunController.time_period_durations" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Return mapping of time periods to durations in hours.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tm2py.controller.RunController.time_period_names" class="doc doc-heading">
            <code class=" language-python"><span class="n">time_period_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.controller.RunController.time_period_names" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Return input time_period name or names and return list of time_period names.</p>
<p>Implemented here for easy access for all components.</p>
<p>Returns: list of uppercased string names of time periods</p>
    </div>

</div>



<div class="doc doc-object doc-function">


<h3 id="tm2py.controller.RunController.__init__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">config_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">run_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">run_components</span><span class="o">=</span><span class="n">component_cls_map</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></code>

<a href="#tm2py.controller.RunController.__init__" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Constructor for RunController class.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>config_file</code></td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="typing.Collection">Collection</span>[<span title="typing.Union">Union</span>[<span title="str">str</span>, <span title="pathlib.Path">Path</span>]], <span title="str">str</span>, <span title="pathlib.Path">Path</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Single or list of config file locations as strings or Path objects.
Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>run_dir</code></td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="pathlib.Path">Path</span>, <span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Model run directory as a Path object or string. If not provided, defaults
to the directory of the first config_file.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>run_components</code></td>
            <td>
                  <code><span title="typing.Collection">Collection</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of component names to run. Defaults to all components.</p>
              </div>
            </td>
            <td>
                  <code><span title="tm2py.controller.component_cls_map.keys">keys</span>()</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/controller.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">config_file</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Collection</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">]],</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">run_dir</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">run_components</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">component_cls_map</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Constructor for RunController class.</span>

<span class="sd">    Args:</span>
<span class="sd">        config_file: Single or list of config file locations as strings or Path objects.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        run_dir: Model run directory as a Path object or string. If not provided, defaults</span>
<span class="sd">            to the directory of the first config_file.</span>
<span class="sd">        run_components: List of component names to run. Defaults to all components.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">run_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">run_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">config_file</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_run_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">run_dir</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">Configuration</span><span class="o">.</span><span class="n">load_toml</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">has_emme</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">emme_context</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">top_sheet</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">trace</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">completed_components</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_validated_components</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_emme_manager</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_iteration</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_component</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_component_name</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_queued_components</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>

    <span class="c1"># create logger before creating components so we can log if issues arise in the component creation</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;initialize_log(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">runtime_log_file</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">runtime_log_headers</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">runtime_log_col_width</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
    <span class="n">initialize_log</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">runtime_log_file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">runtime_log_headers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">runtime_log_col_width</span>
    <span class="p">)</span>

    <span class="c1"># mapping from defined names referenced in config to Component objects</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_component_map</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">component_cls_map</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">run_components</span>
    <span class="p">}</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">set_emme_manager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">emme_manager</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_queue_components</span><span class="p">(</span><span class="n">run_components</span><span class="o">=</span><span class="n">run_components</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.controller.RunController.__repr__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__repr__</span><span class="p">()</span></code>

<a href="#tm2py.controller.RunController.__repr__" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Legible representation.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/controller.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Legible representation.&quot;&quot;&quot;</span>
    <span class="n">_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;RunController</span>
<span class="s2">        Run Directory: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">run_dir</span><span class="si">}</span>
<span class="s2">        Iteration: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">iteration</span><span class="si">}</span><span class="s2"> of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">run_iterations</span><span class="si">}</span>
<span class="s2">        Component: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">component_name</span><span class="si">}</span>
<span class="s2">        Completed: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">completed_components</span><span class="si">}</span>
<span class="s2">        Queued: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_queued_components</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_str</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.controller.RunController.component" class="doc doc-heading">
            <code class=" language-python"><span class="n">component</span><span class="p">()</span></code>

<a href="#tm2py.controller.RunController.component" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Current component of model.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/controller.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">component</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Component</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Current component of model.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_component</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.controller.RunController.get_abs_path" class="doc doc-heading">
            <code class=" language-python"><span class="n">get_abs_path</span><span class="p">(</span><span class="n">rel_path</span><span class="p">)</span></code>

<a href="#tm2py.controller.RunController.get_abs_path" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Get the absolute path from the root run directory given a relative path.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/controller.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rel_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the absolute path from the root run directory given a relative path.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rel_path</span><span class="p">,</span> <span class="n">Path</span><span class="p">):</span>
        <span class="n">rel_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">rel_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">run_dir</span><span class="p">,</span> <span class="n">rel_path</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.controller.RunController.run" class="doc doc-heading">
            <code class=" language-python"><span class="n">run</span><span class="p">()</span></code>

<a href="#tm2py.controller.RunController.run" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Main interface to run model.</p>
<p>Iterates through the self._queued_components and runs them.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/controller.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Main interface to run model.</span>

<span class="sd">    Iterates through the self._queued_components and runs them.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_iteration</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_queued_components</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_next</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.controller.RunController.run_next" class="doc doc-heading">
            <code class=" language-python"><span class="n">run_next</span><span class="p">()</span></code>

<a href="#tm2py.controller.RunController.run_next" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Run next component in the queue.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/controller.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run next component in the queue.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_queued_components</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No components in queue&quot;</span><span class="p">)</span>
    <span class="n">iteration</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">component</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_queued_components</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iteration</span> <span class="o">!=</span> <span class="n">iteration</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Start iteration </span><span class="si">{</span><span class="n">iteration</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_iteration</span> <span class="o">=</span> <span class="n">iteration</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Running iteration </span><span class="si">{</span><span class="n">iteration</span><span class="si">}</span><span class="s2"> component </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">component_start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

    <span class="c1"># check wamrstart files exist</span>
    <span class="k">if</span> <span class="n">iteration</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">warmstart</span><span class="o">.</span><span class="n">warmstart</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">warmstart</span><span class="o">.</span><span class="n">use_warmstart_demand</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">source</span> <span class="ow">in</span> <span class="p">[</span>
                    <span class="s2">&quot;household&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;truck&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;air_passenger&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;internal_external&quot;</span><span class="p">,</span>
                <span class="p">]:</span>
                    <span class="n">highway_demand_file</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">source</span><span class="p">]</span><span class="o">.</span><span class="n">highway_demand_file</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;time_periods&quot;</span><span class="p">]:</span>
                        <span class="n">path</span> <span class="o">=</span> <span class="n">highway_demand_file</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">period</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">iter</span><span class="o">=</span><span class="n">iteration</span>
                        <span class="p">)</span>
                        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span>
                            <span class="n">path</span>
                        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2"> required as warmstart demand does not exist&quot;</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">warmstart</span><span class="o">.</span><span class="n">use_warmstart_skim</span><span class="p">:</span>
                <span class="n">highway_skim_file</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;highway&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">output_skim_path</span>
                        <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;highway&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">output_skim_filename_tmpl</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;time_periods&quot;</span><span class="p">]:</span>
                    <span class="n">path</span> <span class="o">=</span> <span class="n">highway_skim_file</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time_period</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span>
                        <span class="n">path</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2"> required as warmstart skim does not exist&quot;</span>
                <span class="n">transit_skim_file</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;transit&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">output_skim_path</span>
                        <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;transit&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">output_skim_filename_tmpl</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;time_periods&quot;</span><span class="p">]:</span>
                    <span class="k">for</span> <span class="n">tclass</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;transit&quot;</span><span class="p">][</span><span class="s2">&quot;classes&quot;</span><span class="p">]:</span>
                        <span class="n">path</span> <span class="o">=</span> <span class="n">transit_skim_file</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">time_period</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">tclass</span><span class="o">=</span><span class="n">tclass</span><span class="o">.</span><span class="n">name</span>
                        <span class="p">)</span>
                        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span>
                            <span class="n">path</span>
                        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2"> required as warmstart skim does not exist&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_component</span> <span class="o">=</span> <span class="n">component</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">component</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="n">component_end_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">add_run_log</span><span class="p">(</span>
            <span class="n">iteration</span><span class="p">,</span>
            <span class="n">name</span><span class="p">,</span>
            <span class="n">component_start_time</span><span class="p">,</span>
            <span class="n">component_end_time</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">runtime_log_file</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">runtime_log_col_width</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="c1"># re-insert failed component on error</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_queued_components</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">iteration</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">component</span><span class="p">))</span>
        <span class="k">raise</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">completed_components</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">iteration</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">component</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h2 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link"> </a></h2>


<div class="doc doc-object doc-module">



<a id="tm2py.config"></a>
    <div class="doc doc-contents first">

      <p>Config implementation and schema.</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="tm2py.config.ActiveModeShortestPathSkimConfig" class="doc doc-heading">
            <code>ActiveModeShortestPathSkimConfig</code>


<a href="#tm2py.config.ActiveModeShortestPathSkimConfig" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Active mode skim entry.</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ActiveModeShortestPathSkimConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Active mode skim entry.&quot;&quot;&quot;</span>

    <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">roots</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">leaves</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">output</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">max_dist_miles</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.ActiveModesConfig" class="doc doc-heading">
            <code>ActiveModesConfig</code>


<a href="#tm2py.config.ActiveModesConfig" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Active Mode skim parameters.</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ActiveModesConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Active Mode skim parameters.&quot;&quot;&quot;</span>

    <span class="n">emme_scenario_id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">shortest_path_skims</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">ActiveModeShortestPathSkimConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.AirPassengerConfig" class="doc doc-heading">
            <code>AirPassengerConfig</code>


<a href="#tm2py.config.AirPassengerConfig" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Air passenger model parameters.</p>
<p>Properties</p>
<p>highway_demand_file: output OMX file
input_demand_folder: location to find the input demand csvs
input_demand_filename_tmpl: filename template for input demand. Should have
    {year}, {direction} and {airport} variables and end in &lsquo;.csv&rsquo;
reference_start_year: base start year for input demand tables
    used to calculate the linear interpolation, as well as
    in the file name template {year}<em>{direction}{airport}.csv
reference_end_year: end year for input demand tables
    used to calculate the linear interpolation, as well as
    in the file name template {year}</em>{direction}{airport}.csv
airport_names: list of one or more airport names / codes as used in
    the input file names
demand_aggregation: specification of aggregation of by-access mode
    demand to highway class demand</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">AirPassengerConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Air passenger model parameters.</span>

<span class="sd">    Properties</span>

<span class="sd">    highway_demand_file: output OMX file</span>
<span class="sd">    input_demand_folder: location to find the input demand csvs</span>
<span class="sd">    input_demand_filename_tmpl: filename template for input demand. Should have</span>
<span class="sd">        {year}, {direction} and {airport} variables and end in &#39;.csv&#39;</span>
<span class="sd">    reference_start_year: base start year for input demand tables</span>
<span class="sd">        used to calculate the linear interpolation, as well as</span>
<span class="sd">        in the file name template {year}_{direction}{airport}.csv</span>
<span class="sd">    reference_end_year: end year for input demand tables</span>
<span class="sd">        used to calculate the linear interpolation, as well as</span>
<span class="sd">        in the file name template {year}_{direction}{airport}.csv</span>
<span class="sd">    airport_names: list of one or more airport names / codes as used in</span>
<span class="sd">        the input file names</span>
<span class="sd">    demand_aggregation: specification of aggregation of by-access mode</span>
<span class="sd">        demand to highway class demand</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">output_trip_table_directory</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">outfile_trip_table_tmp</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">input_demand_folder</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">input_demand_filename_tmpl</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">highway_demand_file</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">reference_start_year</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">reference_end_year</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">airport_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">demand_aggregation</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AirPassengerDemandAggregationConfig</span><span class="p">]</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;input_demand_filename_tmpl&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">valid_input_demand_filename_tmpl</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate skim matrix template has correct {}.&quot;&quot;&quot;</span>

        <span class="k">assert</span> <span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{year}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">value</span>
        <span class="p">),</span> <span class="s2">&quot;-&gt; &#39;output_skim_matrixname_tmpl must have </span><span class="si">{year}</span><span class="s2">, found </span><span class="si">{value}</span><span class="s2">.&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{direction}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">value</span>
        <span class="p">),</span> <span class="s2">&quot;-&gt; &#39;output_skim_matrixname_tmpl must have </span><span class="si">{direction}</span><span class="s2">, found </span><span class="si">{value}</span><span class="s2">.&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{airport}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">value</span>
        <span class="p">),</span> <span class="s2">&quot;-&gt; &#39;output_skim_matrixname_tmpl must have </span><span class="si">{airport}</span><span class="s2">, found </span><span class="si">{value}</span><span class="s2">.&quot;</span>
        <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tm2py.config.AirPassengerConfig.valid_input_demand_filename_tmpl" class="doc doc-heading">
            <code class=" language-python"><span class="n">valid_input_demand_filename_tmpl</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

<a href="#tm2py.config.AirPassengerConfig.valid_input_demand_filename_tmpl" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Validate skim matrix template has correct {}.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/config.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;input_demand_filename_tmpl&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">valid_input_demand_filename_tmpl</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate skim matrix template has correct {}.&quot;&quot;&quot;</span>

    <span class="k">assert</span> <span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">{year}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">value</span>
    <span class="p">),</span> <span class="s2">&quot;-&gt; &#39;output_skim_matrixname_tmpl must have </span><span class="si">{year}</span><span class="s2">, found </span><span class="si">{value}</span><span class="s2">.&quot;</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">{direction}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">value</span>
    <span class="p">),</span> <span class="s2">&quot;-&gt; &#39;output_skim_matrixname_tmpl must have </span><span class="si">{direction}</span><span class="s2">, found </span><span class="si">{value}</span><span class="s2">.&quot;</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">{airport}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">value</span>
    <span class="p">),</span> <span class="s2">&quot;-&gt; &#39;output_skim_matrixname_tmpl must have </span><span class="si">{airport}</span><span class="s2">, found </span><span class="si">{value}</span><span class="s2">.&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.AirPassengerDemandAggregationConfig" class="doc doc-heading">
            <code>AirPassengerDemandAggregationConfig</code>


<a href="#tm2py.config.AirPassengerDemandAggregationConfig" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Air passenger demand aggregation input parameters.</p>


<details class="properties" open>
  <summary>Properties</summary>
  
</details>
              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">AirPassengerDemandAggregationConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Air passenger demand aggregation input parameters.</span>

<span class="sd">    Properties:</span>
<span class="sd">        name: (src_group_name) name used for the class group in the input columns</span>
<span class="sd">            for the trip tables,</span>
<span class="sd">        mode: (result_class_name) name used in the output OMX matrix names, note</span>
<span class="sd">            that this should match the expected naming convention in the</span>
<span class="sd">            HighwayClassDemandConfig name(s)</span>
<span class="sd">        access_modes: list of names used for the access modes in the input</span>
<span class="sd">            columns for the trip tables</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">access_modes</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.AssignmentStoppingCriteriaConfig" class="doc doc-heading">
            <code>AssignmentStoppingCriteriaConfig</code>


<a href="#tm2py.config.AssignmentStoppingCriteriaConfig" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Assignment stop configuration parameters.</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">AssignmentStoppingCriteriaConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="s2">&quot;Assignment stop configuration parameters.&quot;</span>

    <span class="n">max_iterations</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">relative_difference</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">percent_segments_over_capacity</span><span class="p">:</span> <span class="nb">float</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.CcrWeightsConfig" class="doc doc-heading">
            <code>CcrWeightsConfig</code>


<a href="#tm2py.config.CcrWeightsConfig" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Weights for CCR Configuration.</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">CcrWeightsConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="s2">&quot;Weights for CCR Configuration.&quot;</span>

    <span class="n">min_seat</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">max_seat</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.4</span><span class="p">)</span>
    <span class="n">power_seat</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">2.2</span><span class="p">)</span>
    <span class="n">min_stand</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.4</span><span class="p">)</span>
    <span class="n">max_stand</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.6</span><span class="p">)</span>
    <span class="n">power_stand</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">3.4</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.ChoiceClassConfig" class="doc doc-heading">
            <code>ChoiceClassConfig</code>


<a href="#tm2py.config.ChoiceClassConfig" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Choice class parameters.</p>


<details class="properties" open>
  <summary>Properties</summary>
  
</details>      <p>The end value in the utility equation for class c and property p is:</p>
<p>utility[p].coeff *
   classes[c].property_factor[p] *
   sum(skim(classes[c].skim_mode,skim_p) for skim_p in property_to_skim[p])</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ChoiceClassConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Choice class parameters.</span>

<span class="sd">    Properties:</span>
<span class="sd">        property_to_skim_toll: Maps a property in the utility equation with a list of skim</span>
<span class="sd">            properties. If more than one skim property is listed, they will be summed together</span>
<span class="sd">            (e.g. cost if the sum of bridge toll and value toll). This defaults to a value in the</span>
<span class="sd">            code.</span>
<span class="sd">        property_to_skim_notoll: Maps a property in the utility equation with a list of skim</span>
<span class="sd">            properties for no toll choice.If more than one skim property is listed, they will</span>
<span class="sd">            be summed together  (e.g. cost if the sum of bridge toll and value toll). This</span>
<span class="sd">            defaults to a value in the code.</span>
<span class="sd">        property_factors: This will scale the property for this class. e.g. a shared ride cost</span>
<span class="sd">            could be applied a factor assuming that the cost is shared among individuals.</span>

<span class="sd">    The end value in the utility equation for class c and property p is:</span>

<span class="sd">       utility[p].coeff *</span>
<span class="sd">       classes[c].property_factor[p] *</span>
<span class="sd">       sum(skim(classes[c].skim_mode,skim_p) for skim_p in property_to_skim[p])</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">skim_mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;da&quot;</span><span class="p">)</span>
    <span class="n">veh_group_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">property_factors</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">CoefficientConfig</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.ClassDemandConfig" class="doc doc-heading">
            <code>ClassDemandConfig</code>


<a href="#tm2py.config.ClassDemandConfig" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Input source for demand for highway or transit assignment class.</p>
<p>Used to specify where to find related demand file for this
highway or transit class.</p>


<details class="properties" open>
  <summary>Properties</summary>
  
</details>
              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ClassDemandConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Input source for demand for highway or transit assignment class.</span>

<span class="sd">    Used to specify where to find related demand file for this</span>
<span class="sd">    highway or transit class.</span>

<span class="sd">    Properties:</span>
<span class="sd">        source: reference name of the component section for the</span>
<span class="sd">                source &quot;highway_demand_file&quot; (for a highway class)</span>
<span class="sd">                or &quot;transit_demand_file&quot; (for a transit class), one of:</span>
<span class="sd">                &quot;household&quot;, &quot;air_passenger&quot;, &quot;internal_external&quot;, &quot;truck&quot;</span>
<span class="sd">        name: name of matrix in the OMX file, can include &quot;{period}&quot;</span>
<span class="sd">                placeholder</span>
<span class="sd">        factor: optional, multiplicative factor to generate PCEs from</span>
<span class="sd">                trucks or convert person-trips to vehicle-trips for HOVs</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">source</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;household&quot;</span><span class="p">,</span> <span class="s2">&quot;air_passenger&quot;</span><span class="p">,</span> <span class="s2">&quot;internal_external&quot;</span><span class="p">,</span> <span class="s2">&quot;truck&quot;</span><span class="p">]</span>
    <span class="n">factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.CoefficientConfig" class="doc doc-heading">
            <code>CoefficientConfig</code>


<a href="#tm2py.config.CoefficientConfig" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Coefficient and properties to be used in utility or regression.</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">CoefficientConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Coefficient and properties to be used in utility or regression.&quot;&quot;&quot;</span>

    <span class="nb">property</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">coeff</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.ConfigItem" class="doc doc-heading">
            <code>ConfigItem</code>


<a href="#tm2py.config.ConfigItem" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="abc.ABC">ABC</span></code></p>


      <p>Base class to add partial dict-like interface to tm2py model configuration.</p>
<p>Allow use of .items() [&ldquo;X&rdquo;] and .get(&ldquo;X&rdquo;) .to_dict() from configuration.</p>
<p>Not to be constructed directly. To be used a mixin for dataclasses
representing config schema.
Do not use &ldquo;get&rdquo; &ldquo;to_dict&rdquo;, or &ldquo;items&rdquo; for key names.</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ConfigItem</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class to add partial dict-like interface to tm2py model configuration.</span>

<span class="sd">    Allow use of .items() [&quot;X&quot;] and .get(&quot;X&quot;) .to_dict() from configuration.</span>

<span class="sd">    Not to be constructed directly. To be used a mixin for dataclasses</span>
<span class="sd">    representing config schema.</span>
<span class="sd">    Do not use &quot;get&quot; &quot;to_dict&quot;, or &quot;items&quot; for key names.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get item for config. D[key] -&gt; D[key] if key in D, else raise KeyError.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The sub-config objects in config.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the value for key if key is in the dictionary, else default.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tm2py.config.ConfigItem.__getitem__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span></code>

<a href="#tm2py.config.ConfigItem.__getitem__" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Get item for config. D[key] -&gt; D[key] if key in D, else raise KeyError.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/config.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get item for config. D[key] -&gt; D[key] if key in D, else raise KeyError.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.config.ConfigItem.get" class="doc doc-heading">
            <code class=" language-python"><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#tm2py.config.ConfigItem.get" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Return the value for key if key is in the dictionary, else default.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/config.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the value for key if key is in the dictionary, else default.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.config.ConfigItem.items" class="doc doc-heading">
            <code class=" language-python"><span class="n">items</span><span class="p">()</span></code>

<a href="#tm2py.config.ConfigItem.items" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>The sub-config objects in config.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/config.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The sub-config objects in config.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.Configuration" class="doc doc-heading">
            <code>Configuration</code>


<a href="#tm2py.config.Configuration" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      

              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Configuration</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Configuration: root of the model configuration.&quot;&quot;&quot;</span>

    <span class="n">scenario</span><span class="p">:</span> <span class="n">ScenarioConfig</span>
    <span class="n">run</span><span class="p">:</span> <span class="n">RunConfig</span>
    <span class="n">warmstart</span><span class="p">:</span> <span class="n">WarmStartConfig</span>
    <span class="n">time_periods</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">TimePeriodConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
    <span class="n">household</span><span class="p">:</span> <span class="n">HouseholdConfig</span>
    <span class="n">air_passenger</span><span class="p">:</span> <span class="n">AirPassengerConfig</span>
    <span class="n">internal_external</span><span class="p">:</span> <span class="n">InternalExternalConfig</span>
    <span class="n">truck</span><span class="p">:</span> <span class="n">TruckConfig</span>
    <span class="n">active_modes</span><span class="p">:</span> <span class="n">ActiveModesConfig</span>
    <span class="n">highway</span><span class="p">:</span> <span class="n">HighwayConfig</span>
    <span class="n">transit</span><span class="p">:</span> <span class="n">TransitConfig</span>
    <span class="n">post_processor</span><span class="p">:</span> <span class="n">PostProcessorConfig</span>
    <span class="n">emme</span><span class="p">:</span> <span class="n">EmmeConfig</span>
    <span class="n">logging</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">LoggingConfig</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">LoggingConfig</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load_toml</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">toml_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]],</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Configuration&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load configuration from .toml files(s).</span>

<span class="sd">        Normally the config is split into a scenario_config.toml file and a</span>
<span class="sd">        model_config.toml file.</span>

<span class="sd">        Args:</span>
<span class="sd">            toml_path: a valid system path string or Path object to a TOML format config file or</span>
<span class="sd">                list of paths of path objects to a set of TOML files.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A Configuration object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">toml_path</span><span class="p">,</span> <span class="n">List</span><span class="p">):</span>
            <span class="n">toml_path</span> <span class="o">=</span> <span class="p">[</span><span class="n">toml_path</span><span class="p">]</span>
        <span class="n">toml_path</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="n">toml_path</span><span class="p">))</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">_load_toml</span><span class="p">(</span><span class="n">toml_path</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">path_item</span> <span class="ow">in</span> <span class="n">toml_path</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">_merge_dicts</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">_load_toml</span><span class="p">(</span><span class="n">path_item</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">)</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;highway&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">maz_skim_period_exists</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate highway.maz_to_maz.skim_period refers to a valid period.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;time_periods&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="n">time_period_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;time_periods&quot;</span><span class="p">])</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="n">value</span><span class="o">.</span><span class="n">maz_to_maz</span><span class="o">.</span><span class="n">skim_period</span> <span class="ow">in</span> <span class="n">time_period_names</span>
            <span class="p">),</span> <span class="s2">&quot;maz_to_maz -&gt; skim_period -&gt; name not found in time_periods list&quot;</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;highway&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">relative_gap_length</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate highway.relative_gaps is a list of length greater or equal to global iterations.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;run&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">relative_gaps</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="p">(</span>
                <span class="n">values</span><span class="p">[</span><span class="s2">&quot;run&quot;</span><span class="p">][</span><span class="s2">&quot;end_iteration&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;&#39;highway.relative_gaps must be the same or greater length as end_iteration+1,</span><span class="se">\</span>
<span class="s2">                that includes global iteration 0 to </span><span class="si">{</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;run&#39;</span><span class="p">][</span><span class="s1">&#39;end_iteration&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;transit&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">transit_stop_criteria_length</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate transit.congested.stop_criteria is a list of length greater or equal to global iterations.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;run&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">congested_transit_assignment</span><span class="p">):</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">congested</span><span class="o">.</span><span class="n">stop_criteria</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="p">(</span>
                <span class="n">values</span><span class="p">[</span><span class="s2">&quot;run&quot;</span><span class="p">][</span><span class="s2">&quot;end_iteration&quot;</span><span class="p">]</span>
            <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;&#39;transit.stop_criteria must be the same or greater length as end_iteration,</span><span class="se">\</span>
<span class="s2">                that includes global iteration 1 to </span><span class="si">{</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;run&#39;</span><span class="p">][</span><span class="s1">&#39;end_iteration&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;household&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">sample_rate_length</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate highway.sample_rate_by_iteration is a list of length greater or equal to global iterations.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;run&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">sample_rate_by_iteration</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="p">(</span>
                <span class="n">values</span><span class="p">[</span><span class="s2">&quot;run&quot;</span><span class="p">][</span><span class="s2">&quot;end_iteration&quot;</span><span class="p">]</span>
            <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;&#39;highway.sample_rate_by_iteration must be the same or greater length as end_iteration&#39;&quot;</span>
        <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tm2py.config.Configuration.load_toml" class="doc doc-heading">
            <code class=" language-python"><span class="n">load_toml</span><span class="p">(</span><span class="n">toml_path</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#tm2py.config.Configuration.load_toml" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Load configuration from .toml files(s).</p>
<p>Normally the config is split into a scenario_config.toml file and a
model_config.toml file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>toml_path</code></td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="typing.List">List</span>[<span title="typing.Union">Union</span>[<span title="str">str</span>, <span title="pathlib.Path">Path</span>]], <span title="str">str</span>, <span title="pathlib.Path">Path</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a valid system path string or Path object to a TOML format config file or
list of paths of path objects to a set of TOML files.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="Configuration (tm2py.config.Configuration)" href="#tm2py.config.Configuration">Configuration</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A Configuration object</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/config.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">load_toml</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span>
    <span class="n">toml_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]],</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Configuration&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load configuration from .toml files(s).</span>

<span class="sd">    Normally the config is split into a scenario_config.toml file and a</span>
<span class="sd">    model_config.toml file.</span>

<span class="sd">    Args:</span>
<span class="sd">        toml_path: a valid system path string or Path object to a TOML format config file or</span>
<span class="sd">            list of paths of path objects to a set of TOML files.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A Configuration object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">toml_path</span><span class="p">,</span> <span class="n">List</span><span class="p">):</span>
        <span class="n">toml_path</span> <span class="o">=</span> <span class="p">[</span><span class="n">toml_path</span><span class="p">]</span>
    <span class="n">toml_path</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="n">toml_path</span><span class="p">))</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">_load_toml</span><span class="p">(</span><span class="n">toml_path</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">path_item</span> <span class="ow">in</span> <span class="n">toml_path</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="n">_merge_dicts</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">_load_toml</span><span class="p">(</span><span class="n">path_item</span><span class="p">))</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.config.Configuration.maz_skim_period_exists" class="doc doc-heading">
            <code class=" language-python"><span class="n">maz_skim_period_exists</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>

<a href="#tm2py.config.Configuration.maz_skim_period_exists" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Validate highway.maz_to_maz.skim_period refers to a valid period.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/config.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;highway&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">maz_skim_period_exists</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate highway.maz_to_maz.skim_period refers to a valid period.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;time_periods&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="n">time_period_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;time_periods&quot;</span><span class="p">])</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">value</span><span class="o">.</span><span class="n">maz_to_maz</span><span class="o">.</span><span class="n">skim_period</span> <span class="ow">in</span> <span class="n">time_period_names</span>
        <span class="p">),</span> <span class="s2">&quot;maz_to_maz -&gt; skim_period -&gt; name not found in time_periods list&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.config.Configuration.relative_gap_length" class="doc doc-heading">
            <code class=" language-python"><span class="n">relative_gap_length</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>

<a href="#tm2py.config.Configuration.relative_gap_length" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Validate highway.relative_gaps is a list of length greater or equal to global iterations.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/config.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;highway&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">relative_gap_length</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate highway.relative_gaps is a list of length greater or equal to global iterations.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;run&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">relative_gaps</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="p">(</span>
            <span class="n">values</span><span class="p">[</span><span class="s2">&quot;run&quot;</span><span class="p">][</span><span class="s2">&quot;end_iteration&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;&#39;highway.relative_gaps must be the same or greater length as end_iteration+1,</span><span class="se">\</span>
<span class="s2">            that includes global iteration 0 to </span><span class="si">{</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;run&#39;</span><span class="p">][</span><span class="s1">&#39;end_iteration&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.config.Configuration.sample_rate_length" class="doc doc-heading">
            <code class=" language-python"><span class="n">sample_rate_length</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>

<a href="#tm2py.config.Configuration.sample_rate_length" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Validate highway.sample_rate_by_iteration is a list of length greater or equal to global iterations.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/config.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;household&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">sample_rate_length</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate highway.sample_rate_by_iteration is a list of length greater or equal to global iterations.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;run&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">sample_rate_by_iteration</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="p">(</span>
            <span class="n">values</span><span class="p">[</span><span class="s2">&quot;run&quot;</span><span class="p">][</span><span class="s2">&quot;end_iteration&quot;</span><span class="p">]</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;&#39;highway.sample_rate_by_iteration must be the same or greater length as end_iteration&#39;&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.config.Configuration.transit_stop_criteria_length" class="doc doc-heading">
            <code class=" language-python"><span class="n">transit_stop_criteria_length</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>

<a href="#tm2py.config.Configuration.transit_stop_criteria_length" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Validate transit.congested.stop_criteria is a list of length greater or equal to global iterations.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/config.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;transit&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">transit_stop_criteria_length</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate transit.congested.stop_criteria is a list of length greater or equal to global iterations.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;run&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">congested_transit_assignment</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">congested</span><span class="o">.</span><span class="n">stop_criteria</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="p">(</span>
            <span class="n">values</span><span class="p">[</span><span class="s2">&quot;run&quot;</span><span class="p">][</span><span class="s2">&quot;end_iteration&quot;</span><span class="p">]</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;&#39;transit.stop_criteria must be the same or greater length as end_iteration,</span><span class="se">\</span>
<span class="s2">            that includes global iteration 1 to </span><span class="si">{</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;run&#39;</span><span class="p">][</span><span class="s1">&#39;end_iteration&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.CongestedAssnConfig" class="doc doc-heading">
            <code>CongestedAssnConfig</code>


<a href="#tm2py.config.CongestedAssnConfig" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Congested transit assignment Configuration.</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">CongestedAssnConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="s2">&quot;Congested transit assignment Configuration.&quot;</span>

    <span class="n">trim_demand_before_congested_transit_assignment</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">output_trimmed_demand_report_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">stop_criteria</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">CongestedTransitStopCriteria</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">use_peaking_factor</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">am_peaking_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.219</span><span class="p">)</span>
    <span class="n">pm_peaking_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.262</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.CongestedTransitMaxIteration" class="doc doc-heading">
            <code>CongestedTransitMaxIteration</code>


<a href="#tm2py.config.CongestedTransitMaxIteration" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Congested transit assignment time period specific max iteration parameters.</p>


<details class="properties" open>
  <summary>Properties</summary>
  
</details>
              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">CongestedTransitMaxIteration</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Congested transit assignment time period specific max iteration parameters.</span>

<span class="sd">    Properties:</span>
<span class="sd">        time_period: time period string</span>
<span class="sd">        max_iteration: max iteration specific to time period. In the design of tm2py,</span>
<span class="sd">            congested assignment is run only for AM and PM. For EA, MD, and EV, we run</span>
<span class="sd">            extended assignment. See code here: tm2py/components/network/transit/transit_assign.py#L465-L466</span>
<span class="sd">            Therefore, `max_iteration` here does not impact EA, MD, and EV, this setting</span>
<span class="sd">            is only meaningful for AM and PM.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">max_iteration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.CongestedTransitStopCriteria" class="doc doc-heading">
            <code>CongestedTransitStopCriteria</code>


<a href="#tm2py.config.CongestedTransitStopCriteria" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Congested transit assignment stopping criteria parameters.</p>


<details class="properties" open>
  <summary>Properties</summary>
  
</details>
              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">CongestedTransitStopCriteria</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Congested transit assignment stopping criteria parameters.</span>

<span class="sd">    Properties:</span>
<span class="sd">        global_iteration: global iteration number</span>
<span class="sd">        normalized_gap: normalized_gap</span>
<span class="sd">        relative_gaps: relative gap</span>
<span class="sd">        max_iterations: max iterations config, one for each time period</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">global_iteration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">normalized_gap</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">relative_gap</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">max_iterations</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">CongestedTransitMaxIteration</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.CongestedWeightsConfig" class="doc doc-heading">
            <code>CongestedWeightsConfig</code>


<a href="#tm2py.config.CongestedWeightsConfig" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Weights for Congested Transit Assignment Configuration.</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">CongestedWeightsConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="s2">&quot;Weights for Congested Transit Assignment Configuration.&quot;</span>

    <span class="n">min_seat</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">max_seat</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.4</span><span class="p">)</span>
    <span class="n">power_seat</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">2.2</span><span class="p">)</span>
    <span class="n">min_stand</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.4</span><span class="p">)</span>
    <span class="n">max_stand</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.6</span><span class="p">)</span>
    <span class="n">power_stand</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">3.4</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.DemandCountyGroupConfig" class="doc doc-heading">
            <code>DemandCountyGroupConfig</code>


<a href="#tm2py.config.DemandCountyGroupConfig" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Grouping of counties for assignment and demand files.</p>


<details class="properties" open>
  <summary>Properties</summary>
  
</details>
              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">DemandCountyGroupConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Grouping of counties for assignment and demand files.</span>

<span class="sd">    Properties:</span>
<span class="sd">        number: id number for this group, must be unique</span>
<span class="sd">        counties: list of one or more county names</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">number</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">counties</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">COUNTY_NAMES</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.EawtWeightsConfig" class="doc doc-heading">
            <code>EawtWeightsConfig</code>


<a href="#tm2py.config.EawtWeightsConfig" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Weights for calculating extra added wait time Configuration.</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">EawtWeightsConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="s2">&quot;Weights for calculating extra added wait time Configuration.&quot;</span>

    <span class="n">constant</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.259625</span><span class="p">)</span>
    <span class="n">weight_inverse_headway</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.612019</span><span class="p">)</span>
    <span class="n">vcr</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.005274</span><span class="p">)</span>
    <span class="n">exit_proportion</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.591765</span><span class="p">)</span>
    <span class="n">default_eawt_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.EmmeConfig" class="doc doc-heading">
            <code>EmmeConfig</code>


<a href="#tm2py.config.EmmeConfig" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Emme-specific parameters.</p>


<details class="properties" open>
  <summary>Properties</summary>
  
</details>
              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">EmmeConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Emme-specific parameters.</span>

<span class="sd">    Properties:</span>
<span class="sd">        all_day_scenario_id: scenario ID to use for all day</span>
<span class="sd">            (initial imported) scenario with all time period data</span>
<span class="sd">        project_path: relative path from run_dir to Emme desktop project (.emp)</span>
<span class="sd">        highway_database_path: relative path to highway Emmebank</span>
<span class="sd">        active_north_database_path:  relative paths to active mode Emmebank for north bay</span>
<span class="sd">        active_south_database_path:  relative paths to active mode Emmebank for south bay</span>
<span class="sd">        transit_database_path: relative path to transit Emmebank</span>
<span class="sd">        num_processors: the number of processors to use in Emme procedures,</span>
<span class="sd">            either as an integer, or value MAX, MAX-N. Typically recommend</span>
<span class="sd">            using MAX-1 (on desktop systems) or MAX-2 (on servers with many</span>
<span class="sd">            logical processors) to leave capacity for background / other tasks.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">all_day_scenario_id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">project_path</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">highway_database_path</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">active_north_database_path</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">active_south_database_path</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">transit_database_path</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">num_processors</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;^MAX$|^MAX-\d+$|^\d+$|^MAX/\d+$&quot;</span><span class="p">)</span>
    <span class="n">num_processors_transit_skim</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;^MAX$|^MAX-\d+$|^\d+$|^MAX/\d+$&quot;</span><span class="p">)</span>
    <span class="n">highway_distribution</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">HighwayDistribution</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.HighwayCapClassConfig" class="doc doc-heading">
            <code>HighwayCapClassConfig</code>


<a href="#tm2py.config.HighwayCapClassConfig" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Highway link capacity and speed (&lsquo;capclass&rsquo;) index entry.</p>


<details class="properties" open>
  <summary>Properties</summary>
  
</details>
              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">HighwayCapClassConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Highway link capacity and speed (&#39;capclass&#39;) index entry.</span>

<span class="sd">    Properties:</span>
<span class="sd">        capclass: cross index for link @capclass lookup</span>
<span class="sd">        capacity: value for link capacity, PCE / hour</span>
<span class="sd">        free_flow_speed: value for link free flow speed, miles / hour</span>
<span class="sd">        critical_speed: value for critical speed (Ja) used in Akcelik</span>
<span class="sd">            type functions</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">capclass</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">capacity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">free_flow_speed</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">critical_speed</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.HighwayClassConfig" class="doc doc-heading">
            <code>HighwayClassConfig</code>


<a href="#tm2py.config.HighwayClassConfig" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Highway assignment class definition.</p>
<p>Note that excluded_links, skims and toll attribute names include
vehicle groups (&ldquo;{vehicle}&rdquo;) which reference the list of
highway.toll.dst_vehicle_group_names (see HighwayTollsConfig).
The default example model config uses:
&ldquo;da&rdquo;, &ldquo;sr2&rdquo;, &ldquo;sr3&rdquo;, &ldquo;vsm&rdquo;, sml&rdquo;, &ldquo;med&rdquo;, &ldquo;lrg&rdquo;</p>


<details class="example-single-class-config" open>
  <summary>Example single class config</summary>
  <p>name = &ldquo;da&rdquo;
description= &ldquo;drive alone&rdquo;
mode_code= &ldquo;d&rdquo;
[[highway.classes.demand]]
    source = &ldquo;household&rdquo;
    name = &ldquo;SOV_GP_{period}&rdquo;
[[highway.classes.demand]]
    source = &ldquo;air_passenger&rdquo;
    name = &ldquo;da&rdquo;
[[highway.classes.demand]]
    source = &ldquo;internal_external&rdquo;
    name = &ldquo;da&rdquo;
excluded_links = [&ldquo;is_toll_da&rdquo;, &ldquo;is_sr2&rdquo;],
value_of_time = 18.93,  # $ / hr
operating_cost_per_mile = 17.23,  # cents / mile
toll = [&ldquo;@bridgetoll_da&rdquo;]
skims = [&ldquo;time&rdquo;, &ldquo;dist&rdquo;, &ldquo;freeflowtime&rdquo;, &ldquo;bridgetoll_da&rdquo;],</p>
</details>

<details class="properties" open>
  <summary>Properties</summary>
  
</details>
              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">HighwayClassConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Highway assignment class definition.</span>

<span class="sd">    Note that excluded_links, skims and toll attribute names include</span>
<span class="sd">    vehicle groups (&quot;{vehicle}&quot;) which reference the list of</span>
<span class="sd">    highway.toll.dst_vehicle_group_names (see HighwayTollsConfig).</span>
<span class="sd">    The default example model config uses:</span>
<span class="sd">    &quot;da&quot;, &quot;sr2&quot;, &quot;sr3&quot;, &quot;vsm&quot;, sml&quot;, &quot;med&quot;, &quot;lrg&quot;</span>

<span class="sd">    Example single class config:</span>
<span class="sd">        name = &quot;da&quot;</span>
<span class="sd">        description= &quot;drive alone&quot;</span>
<span class="sd">        mode_code= &quot;d&quot;</span>
<span class="sd">        [[highway.classes.demand]]</span>
<span class="sd">            source = &quot;household&quot;</span>
<span class="sd">            name = &quot;SOV_GP_{period}&quot;</span>
<span class="sd">        [[highway.classes.demand]]</span>
<span class="sd">            source = &quot;air_passenger&quot;</span>
<span class="sd">            name = &quot;da&quot;</span>
<span class="sd">        [[highway.classes.demand]]</span>
<span class="sd">            source = &quot;internal_external&quot;</span>
<span class="sd">            name = &quot;da&quot;</span>
<span class="sd">        excluded_links = [&quot;is_toll_da&quot;, &quot;is_sr2&quot;],</span>
<span class="sd">        value_of_time = 18.93,  # $ / hr</span>
<span class="sd">        operating_cost_per_mile = 17.23,  # cents / mile</span>
<span class="sd">        toll = [&quot;@bridgetoll_da&quot;]</span>
<span class="sd">        skims = [&quot;time&quot;, &quot;dist&quot;, &quot;freeflowtime&quot;, &quot;bridgetoll_da&quot;],</span>

<span class="sd">    Properties:</span>
<span class="sd">        name: short (up to 10 character) unique reference name for the class.</span>
<span class="sd">            used in attribute and matrix names</span>
<span class="sd">        description: longer text used in attribute and matrix descriptions</span>
<span class="sd">        mode_code: single character mode, used to generate link.modes to</span>
<span class="sd">            identify subnetwork, generated from &quot;excluded_links&quot; keywords.</span>
<span class="sd">            Should be unique in list of :es, unless multiple classes</span>
<span class="sd">            have identical excluded_links specification. Cannot be the</span>
<span class="sd">            same as used for highway.maz_to_maz.mode_code.</span>
<span class="sd">        value_of_time: value of time for this class in $ / hr</span>
<span class="sd">        operating_cost_per_mile: vehicle operating cost in cents / mile</span>
<span class="sd">        demand: list of OMX file and matrix keyname references,</span>
<span class="sd">            see ClassDemandConfig</span>
<span class="sd">        excluded_links: list of keywords to identify links to exclude from</span>
<span class="sd">            this class&#39; available subnetwork (generate link.modes)</span>
<span class="sd">            Options are:</span>
<span class="sd">                - &quot;is_sr&quot;: is reserved for shared ride (@useclass in 2,3)</span>
<span class="sd">                - &quot;is_sr2&quot;: is reserved for shared ride 2+ (@useclass == 2)</span>
<span class="sd">                - &quot;is_sr3&quot;: is reserved for shared ride 3+ (@useclass == 3)</span>
<span class="sd">                - &quot;is_auto_only&quot;: is reserved for autos (non-truck) (@useclass != 1)</span>
<span class="sd">                - &quot;is_toll_{vehicle}&quot;: has a value (non-bridge) toll for the {vehicle} toll group</span>
<span class="sd">        toll: list of additional toll cost link attribute (values stored in cents),</span>
<span class="sd">            summed, one of &quot;@bridgetoll_{vehicle}&quot;, &quot;@valuetoll_{vehicle}&quot;</span>
<span class="sd">        toll_factor: optional, factor to apply to toll values in cost calculation</span>
<span class="sd">        pce: optional, passenger car equivalent to convert assigned demand in</span>
<span class="sd">            PCE units to vehicles for total assigned vehicle calculations</span>
<span class="sd">        skims: list of skim matrices to generate</span>
<span class="sd">            Options are:</span>
<span class="sd">                &quot;time&quot;: pure travel time in minutes</span>
<span class="sd">                &quot;dist&quot;: distance in miles</span>
<span class="sd">                &quot;hovdist&quot;: distance on HOV facilities (is_sr2 or is_sr3)</span>
<span class="sd">                &quot;tolldist&quot;: distance on toll facilities</span>
<span class="sd">                    (@tollbooth &gt; highway.tolls.valuetoll_start_tollbooth_code)</span>
<span class="sd">                &quot;freeflowtime&quot;: free flow travel time in minutes</span>
<span class="sd">                &quot;bridgetoll_{vehicle}&quot;: bridge tolls, {vehicle} refers to toll group</span>
<span class="sd">                &quot;valuetoll_{vehicle}&quot;: other, non-bridge tolls, {vehicle} refers to toll group</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">veh_group_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">mode_code</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">value_of_time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">operating_cost_per_mile</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">pce</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># Note that excluded_links, skims, and tolls validated under HighwayConfig to include</span>
    <span class="c1"># highway.toll.dst_vehicle_group_names names</span>
    <span class="n">excluded_links</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">skims</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">toll</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">toll_factor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">demand</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">ClassDemandConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.HighwayConfig" class="doc doc-heading">
            <code>HighwayConfig</code>


<a href="#tm2py.config.HighwayConfig" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Highway assignment and skims parameters.</p>


<details class="properties" open>
  <summary>Properties</summary>
  
</details>
              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">HighwayConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Highway assignment and skims parameters.</span>

<span class="sd">    Properties:</span>
<span class="sd">        generic_highway_mode_code: single character unique mode ID for entire</span>
<span class="sd">            highway network (no excluded_links)</span>
<span class="sd">        relative_gaps: relative gaps for assignment convergence, specific to global iteration, see HighwayRelativeGapConfig</span>
<span class="sd">        max_iterations: maximum iterations stopping criteria</span>
<span class="sd">        area_type_buffer_dist_miles: used to in calculation to categorize link @areatype</span>
<span class="sd">            The area type is determined based on the average density of nearby</span>
<span class="sd">            (within this buffer distance) MAZs, using (pop+jobs*2.5)/acres</span>
<span class="sd">        drive_access_output_skim_path: relative path for drive access to transit skims</span>
<span class="sd">        output_skim_path: relative path template from run dir for OMX output skims</span>
<span class="sd">        output_skim_filename_tmpl: template for OMX filename for a time period. Must include</span>
<span class="sd">            {time_period} in the string and end in &#39;.omx&#39;.</span>
<span class="sd">        output_skim_matrixname_tmpl: template for matrix names within OMX output skims.</span>
<span class="sd">            Should include {time_period}, {mode}, and {property}</span>
<span class="sd">        tolls: input toll specification, see HighwayTollsConfig</span>
<span class="sd">        maz_to_maz: maz-to-maz shortest path assignment and skim specification,</span>
<span class="sd">            see HighwayMazToMazConfig</span>
<span class="sd">        classes: highway assignment multi-class setup and skim specification,</span>
<span class="sd">            see HighwayClassConfig</span>
<span class="sd">        capclass_lookup: index cross-reference table from the link @capclass value</span>
<span class="sd">            to the free-flow speed, capacity, and critical speed values</span>
<span class="sd">        interchange_nodes_file: relative path to the interchange nodes file, this is</span>
<span class="sd">            used for calculating highway reliability</span>
<span class="sd">        apply_msa_demand: average highway demand with previous iterations&#39;. Default to True.</span>
<span class="sd">        reliability: bool to skim highway reliability. Default to true. If true, assignment</span>
<span class="sd">            will be run twice in global iterations 0 (warmstart) and 1, to calculate reliability,</span>
<span class="sd">            assignment will be run only once in global iterations 2 and 3,</span>
<span class="sd">            reliability skim will stay the same as global iteration 1.</span>
<span class="sd">            If false, reliability will not be calculated nor skimmed in all global</span>
<span class="sd">            iterations, and the resulting reliability skims will be 0.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">generic_highway_mode_code</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">relative_gaps</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">HighwayRelativeGapConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">max_iterations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">network_acceleration</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">area_type_buffer_dist_miles</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">drive_access_output_skim_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">output_skim_path</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">output_skim_filename_tmpl</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">output_skim_matrixname_tmpl</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">tolls</span><span class="p">:</span> <span class="n">HighwayTollsConfig</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">maz_to_maz</span><span class="p">:</span> <span class="n">HighwayMazToMazConfig</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">classes</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">HighwayClassConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">capclass_lookup</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">HighwayCapClassConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">interchange_nodes_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">apply_msa_demand</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">reliability</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;output_skim_filename_tmpl&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">valid_skim_template</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate skim template has correct {} and extension.&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="s2">&quot;{time_period&quot;</span> <span class="ow">in</span> <span class="n">value</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;-&gt; output_skim_filename_tmpl must have </span><span class="se">{{</span><span class="s2">time_period</span><span class="se">}}</span><span class="s2">&#39;, found </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">value</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;.omx&quot;</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;-&gt; &#39;output_skim_filename_tmpl must end in &#39;.omx&#39;, found </span><span class="si">{</span><span class="n">value</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="w"> </span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;output_skim_matrixname_tmpl&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">valid_skim_matrix_name_template</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate skim matrix template has correct {}.&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="s2">&quot;{time_period&quot;</span> <span class="ow">in</span> <span class="n">value</span>
        <span class="p">),</span> <span class="s2">&quot;-&gt; &#39;output_skim_matrixname_tmpl must have </span><span class="si">{time_period}</span><span class="s2">, found </span><span class="si">{value}</span><span class="s2">.&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="s2">&quot;{property&quot;</span> <span class="ow">in</span> <span class="n">value</span>
        <span class="p">),</span> <span class="s2">&quot;-&gt; &#39;output_skim_matrixname_tmpl must have </span><span class="si">{property}</span><span class="s2">, found </span><span class="si">{value}</span><span class="s2">.&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="s2">&quot;{mode&quot;</span> <span class="ow">in</span> <span class="n">value</span>
        <span class="p">),</span> <span class="s2">&quot;-&gt; &#39;output_skim_matrixname_tmpl must have </span><span class="si">{mode}</span><span class="s2">, found </span><span class="si">{value}</span><span class="s2">.&quot;</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;capclass_lookup&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">unique_capclass_numbers</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate list of capclass_lookup has unique .capclass values.&quot;&quot;&quot;</span>
        <span class="n">capclass_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">capclass</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
        <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;-&gt; capclass value must be unique in list&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">capclass_ids</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">capclass_ids</span><span class="p">)),</span> <span class="n">error_msg</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;classes&quot;</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">unique_class_names</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate list of classes has unique .name values.&quot;&quot;&quot;</span>
        <span class="n">class_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">highway_class</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
        <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;-&gt; name value must be unique in list&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">class_names</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">class_names</span><span class="p">)),</span> <span class="n">error_msg</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;classes&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">validate_class_mode_excluded_links</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate list of classes has unique .mode_code or .excluded_links match.&quot;&quot;&quot;</span>
        <span class="c1"># validate if any mode IDs are used twice, that they have the same excluded links sets</span>
        <span class="n">mode_excluded_links</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">highway_class</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="c1"># maz_to_maz.mode_code must be unique</span>
            <span class="k">if</span> <span class="s2">&quot;maz_to_maz&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;mode_code&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;maz_to_maz&quot;</span><span class="p">][</span><span class="s2">&quot;mode_code&quot;</span><span class="p">]</span>
                <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;-&gt; </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> -&gt; mode_code: cannot be the same as the highway.maz_to_maz.mode_code&quot;</span>
            <span class="c1"># make sure that if any mode IDs are used twice, they have the same excluded links sets</span>
            <span class="k">if</span> <span class="n">highway_class</span><span class="o">.</span><span class="n">mode_code</span> <span class="ow">in</span> <span class="n">mode_excluded_links</span><span class="p">:</span>
                <span class="n">ex_links1</span> <span class="o">=</span> <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;excluded_links&quot;</span><span class="p">]</span>
                <span class="n">ex_links2</span> <span class="o">=</span> <span class="n">mode_excluded_links</span><span class="p">[</span><span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;mode_code&quot;</span><span class="p">]]</span>
                <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;-&gt; </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: duplicated mode codes (&#39;</span><span class="si">{</span><span class="n">highway_class</span><span class="p">[</span><span class="s1">&#39;mode_code&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;) &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;with different excluded links: </span><span class="si">{</span><span class="n">ex_links1</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">ex_links2</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="k">assert</span> <span class="n">ex_links1</span> <span class="o">==</span> <span class="n">ex_links2</span><span class="p">,</span> <span class="n">error_msg</span>
            <span class="n">mode_excluded_links</span><span class="p">[</span><span class="n">highway_class</span><span class="o">.</span><span class="n">mode_code</span><span class="p">]</span> <span class="o">=</span> <span class="n">highway_class</span><span class="o">.</span><span class="n">excluded_links</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;classes&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">validate_class_keyword_lists</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate classes .skims, .toll, and .excluded_links values.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;tolls&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="n">avail_skims</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;time&quot;</span><span class="p">,</span>
            <span class="s2">&quot;dist&quot;</span><span class="p">,</span>
            <span class="s2">&quot;hovdist&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tolldist&quot;</span><span class="p">,</span>
            <span class="s2">&quot;freeflowtime&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rlbty&quot;</span><span class="p">,</span>
            <span class="s2">&quot;autotime&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">available_link_sets</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;is_sr&quot;</span><span class="p">,</span> <span class="s2">&quot;is_sr2&quot;</span><span class="p">,</span> <span class="s2">&quot;is_sr3&quot;</span><span class="p">,</span> <span class="s2">&quot;is_auto_only&quot;</span><span class="p">]</span>
        <span class="n">avail_toll_attrs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;tolls&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dst_vehicle_group_names</span><span class="p">:</span>
            <span class="n">toll_types</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;bridgetoll_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;valuetoll_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
            <span class="n">avail_skims</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">toll_types</span><span class="p">)</span>
            <span class="n">avail_toll_attrs</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;@&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">toll_types</span><span class="p">])</span>
            <span class="n">available_link_sets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;is_toll_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># validate class skim name list and toll attribute against toll setup</span>
        <span class="k">def</span> <span class="nf">check_keywords</span><span class="p">(</span><span class="n">class_num</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">available</span><span class="p">):</span>
            <span class="n">extra_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">available</span><span class="p">)</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot; -&gt; </span><span class="si">{</span><span class="n">class_num</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: unrecognized </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> name(s): &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">extra_keys</span><span class="p">)</span><span class="si">}</span><span class="s2">.  Available names are: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">available</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="n">extra_keys</span><span class="p">,</span> <span class="n">error_msg</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">highway_class</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="n">check_keywords</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;skim&quot;</span><span class="p">,</span> <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;skims&quot;</span><span class="p">],</span> <span class="n">avail_skims</span><span class="p">)</span>
            <span class="n">check_keywords</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;toll&quot;</span><span class="p">,</span> <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;toll&quot;</span><span class="p">],</span> <span class="n">avail_toll_attrs</span><span class="p">)</span>
            <span class="n">check_keywords</span><span class="p">(</span>
                <span class="n">i</span><span class="p">,</span>
                <span class="s2">&quot;excluded_links&quot;</span><span class="p">,</span>
                <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;excluded_links&quot;</span><span class="p">],</span>
                <span class="n">available_link_sets</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tm2py.config.HighwayConfig.unique_capclass_numbers" class="doc doc-heading">
            <code class=" language-python"><span class="n">unique_capclass_numbers</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

<a href="#tm2py.config.HighwayConfig.unique_capclass_numbers" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Validate list of capclass_lookup has unique .capclass values.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/config.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;capclass_lookup&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">unique_capclass_numbers</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate list of capclass_lookup has unique .capclass values.&quot;&quot;&quot;</span>
    <span class="n">capclass_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">capclass</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
    <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;-&gt; capclass value must be unique in list&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">capclass_ids</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">capclass_ids</span><span class="p">)),</span> <span class="n">error_msg</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.config.HighwayConfig.unique_class_names" class="doc doc-heading">
            <code class=" language-python"><span class="n">unique_class_names</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

<a href="#tm2py.config.HighwayConfig.unique_class_names" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Validate list of classes has unique .name values.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/config.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;classes&quot;</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">unique_class_names</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate list of classes has unique .name values.&quot;&quot;&quot;</span>
    <span class="n">class_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">highway_class</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
    <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;-&gt; name value must be unique in list&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">class_names</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">class_names</span><span class="p">)),</span> <span class="n">error_msg</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.config.HighwayConfig.valid_skim_matrix_name_template" class="doc doc-heading">
            <code class=" language-python"><span class="n">valid_skim_matrix_name_template</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

<a href="#tm2py.config.HighwayConfig.valid_skim_matrix_name_template" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Validate skim matrix template has correct {}.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/config.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;output_skim_matrixname_tmpl&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">valid_skim_matrix_name_template</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate skim matrix template has correct {}.&quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="s2">&quot;{time_period&quot;</span> <span class="ow">in</span> <span class="n">value</span>
    <span class="p">),</span> <span class="s2">&quot;-&gt; &#39;output_skim_matrixname_tmpl must have </span><span class="si">{time_period}</span><span class="s2">, found </span><span class="si">{value}</span><span class="s2">.&quot;</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="s2">&quot;{property&quot;</span> <span class="ow">in</span> <span class="n">value</span>
    <span class="p">),</span> <span class="s2">&quot;-&gt; &#39;output_skim_matrixname_tmpl must have </span><span class="si">{property}</span><span class="s2">, found </span><span class="si">{value}</span><span class="s2">.&quot;</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="s2">&quot;{mode&quot;</span> <span class="ow">in</span> <span class="n">value</span>
    <span class="p">),</span> <span class="s2">&quot;-&gt; &#39;output_skim_matrixname_tmpl must have </span><span class="si">{mode}</span><span class="s2">, found </span><span class="si">{value}</span><span class="s2">.&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.config.HighwayConfig.valid_skim_template" class="doc doc-heading">
            <code class=" language-python"><span class="n">valid_skim_template</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

<a href="#tm2py.config.HighwayConfig.valid_skim_template" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Validate skim template has correct {} and extension.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/config.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">982</span>
<span class="normal">983</span>
<span class="normal">984</span>
<span class="normal">985</span>
<span class="normal">986</span>
<span class="normal">987</span>
<span class="normal">988</span>
<span class="normal">989</span>
<span class="normal">990</span>
<span class="normal">991</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;output_skim_filename_tmpl&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">valid_skim_template</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate skim template has correct {} and extension.&quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="s2">&quot;{time_period&quot;</span> <span class="ow">in</span> <span class="n">value</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;-&gt; output_skim_filename_tmpl must have </span><span class="se">{{</span><span class="s2">time_period</span><span class="se">}}</span><span class="s2">&#39;, found </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">.&quot;</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">value</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;.omx&quot;</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;-&gt; &#39;output_skim_filename_tmpl must end in &#39;.omx&#39;, found </span><span class="si">{</span><span class="n">value</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="w"> </span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.config.HighwayConfig.validate_class_keyword_lists" class="doc doc-heading">
            <code class=" language-python"><span class="n">validate_class_keyword_lists</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>

<a href="#tm2py.config.HighwayConfig.validate_class_keyword_lists" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Validate classes .skims, .toll, and .excluded_links values.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/config.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;classes&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">validate_class_keyword_lists</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate classes .skims, .toll, and .excluded_links values.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;tolls&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">value</span>
    <span class="n">avail_skims</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;time&quot;</span><span class="p">,</span>
        <span class="s2">&quot;dist&quot;</span><span class="p">,</span>
        <span class="s2">&quot;hovdist&quot;</span><span class="p">,</span>
        <span class="s2">&quot;tolldist&quot;</span><span class="p">,</span>
        <span class="s2">&quot;freeflowtime&quot;</span><span class="p">,</span>
        <span class="s2">&quot;rlbty&quot;</span><span class="p">,</span>
        <span class="s2">&quot;autotime&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">available_link_sets</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;is_sr&quot;</span><span class="p">,</span> <span class="s2">&quot;is_sr2&quot;</span><span class="p">,</span> <span class="s2">&quot;is_sr3&quot;</span><span class="p">,</span> <span class="s2">&quot;is_auto_only&quot;</span><span class="p">]</span>
    <span class="n">avail_toll_attrs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;tolls&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dst_vehicle_group_names</span><span class="p">:</span>
        <span class="n">toll_types</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;bridgetoll_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;valuetoll_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="n">avail_skims</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">toll_types</span><span class="p">)</span>
        <span class="n">avail_toll_attrs</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;@&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">toll_types</span><span class="p">])</span>
        <span class="n">available_link_sets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;is_toll_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># validate class skim name list and toll attribute against toll setup</span>
    <span class="k">def</span> <span class="nf">check_keywords</span><span class="p">(</span><span class="n">class_num</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">available</span><span class="p">):</span>
        <span class="n">extra_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">available</span><span class="p">)</span>
        <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot; -&gt; </span><span class="si">{</span><span class="n">class_num</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: unrecognized </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> name(s): &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">extra_keys</span><span class="p">)</span><span class="si">}</span><span class="s2">.  Available names are: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">available</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">extra_keys</span><span class="p">,</span> <span class="n">error_msg</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">highway_class</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="n">check_keywords</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;skim&quot;</span><span class="p">,</span> <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;skims&quot;</span><span class="p">],</span> <span class="n">avail_skims</span><span class="p">)</span>
        <span class="n">check_keywords</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;toll&quot;</span><span class="p">,</span> <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;toll&quot;</span><span class="p">],</span> <span class="n">avail_toll_attrs</span><span class="p">)</span>
        <span class="n">check_keywords</span><span class="p">(</span>
            <span class="n">i</span><span class="p">,</span>
            <span class="s2">&quot;excluded_links&quot;</span><span class="p">,</span>
            <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;excluded_links&quot;</span><span class="p">],</span>
            <span class="n">available_link_sets</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.config.HighwayConfig.validate_class_mode_excluded_links" class="doc doc-heading">
            <code class=" language-python"><span class="n">validate_class_mode_excluded_links</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>

<a href="#tm2py.config.HighwayConfig.validate_class_mode_excluded_links" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Validate list of classes has unique .mode_code or .excluded_links match.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/config.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;classes&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">validate_class_mode_excluded_links</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate list of classes has unique .mode_code or .excluded_links match.&quot;&quot;&quot;</span>
    <span class="c1"># validate if any mode IDs are used twice, that they have the same excluded links sets</span>
    <span class="n">mode_excluded_links</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">highway_class</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="c1"># maz_to_maz.mode_code must be unique</span>
        <span class="k">if</span> <span class="s2">&quot;maz_to_maz&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;mode_code&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;maz_to_maz&quot;</span><span class="p">][</span><span class="s2">&quot;mode_code&quot;</span><span class="p">]</span>
            <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;-&gt; </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> -&gt; mode_code: cannot be the same as the highway.maz_to_maz.mode_code&quot;</span>
        <span class="c1"># make sure that if any mode IDs are used twice, they have the same excluded links sets</span>
        <span class="k">if</span> <span class="n">highway_class</span><span class="o">.</span><span class="n">mode_code</span> <span class="ow">in</span> <span class="n">mode_excluded_links</span><span class="p">:</span>
            <span class="n">ex_links1</span> <span class="o">=</span> <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;excluded_links&quot;</span><span class="p">]</span>
            <span class="n">ex_links2</span> <span class="o">=</span> <span class="n">mode_excluded_links</span><span class="p">[</span><span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;mode_code&quot;</span><span class="p">]]</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;-&gt; </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: duplicated mode codes (&#39;</span><span class="si">{</span><span class="n">highway_class</span><span class="p">[</span><span class="s1">&#39;mode_code&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;) &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;with different excluded links: </span><span class="si">{</span><span class="n">ex_links1</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">ex_links2</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">assert</span> <span class="n">ex_links1</span> <span class="o">==</span> <span class="n">ex_links2</span><span class="p">,</span> <span class="n">error_msg</span>
        <span class="n">mode_excluded_links</span><span class="p">[</span><span class="n">highway_class</span><span class="o">.</span><span class="n">mode_code</span><span class="p">]</span> <span class="o">=</span> <span class="n">highway_class</span><span class="o">.</span><span class="n">excluded_links</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.HighwayDistribution" class="doc doc-heading">
            <code>HighwayDistribution</code>


<a href="#tm2py.config.HighwayDistribution" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Highway distribution run configuration. Use to enable distributing the
   assignment (running time periods in parallel).</p>


<details class="properties" open>
  <summary>Properties</summary>
  
</details>
              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">HighwayDistribution</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Highway distribution run configuration. Use to enable distributing the</span>
<span class="sd">       assignment (running time periods in parallel).</span>

<span class="sd">    Properties:</span>
<span class="sd">        periods: list of the names of the periods to use.</span>
<span class="sd">        num_processors: the number of processors to use as an integer, MAX-N or MAX/N</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">time_periods</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">num_processors</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;^MAX$|^MAX-\d+$|^\d+$|^MAX/\d+$&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.HighwayMazToMazConfig" class="doc doc-heading">
            <code>HighwayMazToMazConfig</code>


<a href="#tm2py.config.HighwayMazToMazConfig" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Highway MAZ to MAZ shortest path assignment and skim parameters.</p>


<details class="properties" open>
  <summary>Properties</summary>
  
</details>
              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">HighwayMazToMazConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Highway MAZ to MAZ shortest path assignment and skim parameters.</span>

<span class="sd">    Properties:</span>
<span class="sd">        mode_code: single character mode, used to generate link.modes to</span>
<span class="sd">            identify subnetwork, generated from &quot;excluded_links&quot; keywords,</span>
<span class="sd">            plus including MAZ connectors.</span>
<span class="sd">        value_of_time: value of time for this class in $ / hr</span>
<span class="sd">        operating_cost_per_mile: vehicle operating cost in cents / mile</span>
<span class="sd">        max_skim_cost: max shortest path distance to search for MAZ-to-MAZ</span>
<span class="sd">            skims, in generized costs units (includes operating cost</span>
<span class="sd">            converted to minutes)</span>
<span class="sd">        excluded_links: list of keywords to identify links to exclude from</span>
<span class="sd">            MAZ-to-MAZ paths, see HighwayClassConfig.excluded_links</span>
<span class="sd">        demand_file: relative path to find the input demand files</span>
<span class="sd">            can have use a placeholder for {period} and {number}, where the</span>
<span class="sd">            {period} is the time_period.name (see TimePeriodConfig)</span>
<span class="sd">            and {number} is the demand_count_groups[].number</span>
<span class="sd">            (see DemandCountyGroupConfig)</span>
<span class="sd">            e.g.: auto_{period}_MAZ_AUTO_{number}_{period}.omx</span>
<span class="sd">        demand_county_groups: List of demand county names and</span>
<span class="sd">        skim_period: period name to use for the shotest path skims, must</span>
<span class="sd">            match one of the names listed in the time_periods</span>
<span class="sd">        output_skim_file: relative path to resulting MAZ-to-MAZ skims</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">mode_code</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">value_of_time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">operating_cost_per_mile</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">max_distance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">max_skim_cost</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">excluded_links</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">demand_file</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">demand_county_groups</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">DemandCountyGroupConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">skim_period</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">output_skim_file</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;demand_county_groups&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">unique_group_numbers</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate list of demand_county_groups has unique .number values.&quot;&quot;&quot;</span>
        <span class="n">group_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">group</span><span class="o">.</span><span class="n">number</span> <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_ids</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">group_ids</span><span class="p">)),</span> <span class="s2">&quot;-&gt; number value must be unique&quot;</span>
        <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tm2py.config.HighwayMazToMazConfig.unique_group_numbers" class="doc doc-heading">
            <code class=" language-python"><span class="n">unique_group_numbers</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

<a href="#tm2py.config.HighwayMazToMazConfig.unique_group_numbers" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Validate list of demand_county_groups has unique .number values.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/config.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;demand_county_groups&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">unique_group_numbers</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate list of demand_county_groups has unique .number values.&quot;&quot;&quot;</span>
    <span class="n">group_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">group</span><span class="o">.</span><span class="n">number</span> <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_ids</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">group_ids</span><span class="p">)),</span> <span class="s2">&quot;-&gt; number value must be unique&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.HighwayRelativeGapConfig" class="doc doc-heading">
            <code>HighwayRelativeGapConfig</code>


<a href="#tm2py.config.HighwayRelativeGapConfig" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Highway assignment relative gap parameters.</p>


<details class="properties" open>
  <summary>Properties</summary>
  
</details>
              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">HighwayRelativeGapConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Highway assignment relative gap parameters.</span>

<span class="sd">    Properties:</span>
<span class="sd">        global_iteration: global iteration number</span>
<span class="sd">        relative_gap: relative gap</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">global_iteration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">relative_gap</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.HighwayTollsConfig" class="doc doc-heading">
            <code>HighwayTollsConfig</code>


<a href="#tm2py.config.HighwayTollsConfig" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Highway assignment and skim input tolls and related parameters.</p>


<details class="properties" open>
  <summary>Properties</summary>
  
</details>
              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">HighwayTollsConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Highway assignment and skim input tolls and related parameters.</span>

<span class="sd">    Properties:</span>
<span class="sd">        file_path: source relative file path for the highway tolls index CSV</span>
<span class="sd">        valuetoll_start_tollbooth_code: tollbooth separates links with &quot;bridge&quot; tolls</span>
<span class="sd">            (index &lt; this value) vs. &quot;value&quot; tolls. These toll attributes</span>
<span class="sd">            can then be referenced separately in the highway.classes[].tolls</span>
<span class="sd">            list</span>
<span class="sd">        src_vehicle_group_names: name used for the vehicle toll CSV column IDs,</span>
<span class="sd">            of the form &quot;toll{period}_{vehicle}&quot;</span>
<span class="sd">        dst_vehicle_group_names: list of names used in destination network</span>
<span class="sd">            for the corresponding vehicle group. Length of list must be the same</span>
<span class="sd">            as src_vehicle_group_names. Used for toll related attributes and</span>
<span class="sd">            resulting skim matrices. Cross-referenced in list of highway.classes[],</span>
<span class="sd">            valid keywords for:</span>
<span class="sd">                excluded_links: &quot;is_toll_{vehicle}&quot;</span>
<span class="sd">                tolls: &quot;@bridgetoll_{vehicle}&quot;, &quot;@valuetoll_{vehicle}&quot;</span>
<span class="sd">                skims: &quot;bridgetoll_{vehicle}&quot;, &quot;valuetoll_{vehicle}&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">file_path</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">valuetoll_start_tollbooth_code</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">src_vehicle_group_names</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">dst_vehicle_group_names</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;dst_vehicle_group_names&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">dst_vehicle_group_names_length</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate dst_vehicle_group_names has same length as src_vehicle_group_names.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;src_vehicle_group_names&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span>
                <span class="n">values</span><span class="p">[</span><span class="s2">&quot;src_vehicle_group_names&quot;</span><span class="p">]</span>
            <span class="p">),</span> <span class="s2">&quot;dst_vehicle_group_names must be same length as src_vehicle_group_names&quot;</span>
            <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span>
                <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">4</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
            <span class="p">),</span> <span class="s2">&quot;dst_vehicle_group_names must be 4 characters or less&quot;</span>
        <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tm2py.config.HighwayTollsConfig.dst_vehicle_group_names_length" class="doc doc-heading">
            <code class=" language-python"><span class="n">dst_vehicle_group_names_length</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>

<a href="#tm2py.config.HighwayTollsConfig.dst_vehicle_group_names_length" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Validate dst_vehicle_group_names has same length as src_vehicle_group_names.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/config.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;dst_vehicle_group_names&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">dst_vehicle_group_names_length</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate dst_vehicle_group_names has same length as src_vehicle_group_names.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;src_vehicle_group_names&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span>
            <span class="n">values</span><span class="p">[</span><span class="s2">&quot;src_vehicle_group_names&quot;</span><span class="p">]</span>
        <span class="p">),</span> <span class="s2">&quot;dst_vehicle_group_names must be same length as src_vehicle_group_names&quot;</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span>
            <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">4</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
        <span class="p">),</span> <span class="s2">&quot;dst_vehicle_group_names must be 4 characters or less&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.HouseholdConfig" class="doc doc-heading">
            <code>HouseholdConfig</code>


<a href="#tm2py.config.HouseholdConfig" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Household (residents) model parameters.</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">HouseholdConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Household (residents) model parameters.&quot;&quot;&quot;</span>

    <span class="n">highway_demand_file</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">transit_demand_file</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">active_demand_file</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">highway_maz_ctramp_output_file</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">OwnedAV_ZPV_factor</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">TNC_ZPV_factor</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">ctramp_indiv_trip_file</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">ctramp_joint_trip_file</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">ctramp_run_dir</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">rideshare_mode_split</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span>
    <span class="n">taxi_split</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span>
    <span class="n">single_tnc_split</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span>
    <span class="n">shared_tnc_split</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span>
    <span class="n">ctramp_mode_names</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
    <span class="n">income_segment</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">]]</span>
    <span class="n">ctramp_hh_file</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">sample_rate_by_iteration</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.HouseholdModeAgg" class="doc doc-heading">
            <code>HouseholdModeAgg</code>


<a href="#tm2py.config.HouseholdModeAgg" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>household trip mode aggregation input parameters.</p>


<details class="properties" open>
  <summary>Properties</summary>
  
</details>
              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">HouseholdModeAgg</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;household trip mode aggregation input parameters.</span>

<span class="sd">    Properties:</span>
<span class="sd">        name: aggregate name used for the class group in the input columns</span>
<span class="sd">            for the trip tables,</span>
<span class="sd">        modes: list of mode choice mode names used for the trip tables</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">modes</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.ImpedanceConfig" class="doc doc-heading">
            <code>ImpedanceConfig</code>


<a href="#tm2py.config.ImpedanceConfig" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Blended skims used for accessibility/friction calculations.</p>
<p>Properties:I
    name: name to store it as, referred to in TripDistribution config
    skim_mode: name of the mode to use for the blended skim
    time_blend: blend of time periods to use; mapped to the factors (which should sum to 1)</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ImpedanceConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Blended skims used for accessibility/friction calculations.</span>

<span class="sd">    Properties:I</span>
<span class="sd">        name: name to store it as, referred to in TripDistribution config</span>
<span class="sd">        skim_mode: name of the mode to use for the blended skim</span>
<span class="sd">        time_blend: blend of time periods to use; mapped to the factors (which should sum to 1)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">skim_mode</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">time_blend</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;time_blend&quot;</span><span class="p">,</span> <span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">sums_to_one</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate highway.maz_to_maz.skim_period refers to a valid period.&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">sum</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="mf">0.0001</span><span class="p">,</span> <span class="s2">&quot;blend factors must sum to 1&quot;</span>
        <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tm2py.config.ImpedanceConfig.sums_to_one" class="doc doc-heading">
            <code class=" language-python"><span class="n">sums_to_one</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

<a href="#tm2py.config.ImpedanceConfig.sums_to_one" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Validate highway.maz_to_maz.skim_period refers to a valid period.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/config.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;time_blend&quot;</span><span class="p">,</span> <span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">sums_to_one</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate highway.maz_to_maz.skim_period refers to a valid period.&quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">sum</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="mf">0.0001</span><span class="p">,</span> <span class="s2">&quot;blend factors must sum to 1&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.InternalExternalConfig" class="doc doc-heading">
            <code>InternalExternalConfig</code>


<a href="#tm2py.config.InternalExternalConfig" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Internal &lt;-&gt; External model parameters.</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">InternalExternalConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Internal &lt;-&gt; External model parameters.&quot;&quot;&quot;</span>

    <span class="n">output_trip_table_directory</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">outfile_trip_table_tmp</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">highway_demand_file</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">modes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">demand</span><span class="p">:</span> <span class="n">DemandGrowth</span>
    <span class="n">time_of_day</span><span class="p">:</span> <span class="n">TimeOfDayConfig</span>
    <span class="n">toll_choice</span><span class="p">:</span> <span class="n">TollChoiceConfig</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.LoggingConfig" class="doc doc-heading">
            <code>LoggingConfig</code>


<a href="#tm2py.config.LoggingConfig" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Logging parameters. TODO.</p>


<details class="properties" open>
  <summary>Properties</summary>
  
</details>
              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">LoggingConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Logging parameters. TODO.</span>

<span class="sd">    Properties:</span>
<span class="sd">        display_level: filter level for messages to show in console, default</span>
<span class="sd">            is STATUS</span>
<span class="sd">        run_file_path: relative path to high-level log file for the model run,</span>
<span class="sd">            default is tm2py_run_[%Y%m%d_%H%M].log</span>
<span class="sd">        run_file_level: filter level for messages recorded in the run log,</span>
<span class="sd">            default is INFO</span>
<span class="sd">        log_file_path: relative path to general log file with more detail</span>
<span class="sd">            than the run_file, default is tm2py_detail_[%Y%m%d_%H%M].log</span>
<span class="sd">        log_file_level: optional, filter level for messages recorded in the</span>
<span class="sd">            standard log, default is DETAIL</span>
<span class="sd">        log_on_error_file_path: relative path to use for fallback log message cache</span>
<span class="sd">            on error, default is tm2py_error_[%Y%m%d_%H%M].log</span>
<span class="sd">        notify_slack: if true notify_slack messages will be sent, default is False</span>
<span class="sd">        use_emme_logbook: if True log messages recorded in the standard log file will</span>
<span class="sd">            also be recorded in the Emme logbook, default is True</span>
<span class="sd">        iter_component_level: tuple of tuples of iteration, component name, log level.</span>
<span class="sd">            Used to override log levels (log_file_level) for debugging and recording</span>
<span class="sd">            more detail in the log_file_path.</span>
<span class="sd">            Example: [ [2, &quot;highway&quot;, &quot;TRACE&quot;] ] to record all messages</span>
<span class="sd">            during the highway component run at iteration 2.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">display_level</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">LogLevel</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;STATUS&quot;</span><span class="p">)</span>
    <span class="n">run_file_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;tm2py_run_</span><span class="si">{}</span><span class="s2">.log&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">_%H%M&quot;</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">run_file_level</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">LogLevel</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;INFO&quot;</span><span class="p">)</span>
    <span class="n">log_file_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;tm2py_debug_</span><span class="si">{}</span><span class="s2">.log&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">_%H%M&quot;</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">log_file_level</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">LogLevel</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>
    <span class="n">log_on_error_file_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;tm2py_error_</span><span class="si">{}</span><span class="s2">.log&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">_%H%M&quot;</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">notify_slack</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">use_emme_logbook</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">iter_component_level</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">ComponentNames</span><span class="p">,</span> <span class="n">LogLevel</span><span class="p">],</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.ManualJourneyLevelsConfig" class="doc doc-heading">
            <code>ManualJourneyLevelsConfig</code>


<a href="#tm2py.config.ManualJourneyLevelsConfig" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Manual Journey Level Specification</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ManualJourneyLevelsConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Manual Journey Level Specification&quot;&quot;&quot;</span>

    <span class="n">level_id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">group_fare_systems</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.MatrixFactorConfig" class="doc doc-heading">
            <code>MatrixFactorConfig</code>


<a href="#tm2py.config.MatrixFactorConfig" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Mapping of zone or list of zones to factor value.</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">MatrixFactorConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Mapping of zone or list of zones to factor value.&quot;&quot;&quot;</span>

    <span class="n">zone_index</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]]</span>
    <span class="n">factor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">i_factor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">j_factor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">as_growth_rate</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;zone_index&quot;</span><span class="p">,</span> <span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">valid_zone_index</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate zone index and turn to list if isn&#39;t one.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]),</span> <span class="s2">&quot;Zone_index must be greater or equal to 0&quot;</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;factor&quot;</span><span class="p">,</span> <span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">valid_factor</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="s2">&quot;i_factor&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">values</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="p">),</span> <span class="s2">&quot;Found both `factor` and</span><span class="se">\</span>
<span class="s2">            `i_factor` in MatrixFactorConfig. Should be one or the other.&quot;</span>

        <span class="k">assert</span> <span class="p">(</span>
            <span class="s2">&quot;j_factor&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">values</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="p">),</span> <span class="s2">&quot;Found both `factor` and</span><span class="se">\</span>
<span class="s2">            `j_factor` in MatrixFactorConfig. Should be one or the other.&quot;</span>
        <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tm2py.config.MatrixFactorConfig.valid_zone_index" class="doc doc-heading">
            <code class=" language-python"><span class="n">valid_zone_index</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

<a href="#tm2py.config.MatrixFactorConfig.valid_zone_index" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Validate zone index and turn to list if isn&rsquo;t one.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/config.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;zone_index&quot;</span><span class="p">,</span> <span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">valid_zone_index</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate zone index and turn to list if isn&#39;t one.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]),</span> <span class="s2">&quot;Zone_index must be greater or equal to 0&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.PostProcessorConfig" class="doc doc-heading">
            <code>PostProcessorConfig</code>


<a href="#tm2py.config.PostProcessorConfig" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Post Processor Configuration.</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">PostProcessorConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="s2">&quot;Post Processor Configuration.&quot;</span>
    <span class="n">network_shapefile_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">boardings_by_segment_file_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">boardings_by_segment_geofile_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.RunConfig" class="doc doc-heading">
            <code>RunConfig</code>


<a href="#tm2py.config.RunConfig" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Model run parameters.</p>
<p>Note that the components will be executed in the order listed.</p>


<details class="properties" open>
  <summary>Properties</summary>
  
</details>
              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">RunConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Model run parameters.</span>

<span class="sd">    Note that the components will be executed in the order listed.</span>

<span class="sd">    Properties:</span>
<span class="sd">        start_iteration: start iteration number, 0 to include initial_components</span>
<span class="sd">        end_iteration: final iteration number</span>
<span class="sd">        start_component: name of component to start with, will skip components</span>
<span class="sd">            list prior to this component</span>
<span class="sd">        initial_components: list of components to run as initial (0) iteration, in order</span>
<span class="sd">        global_iteration_components: list of component to run at every subsequent</span>
<span class="sd">            iteration (max(1, start_iteration) to end_iteration), in order.</span>
<span class="sd">        final_components: list of components to run after final iteration, in order</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">initial_components</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">ComponentNames</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
    <span class="n">global_iteration_components</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">ComponentNames</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
    <span class="n">final_components</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">ComponentNames</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
    <span class="n">start_iteration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">end_iteration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">start_component</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">ComponentNames</span><span class="p">,</span> <span class="n">EmptyString</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;end_iteration&quot;</span><span class="p">,</span> <span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">end_iteration_gt_start</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate end_iteration greater than start_iteration.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start_iteration&quot;</span><span class="p">):</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="n">value</span> <span class="o">&gt;=</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;start_iteration&quot;</span><span class="p">]</span>
            <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;&#39;end_iteration&#39; (</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">) must be greater than &#39;start_iteration&#39;</span><span class="se">\</span>
<span class="s2">                (</span><span class="si">{</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;start_iteration&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;start_component&quot;</span><span class="p">,</span> <span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">start_component_used</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate start_component is listed in *_components.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start_component&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>

        <span class="k">if</span> <span class="s2">&quot;start_iteration&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start_iteration&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="s2">&quot;initial_components&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span>
                <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;&#39;start_component&#39; (</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">) must be one of the components listed in</span><span class="se">\</span>
<span class="s2">                    initial_components if &#39;start_iteration = 0&#39;&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="s2">&quot;global_iteration_components&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">values</span><span class="p">]</span>
                <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;&#39;start_component&#39; (</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">) must be one of the components listed in</span><span class="se">\</span>
<span class="s2">                    global_iteration_components if &#39;start_iteration &gt; 0&#39;&quot;</span>
        <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tm2py.config.RunConfig.end_iteration_gt_start" class="doc doc-heading">
            <code class=" language-python"><span class="n">end_iteration_gt_start</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>

<a href="#tm2py.config.RunConfig.end_iteration_gt_start" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Validate end_iteration greater than start_iteration.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/config.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;end_iteration&quot;</span><span class="p">,</span> <span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">end_iteration_gt_start</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate end_iteration greater than start_iteration.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start_iteration&quot;</span><span class="p">):</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">value</span> <span class="o">&gt;=</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;start_iteration&quot;</span><span class="p">]</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;&#39;end_iteration&#39; (</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">) must be greater than &#39;start_iteration&#39;</span><span class="se">\</span>
<span class="s2">            (</span><span class="si">{</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;start_iteration&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.config.RunConfig.start_component_used" class="doc doc-heading">
            <code class=" language-python"><span class="n">start_component_used</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>

<a href="#tm2py.config.RunConfig.start_component_used" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Validate start_component is listed in *_components.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/config.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;start_component&quot;</span><span class="p">,</span> <span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">start_component_used</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate start_component is listed in *_components.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start_component&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">if</span> <span class="s2">&quot;start_iteration&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start_iteration&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">&quot;initial_components&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span>
            <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;&#39;start_component&#39; (</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">) must be one of the components listed in</span><span class="se">\</span>
<span class="s2">                initial_components if &#39;start_iteration = 0&#39;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">&quot;global_iteration_components&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">values</span><span class="p">]</span>
            <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;&#39;start_component&#39; (</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">) must be one of the components listed in</span><span class="se">\</span>
<span class="s2">                global_iteration_components if &#39;start_iteration &gt; 0&#39;&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.ScenarioConfig" class="doc doc-heading">
            <code>ScenarioConfig</code>


<a href="#tm2py.config.ScenarioConfig" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Scenario related parameters.</p>


<details class="properties" open>
  <summary>Properties</summary>
  
</details>
              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ScenarioConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Scenario related parameters.</span>

<span class="sd">    Properties:</span>
<span class="sd">        verify: optional, default False if specified as True components will run</span>
<span class="sd">            additional post-process verify step to validate results / outputs</span>
<span class="sd">            (not implemented yet)</span>
<span class="sd">        maz_landuse_file: relative path to maz_landuse_file used by multiple</span>
<span class="sd">            components</span>
<span class="sd">        name: scenario name string</span>
<span class="sd">        year: model year, must be at least 2005</span>
<span class="sd">        landuse_file: TAZ file</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">maz_landuse_file</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">zone_seq_file</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">landuse_file</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">landuse_index_column</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">year</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">2005</span><span class="p">)</span>
    <span class="n">verify</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.TimeOfDayClassConfig" class="doc doc-heading">
            <code>TimeOfDayClassConfig</code>


<a href="#tm2py.config.TimeOfDayClassConfig" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Configuration for a class of time of day model.</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TimeOfDayClassConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Configuration for a class of time of day model.&quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">time_period_split</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">TimeSplitConfig</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.TimeOfDayConfig" class="doc doc-heading">
            <code>TimeOfDayConfig</code>


<a href="#tm2py.config.TimeOfDayConfig" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Configuration for time of day model.</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TimeOfDayConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Configuration for time of day model.&quot;&quot;&quot;</span>

    <span class="n">classes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">TimeOfDayClassConfig</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.TimePeriodConfig" class="doc doc-heading">
            <code>TimePeriodConfig</code>


<a href="#tm2py.config.TimePeriodConfig" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Time time period entry.</p>


<details class="properties" open>
  <summary>Properties</summary>
  
</details>
              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TimePeriodConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Time time period entry.</span>

<span class="sd">    Properties:</span>
<span class="sd">        name: name of the time period, up to four characters</span>
<span class="sd">        length_hours: length of the time period in hours</span>
<span class="sd">        highway_capacity_factor: factor to use to multiple the per-hour</span>
<span class="sd">            capacites in the highway network</span>
<span class="sd">        emme_scenario_id: scenario ID to use for Emme per-period</span>
<span class="sd">            assignment (highway and transit) scenarios</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">start_period</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">length_hours</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">highway_capacity_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">emme_scenario_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.TimeSplitConfig" class="doc doc-heading">
            <code>TimeSplitConfig</code>


<a href="#tm2py.config.TimeSplitConfig" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Split matrix i and j.</p>
<p>i.e. for time of day splits.</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TimeSplitConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Split matrix i and j.</span>

<span class="sd">    i.e. for time of day splits.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">production</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NonNegativeFloat</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">attraction</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NonNegativeFloat</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">od</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NonNegativeFloat</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;production&quot;</span><span class="p">,</span> <span class="s2">&quot;attraction&quot;</span><span class="p">,</span> <span class="s2">&quot;od&quot;</span><span class="p">,</span> <span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">less_than_equal_one</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">v</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s2">&quot;Value should be less than or equal to 1&quot;</span>
        <span class="k">return</span> <span class="n">v</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">od</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">production</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attraction</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;TimeSplitConfig: Must either specifify an od or any of</span><span class="se">\</span>
<span class="s2">            production/attraction - not both.</span><span class="se">\n</span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">production</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attraction</span><span class="p">])</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">production</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attraction</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;TimeSplitConfig: Must have both production AND attraction</span><span class="se">\</span>
<span class="s2">            if one of them is specified.&quot;</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.TollChoiceConfig" class="doc doc-heading">
            <code>TollChoiceConfig</code>


<a href="#tm2py.config.TollChoiceConfig" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Toll choice parameters.</p>


<details class="properties" open>
  <summary>Properties</summary>
  
</details>
              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TollChoiceConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Toll choice parameters.</span>

<span class="sd">    Properties:</span>
<span class="sd">        property_to_skim_toll: Maps a property in the utility equation with a list of skim</span>
<span class="sd">            properties. If more than one skim property is listed, they will be summed together</span>
<span class="sd">            (e.g. cost if the sum of bridge toll and value toll). This defaults to a value in the</span>
<span class="sd">            code.</span>
<span class="sd">        property_to_skim_notoll: Maps a property in the utility equation with a list of skim</span>
<span class="sd">            properties for no toll choice.If more than one skim property is listed, they will</span>
<span class="sd">            be summed together  (e.g. cost if the sum of bridge toll and value toll). This</span>
<span class="sd">            defaults to a value in the code.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">classes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ChoiceClassConfig</span><span class="p">]</span>
    <span class="n">value_of_time</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">operating_cost_per_mile</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">property_to_skim_toll</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">property_to_skim_notoll</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span>
    <span class="p">)</span>
    <span class="n">utility</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">CoefficientConfig</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.TransitClassConfig" class="doc doc-heading">
            <code>TransitClassConfig</code>


<a href="#tm2py.config.TransitClassConfig" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Transit demand class definition.</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TransitClassConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Transit demand class definition.&quot;&quot;&quot;</span>

    <span class="n">skim_set_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">mode_types</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
    <span class="n">demand</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">ClassDemandConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
    <span class="n">required_mode_combo</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.TransitConfig" class="doc doc-heading">
            <code>TransitConfig</code>


<a href="#tm2py.config.TransitConfig" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Transit assignment parameters.</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TransitConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Transit assignment parameters.&quot;&quot;&quot;</span>

    <span class="n">modes</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">TransitModeConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
    <span class="n">classes</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">TransitClassConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
    <span class="n">journey_levels</span><span class="p">:</span> <span class="n">TransitJourneyLevelsConfig</span>
    <span class="n">apply_msa_demand</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">value_of_time</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">walk_speed</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">transit_speed</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">effective_headway_source</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">initial_wait_perception_factor</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">transfer_wait_perception_factor</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">walk_perception_factor</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">walk_perception_factor</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">walk_perception_factor_cbd</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">drive_perception_factor</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">max_transfers</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">use_fares</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">fare_2015_to_2000_deflator</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">fares_path</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">fare_matrix_path</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">fare_max_transfer_distance_miles</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">override_connector_times</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">use_ccr</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">ccr_stop_criteria</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AssignmentStoppingCriteriaConfig</span><span class="p">]</span>
    <span class="n">ccr_weights</span><span class="p">:</span> <span class="n">CcrWeightsConfig</span>
    <span class="n">eawt_weights</span><span class="p">:</span> <span class="n">EawtWeightsConfig</span>
    <span class="n">congested_transit_assignment</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">congested</span><span class="p">:</span> <span class="n">CongestedAssnConfig</span>
    <span class="n">congested_weights</span><span class="p">:</span> <span class="n">CongestedWeightsConfig</span>
    <span class="n">output_skim_path</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">output_skim_filename_tmpl</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">output_skim_matrixname_tmpl</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">output_stop_usage_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">output_transit_boardings_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">output_transit_segment_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">output_station_to_station_flow_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">output_transfer_at_station_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">timed_transfer_nodes</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">output_transfer_at_station_node_ids</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">max_ccr_iterations</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">split_connectors_to_prevent_walk</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">input_connector_access_times_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">input_connector_egress_times_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">vehicles</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TransitVehicleConfig</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="n">TransitVehicleConfig</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.TransitJourneyLevelsConfig" class="doc doc-heading">
            <code>TransitJourneyLevelsConfig</code>


<a href="#tm2py.config.TransitJourneyLevelsConfig" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Transit manual journey levels structure.</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TransitJourneyLevelsConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Transit manual journey levels structure.&quot;&quot;&quot;</span>

    <span class="n">use_algorithm</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The original translation from Cube to Emme used an algorithm to, as faithfully as possible, reflect transfer fares via journey levels. </span>
<span class="sd">    The algorithm examines fare costs and proximity of transit services to create a set of journey levels that reflects transfer costs. </span>
<span class="sd">    While this algorithm works well, the Bay Area&#39;s complex fare system results in numerous journey levels specific to operators with low ridership. </span>
<span class="sd">    The resulting assignment compute therefore expends a lot of resources on these operators. </span>
<span class="sd">    Set this parameter to `True` to use the algorithm. Exactly one of `use_algorithm` or `specify_manually` must be `True`. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">specify_manually</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An alternative to using an algorithm to specify the journey levels is to use specify them manually. </span>
<span class="sd">    If this option is set to `True`, the `manual` parameter can be used to assign fare systems to faresystem groups (or journey levels). </span>
<span class="sd">    Consider, for example, the following three journey levels: 0 - has yet to board transit; 1 - has boarded SF Muni; 2 - has boarded all other transit systems. </span>
<span class="sd">    To specify this configuration, a single `manual` entry identifying the SF Muni fare systems is needed. </span>
<span class="sd">    The other faresystem group is automatically generated in the code with the rest of the faresystems which are not specified in any of the groups.</span>
<span class="sd">    See the `manual` entry for an example.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">manual</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">ManualJourneyLevelsConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">ManualJourneyLevelsConfig</span><span class="p">(</span><span class="n">level_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">group_fare_systems</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,)),</span>
    <span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If &#39;specify_manually&#39; is set to `True`, there should be at least one faresystem group specified here.</span>
<span class="sd">    The format includes two entries: `level_id`, which is the serial number of the group specified, </span>
<span class="sd">    and `group_fare_system`, which is a list of all faresystems belonging to that group.</span>
<span class="sd">    For example, to specify MUNI as one faresystem group, the right configuration would be:</span>
<span class="sd">    [[transit.journey_levels.manual]]</span>
<span class="sd">    level_id = 1</span>
<span class="sd">    group_fare_systems = [25]</span>
<span class="sd">    If there are multiple groups required to be specified, for example, MUNI in one and Caltrain in the other group,</span>
<span class="sd">    it can be achieved by adding another entry of `manual`, like:</span>
<span class="sd">    [[transit.journey_levels.manual]]</span>
<span class="sd">    level_id = 1</span>
<span class="sd">    group_fare_systems = [25]</span>
<span class="sd">    [[transit.journey_levels.manual]]</span>
<span class="sd">    level_id = 2</span>
<span class="sd">    group_fare_systems = [12,14]</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;specify_manually&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">check_exclusivity</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Valdiates that exactly one of specify_manually and use_algorithm is True&quot;&quot;&quot;</span>
        <span class="n">use_algorithm</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;use_algorithm&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">use_algorithm</span> <span class="o">!=</span> <span class="n">v</span>
        <span class="p">),</span> <span class="s1">&#39;Exactly one of &quot;use_algorithm&quot; or &quot;specify_manually&quot; must be True.&#39;</span>
        <span class="k">return</span> <span class="n">v</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;manual&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">check_manual</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;specify_manually&quot;</span><span class="p">):</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="p">),</span> <span class="s2">&quot;If &#39;specify_manually&#39; is True, &#39;manual&#39; cannot be None or empty.&quot;</span>
        <span class="k">return</span> <span class="n">v</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="tm2py.config.TransitJourneyLevelsConfig.manual" class="doc doc-heading">
            <code class=" language-python"><span class="n">manual</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">ManualJourneyLevelsConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ManualJourneyLevelsConfig</span><span class="p">(</span><span class="n">level_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">group_fare_systems</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,)),)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#tm2py.config.TransitJourneyLevelsConfig.manual" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>If &lsquo;specify_manually&rsquo; is set to <code>True</code>, there should be at least one faresystem group specified here.
The format includes two entries: <code>level_id</code>, which is the serial number of the group specified, 
and <code>group_fare_system</code>, which is a list of all faresystems belonging to that group.
For example, to specify MUNI as one faresystem group, the right configuration would be:
[[transit.journey_levels.manual]]
level_id = 1
group_fare_systems = [25]
If there are multiple groups required to be specified, for example, MUNI in one and Caltrain in the other group,
it can be achieved by adding another entry of <code>manual</code>, like:
[[transit.journey_levels.manual]]
level_id = 1
group_fare_systems = [25][[transit.journey_levels.manual]]
level_id = 2
group_fare_systems = [12,14]</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tm2py.config.TransitJourneyLevelsConfig.specify_manually" class="doc doc-heading">
            <code class=" language-python"><span class="n">specify_manually</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#tm2py.config.TransitJourneyLevelsConfig.specify_manually" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>An alternative to using an algorithm to specify the journey levels is to use specify them manually. 
If this option is set to <code>True</code>, the <code>manual</code> parameter can be used to assign fare systems to faresystem groups (or journey levels). 
Consider, for example, the following three journey levels: 0 - has yet to board transit; 1 - has boarded SF Muni; 2 - has boarded all other transit systems. 
To specify this configuration, a single <code>manual</code> entry identifying the SF Muni fare systems is needed. 
The other faresystem group is automatically generated in the code with the rest of the faresystems which are not specified in any of the groups.
See the <code>manual</code> entry for an example.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tm2py.config.TransitJourneyLevelsConfig.use_algorithm" class="doc doc-heading">
            <code class=" language-python"><span class="n">use_algorithm</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#tm2py.config.TransitJourneyLevelsConfig.use_algorithm" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>The original translation from Cube to Emme used an algorithm to, as faithfully as possible, reflect transfer fares via journey levels. 
The algorithm examines fare costs and proximity of transit services to create a set of journey levels that reflects transfer costs. 
While this algorithm works well, the Bay Area&rsquo;s complex fare system results in numerous journey levels specific to operators with low ridership. 
The resulting assignment compute therefore expends a lot of resources on these operators. 
Set this parameter to <code>True</code> to use the algorithm. Exactly one of <code>use_algorithm</code> or <code>specify_manually</code> must be <code>True</code>.</p>
    </div>

</div>



<div class="doc doc-object doc-function">


<h3 id="tm2py.config.TransitJourneyLevelsConfig.check_exclusivity" class="doc doc-heading">
            <code class=" language-python"><span class="n">check_exclusivity</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>

<a href="#tm2py.config.TransitJourneyLevelsConfig.check_exclusivity" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Valdiates that exactly one of specify_manually and use_algorithm is True</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/config.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;specify_manually&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">check_exclusivity</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Valdiates that exactly one of specify_manually and use_algorithm is True&quot;&quot;&quot;</span>
    <span class="n">use_algorithm</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;use_algorithm&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">use_algorithm</span> <span class="o">!=</span> <span class="n">v</span>
    <span class="p">),</span> <span class="s1">&#39;Exactly one of &quot;use_algorithm&quot; or &quot;specify_manually&quot; must be True.&#39;</span>
    <span class="k">return</span> <span class="n">v</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.TransitModeConfig" class="doc doc-heading">
            <code>TransitModeConfig</code>


<a href="#tm2py.config.TransitModeConfig" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Transit mode definition (see also mode in the Emme API).</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TransitModeConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Transit mode definition (see also mode in the Emme API).&quot;&quot;&quot;</span>

    <span class="nb">type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span>
        <span class="s2">&quot;WALK&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ACCESS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;EGRESS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;LOCAL&quot;</span><span class="p">,</span>
        <span class="s2">&quot;PREMIUM&quot;</span><span class="p">,</span>
        <span class="s2">&quot;DRIVE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;PNR_dummy&quot;</span><span class="p">,</span>
        <span class="s2">&quot;KNR_dummy&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">assign_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;TRANSIT&quot;</span><span class="p">,</span> <span class="s2">&quot;AUX_TRANSIT&quot;</span><span class="p">]</span>
    <span class="n">mode_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">in_vehicle_perception_factor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">speed_or_time_factor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">initial_boarding_penalty</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">transfer_boarding_penalty</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">headway_fraction</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">transfer_wait_perception_factor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">eawt_factor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;in_vehicle_perception_factor&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">in_vehicle_perception_factor_valid</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate in_vehicle_perception_factor exists if assign_type is TRANSIT.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;assign_type&quot;</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assign_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;TRANSIT&quot;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;must be specified when assign_type==TRANSIT&quot;</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;speed_or_time_factor&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">speed_or_time_factor_valid</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate speed_or_time_factor exists if assign_type is AUX_TRANSIT.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;assign_type&quot;</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assign_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;AUX_TRANSIT&quot;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;must be specified when assign_type==AUX_TRANSIT&quot;</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;initial_boarding_penalty&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">initial_boarding_penalty_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate initial_boarding_penalty exists if assign_type is TRANSIT.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;assign_type&quot;</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assign_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;TRANSIT&quot;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;must be specified when assign_type==TRANSIT&quot;</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;transfer_boarding_penalty&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">transfer_boarding_penalty_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate transfer_boarding_penalty exists if assign_type is TRANSIT.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;assign_type&quot;</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assign_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;TRANSIT&quot;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;must be specified when assign_type==TRANSIT&quot;</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;headway_fraction&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">headway_fraction_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate headway_fraction exists if assign_type is TRANSIT.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;assign_type&quot;</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assign_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;TRANSIT&quot;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;must be specified when assign_type==TRANSIT&quot;</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;transfer_wait_perception_factor&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">transfer_wait_perception_factor_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate transfer_wait_perception_factor exists if assign_type is TRANSIT.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;assign_type&quot;</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assign_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;TRANSIT&quot;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;must be specified when assign_type==TRANSIT&quot;</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@classmethod</span>
    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;mode_id&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">mode_id_valid</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate mode_id.&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;mode_id must be one character&quot;</span>
        <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tm2py.config.TransitModeConfig.headway_fraction_valid" class="doc doc-heading">
            <code class=" language-python"><span class="n">headway_fraction_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>

<a href="#tm2py.config.TransitModeConfig.headway_fraction_valid" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Validate headway_fraction exists if assign_type is TRANSIT.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/config.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;headway_fraction&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">headway_fraction_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate headway_fraction exists if assign_type is TRANSIT.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;assign_type&quot;</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assign_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;TRANSIT&quot;</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;must be specified when assign_type==TRANSIT&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.config.TransitModeConfig.in_vehicle_perception_factor_valid" class="doc doc-heading">
            <code class=" language-python"><span class="n">in_vehicle_perception_factor_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>

<a href="#tm2py.config.TransitModeConfig.in_vehicle_perception_factor_valid" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Validate in_vehicle_perception_factor exists if assign_type is TRANSIT.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/config.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;in_vehicle_perception_factor&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">in_vehicle_perception_factor_valid</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate in_vehicle_perception_factor exists if assign_type is TRANSIT.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;assign_type&quot;</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assign_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;TRANSIT&quot;</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;must be specified when assign_type==TRANSIT&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.config.TransitModeConfig.initial_boarding_penalty_valid" class="doc doc-heading">
            <code class=" language-python"><span class="n">initial_boarding_penalty_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>

<a href="#tm2py.config.TransitModeConfig.initial_boarding_penalty_valid" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Validate initial_boarding_penalty exists if assign_type is TRANSIT.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/config.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;initial_boarding_penalty&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">initial_boarding_penalty_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate initial_boarding_penalty exists if assign_type is TRANSIT.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;assign_type&quot;</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assign_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;TRANSIT&quot;</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;must be specified when assign_type==TRANSIT&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.config.TransitModeConfig.mode_id_valid" class="doc doc-heading">
            <code class=" language-python"><span class="n">mode_id_valid</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#tm2py.config.TransitModeConfig.mode_id_valid" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Validate mode_id.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/config.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;mode_id&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">mode_id_valid</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate mode_id.&quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;mode_id must be one character&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.config.TransitModeConfig.speed_or_time_factor_valid" class="doc doc-heading">
            <code class=" language-python"><span class="n">speed_or_time_factor_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>

<a href="#tm2py.config.TransitModeConfig.speed_or_time_factor_valid" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Validate speed_or_time_factor exists if assign_type is AUX_TRANSIT.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/config.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;speed_or_time_factor&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">speed_or_time_factor_valid</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate speed_or_time_factor exists if assign_type is AUX_TRANSIT.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;assign_type&quot;</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assign_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;AUX_TRANSIT&quot;</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;must be specified when assign_type==AUX_TRANSIT&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.config.TransitModeConfig.transfer_boarding_penalty_valid" class="doc doc-heading">
            <code class=" language-python"><span class="n">transfer_boarding_penalty_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>

<a href="#tm2py.config.TransitModeConfig.transfer_boarding_penalty_valid" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Validate transfer_boarding_penalty exists if assign_type is TRANSIT.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/config.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;transfer_boarding_penalty&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">transfer_boarding_penalty_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate transfer_boarding_penalty exists if assign_type is TRANSIT.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;assign_type&quot;</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assign_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;TRANSIT&quot;</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;must be specified when assign_type==TRANSIT&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.config.TransitModeConfig.transfer_wait_perception_factor_valid" class="doc doc-heading">
            <code class=" language-python"><span class="n">transfer_wait_perception_factor_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>

<a href="#tm2py.config.TransitModeConfig.transfer_wait_perception_factor_valid" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Validate transfer_wait_perception_factor exists if assign_type is TRANSIT.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/config.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;transfer_wait_perception_factor&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">transfer_wait_perception_factor_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate transfer_wait_perception_factor exists if assign_type is TRANSIT.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;assign_type&quot;</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assign_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;TRANSIT&quot;</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;must be specified when assign_type==TRANSIT&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.TransitVehicleConfig" class="doc doc-heading">
            <code>TransitVehicleConfig</code>


<a href="#tm2py.config.TransitVehicleConfig" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Transit vehicle definition (see also transit vehicle in the Emme API).</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TransitVehicleConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Transit vehicle definition (see also transit vehicle in the Emme API).&quot;&quot;&quot;</span>

    <span class="n">vehicle_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">auto_equivalent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">seated_capacity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">total_capacity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.TripDistributionClassConfig" class="doc doc-heading">
            <code>TripDistributionClassConfig</code>


<a href="#tm2py.config.TripDistributionClassConfig" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Trip Distribution parameters.</p>


<details class="properties" open>
  <summary>Properties</summary>
  
</details>
              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TripDistributionClassConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Trip Distribution parameters.</span>

<span class="sd">    Properties:</span>
<span class="sd">        name: name of class to apply to</span>
<span class="sd">        impedance_name: refers to an impedance (skim) matrix to use - often a blended skim.</span>
<span class="sd">        use_k_factors: boolean on if to use k-factors</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">impedance</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">use_k_factors</span><span class="p">:</span> <span class="nb">bool</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.TripDistributionConfig" class="doc doc-heading">
            <code>TripDistributionConfig</code>


<a href="#tm2py.config.TripDistributionConfig" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Trip Distribution parameters.</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TripDistributionConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Trip Distribution parameters.&quot;&quot;&quot;</span>

    <span class="n">classes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">TripDistributionClassConfig</span><span class="p">]</span>
    <span class="n">max_balance_iterations</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">max_balance_relative_error</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">friction_factors_file</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">k_factors_file</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.TripGenerationClassConfig" class="doc doc-heading">
            <code>TripGenerationClassConfig</code>


<a href="#tm2py.config.TripGenerationClassConfig" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Trip Generation parameters.</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TripGenerationClassConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Trip Generation parameters.&quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">purpose</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">production_formula</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TripGenerationFormulaConfig</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">attraction_formula</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TripGenerationFormulaConfig</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">balance_to</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;production&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.TripGenerationConfig" class="doc doc-heading">
            <code>TripGenerationConfig</code>


<a href="#tm2py.config.TripGenerationConfig" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Trip Generation parameters.</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TripGenerationConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Trip Generation parameters.&quot;&quot;&quot;</span>

    <span class="n">classes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">TripGenerationClassConfig</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.TripGenerationFormulaConfig" class="doc doc-heading">
            <code>TripGenerationFormulaConfig</code>


<a href="#tm2py.config.TripGenerationFormulaConfig" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>TripProductionConfig.</p>
<p>Trip productions or attractions for a zone are the constant plus the sum of the rates * values
in land use file for that zone.</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TripGenerationFormulaConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;TripProductionConfig.</span>

<span class="sd">    Trip productions or attractions for a zone are the constant plus the sum of the rates * values</span>
<span class="sd">    in land use file for that zone.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">land_use_rates</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">CoefficientConfig</span><span class="p">]</span>
    <span class="n">constant</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">multiplier</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.TruckClassConfig" class="doc doc-heading">
            <code>TruckClassConfig</code>


<a href="#tm2py.config.TruckClassConfig" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Truck class parameters.</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TruckClassConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Truck class parameters.&quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.TruckConfig" class="doc doc-heading">
            <code>TruckConfig</code>


<a href="#tm2py.config.TruckConfig" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Truck model parameters.</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TruckConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Truck model parameters.&quot;&quot;&quot;</span>

    <span class="n">classes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">TruckClassConfig</span><span class="p">]</span>
    <span class="n">impedances</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ImpedanceConfig</span><span class="p">]</span>
    <span class="n">trip_gen</span><span class="p">:</span> <span class="n">TripGenerationConfig</span>
    <span class="n">trip_dist</span><span class="p">:</span> <span class="n">TripDistributionConfig</span>
    <span class="n">time_of_day</span><span class="p">:</span> <span class="n">TimeOfDayConfig</span>
    <span class="n">toll_choice</span><span class="p">:</span> <span class="n">TollChoiceConfig</span>
    <span class="n">output_trip_table_directory</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">outfile_trip_table_tmp</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">highway_demand_file</span><span class="p">:</span> <span class="nb">str</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    @validator(&quot;classes&quot;)</span>
<span class="sd">    def class_consistency(cls, v, values):</span>
<span class="sd">        # TODO Can&#39;t get to work righ tnow</span>
<span class="sd">        _class_names = [c.name for c in v]</span>
<span class="sd">        _gen_classes = [c.name for c in values[&quot;trip_gen&quot;]]</span>
<span class="sd">        _dist_classes = [c.name for c in values[&quot;trip_dist&quot;]]</span>
<span class="sd">        _time_classes = [c.name for c in values[&quot;time_split&quot;]]</span>
<span class="sd">        _toll_classes = [c.name for c in values[&quot;toll_choice&quot;]]</span>

<span class="sd">        assert (</span>
<span class="sd">            _class_names == _gen_classes</span>
<span class="sd">        ), &quot;truck.classes ({_class_names}) doesn&#39;t equal\</span>
<span class="sd">            class names in truck.trip_gen ({_gen_classes}).&quot;</span>
<span class="sd">        assert (</span>
<span class="sd">            _class_names == _dist_classes</span>
<span class="sd">        ), &quot;truck.classes ({_class_names}) doesn&#39;t  equal\</span>
<span class="sd">            class names in truck.trip_dist ({_dist_classes}).&quot;</span>
<span class="sd">        assert (</span>
<span class="sd">            _class_names == _time_classes</span>
<span class="sd">        ), &quot;truck.classes ({_class_names}) doesn&#39;t  equal\</span>
<span class="sd">            class names in truck.time_split ({_time_classes}).&quot;</span>
<span class="sd">        assert (</span>
<span class="sd">            _class_names == _toll_classes</span>
<span class="sd">        ), &quot;truck.classes ({_class_names}) doesn&#39;t equal\</span>
<span class="sd">            class names in truck.toll_choice ({_toll_classes}).&quot;</span>

<span class="sd">        return v</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="tm2py.config.TruckConfig.highway_demand_file" class="doc doc-heading">
            <code class=" language-python"><span class="n">highway_demand_file</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#tm2py.config.TruckConfig.highway_demand_file" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>@validator(&ldquo;classes&rdquo;)
def class_consistency(cls, v, values):
    # TODO Can&rsquo;t get to work righ tnow
    _class_names = [c.name for c in v]
    _gen_classes = [c.name for c in values[&ldquo;trip_gen&rdquo;]]
    _dist_classes = [c.name for c in values[&ldquo;trip_dist&rdquo;]]
    _time_classes = [c.name for c in values[&ldquo;time_split&rdquo;]]
    _toll_classes = [c.name for c in values[&ldquo;toll_choice&rdquo;]]</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nx">assert</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">_class_names</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">_gen_classes</span>
<span class="p">),</span><span class="w"> </span><span class="s">&quot;truck.classes ({_class_names}) doesn&#39;t equal            class names in truck.trip_gen ({_gen_classes}).&quot;</span>
<span class="nx">assert</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">_class_names</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">_dist_classes</span>
<span class="p">),</span><span class="w"> </span><span class="s">&quot;truck.classes ({_class_names}) doesn&#39;t  equal            class names in truck.trip_dist ({_dist_classes}).&quot;</span>
<span class="nx">assert</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">_class_names</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">_time_classes</span>
<span class="p">),</span><span class="w"> </span><span class="s">&quot;truck.classes ({_class_names}) doesn&#39;t  equal            class names in truck.time_split ({_time_classes}).&quot;</span>
<span class="nx">assert</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">_class_names</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">_toll_classes</span>
<span class="p">),</span><span class="w"> </span><span class="s">&quot;truck.classes ({_class_names}) doesn&#39;t equal            class names in truck.toll_choice ({_toll_classes}).&quot;</span>

<span class="k">return</span><span class="w"> </span><span class="nx">v</span>
</code></pre></div></td></tr></table></div>
    </div>

</div>





  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.config.WarmStartConfig" class="doc doc-heading">
            <code>WarmStartConfig</code>


<a href="#tm2py.config.WarmStartConfig" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Warm start parameters.</p>
<p>Note that the components will be executed in the order listed.</p>


<details class="properties" open>
  <summary>Properties</summary>
  
</details>
              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">WarmStartConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Warm start parameters.</span>

<span class="sd">    Note that the components will be executed in the order listed.</span>

<span class="sd">    Properties:</span>
<span class="sd">        warmstart: Boolean indicating whether warmstart demand matrices are used.</span>
<span class="sd">            If set to True, the global iteration 0 will either assign warmstart demand for highway and transit, or skip the assignment and just use warmstart skims.</span>
<span class="sd">            If set to False, the global iteration 0 will assign zero demand for highway and transit.</span>
<span class="sd">        warmstart_skim: Boolean indicating whether to use warmstart skims. If set to True, then skips warmstart assignment in iteraton 0.</span>
<span class="sd">        warmstart_demand: Boolean indicating whether to use warmstart demand. If set to True, then runs warmstart assignment in iteration 0.</span>
<span class="sd">        warmstart_check: if on, check that demand matrix files exist.</span>
<span class="sd">        household_highway_demand_file: file name template of warmstart household highway demand matrices.</span>
<span class="sd">        household_transit_demand_file: file name template of warmstart household transit demand matrices.</span>
<span class="sd">        air_passenger_highway_demand_file: file name template of warmstart airport highway demand matrices.</span>
<span class="sd">        internal_external_highway_demand_file: file name template of warmstart internal-external highway demand matrices.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">warmstart</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">use_warmstart_skim</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">use_warmstart_demand</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">warmstart_check</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">household_highway_demand_file</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">household_transit_demand_file</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">air_passenger_highway_demand_file</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">internal_external_highway_demand_file</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">truck_highway_demand_file</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;warmstart&quot;</span><span class="p">,</span> <span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">check_warmstart_method</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;When warmstart, either skim or demand should be true.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;warmstart&quot;</span><span class="p">):</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="n">values</span><span class="o">.</span><span class="n">use_warmstart_skim</span> <span class="o">!=</span> <span class="n">values</span><span class="o">.</span><span class="n">use_warmstart_demand</span>
            <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;&#39;warmstart is on, only one of&#39; </span><span class="si">{</span><span class="n">values</span><span class="o">.</span><span class="n">use_warmstart_skim</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">values</span><span class="o">.</span><span class="n">use_warmstart_demand</span><span class="si">}</span><span class="s2"> can be true&quot;</span>
        <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tm2py.config.WarmStartConfig.check_warmstart_method" class="doc doc-heading">
            <code class=" language-python"><span class="n">check_warmstart_method</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>

<a href="#tm2py.config.WarmStartConfig.check_warmstart_method" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>When warmstart, either skim or demand should be true.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/config.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;warmstart&quot;</span><span class="p">,</span> <span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">check_warmstart_method</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;When warmstart, either skim or demand should be true.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;warmstart&quot;</span><span class="p">):</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">values</span><span class="o">.</span><span class="n">use_warmstart_skim</span> <span class="o">!=</span> <span class="n">values</span><span class="o">.</span><span class="n">use_warmstart_demand</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;&#39;warmstart is on, only one of&#39; </span><span class="si">{</span><span class="n">values</span><span class="o">.</span><span class="n">use_warmstart_skim</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">values</span><span class="o">.</span><span class="n">use_warmstart_demand</span><span class="si">}</span><span class="s2"> can be true&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><p><strong>Configurations for each component are listed with those components</strong></p>
<h2 id="components">Components<a class="headerlink" href="#components" title="Permanent link"> </a></h2>
<h3 id="base-component">Base Component<a class="headerlink" href="#base-component" title="Permanent link"> </a></h3>


<div class="doc doc-object doc-module">



<a id="tm2py.components.component"></a>
    <div class="doc doc-contents first">

      <p>Root component ABC.</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="tm2py.components.component.Component" class="doc doc-heading">
            <code>Component</code>


<a href="#tm2py.components.component.Component" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="abc.ABC">ABC</span></code></p>


      <p>Template for Component class with several built-in methods.</p>
<p>A component is a piece of the model that can be run independently (of other components) given
the required input data and configuration.  It communicates information to other components via
disk I/O (including the emmebank).</p>
<p>Note: if the component needs data that is not written to disk, it would be considered a
subcomponent.</p>
<p>Abstract Methods Each component class must have the following methods:
    __init___: constructor, which associates the RunController with the instantiated object
    run: run the component without any arguments
    validate_inputs: validate the inputs to the component
    report_progress: report progress to the user
    verify: verify the component&rsquo;s output
    write_top_sheet: write outputs to topsheet
    test_component: test the component</p>


<details class="template-class-methods---component-classes-inherit" open>
  <summary>Template Class methods - component classes inherit</summary>
  
</details>

<details class="template-class-properties---component-classes-inherit" open>
  <summary>Template Class Properties - component classes inherit</summary>
  
</details>      <p>::
    class MyComponent(Component):</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div><pre><span></span><code>def __init__(self, controller):
    super().__init__(controller)
    self._parameter = None

def run(self):
    self._step1()
    self._step2()

def _step1(self):
    pass

def _step2(self):
    pass
</code></pre></div></td></tr></table></div>

              <details class="quote">
                <summary>Source code in <code>tm2py/components/component.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Component</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Template for Component class with several built-in methods.</span>

<span class="sd">    A component is a piece of the model that can be run independently (of other components) given</span>
<span class="sd">    the required input data and configuration.  It communicates information to other components via</span>
<span class="sd">    disk I/O (including the emmebank).</span>

<span class="sd">    Note: if the component needs data that is not written to disk, it would be considered a</span>
<span class="sd">    subcomponent.</span>

<span class="sd">    Abstract Methods Each component class must have the following methods:</span>
<span class="sd">        __init___: constructor, which associates the RunController with the instantiated object</span>
<span class="sd">        run: run the component without any arguments</span>
<span class="sd">        validate_inputs: validate the inputs to the component</span>
<span class="sd">        report_progress: report progress to the user</span>
<span class="sd">        verify: verify the component&#39;s output</span>
<span class="sd">        write_top_sheet: write outputs to topsheet</span>
<span class="sd">        test_component: test the component</span>

<span class="sd">    Template Class methods - component classes inherit:</span>
<span class="sd">        get_abs_path: convenience method to get absolute path of the run directory</span>


<span class="sd">    Template Class Properties - component classes inherit:</span>
<span class="sd">        controller: RunController object</span>
<span class="sd">        config: Config object</span>
<span class="sd">        time_period_names: convenience property</span>
<span class="sd">        top_sheet: topsheet object</span>
<span class="sd">        logger: logger object</span>
<span class="sd">        trace: trace object</span>

<span class="sd">    Example:</span>
<span class="sd">    ::</span>
<span class="sd">        class MyComponent(Component):</span>

<span class="sd">        def __init__(self, controller):</span>
<span class="sd">            super().__init__(controller)</span>
<span class="sd">            self._parameter = None</span>

<span class="sd">        def run(self):</span>
<span class="sd">            self._step1()</span>
<span class="sd">            self._step2()</span>

<span class="sd">        def _step1(self):</span>
<span class="sd">            pass</span>

<span class="sd">        def _step2(self):</span>
<span class="sd">            pass</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Model component template/abstract base class.</span>

<span class="sd">        Args:</span>
<span class="sd">            controller (RunController): Reference to the run controller object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_controller</span> <span class="o">=</span> <span class="n">controller</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trace</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_controller</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">detail</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Initializing component </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__qualname__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">controller</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parent controller.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_controller</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">emme_manager</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span>

    <span class="k">def</span> <span class="nf">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convenince method to get absolute path from run directory.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">path</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">time_period_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return input time_period name or names and return list of time_period names.</span>

<span class="sd">        Implemented here for easy access for all components.</span>

<span class="sd">        Returns: list of uppercased string names of time periods</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">time_period_names</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">time_period_durations</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return mapping of time periods to durations in hours.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">time_period_durations</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">congested_transit_assn_max_iteration</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return mapping of time periods to max iteration in congested transit assignment.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">congested_transit_assn_max_iteration</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">top_sheet</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reference to top sheet.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">top_sheet</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">logger</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reference to logger.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">logger</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">trace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reference to trace.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trace</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate inputs are correct at model initiation, raise on error.&quot;&quot;&quot;</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run model component.&quot;&quot;&quot;</span>

    <span class="c1"># @abstractmethod</span>
    <span class="k">def</span> <span class="nf">report_progress</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write progress to log file.&quot;&quot;&quot;</span>

    <span class="c1"># @abstractmethod</span>
    <span class="k">def</span> <span class="nf">verify</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Verify component outputs / results.&quot;&quot;&quot;</span>

    <span class="c1"># @abstractmethod</span>
    <span class="k">def</span> <span class="nf">write_top_sheet</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write key outputs to the model top sheet.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="tm2py.components.component.Component.congested_transit_assn_max_iteration" class="doc doc-heading">
            <code class=" language-python"><span class="n">congested_transit_assn_max_iteration</span><span class="p">:</span> <span class="nb">dict</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.components.component.Component.congested_transit_assn_max_iteration" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Return mapping of time periods to max iteration in congested transit assignment.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tm2py.components.component.Component.controller" class="doc doc-heading">
            <code class=" language-python"><span class="n">controller</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.components.component.Component.controller" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Parent controller.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tm2py.components.component.Component.logger" class="doc doc-heading">
            <code class=" language-python"><span class="n">logger</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.components.component.Component.logger" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Reference to logger.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tm2py.components.component.Component.time_period_durations" class="doc doc-heading">
            <code class=" language-python"><span class="n">time_period_durations</span><span class="p">:</span> <span class="nb">dict</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.components.component.Component.time_period_durations" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Return mapping of time periods to durations in hours.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tm2py.components.component.Component.time_period_names" class="doc doc-heading">
            <code class=" language-python"><span class="n">time_period_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.components.component.Component.time_period_names" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Return input time_period name or names and return list of time_period names.</p>
<p>Implemented here for easy access for all components.</p>
<p>Returns: list of uppercased string names of time periods</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tm2py.components.component.Component.top_sheet" class="doc doc-heading">
            <code class=" language-python"><span class="n">top_sheet</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.components.component.Component.top_sheet" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Reference to top sheet.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tm2py.components.component.Component.trace" class="doc doc-heading">
            <code class=" language-python"><span class="n">trace</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.components.component.Component.trace" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Reference to trace.</p>
    </div>

</div>



<div class="doc doc-object doc-function">


<h3 id="tm2py.components.component.Component.__init__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span></code>

<a href="#tm2py.components.component.Component.__init__" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Model component template/abstract base class.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>controller</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="RunController (tm2py.controller.RunController)" href="#tm2py.controller.RunController">RunController</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reference to the run controller object.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/component.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Model component template/abstract base class.</span>

<span class="sd">    Args:</span>
<span class="sd">        controller (RunController): Reference to the run controller object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_controller</span> <span class="o">=</span> <span class="n">controller</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_trace</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_controller</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">detail</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Initializing component </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__qualname__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.component.Component.get_abs_path" class="doc doc-heading">
            <code class=" language-python"><span class="n">get_abs_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></code>

<a href="#tm2py.components.component.Component.get_abs_path" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Convenince method to get absolute path from run directory.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/component.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convenince method to get absolute path from run directory.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">path</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.component.Component.report_progress" class="doc doc-heading">
            <code class=" language-python"><span class="n">report_progress</span><span class="p">()</span></code>

<a href="#tm2py.components.component.Component.report_progress" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Write progress to log file.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/component.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">150</span>
<span class="normal">151</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">report_progress</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Write progress to log file.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.component.Component.run" class="doc doc-heading">
            <code class=" language-python"><span class="n">run</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

<a href="#tm2py.components.component.Component.run" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Run model component.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/component.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run model component.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.component.Component.validate_inputs" class="doc doc-heading">
            <code class=" language-python"><span class="n">validate_inputs</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

<a href="#tm2py.components.component.Component.validate_inputs" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Validate inputs are correct at model initiation, raise on error.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/component.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate inputs are correct at model initiation, raise on error.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.component.Component.verify" class="doc doc-heading">
            <code class=" language-python"><span class="n">verify</span><span class="p">()</span></code>

<a href="#tm2py.components.component.Component.verify" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Verify component outputs / results.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/component.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">154</span>
<span class="normal">155</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">verify</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Verify component outputs / results.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.component.Component.write_top_sheet" class="doc doc-heading">
            <code class=" language-python"><span class="n">write_top_sheet</span><span class="p">()</span></code>

<a href="#tm2py.components.component.Component.write_top_sheet" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Write key outputs to the model top sheet.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/component.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">158</span>
<span class="normal">159</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">write_top_sheet</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Write key outputs to the model top sheet.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.components.component.FileFormatError" class="doc doc-heading">
            <code>FileFormatError</code>


<a href="#tm2py.components.component.FileFormatError" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="Exception">Exception</span></code></p>


      <p>Exception raised when a file is not in the expected format.</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/components/component.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">FileFormatError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Exception raised when a file is not in the expected format.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Exception for invalid file formats.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">f</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;String representation for FileFormatError.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="si">}</span><span class="s2"> is not a valid format.&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tm2py.components.component.FileFormatError.__init__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span></code>

<a href="#tm2py.components.component.FileFormatError.__init__" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Exception for invalid file formats.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/component.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Exception for invalid file formats.&quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">f</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.component.FileFormatError.__str__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__str__</span><span class="p">()</span></code>

<a href="#tm2py.components.component.FileFormatError.__str__" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>String representation for FileFormatError.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/component.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;String representation for FileFormatError.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="si">}</span><span class="s2"> is not a valid format.&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.components.component.Subcomponent" class="doc doc-heading">
            <code>Subcomponent</code>


<a href="#tm2py.components.component.Subcomponent" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="Component (tm2py.components.component.Component)" href="#tm2py.components.component.Component">Component</a></code></p>


      <p>Template for sub-component class.</p>
<p>A sub-component is a more loosly defined component that allows for input into the run()
method.  It is used to break-up larger processes into smaller chunks which can be:
(1) re-used across components (i.e toll choice)
(2) updated/subbed in to a parent component(s) run method based on the expected API
(3) easier to test, understand and debug.
(4) more consistent with the algorithms we understand from transportation planning 101</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/components/component.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Subcomponent</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Template for sub-component class.</span>

<span class="sd">    A sub-component is a more loosly defined component that allows for input into the run()</span>
<span class="sd">    method.  It is used to break-up larger processes into smaller chunks which can be:</span>
<span class="sd">    (1) re-used across components (i.e toll choice)</span>
<span class="sd">    (2) updated/subbed in to a parent component(s) run method based on the expected API</span>
<span class="sd">    (3) easier to test, understand and debug.</span>
<span class="sd">    (4) more consistent with the algorithms we understand from transportation planning 101</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">,</span> <span class="n">component</span><span class="p">:</span> <span class="n">Component</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor for model sub-component abstract base class.</span>

<span class="sd">        Only calls the super class constructor.</span>

<span class="sd">        Args:</span>
<span class="sd">            controller (RunController): Reference to the run controller object.</span>
<span class="sd">            component (Component): Reference to the parent component object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">component</span> <span class="o">=</span> <span class="n">component</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run sub-component, allowing for multiple inputs.</span>

<span class="sd">        Allowing for inputs to the run() method is what differentiates a sub-component from</span>
<span class="sd">        a component.</span>
<span class="sd">        &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tm2py.components.component.Subcomponent.__init__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">component</span><span class="p">)</span></code>

<a href="#tm2py.components.component.Subcomponent.__init__" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Constructor for model sub-component abstract base class.</p>
<p>Only calls the super class constructor.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>controller</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="RunController (tm2py.controller.RunController)" href="#tm2py.controller.RunController">RunController</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reference to the run controller object.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>component</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Component (tm2py.components.component.Component)" href="#tm2py.components.component.Component">Component</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reference to the parent component object.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/component.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">,</span> <span class="n">component</span><span class="p">:</span> <span class="n">Component</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Constructor for model sub-component abstract base class.</span>

<span class="sd">    Only calls the super class constructor.</span>

<span class="sd">    Args:</span>
<span class="sd">        controller (RunController): Reference to the run controller object.</span>
<span class="sd">        component (Component): Reference to the parent component object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">component</span> <span class="o">=</span> <span class="n">component</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.component.Subcomponent.run" class="doc doc-heading">
            <code class=" language-python"><span class="n">run</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

<a href="#tm2py.components.component.Subcomponent.run" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Run sub-component, allowing for multiple inputs.</p>
<p>Allowing for inputs to the run() method is what differentiates a sub-component from
a component.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/component.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run sub-component, allowing for multiple inputs.</span>

<span class="sd">    Allowing for inputs to the run() method is what differentiates a sub-component from</span>
<span class="sd">    a component.</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h3 id="demand-components">Demand Components<a class="headerlink" href="#demand-components" title="Permanent link"> </a></h3>


<div class="doc doc-object doc-module">



<a id="tm2py.components.demand.prepare_demand"></a>
    <div class="doc doc-contents first">

      <p>Demand loading from OMX to Emme database.</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="tm2py.components.demand.prepare_demand.EmmeDemand" class="doc doc-heading">
            <code>EmmeDemand</code>


<a href="#tm2py.components.demand.prepare_demand.EmmeDemand" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">


      <p>Abstract base class to import and average demand.</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/components/demand/prepare_demand.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">EmmeDemand</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Abstract base class to import and average demand.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor for PrepareDemand class.</span>

<span class="sd">        Args:</span>
<span class="sd">            controller (RunController): Run controller for the current run.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span> <span class="o">=</span> <span class="n">controller</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_source_ref_key</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">logger</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reference to logger.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">logger</span>

    <span class="k">def</span> <span class="nf">_read</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">num_zones</span><span class="p">,</span> <span class="n">factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NumpyArray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Read matrix array from OMX file at path with name, and multiple by factor (if specified).</span>

<span class="sd">        Args:</span>
<span class="sd">            path: full path to OMX file</span>
<span class="sd">            name: name of the OMX matrix / key</span>
<span class="sd">            factor: optional factor to apply to matrix</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">OMXManager</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">omx_file</span><span class="p">:</span>
            <span class="n">demand</span> <span class="o">=</span> <span class="n">omx_file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">omx_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">factor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">demand</span> <span class="o">=</span> <span class="n">factor</span> <span class="o">*</span> <span class="n">demand</span>
        <span class="n">demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redim_demand</span><span class="p">(</span><span class="n">demand</span><span class="p">,</span> <span class="n">num_zones</span><span class="p">)</span>
        <span class="c1"># self.logger.log(f&quot;{name} sum: {demand.sum()}&quot;, level=3)</span>
        <span class="k">return</span> <span class="n">demand</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_redim_demand</span><span class="p">(</span><span class="n">demand</span><span class="p">,</span> <span class="n">num_zones</span><span class="p">):</span>
        <span class="n">_shape</span> <span class="o">=</span> <span class="n">demand</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">if</span> <span class="n">_shape</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">num_zones</span><span class="p">,</span> <span class="n">num_zones</span><span class="p">):</span>
            <span class="n">demand</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span>
                <span class="n">demand</span><span class="p">,</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_zones</span> <span class="o">-</span> <span class="n">_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_zones</span> <span class="o">-</span> <span class="n">_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">_shape</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">num_zones</span><span class="p">,</span> <span class="n">num_zones</span><span class="p">):</span>
            <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Provided demand matrix is larger (</span><span class="si">{</span><span class="n">_shape</span><span class="si">}</span><span class="s2">) than the </span><span class="se">\</span>
<span class="s2">                specified number of zones: </span><span class="si">{</span><span class="n">num_zones</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">demand</span>

    <span class="k">def</span> <span class="nf">_save_demand</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">demand</span><span class="p">:</span> <span class="n">NumpyArray</span><span class="p">,</span>
        <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">apply_msa</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save demand array to Emme matrix with name, optional description.</span>

<span class="sd">        Matrix will be created if it does not exist and the model is on iteration 0.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: name of the matrix in the Emmebank</span>
<span class="sd">            demand: NumpyArray, demand array to save</span>
<span class="sd">            description: str, optional description to use in the Emmebank</span>
<span class="sd">            apply_msa: bool, default False: use MSA on matrix with current array</span>
<span class="sd">                values if model is on iteration &gt;= 1</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank</span><span class="o">.</span><span class="n">emmebank</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
        <span class="n">msa_iteration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">iteration</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">apply_msa</span> <span class="ow">or</span> <span class="n">msa_iteration</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">matrix</span><span class="p">:</span>
                <span class="n">ident</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank</span><span class="o">.</span><span class="n">emmebank</span><span class="o">.</span><span class="n">available_matrix_identifier</span><span class="p">(</span><span class="s2">&quot;FULL&quot;</span><span class="p">)</span>
                <span class="n">matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank</span><span class="o">.</span><span class="n">emmebank</span><span class="o">.</span><span class="n">create_matrix</span><span class="p">(</span><span class="n">ident</span><span class="p">)</span>
                <span class="n">matrix</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
                <span class="k">if</span> <span class="n">description</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">matrix</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">matrix</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;error averaging demand: matrix </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> does not exist&quot;</span><span class="p">)</span>
            <span class="n">prev_demand</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">get_numpy_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="n">demand</span> <span class="o">=</span> <span class="n">prev_demand</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">msa_iteration</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">demand</span> <span class="o">-</span> <span class="n">prev_demand</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> sum: </span><span class="si">{</span><span class="n">demand</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>
        <span class="n">matrix</span><span class="o">.</span><span class="n">set_numpy_data</span><span class="p">(</span><span class="n">demand</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="tm2py.components.demand.prepare_demand.EmmeDemand.logger" class="doc doc-heading">
            <code class=" language-python"><span class="n">logger</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.components.demand.prepare_demand.EmmeDemand.logger" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Reference to logger.</p>
    </div>

</div>



<div class="doc doc-object doc-function">


<h3 id="tm2py.components.demand.prepare_demand.EmmeDemand.__init__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span></code>

<a href="#tm2py.components.demand.prepare_demand.EmmeDemand.__init__" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Constructor for PrepareDemand class.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>controller</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="RunController (tm2py.controller.RunController)" href="#tm2py.controller.RunController">RunController</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Run controller for the current run.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/demand/prepare_demand.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Constructor for PrepareDemand class.</span>

<span class="sd">    Args:</span>
<span class="sd">        controller (RunController): Run controller for the current run.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">controller</span> <span class="o">=</span> <span class="n">controller</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_source_ref_key</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.components.demand.prepare_demand.PrepareHighwayDemand" class="doc doc-heading">
            <code>PrepareHighwayDemand</code>


<a href="#tm2py.components.demand.prepare_demand.PrepareHighwayDemand" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="EmmeDemand (tm2py.components.demand.prepare_demand.EmmeDemand)" href="#tm2py.components.demand.prepare_demand.EmmeDemand">EmmeDemand</a></code></p>


      <p>Import and average highway demand.</p>
<p>Demand is imported from OMX files based on reference file paths and OMX
matrix names in highway assignment config (highway.classes).
The demand is average using MSA with the current demand matrices
(in the Emmebank) if the controller.iteration &gt; 1.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>controller</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="RunController (tm2py.controller.RunController)" href="#tm2py.controller.RunController">RunController</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>parent RunController object</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>tm2py/components/demand/prepare_demand.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">PrepareHighwayDemand</span><span class="p">(</span><span class="n">EmmeDemand</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Import and average highway demand.</span>

<span class="sd">    Demand is imported from OMX files based on reference file paths and OMX</span>
<span class="sd">    matrix names in highway assignment config (highway.classes).</span>
<span class="sd">    The demand is average using MSA with the current demand matrices</span>
<span class="sd">    (in the Emmebank) if the controller.iteration &gt; 1.</span>

<span class="sd">    Args:</span>
<span class="sd">        controller: parent RunController object</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor for PrepareHighwayDemand.</span>

<span class="sd">        Args:</span>
<span class="sd">            controller (RunController): Reference to run controller object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span> <span class="o">=</span> <span class="n">controller</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_highway_emmebank</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># TODO</span>
        <span class="k">pass</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">highway_emmebank</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_highway_emmebank</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_highway_emmebank</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">highway_emmebank</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_highway_emmebank</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_highway_emmebank</span>

    <span class="c1"># @LogStartEnd(&quot;prepare highway demand&quot;)</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Open combined demand OMX files from demand models and prepare for assignment.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">highway_emmebank</span><span class="o">.</span><span class="n">create_zero_matrix</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">klass</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_demand</span><span class="p">(</span><span class="n">klass</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">klass</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">klass</span><span class="o">.</span><span class="n">demand</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_prepare_demand</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">description</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">demand_config</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]],</span>
        <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load demand from OMX files and save to Emme matrix for highway assignment.</span>

<span class="sd">        Average with previous demand (MSA) if the current iteration &gt; 1</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): the name of the highway assignment class</span>
<span class="sd">            description (str): the description for the highway assignment class</span>
<span class="sd">            demand_config (dict): the list of file cross-reference(s) for the demand to be loaded</span>
<span class="sd">                {&quot;source&quot;: &lt;name of demand model component&gt;,</span>
<span class="sd">                 &quot;name&quot;: &lt;OMX key name&gt;,</span>
<span class="sd">                 &quot;factor&quot;: &lt;factor to apply to demand in this file&gt;}</span>
<span class="sd">            time_period (str): the time time_period ID (name)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">highway_emmebank</span><span class="o">.</span><span class="n">scenario</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span>
        <span class="n">num_zones</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="o">.</span><span class="n">zone_numbers</span><span class="p">)</span>
        <span class="n">demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_demand</span><span class="p">(</span><span class="n">demand_config</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">time_period</span><span class="p">,</span> <span class="n">num_zones</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">file_config</span> <span class="ow">in</span> <span class="n">demand_config</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">demand</span> <span class="o">=</span> <span class="n">demand</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_demand</span><span class="p">(</span><span class="n">file_config</span><span class="p">,</span> <span class="n">time_period</span><span class="p">,</span> <span class="n">num_zones</span><span class="p">)</span>
        <span class="n">demand_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time_period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">description</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time_period</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">description</span><span class="si">}</span><span class="s2"> demand&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_demand</span><span class="p">(</span>
            <span class="n">demand_name</span><span class="p">,</span> <span class="n">demand</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">apply_msa</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">apply_msa_demand</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_read_demand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_config</span><span class="p">,</span> <span class="n">time_period</span><span class="p">,</span> <span class="n">num_zones</span><span class="p">):</span>
        <span class="c1"># Load demand from cross-referenced source file,</span>
        <span class="c1"># the named demand model component under the key highway_demand_file</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">file_config</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">file_config</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="n">time_period</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">source</span><span class="p">]</span><span class="o">.</span><span class="n">highway_demand_file</span>
        <span class="p">)</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read</span><span class="p">(</span>
            <span class="n">path</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="n">time_period</span><span class="p">,</span> <span class="nb">iter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">iteration</span><span class="p">),</span>
            <span class="n">name</span><span class="p">,</span>
            <span class="n">num_zones</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@LogStartEnd</span><span class="p">(</span><span class="s2">&quot;Prepare household demand matrices.&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">prepare_household_demand</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prepares highway and transit household demand matrices from trip lists produced by CT-RAMP.&quot;&quot;&quot;</span>
        <span class="n">iteration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">iteration</span>

        <span class="c1"># Create folders if they don&#39;t exist</span>
        <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">household</span><span class="o">.</span><span class="n">highway_demand_file</span>
            <span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">household</span><span class="o">.</span><span class="n">transit_demand_file</span>
            <span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1">#    pathlib.Path(self.controller.get_abs_path(self.controller.config.household.active_demand_file)).parents[0].mkdir(parents=True, exist_ok=True)</span>

        <span class="n">indiv_trip_file</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">household</span><span class="o">.</span><span class="n">ctramp_indiv_trip_file</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">iteration</span><span class="o">=</span><span class="n">iteration</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">joint_trip_file</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">household</span><span class="o">.</span><span class="n">ctramp_joint_trip_file</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">iteration</span><span class="o">=</span><span class="n">iteration</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">it_full</span><span class="p">,</span> <span class="n">jt_full</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">indiv_trip_file</span><span class="p">),</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">joint_trip_file</span><span class="p">)</span>

        <span class="c1"># Add time period, expanded count</span>
        <span class="n">time_period_start</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="nb">zip</span><span class="p">(</span>
                <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">time_periods</span><span class="p">],</span>
                <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">start_period</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">time_periods</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># the last time period needs to be filled in because the first period may or may not start at midnight</span>
        <span class="n">time_periods_sorted</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
            <span class="n">time_period_start</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">time_period_start</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
        <span class="p">)</span>  <span class="c1"># in upper case</span>
        <span class="n">first_period</span> <span class="o">=</span> <span class="n">time_periods_sorted</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">periods_except_last</span> <span class="o">=</span> <span class="n">time_periods_sorted</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">breakpoints</span> <span class="o">=</span> <span class="p">[</span><span class="n">time_period_start</span><span class="p">[</span><span class="n">tp</span><span class="p">]</span> <span class="k">for</span> <span class="n">tp</span> <span class="ow">in</span> <span class="n">time_periods_sorted</span><span class="p">]</span>
        <span class="n">it_full</span><span class="p">[</span><span class="s2">&quot;time_period&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span>
                <span class="n">it_full</span><span class="o">.</span><span class="n">stop_period</span><span class="p">,</span>
                <span class="n">breakpoints</span><span class="p">,</span>
                <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">labels</span><span class="o">=</span><span class="n">periods_except_last</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">add_categories</span><span class="p">(</span><span class="n">time_periods_sorted</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">time_periods_sorted</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">jt_full</span><span class="p">[</span><span class="s2">&quot;time_period&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span>
                <span class="n">jt_full</span><span class="o">.</span><span class="n">stop_period</span><span class="p">,</span>
                <span class="n">breakpoints</span><span class="p">,</span>
                <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">labels</span><span class="o">=</span><span class="n">periods_except_last</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">add_categories</span><span class="p">(</span><span class="n">time_periods_sorted</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">time_periods_sorted</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">it_full</span><span class="p">[</span><span class="s2">&quot;eq_cnt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">it_full</span><span class="o">.</span><span class="n">sampleRate</span>
        <span class="n">it_full</span><span class="p">[</span><span class="s2">&quot;eq_cnt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
            <span class="n">it_full</span><span class="p">[</span><span class="s2">&quot;trip_mode&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]),</span>
            <span class="mf">0.5</span> <span class="o">*</span> <span class="n">it_full</span><span class="p">[</span><span class="s2">&quot;eq_cnt&quot;</span><span class="p">],</span>
            <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                <span class="n">it_full</span><span class="p">[</span><span class="s2">&quot;trip_mode&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]),</span>
                <span class="mf">0.35</span> <span class="o">*</span> <span class="n">it_full</span><span class="p">[</span><span class="s2">&quot;eq_cnt&quot;</span><span class="p">],</span>
                <span class="n">it_full</span><span class="p">[</span><span class="s2">&quot;eq_cnt&quot;</span><span class="p">],</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="n">jt_full</span><span class="p">[</span><span class="s2">&quot;eq_cnt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">jt_full</span><span class="o">.</span><span class="n">num_participants</span> <span class="o">/</span> <span class="n">jt_full</span><span class="o">.</span><span class="n">sampleRate</span>
        <span class="n">zp_cav</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">household</span><span class="o">.</span><span class="n">OwnedAV_ZPV_factor</span>
        <span class="n">zp_tnc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">household</span><span class="o">.</span><span class="n">TNC_ZPV_factor</span>

        <span class="n">maz_taz_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">scenario</span><span class="o">.</span><span class="n">landuse_file</span><span class="p">),</span>
            <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;MAZ&quot;</span><span class="p">,</span> <span class="s2">&quot;TAZ&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">it_full</span> <span class="o">=</span> <span class="n">it_full</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
            <span class="n">maz_taz_df</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;orig_mgra&quot;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;MAZ&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;TAZ&quot;</span><span class="p">:</span> <span class="s2">&quot;orig_taz&quot;</span><span class="p">})</span>
        <span class="n">it_full</span> <span class="o">=</span> <span class="n">it_full</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
            <span class="n">maz_taz_df</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;dest_mgra&quot;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;MAZ&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;TAZ&quot;</span><span class="p">:</span> <span class="s2">&quot;dest_taz&quot;</span><span class="p">})</span>
        <span class="n">jt_full</span> <span class="o">=</span> <span class="n">jt_full</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
            <span class="n">maz_taz_df</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;orig_mgra&quot;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;MAZ&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;TAZ&quot;</span><span class="p">:</span> <span class="s2">&quot;orig_taz&quot;</span><span class="p">})</span>
        <span class="n">jt_full</span> <span class="o">=</span> <span class="n">jt_full</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
            <span class="n">maz_taz_df</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;dest_mgra&quot;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;MAZ&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;TAZ&quot;</span><span class="p">:</span> <span class="s2">&quot;dest_taz&quot;</span><span class="p">})</span>
        <span class="n">it_full</span><span class="p">[</span><span class="s2">&quot;trip_mode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
            <span class="n">it_full</span><span class="p">[</span><span class="s2">&quot;trip_mode&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="n">it_full</span><span class="p">[</span><span class="s2">&quot;trip_mode&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">jt_full</span><span class="p">[</span><span class="s2">&quot;trip_mode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
            <span class="n">jt_full</span><span class="p">[</span><span class="s2">&quot;trip_mode&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="n">jt_full</span><span class="p">[</span><span class="s2">&quot;trip_mode&quot;</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="n">num_zones</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_internal_zones</span>
        <span class="n">OD_full_index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_product</span><span class="p">(</span>
            <span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_zones</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_zones</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="p">)</span>

        <span class="k">def</span> <span class="nf">combine_trip_lists</span><span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="n">jt</span><span class="p">,</span> <span class="n">trip_mode</span><span class="p">):</span>
            <span class="c1"># combines individual trip list and joint trip list</span>
            <span class="n">combined_trips</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                <span class="p">[</span><span class="n">it</span><span class="p">[(</span><span class="n">it</span><span class="p">[</span><span class="s2">&quot;trip_mode&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">trip_mode</span><span class="p">)],</span> <span class="n">jt</span><span class="p">[(</span><span class="n">jt</span><span class="p">[</span><span class="s2">&quot;trip_mode&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">trip_mode</span><span class="p">)]]</span>
            <span class="p">)</span>
            <span class="n">combined_sum</span> <span class="o">=</span> <span class="n">combined_trips</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;orig_taz&quot;</span><span class="p">,</span> <span class="s2">&quot;dest_taz&quot;</span><span class="p">])[</span>
                <span class="s2">&quot;eq_cnt&quot;</span>
            <span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">combined_sum</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">OD_full_index</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>

        <span class="k">def</span> <span class="nf">create_zero_passenger_trips</span><span class="p">(</span>
            <span class="n">trips</span><span class="p">,</span> <span class="n">deadheading_factor</span><span class="p">,</span> <span class="n">trip_modes</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="n">zpv_trips</span> <span class="o">=</span> <span class="n">trips</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                <span class="p">(</span><span class="n">trips</span><span class="p">[</span><span class="s2">&quot;avAvailable&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">trips</span><span class="p">[</span><span class="s2">&quot;trip_mode&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">trip_modes</span><span class="p">))</span>
            <span class="p">]</span>
            <span class="n">zpv_trips</span><span class="p">[</span><span class="s2">&quot;eq_cnt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">zpv_trips</span><span class="p">[</span><span class="s2">&quot;eq_cnt&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">deadheading_factor</span>
            <span class="n">zpv_trips</span> <span class="o">=</span> <span class="n">zpv_trips</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
                <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;dest_taz&quot;</span><span class="p">:</span> <span class="s2">&quot;orig_taz&quot;</span><span class="p">,</span> <span class="s2">&quot;orig_taz&quot;</span><span class="p">:</span> <span class="s2">&quot;dest_taz&quot;</span><span class="p">}</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">zpv_trips</span>

        <span class="c1"># create zero passenger trips for auto modes</span>
        <span class="k">if</span> <span class="n">it_full</span><span class="p">[</span><span class="s2">&quot;avAvailable&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">it_zpav_trp</span> <span class="o">=</span> <span class="n">create_zero_passenger_trips</span><span class="p">(</span>
                <span class="n">it_full</span><span class="p">,</span> <span class="n">zp_cav</span><span class="p">,</span> <span class="n">trip_modes</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">it_zptnc_trp</span> <span class="o">=</span> <span class="n">create_zero_passenger_trips</span><span class="p">(</span><span class="n">it_full</span><span class="p">,</span> <span class="n">zp_tnc</span><span class="p">,</span> <span class="n">trip_modes</span><span class="o">=</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span>
            <span class="c1"># Combining zero passenger trips to trip files</span>
            <span class="n">it_full</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                <span class="p">[</span><span class="n">it_full</span><span class="p">,</span> <span class="n">it_zpav_trp</span><span class="p">,</span> <span class="n">it_zptnc_trp</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">jt_full</span><span class="p">[</span><span class="s2">&quot;avAvailable&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">jt_zpav_trp</span> <span class="o">=</span> <span class="n">create_zero_passenger_trips</span><span class="p">(</span>
                <span class="n">jt_full</span><span class="p">,</span> <span class="n">zp_cav</span><span class="p">,</span> <span class="n">trip_modes</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">jt_zptnc_trp</span> <span class="o">=</span> <span class="n">create_zero_passenger_trips</span><span class="p">(</span><span class="n">jt_full</span><span class="p">,</span> <span class="n">zp_tnc</span><span class="p">,</span> <span class="n">trip_modes</span><span class="o">=</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span>
            <span class="c1"># Combining zero passenger trips to trip files</span>
            <span class="n">jt_full</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                <span class="p">[</span><span class="n">jt_full</span><span class="p">,</span> <span class="n">jt_zpav_trp</span><span class="p">,</span> <span class="n">jt_zptnc_trp</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># read properties from config</span>

        <span class="n">mode_name_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">household</span><span class="o">.</span><span class="n">ctramp_mode_names</span>
        <span class="n">income_segment_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">household</span><span class="o">.</span><span class="n">income_segment</span>

        <span class="k">if</span> <span class="n">income_segment_config</span><span class="p">[</span><span class="s2">&quot;enabled&quot;</span><span class="p">]:</span>
            <span class="c1"># This only affects highway trip tables.</span>

            <span class="n">hh_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">household</span><span class="o">.</span><span class="n">ctramp_hh_file</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">iteration</span><span class="o">=</span><span class="n">iteration</span>
            <span class="p">)</span>
            <span class="n">hh</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">hh_file</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;hh_id&quot;</span><span class="p">,</span> <span class="s2">&quot;income&quot;</span><span class="p">])</span>
            <span class="n">it_full</span> <span class="o">=</span> <span class="n">it_full</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">hh</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;hh_id&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
            <span class="n">jt_full</span> <span class="o">=</span> <span class="n">jt_full</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">hh</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;hh_id&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>

            <span class="n">suffixes</span> <span class="o">=</span> <span class="n">income_segment_config</span><span class="p">[</span><span class="s2">&quot;segment_suffixes&quot;</span><span class="p">]</span>

            <span class="n">it_full</span><span class="p">[</span><span class="s2">&quot;income_seg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span>
                <span class="n">it_full</span><span class="p">[</span><span class="s2">&quot;income&quot;</span><span class="p">],</span>
                <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">bins</span><span class="o">=</span><span class="n">income_segment_config</span><span class="p">[</span><span class="s2">&quot;cutoffs&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)],</span>
                <span class="n">labels</span><span class="o">=</span><span class="n">suffixes</span><span class="p">,</span>
            <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

            <span class="n">jt_full</span><span class="p">[</span><span class="s2">&quot;income_seg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span>
                <span class="n">jt_full</span><span class="p">[</span><span class="s2">&quot;income&quot;</span><span class="p">],</span>
                <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">bins</span><span class="o">=</span><span class="n">income_segment_config</span><span class="p">[</span><span class="s2">&quot;cutoffs&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)],</span>
                <span class="n">labels</span><span class="o">=</span><span class="n">suffixes</span><span class="p">,</span>
            <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">it_full</span><span class="p">[</span><span class="s2">&quot;income_seg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">jt_full</span><span class="p">[</span><span class="s2">&quot;income_seg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">suffixes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span>

        <span class="c1"># groupby objects for combinations of time period - income segmentation, used for highway modes only</span>
        <span class="n">it_grp</span> <span class="o">=</span> <span class="n">it_full</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;time_period&quot;</span><span class="p">,</span> <span class="s2">&quot;income_seg&quot;</span><span class="p">])</span>
        <span class="n">jt_grp</span> <span class="o">=</span> <span class="n">jt_full</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;time_period&quot;</span><span class="p">,</span> <span class="s2">&quot;income_seg&quot;</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">time_period</span> <span class="ow">in</span> <span class="n">time_periods_sorted</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Producing household demand matrices for period </span><span class="si">{</span><span class="n">time_period</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

            <span class="n">highway_out_file</span> <span class="o">=</span> <span class="n">OMXManager</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">household</span><span class="o">.</span><span class="n">highway_demand_file</span>
                <span class="p">)</span>
                <span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="n">time_period</span><span class="p">,</span> <span class="nb">iter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">iteration</span><span class="p">),</span>
                <span class="s2">&quot;w&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">transit_out_file</span> <span class="o">=</span> <span class="n">OMXManager</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">household</span><span class="o">.</span><span class="n">transit_demand_file</span>
                <span class="p">)</span>
                <span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="n">time_period</span><span class="p">,</span> <span class="nb">iter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">iteration</span><span class="p">),</span>
                <span class="s2">&quot;w&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># active_out_file = OMXManager(</span>
            <span class="c1">#    self.controller.get_abs_path(self.controller.config.household.active_demand_file).__str__().format(period=time_period), &#39;w&#39;)</span>

            <span class="c1"># hsr_trips_file = _omx.open_file(</span>
            <span class="c1">#    self.controller.get_abs_path(self.controller.config.household.hsr_demand_file).format(year=self.controller.config.scenario.year, period=time_period))</span>

            <span class="c1"># interregional_trips_file = _omx.open_file(</span>
            <span class="c1">#   self.controller.get_abs_path(self.controller.config.household.interregional_demand_file).format(year=self.controller.config.scenario.year, period=time_period))</span>

            <span class="n">highway_out_file</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
            <span class="n">transit_out_file</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
            <span class="c1"># active_out_file.open()</span>

            <span class="c1"># Transit and active modes: one matrix per time period per mode</span>
            <span class="n">it</span> <span class="o">=</span> <span class="n">it_full</span><span class="p">[</span><span class="n">it_full</span><span class="o">.</span><span class="n">time_period</span> <span class="o">==</span> <span class="n">time_period</span><span class="p">]</span>
            <span class="n">jt</span> <span class="o">=</span> <span class="n">jt_full</span><span class="p">[</span><span class="n">jt_full</span><span class="o">.</span><span class="n">time_period</span> <span class="o">==</span> <span class="n">time_period</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">trip_mode</span> <span class="ow">in</span> <span class="n">mode_name_dict</span><span class="p">:</span>
                <span class="c1">#                if trip_mode in [9,10]:</span>
                <span class="c1">#                    matrix_name =  mode_name_dict[trip_mode]</span>
                <span class="c1">#                    self.logger.debug(f&quot;Writing out mode {mode_name_dict[trip_mode]}&quot;)</span>
                <span class="c1">#                    active_out_file.write_array(numpy_array=combine_trip_lists(it,jt, trip_mode), name = matrix_name)</span>

                <span class="k">if</span> <span class="n">trip_mode</span> <span class="o">==</span> <span class="mi">11</span><span class="p">:</span>
                    <span class="n">matrix_name</span> <span class="o">=</span> <span class="s2">&quot;WLK_TRN_WLK&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Writing out mode WLK_TRN_WLK&quot;</span><span class="p">)</span>
                    <span class="c1"># other_trn_trips = np.array(hsr_trips_file[matrix_name])+np.array(interregional_trips_file[matrix_name])</span>
                    <span class="n">transit_out_file</span><span class="o">.</span><span class="n">write_array</span><span class="p">(</span>
                        <span class="n">numpy_array</span><span class="o">=</span><span class="p">(</span><span class="n">combine_trip_lists</span><span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="n">jt</span><span class="p">,</span> <span class="n">trip_mode</span><span class="p">)),</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">matrix_name</span><span class="p">,</span>
                    <span class="p">)</span>

                <span class="k">elif</span> <span class="n">trip_mode</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">]:</span>
                    <span class="n">it_outbound</span><span class="p">,</span> <span class="n">it_inbound</span> <span class="o">=</span> <span class="n">it</span><span class="p">[</span><span class="n">it</span><span class="o">.</span><span class="n">inbound</span> <span class="o">==</span> <span class="mi">0</span><span class="p">],</span> <span class="n">it</span><span class="p">[</span><span class="n">it</span><span class="o">.</span><span class="n">inbound</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="n">jt_outbound</span><span class="p">,</span> <span class="n">jt_inbound</span> <span class="o">=</span> <span class="n">jt</span><span class="p">[</span><span class="n">jt</span><span class="o">.</span><span class="n">inbound</span> <span class="o">==</span> <span class="mi">0</span><span class="p">],</span> <span class="n">jt</span><span class="p">[</span><span class="n">jt</span><span class="o">.</span><span class="n">inbound</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>

                    <span class="n">matrix_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mode_name_dict</span><span class="p">[</span><span class="n">trip_mode</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">_TRN_WLK&quot;</span>
                    <span class="c1"># other_trn_trips = np.array(hsr_trips_file[matrix_name])+np.array(interregional_trips_file[matrix_name])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Writing out mode </span><span class="si">{</span><span class="n">mode_name_dict</span><span class="p">[</span><span class="n">trip_mode</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;_TRN_WLK&#39;</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                    <span class="n">transit_out_file</span><span class="o">.</span><span class="n">write_array</span><span class="p">(</span>
                        <span class="n">numpy_array</span><span class="o">=</span><span class="p">(</span>
                            <span class="n">combine_trip_lists</span><span class="p">(</span><span class="n">it_outbound</span><span class="p">,</span> <span class="n">jt_outbound</span><span class="p">,</span> <span class="n">trip_mode</span><span class="p">)</span>
                        <span class="p">),</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">matrix_name</span><span class="p">,</span>
                    <span class="p">)</span>

                    <span class="n">matrix_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;WLK_TRN_</span><span class="si">{</span><span class="n">mode_name_dict</span><span class="p">[</span><span class="n">trip_mode</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="c1"># other_trn_trips = np.array(hsr_trips_file[matrix_name])+np.array(interregional_trips_file[matrix_name])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Writing out mode </span><span class="si">{</span><span class="s1">&#39;WLK_TRN_&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mode_name_dict</span><span class="p">[</span><span class="n">trip_mode</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                    <span class="n">transit_out_file</span><span class="o">.</span><span class="n">write_array</span><span class="p">(</span>
                        <span class="n">numpy_array</span><span class="o">=</span><span class="p">(</span>
                            <span class="n">combine_trip_lists</span><span class="p">(</span><span class="n">it_inbound</span><span class="p">,</span> <span class="n">jt_inbound</span><span class="p">,</span> <span class="n">trip_mode</span><span class="p">)</span>
                        <span class="p">),</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">matrix_name</span><span class="p">,</span>
                    <span class="p">)</span>

            <span class="c1"># Highway modes: one matrix per suffix (income class) per time period per mode</span>
            <span class="k">for</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="n">suffixes</span><span class="p">:</span>
                <span class="n">highway_cache</span> <span class="o">=</span> <span class="p">{}</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">time_period</span><span class="p">,</span> <span class="n">suffix</span><span class="p">)</span> <span class="ow">in</span> <span class="n">it_grp</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">it</span> <span class="o">=</span> <span class="n">it_grp</span><span class="o">.</span><span class="n">get_group</span><span class="p">((</span><span class="n">time_period</span><span class="p">,</span> <span class="n">suffix</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">it</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">it_full</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">time_period</span><span class="p">,</span> <span class="n">suffix</span><span class="p">)</span> <span class="ow">in</span> <span class="n">jt_grp</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">jt</span> <span class="o">=</span> <span class="n">jt_grp</span><span class="o">.</span><span class="n">get_group</span><span class="p">((</span><span class="n">time_period</span><span class="p">,</span> <span class="n">suffix</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">jt</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">jt_full</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">trip_mode</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">mode_name_dict</span><span class="p">):</span>
                    <span class="c1"># Python preserves keys in the order they are inserted but</span>
                    <span class="c1"># mode_name_dict originates from TOML, which does not guarantee</span>
                    <span class="c1"># that the ordering of keys is preserved.  See</span>
                    <span class="c1"># https://github.com/toml-lang/toml/issues/162</span>

                    <span class="k">if</span> <span class="n">trip_mode</span> <span class="ow">in</span> <span class="p">[</span>
                        <span class="mi">1</span><span class="p">,</span>
                        <span class="mi">2</span><span class="p">,</span>
                        <span class="mi">3</span><span class="p">,</span>
                        <span class="mi">4</span><span class="p">,</span>
                        <span class="mi">5</span><span class="p">,</span>
                        <span class="mi">6</span><span class="p">,</span>
                        <span class="mi">7</span><span class="p">,</span>
                        <span class="mi">8</span><span class="p">,</span>
                        <span class="mi">9</span><span class="p">,</span>
                        <span class="mi">10</span><span class="p">,</span>
                        <span class="mi">15</span><span class="p">,</span>
                        <span class="mi">16</span><span class="p">,</span>
                        <span class="mi">17</span><span class="p">,</span>
                    <span class="p">]:</span>  <span class="c1"># currently hard-coded based on Travel Mode trip mode codes</span>
                        <span class="n">highway_cache</span><span class="p">[</span><span class="n">mode_name_dict</span><span class="p">[</span><span class="n">trip_mode</span><span class="p">]]</span> <span class="o">=</span> <span class="n">combine_trip_lists</span><span class="p">(</span>
                            <span class="n">it</span><span class="p">,</span> <span class="n">jt</span><span class="p">,</span> <span class="n">trip_mode</span>
                        <span class="p">)</span>
                        <span class="n">out_mode</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mode_name_dict</span><span class="p">[</span><span class="n">trip_mode</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="n">matrix_name</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">out_mode</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">time_period</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
                            <span class="k">if</span> <span class="n">suffix</span>
                            <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">out_mode</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">time_period</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>
                        <span class="n">highway_out_file</span><span class="o">.</span><span class="n">write_array</span><span class="p">(</span>
                            <span class="n">numpy_array</span><span class="o">=</span><span class="n">highway_cache</span><span class="p">[</span><span class="n">mode_name_dict</span><span class="p">[</span><span class="n">trip_mode</span><span class="p">]],</span>
                            <span class="n">name</span><span class="o">=</span><span class="n">matrix_name</span><span class="p">,</span>
                        <span class="p">)</span>

                    <span class="k">elif</span> <span class="n">trip_mode</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">15</span><span class="p">,</span> <span class="mi">16</span><span class="p">]:</span>
                        <span class="c1"># identify the correct mode split factors for da, sr2, sr3</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Splitting ridehail trips into shared ride trips&quot;</span>
                        <span class="p">)</span>
                        <span class="n">ridehail_split_factors</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
                        <span class="n">splits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">household</span><span class="o">.</span><span class="n">rideshare_mode_split</span>
                        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">splits</span><span class="p">:</span>
                            <span class="n">out_mode_split</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">household</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span>
                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">_split&quot;</span>
                            <span class="p">]</span>
                            <span class="k">for</span> <span class="n">out_mode</span> <span class="ow">in</span> <span class="n">out_mode_split</span><span class="p">:</span>
                                <span class="n">ridehail_split_factors</span><span class="p">[</span><span class="n">out_mode</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span>
                                    <span class="n">out_mode_split</span><span class="p">[</span><span class="n">out_mode</span><span class="p">]</span> <span class="o">*</span> <span class="n">splits</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                                <span class="p">)</span>

                        <span class="n">ridehail_trips</span> <span class="o">=</span> <span class="n">combine_trip_lists</span><span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="n">jt</span><span class="p">,</span> <span class="n">trip_mode</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">out_mode</span> <span class="ow">in</span> <span class="n">ridehail_split_factors</span><span class="p">:</span>
                            <span class="n">matrix_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">out_mode</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">suffix</span> <span class="k">else</span> <span class="n">out_mode</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Writing out mode </span><span class="si">{</span><span class="n">out_mode</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="n">highway_cache</span><span class="p">[</span><span class="n">out_mode</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span>
                                <span class="p">(</span><span class="n">ridehail_trips</span> <span class="o">*</span> <span class="n">ridehail_split_factors</span><span class="p">[</span><span class="n">out_mode</span><span class="p">])</span>
                                <span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
                                <span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                            <span class="p">)</span>
                            <span class="n">highway_out_file</span><span class="o">.</span><span class="n">write_array</span><span class="p">(</span>
                                <span class="n">numpy_array</span><span class="o">=</span><span class="n">highway_cache</span><span class="p">[</span><span class="n">out_mode</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="n">matrix_name</span>
                            <span class="p">)</span>

            <span class="n">highway_out_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">transit_out_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="c1"># active_out_file.close()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">num_internal_zones</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">scenario</span><span class="o">.</span><span class="n">landuse_file</span><span class="p">),</span>
            <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">scenario</span><span class="o">.</span><span class="n">landuse_index_column</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;TAZ&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">num_total_zones</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">emme</span><span class="o">.</span><span class="n">highway_database_path</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">emmebank</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_emmebank_path</span><span class="p">)</span>
        <span class="n">time_period</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">time_periods</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
        <span class="n">scenario</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_emme_scenario</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">time_period</span>
        <span class="p">)</span>  <span class="c1"># any scenario id works</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">scenario</span><span class="o">.</span><span class="n">zone_numbers</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tm2py.components.demand.prepare_demand.PrepareHighwayDemand.__init__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span></code>

<a href="#tm2py.components.demand.prepare_demand.PrepareHighwayDemand.__init__" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Constructor for PrepareHighwayDemand.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>controller</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="RunController (tm2py.controller.RunController)" href="#tm2py.controller.RunController">RunController</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reference to run controller object.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/demand/prepare_demand.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Constructor for PrepareHighwayDemand.</span>

<span class="sd">    Args:</span>
<span class="sd">        controller (RunController): Reference to run controller object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">controller</span> <span class="o">=</span> <span class="n">controller</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_highway_emmebank</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.demand.prepare_demand.PrepareHighwayDemand.prepare_household_demand" class="doc doc-heading">
            <code class=" language-python"><span class="n">prepare_household_demand</span><span class="p">()</span></code>

<a href="#tm2py.components.demand.prepare_demand.PrepareHighwayDemand.prepare_household_demand" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Prepares highway and transit household demand matrices from trip lists produced by CT-RAMP.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/demand/prepare_demand.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@LogStartEnd</span><span class="p">(</span><span class="s2">&quot;Prepare household demand matrices.&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">prepare_household_demand</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Prepares highway and transit household demand matrices from trip lists produced by CT-RAMP.&quot;&quot;&quot;</span>
    <span class="n">iteration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">iteration</span>

    <span class="c1"># Create folders if they don&#39;t exist</span>
    <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">household</span><span class="o">.</span><span class="n">highway_demand_file</span>
        <span class="p">)</span>
    <span class="p">)</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">household</span><span class="o">.</span><span class="n">transit_demand_file</span>
        <span class="p">)</span>
    <span class="p">)</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1">#    pathlib.Path(self.controller.get_abs_path(self.controller.config.household.active_demand_file)).parents[0].mkdir(parents=True, exist_ok=True)</span>

    <span class="n">indiv_trip_file</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">household</span><span class="o">.</span><span class="n">ctramp_indiv_trip_file</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">iteration</span><span class="o">=</span><span class="n">iteration</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">joint_trip_file</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">household</span><span class="o">.</span><span class="n">ctramp_joint_trip_file</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">iteration</span><span class="o">=</span><span class="n">iteration</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">it_full</span><span class="p">,</span> <span class="n">jt_full</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">indiv_trip_file</span><span class="p">),</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">joint_trip_file</span><span class="p">)</span>

    <span class="c1"># Add time period, expanded count</span>
    <span class="n">time_period_start</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="nb">zip</span><span class="p">(</span>
            <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">time_periods</span><span class="p">],</span>
            <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">start_period</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">time_periods</span><span class="p">],</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="c1"># the last time period needs to be filled in because the first period may or may not start at midnight</span>
    <span class="n">time_periods_sorted</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
        <span class="n">time_period_start</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">time_period_start</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
    <span class="p">)</span>  <span class="c1"># in upper case</span>
    <span class="n">first_period</span> <span class="o">=</span> <span class="n">time_periods_sorted</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">periods_except_last</span> <span class="o">=</span> <span class="n">time_periods_sorted</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">breakpoints</span> <span class="o">=</span> <span class="p">[</span><span class="n">time_period_start</span><span class="p">[</span><span class="n">tp</span><span class="p">]</span> <span class="k">for</span> <span class="n">tp</span> <span class="ow">in</span> <span class="n">time_periods_sorted</span><span class="p">]</span>
    <span class="n">it_full</span><span class="p">[</span><span class="s2">&quot;time_period&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span>
            <span class="n">it_full</span><span class="o">.</span><span class="n">stop_period</span><span class="p">,</span>
            <span class="n">breakpoints</span><span class="p">,</span>
            <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">labels</span><span class="o">=</span><span class="n">periods_except_last</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">add_categories</span><span class="p">(</span><span class="n">time_periods_sorted</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">time_periods_sorted</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">jt_full</span><span class="p">[</span><span class="s2">&quot;time_period&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span>
            <span class="n">jt_full</span><span class="o">.</span><span class="n">stop_period</span><span class="p">,</span>
            <span class="n">breakpoints</span><span class="p">,</span>
            <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">labels</span><span class="o">=</span><span class="n">periods_except_last</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">add_categories</span><span class="p">(</span><span class="n">time_periods_sorted</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">time_periods_sorted</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">it_full</span><span class="p">[</span><span class="s2">&quot;eq_cnt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">it_full</span><span class="o">.</span><span class="n">sampleRate</span>
    <span class="n">it_full</span><span class="p">[</span><span class="s2">&quot;eq_cnt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
        <span class="n">it_full</span><span class="p">[</span><span class="s2">&quot;trip_mode&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]),</span>
        <span class="mf">0.5</span> <span class="o">*</span> <span class="n">it_full</span><span class="p">[</span><span class="s2">&quot;eq_cnt&quot;</span><span class="p">],</span>
        <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
            <span class="n">it_full</span><span class="p">[</span><span class="s2">&quot;trip_mode&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]),</span>
            <span class="mf">0.35</span> <span class="o">*</span> <span class="n">it_full</span><span class="p">[</span><span class="s2">&quot;eq_cnt&quot;</span><span class="p">],</span>
            <span class="n">it_full</span><span class="p">[</span><span class="s2">&quot;eq_cnt&quot;</span><span class="p">],</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">jt_full</span><span class="p">[</span><span class="s2">&quot;eq_cnt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">jt_full</span><span class="o">.</span><span class="n">num_participants</span> <span class="o">/</span> <span class="n">jt_full</span><span class="o">.</span><span class="n">sampleRate</span>
    <span class="n">zp_cav</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">household</span><span class="o">.</span><span class="n">OwnedAV_ZPV_factor</span>
    <span class="n">zp_tnc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">household</span><span class="o">.</span><span class="n">TNC_ZPV_factor</span>

    <span class="n">maz_taz_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">scenario</span><span class="o">.</span><span class="n">landuse_file</span><span class="p">),</span>
        <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;MAZ&quot;</span><span class="p">,</span> <span class="s2">&quot;TAZ&quot;</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="n">it_full</span> <span class="o">=</span> <span class="n">it_full</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
        <span class="n">maz_taz_df</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;orig_mgra&quot;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;MAZ&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span>
    <span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;TAZ&quot;</span><span class="p">:</span> <span class="s2">&quot;orig_taz&quot;</span><span class="p">})</span>
    <span class="n">it_full</span> <span class="o">=</span> <span class="n">it_full</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
        <span class="n">maz_taz_df</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;dest_mgra&quot;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;MAZ&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span>
    <span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;TAZ&quot;</span><span class="p">:</span> <span class="s2">&quot;dest_taz&quot;</span><span class="p">})</span>
    <span class="n">jt_full</span> <span class="o">=</span> <span class="n">jt_full</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
        <span class="n">maz_taz_df</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;orig_mgra&quot;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;MAZ&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span>
    <span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;TAZ&quot;</span><span class="p">:</span> <span class="s2">&quot;orig_taz&quot;</span><span class="p">})</span>
    <span class="n">jt_full</span> <span class="o">=</span> <span class="n">jt_full</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
        <span class="n">maz_taz_df</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;dest_mgra&quot;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;MAZ&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span>
    <span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;TAZ&quot;</span><span class="p">:</span> <span class="s2">&quot;dest_taz&quot;</span><span class="p">})</span>
    <span class="n">it_full</span><span class="p">[</span><span class="s2">&quot;trip_mode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
        <span class="n">it_full</span><span class="p">[</span><span class="s2">&quot;trip_mode&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="n">it_full</span><span class="p">[</span><span class="s2">&quot;trip_mode&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">jt_full</span><span class="p">[</span><span class="s2">&quot;trip_mode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
        <span class="n">jt_full</span><span class="p">[</span><span class="s2">&quot;trip_mode&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="n">jt_full</span><span class="p">[</span><span class="s2">&quot;trip_mode&quot;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="n">num_zones</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_internal_zones</span>
    <span class="n">OD_full_index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_product</span><span class="p">(</span>
        <span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_zones</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_zones</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">combine_trip_lists</span><span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="n">jt</span><span class="p">,</span> <span class="n">trip_mode</span><span class="p">):</span>
        <span class="c1"># combines individual trip list and joint trip list</span>
        <span class="n">combined_trips</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
            <span class="p">[</span><span class="n">it</span><span class="p">[(</span><span class="n">it</span><span class="p">[</span><span class="s2">&quot;trip_mode&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">trip_mode</span><span class="p">)],</span> <span class="n">jt</span><span class="p">[(</span><span class="n">jt</span><span class="p">[</span><span class="s2">&quot;trip_mode&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">trip_mode</span><span class="p">)]]</span>
        <span class="p">)</span>
        <span class="n">combined_sum</span> <span class="o">=</span> <span class="n">combined_trips</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;orig_taz&quot;</span><span class="p">,</span> <span class="s2">&quot;dest_taz&quot;</span><span class="p">])[</span>
            <span class="s2">&quot;eq_cnt&quot;</span>
        <span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">combined_sum</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">OD_full_index</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>

    <span class="k">def</span> <span class="nf">create_zero_passenger_trips</span><span class="p">(</span>
        <span class="n">trips</span><span class="p">,</span> <span class="n">deadheading_factor</span><span class="p">,</span> <span class="n">trip_modes</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">):</span>
        <span class="n">zpv_trips</span> <span class="o">=</span> <span class="n">trips</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="p">(</span><span class="n">trips</span><span class="p">[</span><span class="s2">&quot;avAvailable&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">trips</span><span class="p">[</span><span class="s2">&quot;trip_mode&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">trip_modes</span><span class="p">))</span>
        <span class="p">]</span>
        <span class="n">zpv_trips</span><span class="p">[</span><span class="s2">&quot;eq_cnt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">zpv_trips</span><span class="p">[</span><span class="s2">&quot;eq_cnt&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">deadheading_factor</span>
        <span class="n">zpv_trips</span> <span class="o">=</span> <span class="n">zpv_trips</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
            <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;dest_taz&quot;</span><span class="p">:</span> <span class="s2">&quot;orig_taz&quot;</span><span class="p">,</span> <span class="s2">&quot;orig_taz&quot;</span><span class="p">:</span> <span class="s2">&quot;dest_taz&quot;</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">zpv_trips</span>

    <span class="c1"># create zero passenger trips for auto modes</span>
    <span class="k">if</span> <span class="n">it_full</span><span class="p">[</span><span class="s2">&quot;avAvailable&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">it_zpav_trp</span> <span class="o">=</span> <span class="n">create_zero_passenger_trips</span><span class="p">(</span>
            <span class="n">it_full</span><span class="p">,</span> <span class="n">zp_cav</span><span class="p">,</span> <span class="n">trip_modes</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">it_zptnc_trp</span> <span class="o">=</span> <span class="n">create_zero_passenger_trips</span><span class="p">(</span><span class="n">it_full</span><span class="p">,</span> <span class="n">zp_tnc</span><span class="p">,</span> <span class="n">trip_modes</span><span class="o">=</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span>
        <span class="c1"># Combining zero passenger trips to trip files</span>
        <span class="n">it_full</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
            <span class="p">[</span><span class="n">it_full</span><span class="p">,</span> <span class="n">it_zpav_trp</span><span class="p">,</span> <span class="n">it_zptnc_trp</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">jt_full</span><span class="p">[</span><span class="s2">&quot;avAvailable&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">jt_zpav_trp</span> <span class="o">=</span> <span class="n">create_zero_passenger_trips</span><span class="p">(</span>
            <span class="n">jt_full</span><span class="p">,</span> <span class="n">zp_cav</span><span class="p">,</span> <span class="n">trip_modes</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">jt_zptnc_trp</span> <span class="o">=</span> <span class="n">create_zero_passenger_trips</span><span class="p">(</span><span class="n">jt_full</span><span class="p">,</span> <span class="n">zp_tnc</span><span class="p">,</span> <span class="n">trip_modes</span><span class="o">=</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span>
        <span class="c1"># Combining zero passenger trips to trip files</span>
        <span class="n">jt_full</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
            <span class="p">[</span><span class="n">jt_full</span><span class="p">,</span> <span class="n">jt_zpav_trp</span><span class="p">,</span> <span class="n">jt_zptnc_trp</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># read properties from config</span>

    <span class="n">mode_name_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">household</span><span class="o">.</span><span class="n">ctramp_mode_names</span>
    <span class="n">income_segment_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">household</span><span class="o">.</span><span class="n">income_segment</span>

    <span class="k">if</span> <span class="n">income_segment_config</span><span class="p">[</span><span class="s2">&quot;enabled&quot;</span><span class="p">]:</span>
        <span class="c1"># This only affects highway trip tables.</span>

        <span class="n">hh_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">household</span><span class="o">.</span><span class="n">ctramp_hh_file</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">iteration</span><span class="o">=</span><span class="n">iteration</span>
        <span class="p">)</span>
        <span class="n">hh</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">hh_file</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;hh_id&quot;</span><span class="p">,</span> <span class="s2">&quot;income&quot;</span><span class="p">])</span>
        <span class="n">it_full</span> <span class="o">=</span> <span class="n">it_full</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">hh</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;hh_id&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
        <span class="n">jt_full</span> <span class="o">=</span> <span class="n">jt_full</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">hh</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;hh_id&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>

        <span class="n">suffixes</span> <span class="o">=</span> <span class="n">income_segment_config</span><span class="p">[</span><span class="s2">&quot;segment_suffixes&quot;</span><span class="p">]</span>

        <span class="n">it_full</span><span class="p">[</span><span class="s2">&quot;income_seg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span>
            <span class="n">it_full</span><span class="p">[</span><span class="s2">&quot;income&quot;</span><span class="p">],</span>
            <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">bins</span><span class="o">=</span><span class="n">income_segment_config</span><span class="p">[</span><span class="s2">&quot;cutoffs&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)],</span>
            <span class="n">labels</span><span class="o">=</span><span class="n">suffixes</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

        <span class="n">jt_full</span><span class="p">[</span><span class="s2">&quot;income_seg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span>
            <span class="n">jt_full</span><span class="p">[</span><span class="s2">&quot;income&quot;</span><span class="p">],</span>
            <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">bins</span><span class="o">=</span><span class="n">income_segment_config</span><span class="p">[</span><span class="s2">&quot;cutoffs&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)],</span>
            <span class="n">labels</span><span class="o">=</span><span class="n">suffixes</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">it_full</span><span class="p">[</span><span class="s2">&quot;income_seg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">jt_full</span><span class="p">[</span><span class="s2">&quot;income_seg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">suffixes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span>

    <span class="c1"># groupby objects for combinations of time period - income segmentation, used for highway modes only</span>
    <span class="n">it_grp</span> <span class="o">=</span> <span class="n">it_full</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;time_period&quot;</span><span class="p">,</span> <span class="s2">&quot;income_seg&quot;</span><span class="p">])</span>
    <span class="n">jt_grp</span> <span class="o">=</span> <span class="n">jt_full</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;time_period&quot;</span><span class="p">,</span> <span class="s2">&quot;income_seg&quot;</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">time_period</span> <span class="ow">in</span> <span class="n">time_periods_sorted</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Producing household demand matrices for period </span><span class="si">{</span><span class="n">time_period</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="n">highway_out_file</span> <span class="o">=</span> <span class="n">OMXManager</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">household</span><span class="o">.</span><span class="n">highway_demand_file</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>
            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="n">time_period</span><span class="p">,</span> <span class="nb">iter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">iteration</span><span class="p">),</span>
            <span class="s2">&quot;w&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">transit_out_file</span> <span class="o">=</span> <span class="n">OMXManager</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">household</span><span class="o">.</span><span class="n">transit_demand_file</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>
            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="n">time_period</span><span class="p">,</span> <span class="nb">iter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">iteration</span><span class="p">),</span>
            <span class="s2">&quot;w&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># active_out_file = OMXManager(</span>
        <span class="c1">#    self.controller.get_abs_path(self.controller.config.household.active_demand_file).__str__().format(period=time_period), &#39;w&#39;)</span>

        <span class="c1"># hsr_trips_file = _omx.open_file(</span>
        <span class="c1">#    self.controller.get_abs_path(self.controller.config.household.hsr_demand_file).format(year=self.controller.config.scenario.year, period=time_period))</span>

        <span class="c1"># interregional_trips_file = _omx.open_file(</span>
        <span class="c1">#   self.controller.get_abs_path(self.controller.config.household.interregional_demand_file).format(year=self.controller.config.scenario.year, period=time_period))</span>

        <span class="n">highway_out_file</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
        <span class="n">transit_out_file</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
        <span class="c1"># active_out_file.open()</span>

        <span class="c1"># Transit and active modes: one matrix per time period per mode</span>
        <span class="n">it</span> <span class="o">=</span> <span class="n">it_full</span><span class="p">[</span><span class="n">it_full</span><span class="o">.</span><span class="n">time_period</span> <span class="o">==</span> <span class="n">time_period</span><span class="p">]</span>
        <span class="n">jt</span> <span class="o">=</span> <span class="n">jt_full</span><span class="p">[</span><span class="n">jt_full</span><span class="o">.</span><span class="n">time_period</span> <span class="o">==</span> <span class="n">time_period</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">trip_mode</span> <span class="ow">in</span> <span class="n">mode_name_dict</span><span class="p">:</span>
            <span class="c1">#                if trip_mode in [9,10]:</span>
            <span class="c1">#                    matrix_name =  mode_name_dict[trip_mode]</span>
            <span class="c1">#                    self.logger.debug(f&quot;Writing out mode {mode_name_dict[trip_mode]}&quot;)</span>
            <span class="c1">#                    active_out_file.write_array(numpy_array=combine_trip_lists(it,jt, trip_mode), name = matrix_name)</span>

            <span class="k">if</span> <span class="n">trip_mode</span> <span class="o">==</span> <span class="mi">11</span><span class="p">:</span>
                <span class="n">matrix_name</span> <span class="o">=</span> <span class="s2">&quot;WLK_TRN_WLK&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Writing out mode WLK_TRN_WLK&quot;</span><span class="p">)</span>
                <span class="c1"># other_trn_trips = np.array(hsr_trips_file[matrix_name])+np.array(interregional_trips_file[matrix_name])</span>
                <span class="n">transit_out_file</span><span class="o">.</span><span class="n">write_array</span><span class="p">(</span>
                    <span class="n">numpy_array</span><span class="o">=</span><span class="p">(</span><span class="n">combine_trip_lists</span><span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="n">jt</span><span class="p">,</span> <span class="n">trip_mode</span><span class="p">)),</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">matrix_name</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="k">elif</span> <span class="n">trip_mode</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">]:</span>
                <span class="n">it_outbound</span><span class="p">,</span> <span class="n">it_inbound</span> <span class="o">=</span> <span class="n">it</span><span class="p">[</span><span class="n">it</span><span class="o">.</span><span class="n">inbound</span> <span class="o">==</span> <span class="mi">0</span><span class="p">],</span> <span class="n">it</span><span class="p">[</span><span class="n">it</span><span class="o">.</span><span class="n">inbound</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">jt_outbound</span><span class="p">,</span> <span class="n">jt_inbound</span> <span class="o">=</span> <span class="n">jt</span><span class="p">[</span><span class="n">jt</span><span class="o">.</span><span class="n">inbound</span> <span class="o">==</span> <span class="mi">0</span><span class="p">],</span> <span class="n">jt</span><span class="p">[</span><span class="n">jt</span><span class="o">.</span><span class="n">inbound</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>

                <span class="n">matrix_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mode_name_dict</span><span class="p">[</span><span class="n">trip_mode</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">_TRN_WLK&quot;</span>
                <span class="c1"># other_trn_trips = np.array(hsr_trips_file[matrix_name])+np.array(interregional_trips_file[matrix_name])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Writing out mode </span><span class="si">{</span><span class="n">mode_name_dict</span><span class="p">[</span><span class="n">trip_mode</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;_TRN_WLK&#39;</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="n">transit_out_file</span><span class="o">.</span><span class="n">write_array</span><span class="p">(</span>
                    <span class="n">numpy_array</span><span class="o">=</span><span class="p">(</span>
                        <span class="n">combine_trip_lists</span><span class="p">(</span><span class="n">it_outbound</span><span class="p">,</span> <span class="n">jt_outbound</span><span class="p">,</span> <span class="n">trip_mode</span><span class="p">)</span>
                    <span class="p">),</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">matrix_name</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="n">matrix_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;WLK_TRN_</span><span class="si">{</span><span class="n">mode_name_dict</span><span class="p">[</span><span class="n">trip_mode</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="c1"># other_trn_trips = np.array(hsr_trips_file[matrix_name])+np.array(interregional_trips_file[matrix_name])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Writing out mode </span><span class="si">{</span><span class="s1">&#39;WLK_TRN_&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mode_name_dict</span><span class="p">[</span><span class="n">trip_mode</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="n">transit_out_file</span><span class="o">.</span><span class="n">write_array</span><span class="p">(</span>
                    <span class="n">numpy_array</span><span class="o">=</span><span class="p">(</span>
                        <span class="n">combine_trip_lists</span><span class="p">(</span><span class="n">it_inbound</span><span class="p">,</span> <span class="n">jt_inbound</span><span class="p">,</span> <span class="n">trip_mode</span><span class="p">)</span>
                    <span class="p">),</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">matrix_name</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="c1"># Highway modes: one matrix per suffix (income class) per time period per mode</span>
        <span class="k">for</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="n">suffixes</span><span class="p">:</span>
            <span class="n">highway_cache</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">time_period</span><span class="p">,</span> <span class="n">suffix</span><span class="p">)</span> <span class="ow">in</span> <span class="n">it_grp</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">it</span> <span class="o">=</span> <span class="n">it_grp</span><span class="o">.</span><span class="n">get_group</span><span class="p">((</span><span class="n">time_period</span><span class="p">,</span> <span class="n">suffix</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">it</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">it_full</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">time_period</span><span class="p">,</span> <span class="n">suffix</span><span class="p">)</span> <span class="ow">in</span> <span class="n">jt_grp</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">jt</span> <span class="o">=</span> <span class="n">jt_grp</span><span class="o">.</span><span class="n">get_group</span><span class="p">((</span><span class="n">time_period</span><span class="p">,</span> <span class="n">suffix</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">jt</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">jt_full</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">trip_mode</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">mode_name_dict</span><span class="p">):</span>
                <span class="c1"># Python preserves keys in the order they are inserted but</span>
                <span class="c1"># mode_name_dict originates from TOML, which does not guarantee</span>
                <span class="c1"># that the ordering of keys is preserved.  See</span>
                <span class="c1"># https://github.com/toml-lang/toml/issues/162</span>

                <span class="k">if</span> <span class="n">trip_mode</span> <span class="ow">in</span> <span class="p">[</span>
                    <span class="mi">1</span><span class="p">,</span>
                    <span class="mi">2</span><span class="p">,</span>
                    <span class="mi">3</span><span class="p">,</span>
                    <span class="mi">4</span><span class="p">,</span>
                    <span class="mi">5</span><span class="p">,</span>
                    <span class="mi">6</span><span class="p">,</span>
                    <span class="mi">7</span><span class="p">,</span>
                    <span class="mi">8</span><span class="p">,</span>
                    <span class="mi">9</span><span class="p">,</span>
                    <span class="mi">10</span><span class="p">,</span>
                    <span class="mi">15</span><span class="p">,</span>
                    <span class="mi">16</span><span class="p">,</span>
                    <span class="mi">17</span><span class="p">,</span>
                <span class="p">]:</span>  <span class="c1"># currently hard-coded based on Travel Mode trip mode codes</span>
                    <span class="n">highway_cache</span><span class="p">[</span><span class="n">mode_name_dict</span><span class="p">[</span><span class="n">trip_mode</span><span class="p">]]</span> <span class="o">=</span> <span class="n">combine_trip_lists</span><span class="p">(</span>
                        <span class="n">it</span><span class="p">,</span> <span class="n">jt</span><span class="p">,</span> <span class="n">trip_mode</span>
                    <span class="p">)</span>
                    <span class="n">out_mode</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mode_name_dict</span><span class="p">[</span><span class="n">trip_mode</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">matrix_name</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">out_mode</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">time_period</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="k">if</span> <span class="n">suffix</span>
                        <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">out_mode</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">time_period</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                    <span class="n">highway_out_file</span><span class="o">.</span><span class="n">write_array</span><span class="p">(</span>
                        <span class="n">numpy_array</span><span class="o">=</span><span class="n">highway_cache</span><span class="p">[</span><span class="n">mode_name_dict</span><span class="p">[</span><span class="n">trip_mode</span><span class="p">]],</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">matrix_name</span><span class="p">,</span>
                    <span class="p">)</span>

                <span class="k">elif</span> <span class="n">trip_mode</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">15</span><span class="p">,</span> <span class="mi">16</span><span class="p">]:</span>
                    <span class="c1"># identify the correct mode split factors for da, sr2, sr3</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Splitting ridehail trips into shared ride trips&quot;</span>
                    <span class="p">)</span>
                    <span class="n">ridehail_split_factors</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
                    <span class="n">splits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">household</span><span class="o">.</span><span class="n">rideshare_mode_split</span>
                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">splits</span><span class="p">:</span>
                        <span class="n">out_mode_split</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">household</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">_split&quot;</span>
                        <span class="p">]</span>
                        <span class="k">for</span> <span class="n">out_mode</span> <span class="ow">in</span> <span class="n">out_mode_split</span><span class="p">:</span>
                            <span class="n">ridehail_split_factors</span><span class="p">[</span><span class="n">out_mode</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span>
                                <span class="n">out_mode_split</span><span class="p">[</span><span class="n">out_mode</span><span class="p">]</span> <span class="o">*</span> <span class="n">splits</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                            <span class="p">)</span>

                    <span class="n">ridehail_trips</span> <span class="o">=</span> <span class="n">combine_trip_lists</span><span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="n">jt</span><span class="p">,</span> <span class="n">trip_mode</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">out_mode</span> <span class="ow">in</span> <span class="n">ridehail_split_factors</span><span class="p">:</span>
                        <span class="n">matrix_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">out_mode</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">suffix</span> <span class="k">else</span> <span class="n">out_mode</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Writing out mode </span><span class="si">{</span><span class="n">out_mode</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="n">highway_cache</span><span class="p">[</span><span class="n">out_mode</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span>
                            <span class="p">(</span><span class="n">ridehail_trips</span> <span class="o">*</span> <span class="n">ridehail_split_factors</span><span class="p">[</span><span class="n">out_mode</span><span class="p">])</span>
                            <span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
                            <span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                        <span class="p">)</span>
                        <span class="n">highway_out_file</span><span class="o">.</span><span class="n">write_array</span><span class="p">(</span>
                            <span class="n">numpy_array</span><span class="o">=</span><span class="n">highway_cache</span><span class="p">[</span><span class="n">out_mode</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="n">matrix_name</span>
                        <span class="p">)</span>

        <span class="n">highway_out_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">transit_out_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.demand.prepare_demand.PrepareHighwayDemand.run" class="doc doc-heading">
            <code class=" language-python"><span class="n">run</span><span class="p">()</span></code>

<a href="#tm2py.components.demand.prepare_demand.PrepareHighwayDemand.run" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Open combined demand OMX files from demand models and prepare for assignment.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/demand/prepare_demand.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Open combined demand OMX files from demand models and prepare for assignment.&quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">highway_emmebank</span><span class="o">.</span><span class="n">create_zero_matrix</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">klass</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_demand</span><span class="p">(</span><span class="n">klass</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">klass</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">klass</span><span class="o">.</span><span class="n">demand</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.components.demand.prepare_demand.PrepareTransitDemand" class="doc doc-heading">
            <code>PrepareTransitDemand</code>


<a href="#tm2py.components.demand.prepare_demand.PrepareTransitDemand" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="EmmeDemand (tm2py.components.demand.prepare_demand.EmmeDemand)" href="#tm2py.components.demand.prepare_demand.EmmeDemand">EmmeDemand</a></code></p>


      <p>Import transit demand.</p>
<p>Demand is imported from OMX files based on reference file paths and OMX
matrix names in transit assignment config (transit.classes).
The demand is average using MSA with the current demand matrices (in the
Emmebank) if transit.apply_msa_demand is true if the
controller.iteration &gt; 1.</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/components/demand/prepare_demand.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">PrepareTransitDemand</span><span class="p">(</span><span class="n">EmmeDemand</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Import transit demand.</span>

<span class="sd">    Demand is imported from OMX files based on reference file paths and OMX</span>
<span class="sd">    matrix names in transit assignment config (transit.classes).</span>
<span class="sd">    The demand is average using MSA with the current demand matrices (in the</span>
<span class="sd">    Emmebank) if transit.apply_msa_demand is true if the</span>
<span class="sd">    controller.iteration &gt; 1.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="s2">&quot;RunController&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor for PrepareTransitDemand.</span>

<span class="sd">        Args:</span>
<span class="sd">            controller: RunController object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span> <span class="o">=</span> <span class="n">controller</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">transit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_transit_emmebank</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate the inputs.&quot;&quot;&quot;</span>
        <span class="c1"># TODO</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">transit_emmebank</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transit_emmebank</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_transit_emmebank</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">transit_emmebank</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transit_emmebank</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transit_emmebank</span>

    <span class="nd">@LogStartEnd</span><span class="p">(</span><span class="s2">&quot;Prepare transit demand&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Open combined demand OMX files from demand models and prepare for assignment.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_source_ref_key</span> <span class="o">=</span> <span class="s2">&quot;transit_demand_file&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transit_emmebank</span><span class="o">.</span><span class="n">create_zero_matrix</span><span class="p">()</span>
        <span class="n">_time_period_tclass</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">_time_period</span><span class="p">,</span> <span class="n">_tclass</span> <span class="ow">in</span> <span class="n">_time_period_tclass</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_demand</span><span class="p">(</span>
                <span class="n">_tclass</span><span class="o">.</span><span class="n">skim_set_id</span><span class="p">,</span> <span class="n">_tclass</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">_tclass</span><span class="o">.</span><span class="n">demand</span><span class="p">,</span> <span class="n">_time_period</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_prepare_demand</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">description</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">demand_config</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]],</span>
        <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load demand from OMX files and save to Emme matrix for transit assignment.</span>

<span class="sd">        Average with previous demand (MSA) if the current iteration &gt; 1 and</span>
<span class="sd">        config.transit.apply_msa_demand is True</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): the name of the transit assignment class in the OMX files, usually a number</span>
<span class="sd">            description (str): the description for the transit assignment class</span>
<span class="sd">            demand_config (dict): the list of file cross-reference(s) for the demand to be loaded</span>
<span class="sd">                {&quot;source&quot;: &lt;name of demand model component&gt;,</span>
<span class="sd">                 &quot;name&quot;: &lt;OMX key name&gt;,</span>
<span class="sd">                 &quot;factor&quot;: &lt;factor to apply to demand in this file&gt;}</span>
<span class="sd">            time_period (str): the time _time_period ID (name)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transit_emmebank</span><span class="o">.</span><span class="n">scenario</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span>
        <span class="n">num_zones</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="o">.</span><span class="n">zone_numbers</span><span class="p">)</span>
        <span class="n">demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_demand</span><span class="p">(</span><span class="n">demand_config</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">time_period</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">num_zones</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">file_config</span> <span class="ow">in</span> <span class="n">demand_config</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">demand</span> <span class="o">=</span> <span class="n">demand</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_demand</span><span class="p">(</span>
                <span class="n">file_config</span><span class="p">,</span> <span class="n">time_period</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">num_zones</span>
            <span class="p">)</span>
        <span class="n">demand_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;TRN_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">time_period</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">description</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time_period</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">description</span><span class="si">}</span><span class="s2"> demand&quot;</span>
        <span class="n">apply_msa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">apply_msa_demand</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_demand</span><span class="p">(</span><span class="n">demand_name</span><span class="p">,</span> <span class="n">demand</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">apply_msa</span><span class="o">=</span><span class="n">apply_msa</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_read_demand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_config</span><span class="p">,</span> <span class="n">time_period</span><span class="p">,</span> <span class="n">skim_set</span><span class="p">,</span> <span class="n">num_zones</span><span class="p">):</span>
        <span class="c1"># Load demand from cross-referenced source file,</span>
        <span class="c1"># the named demand model component under the key highway_demand_file</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">warmstart</span><span class="o">.</span><span class="n">warmstart</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">iteration</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="p">):</span>
            <span class="n">source</span> <span class="o">=</span> <span class="n">file_config</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]</span>
            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">source</span><span class="p">]</span><span class="o">.</span><span class="n">transit_demand_file</span>
            <span class="p">)</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">source</span> <span class="o">=</span> <span class="n">file_config</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]</span>
            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">source</span><span class="p">]</span><span class="o">.</span><span class="n">transit_demand_file</span>
            <span class="p">)</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">file_config</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read</span><span class="p">(</span>
            <span class="n">path</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="n">time_period</span><span class="p">,</span> <span class="nb">iter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">iteration</span><span class="p">),</span>
            <span class="n">name</span><span class="p">,</span>
            <span class="n">num_zones</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tm2py.components.demand.prepare_demand.PrepareTransitDemand.__init__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span></code>

<a href="#tm2py.components.demand.prepare_demand.PrepareTransitDemand.__init__" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Constructor for PrepareTransitDemand.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>controller</code></td>
            <td>
                  <code>&#39;RunController&#39;</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>RunController object.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/demand/prepare_demand.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="s2">&quot;RunController&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Constructor for PrepareTransitDemand.</span>

<span class="sd">    Args:</span>
<span class="sd">        controller: RunController object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">controller</span> <span class="o">=</span> <span class="n">controller</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">transit</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_transit_emmebank</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.demand.prepare_demand.PrepareTransitDemand.run" class="doc doc-heading">
            <code class=" language-python"><span class="n">run</span><span class="p">()</span></code>

<a href="#tm2py.components.demand.prepare_demand.PrepareTransitDemand.run" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Open combined demand OMX files from demand models and prepare for assignment.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/demand/prepare_demand.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@LogStartEnd</span><span class="p">(</span><span class="s2">&quot;Prepare transit demand&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Open combined demand OMX files from demand models and prepare for assignment.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_source_ref_key</span> <span class="o">=</span> <span class="s2">&quot;transit_demand_file&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">transit_emmebank</span><span class="o">.</span><span class="n">create_zero_matrix</span><span class="p">()</span>
    <span class="n">_time_period_tclass</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">_time_period</span><span class="p">,</span> <span class="n">_tclass</span> <span class="ow">in</span> <span class="n">_time_period_tclass</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_demand</span><span class="p">(</span>
            <span class="n">_tclass</span><span class="o">.</span><span class="n">skim_set_id</span><span class="p">,</span> <span class="n">_tclass</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">_tclass</span><span class="o">.</span><span class="n">demand</span><span class="p">,</span> <span class="n">_time_period</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.demand.prepare_demand.PrepareTransitDemand.validate_inputs" class="doc doc-heading">
            <code class=" language-python"><span class="n">validate_inputs</span><span class="p">()</span></code>

<a href="#tm2py.components.demand.prepare_demand.PrepareTransitDemand.validate_inputs" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Validate the inputs.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/demand/prepare_demand.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">621</span>
<span class="normal">622</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate the inputs.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="tm2py.components.demand.prepare_demand.avg_matrix_msa" class="doc doc-heading">
            <code class=" language-python"><span class="n">avg_matrix_msa</span><span class="p">(</span><span class="n">prev_avg_matrix</span><span class="p">,</span> <span class="n">this_iter_matrix</span><span class="p">,</span> <span class="n">msa_iteration</span><span class="p">)</span></code>

<a href="#tm2py.components.demand.prepare_demand.avg_matrix_msa" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">

      <p>Average matrices based on Method of Successive Averages (MSA).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>prev_avg_matrix</code></td>
            <td>
                  <code><span title="tm2py.components.demand.prepare_demand.NumpyArray">NumpyArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Previously averaged matrix</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>this_iter_matrix</code></td>
            <td>
                  <code><span title="tm2py.components.demand.prepare_demand.NumpyArray">NumpyArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Matrix for this iteration</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>msa_iteration</code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>MSA iteration</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>NumpyArray</code></td>            <td>
                  <code><span title="tm2py.components.demand.prepare_demand.NumpyArray">NumpyArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>MSA Averaged matrix for this iteration.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/demand/prepare_demand.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">avg_matrix_msa</span><span class="p">(</span>
    <span class="n">prev_avg_matrix</span><span class="p">:</span> <span class="n">NumpyArray</span><span class="p">,</span> <span class="n">this_iter_matrix</span><span class="p">:</span> <span class="n">NumpyArray</span><span class="p">,</span> <span class="n">msa_iteration</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NumpyArray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Average matrices based on Method of Successive Averages (MSA).</span>

<span class="sd">    Args:</span>
<span class="sd">        prev_avg_matrix (NumpyArray): Previously averaged matrix</span>
<span class="sd">        this_iter_matrix (NumpyArray): Matrix for this iteration</span>
<span class="sd">        msa_iteration (int): MSA iteration</span>

<span class="sd">    Returns:</span>
<span class="sd">        NumpyArray: MSA Averaged matrix for this iteration.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">msa_iteration</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">this_iter_matrix</span>
    <span class="n">result_matrix</span> <span class="o">=</span> <span class="n">prev_avg_matrix</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">msa_iteration</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
        <span class="n">this_iter_matrix</span> <span class="o">-</span> <span class="n">prev_avg_matrix</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">result_matrix</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h4 id="household-demand">Household Demand<a class="headerlink" href="#household-demand" title="Permanent link"> </a></h4>
<p>Personal travel demand generated by household members.</p>


<div class="doc doc-object doc-module">



<a id="tm2py.components.demand.household"></a>
    <div class="doc doc-contents first">

      <p>Placeholder docstring for CT-RAMP related components for household residents&rsquo; model.</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="tm2py.components.demand.household.HouseholdModel" class="doc doc-heading">
            <code>HouseholdModel</code>


<a href="#tm2py.components.demand.household.HouseholdModel" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="Component (tm2py.components.component.Component)" href="#tm2py.components.component.Component">Component</a></code></p>


      <p>Run household resident model.</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/components/demand/household.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">HouseholdModel</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run household resident model.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validates inputs for component.&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@LogStartEnd</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run the the household resident travel demand model.</span>

<span class="sd">        Steps:</span>
<span class="sd">            1. Starts household manager.</span>
<span class="sd">            2. Starts matrix manager.</span>
<span class="sd">            3. Starts resident travel model (CTRAMP).</span>
<span class="sd">            4. Cleans up CTRAMP java.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">household</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start_household_manager</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start_matrix_manager</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_run_resident_model</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stop_java</span><span class="p">()</span>
        <span class="c1"># consume ctramp person trip list and create trip tables for assignment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_demand_for_assignment</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_copy_auto_maz_demand</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_prepare_demand_for_assignment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">prep_demand</span> <span class="o">=</span> <span class="n">PrepareHighwayDemand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="p">)</span>
        <span class="n">prep_demand</span><span class="o">.</span><span class="n">prepare_household_demand</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_start_household_manager</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">commands</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;cd /d </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">run_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;CALL </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">run_dir</span><span class="si">}</span><span class="se">\\</span><span class="s2">CTRAMP</span><span class="se">\\</span><span class="s2">runtime</span><span class="se">\\</span><span class="s2">CTRampEnv.bat&quot;</span><span class="p">,</span>
            <span class="s2">&quot;set PATH=%CD%</span><span class="se">\\</span><span class="s2">CTRAMP</span><span class="se">\\</span><span class="s2">runtime;C:</span><span class="se">\\</span><span class="s2">Windows</span><span class="se">\\</span><span class="s2">System32;%JAVA_PATH%</span><span class="se">\\</span><span class="s2">bin;&quot;</span>
            <span class="s2">&quot;%TPP_PATH%;%PYTHON_PATH%;%PYTHON_PATH%</span><span class="se">\\</span><span class="s2">condabin;%PYTHON_PATH%</span><span class="se">\\</span><span class="s2">envs&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;CALL </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">run_dir</span><span class="si">}</span><span class="se">\\</span><span class="s2">CTRAMP</span><span class="se">\\</span><span class="s2">runtime</span><span class="se">\\</span><span class="s2">runHhMgr.cmd %JAVA_PATH% %HOST_IP_ADDRESS%&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">run_process</span><span class="p">(</span><span class="n">commands</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;start_household_manager&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_start_matrix_manager</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">commands</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;cd /d </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">run_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;CALL </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">run_dir</span><span class="si">}</span><span class="se">\\</span><span class="s2">CTRAMP</span><span class="se">\\</span><span class="s2">runtime</span><span class="se">\\</span><span class="s2">CTRampEnv.bat&quot;</span><span class="p">,</span>
            <span class="s2">&quot;set PATH=%CD%</span><span class="se">\\</span><span class="s2">CTRAMP</span><span class="se">\\</span><span class="s2">runtime;C:</span><span class="se">\\</span><span class="s2">Windows</span><span class="se">\\</span><span class="s2">System32;%JAVA_PATH%</span><span class="se">\\</span><span class="s2">bin;&quot;</span>
            <span class="s2">&quot;%TPP_PATH%;%PYTHON_PATH%;%PYTHON_PATH%</span><span class="se">\\</span><span class="s2">condabin;%PYTHON_PATH%</span><span class="se">\\</span><span class="s2">envs&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;CALL </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">run_dir</span><span class="si">}</span><span class="se">\\</span><span class="s2">CTRAMP</span><span class="se">\\</span><span class="s2">runtime</span><span class="se">\\</span><span class="s2">runMtxMgr.cmd %HOST_IP_ADDRESS% %JAVA_PATH%&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">run_process</span><span class="p">(</span><span class="n">commands</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;start_matrix_manager&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_run_resident_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sample_rate_iteration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">sample_rate_by_iteration</span>
        <span class="n">iteration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">iteration</span>
        <span class="n">sample_rate</span> <span class="o">=</span> <span class="n">sample_rate_iteration</span><span class="p">[</span><span class="n">iteration</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">_shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="s2">&quot;CTRAMP</span><span class="se">\\</span><span class="s2">runtime</span><span class="se">\\</span><span class="s2">mtctm2.properties&quot;</span><span class="p">,</span> <span class="s2">&quot;mtctm2.properties&quot;</span><span class="p">)</span>
        <span class="n">commands</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;cd /d </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">run_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;CALL </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">run_dir</span><span class="si">}</span><span class="se">\\</span><span class="s2">CTRAMP</span><span class="se">\\</span><span class="s2">runtime</span><span class="se">\\</span><span class="s2">CTRampEnv.bat&quot;</span><span class="p">,</span>
            <span class="s2">&quot;set PATH=%CD%</span><span class="se">\\</span><span class="s2">CTRAMP</span><span class="se">\\</span><span class="s2">runtime;C:</span><span class="se">\\</span><span class="s2">Windows</span><span class="se">\\</span><span class="s2">System32;%JAVA_PATH%</span><span class="se">\\</span><span class="s2">bin;&quot;</span>
            <span class="s2">&quot;%TPP_PATH%;%PYTHON_PATH%;%PYTHON_PATH%</span><span class="se">\\</span><span class="s2">condabin;%PYTHON_PATH%</span><span class="se">\\</span><span class="s2">envs&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;CALL </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">run_dir</span><span class="si">}</span><span class="se">\\</span><span class="s2">CTRAMP</span><span class="se">\\</span><span class="s2">runtime</span><span class="se">\\</span><span class="s2">runMTCTM2ABM.cmd </span><span class="si">{</span><span class="n">sample_rate</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">iteration</span><span class="si">}</span><span class="s2"> %JAVA_PATH%&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">run_process</span><span class="p">(</span><span class="n">commands</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;run_resident_model&quot;</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_stop_java</span><span class="p">():</span>
        <span class="n">run_process</span><span class="p">([</span><span class="s1">&#39;taskkill /im &quot;java.exe&quot; /F&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_copy_auto_maz_demand</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">time_period_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span>

        <span class="k">for</span> <span class="n">period</span> <span class="ow">in</span> <span class="n">time_period_names</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">maz_group</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]:</span>
                <span class="n">output_path</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">maz_to_maz</span><span class="o">.</span><span class="n">demand_file</span>
                    <span class="p">)</span>
                    <span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>
                    <span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">period</span><span class="o">=</span><span class="n">period</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="n">maz_group</span><span class="p">,</span> <span class="nb">iter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">iteration</span>
                    <span class="p">)</span>
                <span class="p">)</span>

                <span class="n">input_path</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway_maz_ctramp_output_file</span>
                    <span class="p">)</span>
                    <span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>
                    <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="n">period</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="n">maz_group</span><span class="p">)</span>
                <span class="p">)</span>

                <span class="n">_shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">input_path</span><span class="p">,</span> <span class="n">output_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_consolidate_demand_for_assign</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        CTRAMP writes out demands in separate omx files, e.g.</span>
<span class="sd">        ctramp_output\\auto_@p@_SOV_GP_@p@.mat</span>
<span class="sd">        ctramp_output\\auto_@p@_SOV_PAY_@p@.mat</span>
<span class="sd">        ctramp_output\\auto_@p@_SR2_GP_@p@.mat</span>
<span class="sd">        ctramp_output\\auto_@p@_SR2_HOV_@p@.mat</span>
<span class="sd">        ctramp_output\\auto_@p@_SR2_PAY_@p@.mat</span>
<span class="sd">        ctramp_output\\auto_@p@_SR3_GP_@p@.mat</span>
<span class="sd">        ctramp_output\\auto_@p@_SR3_HOV_@p@.mat</span>
<span class="sd">        ctramp_output\\auto_@p@_SR3_PAY_@p@.mat</span>
<span class="sd">        ctramp_output\\Nonmotor_@p@_BIKE_@p@.mat</span>
<span class="sd">        ctramp_output\\Nonmotor_@p@_WALK_@p@.mat</span>
<span class="sd">        ctramp_output\\other_@p@_SCHLBUS_@p@.mat</span>

<span class="sd">        Need to combine demands for one period into one omx file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">time_period_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span>

        <span class="c1"># auto TAZ</span>
        <span class="k">for</span> <span class="n">period</span> <span class="ow">in</span> <span class="n">time_period_names</span><span class="p">:</span>
            <span class="n">output_path</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway_demand_file</span><span class="p">)</span>
                <span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="n">period</span><span class="p">,</span> <span class="nb">iter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">iteration</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">output_omx</span> <span class="o">=</span> <span class="n">omx</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">mode_agg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">mode_agg</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">mode_agg</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;transit&quot;</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">mode_agg</span><span class="o">.</span><span class="n">modes</span><span class="p">:</span>
                    <span class="n">input_path</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway_taz_ctramp_output_file</span>
                        <span class="p">)</span>
                        <span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>
                        <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="n">period</span><span class="p">,</span> <span class="n">mode_agg</span><span class="o">=</span><span class="n">mode_agg</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="n">input_omx</span> <span class="o">=</span> <span class="n">omx</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="n">input_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
                    <span class="n">core_name</span> <span class="o">=</span> <span class="n">mode</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">period</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
                    <span class="n">output_omx</span><span class="p">[</span><span class="n">core_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_omx</span><span class="p">[</span><span class="n">core_name</span><span class="p">][:,</span> <span class="p">:]</span>
                    <span class="n">input_omx</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="n">output_omx</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># auto MAZ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_copy_auto_maz_demand</span><span class="p">()</span>

        <span class="c1"># transit TAP</span>
        <span class="c1"># for period in time_period_names:</span>
        <span class="c1">#    for set in [&quot;set1&quot;, &quot;set2&quot;, &quot;set3&quot;]:</span>
        <span class="c1">#        output_path = (</span>
        <span class="c1">#            self.controller.get_abs_path(self.config.transit_demand_file)</span>
        <span class="c1">#            .__str__()</span>
        <span class="c1">#            .format(period=period, iter=self.controller.iteration, set=set)</span>
        <span class="c1">#        )</span>
        <span class="c1">#        output_omx = omx.open_file(output_path, &quot;w&quot;)</span>
        <span class="c1">#        for mode_agg in self.config.mode_agg:</span>
        <span class="c1">#            if mode_agg.name != &quot;transit&quot;:</span>
        <span class="c1">#                continue</span>
        <span class="c1">#            for mode in mode_agg.modes:</span>
        <span class="c1">#                input_path = (</span>
        <span class="c1">#                    self.controller.get_abs_path(</span>
        <span class="c1">#                        self.config.transit_tap_ctramp_output_file</span>
        <span class="c1">#                    )</span>
        <span class="c1">#                    .__str__()</span>
        <span class="c1">#                    .format(</span>
        <span class="c1">#                        period=period,</span>
        <span class="c1">#                        mode_agg=mode_agg.name,</span>
        <span class="c1">#                        mode=mode,</span>
        <span class="c1">#                        set=set,</span>
        <span class="c1">#                    )</span>
        <span class="c1">#                )</span>
        <span class="c1">#                input_omx = omx.open_file(input_path, &quot;r&quot;)</span>
        <span class="c1">#                core_name = mode + &quot;_TRN_&quot; + set + &quot;_&quot; + period.upper()</span>
        <span class="c1">#                output_omx[core_name] = input_omx[core_name][:, :]</span>
        <span class="c1">#                input_omx.close()</span>
        <span class="c1">#</span>
        <span class="c1">#        output_omx.close()</span>
        <span class="c1"># transit TAZ</span>
        <span class="k">for</span> <span class="n">period</span> <span class="ow">in</span> <span class="n">time_period_names</span><span class="p">:</span>
            <span class="n">output_path</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">transit_demand_file</span><span class="p">)</span>
                <span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="n">period</span><span class="p">,</span> <span class="nb">iter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">iteration</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">output_omx</span> <span class="o">=</span> <span class="n">omx</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">mode_agg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">mode_agg</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">mode_agg</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;transit&quot;</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">mode_agg</span><span class="o">.</span><span class="n">modes</span><span class="p">:</span>
                    <span class="n">input_path</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">transit_taz_ctramp_output_file</span>
                        <span class="p">)</span>
                        <span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>
                        <span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">period</span><span class="o">=</span><span class="n">period</span><span class="p">,</span>
                            <span class="n">mode_agg</span><span class="o">=</span><span class="n">mode_agg</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                            <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                    <span class="n">input_omx</span> <span class="o">=</span> <span class="n">omx</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="n">input_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
                    <span class="n">core_name</span> <span class="o">=</span> <span class="n">mode</span> <span class="o">+</span> <span class="s2">&quot;_TRN_&quot;</span> <span class="o">+</span> <span class="n">period</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
                    <span class="n">output_omx</span><span class="p">[</span><span class="n">core_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_omx</span><span class="p">[</span><span class="n">core_name</span><span class="p">][:,</span> <span class="p">:]</span>
                    <span class="n">input_omx</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="n">output_omx</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tm2py.components.demand.household.HouseholdModel.run" class="doc doc-heading">
            <code class=" language-python"><span class="n">run</span><span class="p">()</span></code>

<a href="#tm2py.components.demand.household.HouseholdModel.run" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Run the the household resident travel demand model.</p>


<details class="steps" open>
  <summary>Steps</summary>
  <ol>
<li>Starts household manager.</li>
<li>Starts matrix manager.</li>
<li>Starts resident travel model (CTRAMP).</li>
<li>Cleans up CTRAMP java.</li>
</ol>
</details>
            <details class="quote">
              <summary>Source code in <code>tm2py/components/demand/household.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@LogStartEnd</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run the the household resident travel demand model.</span>

<span class="sd">    Steps:</span>
<span class="sd">        1. Starts household manager.</span>
<span class="sd">        2. Starts matrix manager.</span>
<span class="sd">        3. Starts resident travel model (CTRAMP).</span>
<span class="sd">        4. Cleans up CTRAMP java.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">household</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_start_household_manager</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_start_matrix_manager</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_run_resident_model</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_stop_java</span><span class="p">()</span>
    <span class="c1"># consume ctramp person trip list and create trip tables for assignment</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_demand_for_assignment</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_copy_auto_maz_demand</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.demand.household.HouseholdModel.validate_inputs" class="doc doc-heading">
            <code class=" language-python"><span class="n">validate_inputs</span><span class="p">()</span></code>

<a href="#tm2py.components.demand.household.HouseholdModel.validate_inputs" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Validates inputs for component.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/demand/household.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validates inputs for component.&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<a id="tm2py.config.HouseholdConfig"></a>
    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Household (residents) model parameters.</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">HouseholdConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Household (residents) model parameters.&quot;&quot;&quot;</span>

    <span class="n">highway_demand_file</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">transit_demand_file</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">active_demand_file</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">highway_maz_ctramp_output_file</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">OwnedAV_ZPV_factor</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">TNC_ZPV_factor</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">ctramp_indiv_trip_file</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">ctramp_joint_trip_file</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">ctramp_run_dir</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">rideshare_mode_split</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span>
    <span class="n">taxi_split</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span>
    <span class="n">single_tnc_split</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span>
    <span class="n">shared_tnc_split</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span>
    <span class="n">ctramp_mode_names</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
    <span class="n">income_segment</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">]]</span>
    <span class="n">ctramp_hh_file</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">sample_rate_by_iteration</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div><h4 id="air-passenger-demand">Air Passenger Demand<a class="headerlink" href="#air-passenger-demand" title="Permanent link"> </a></h4>


<div class="doc doc-object doc-module">



<a id="tm2py.components.demand.air_passenger"></a>
    <div class="doc doc-contents first">

      <p>Module containing the AirPassenger class which builds the airport trip matrices.</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="tm2py.components.demand.air_passenger.AirPassenger" class="doc doc-heading">
            <code>AirPassenger</code>


<a href="#tm2py.components.demand.air_passenger.AirPassenger" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="Component (tm2py.components.component.Component)" href="#tm2py.components.component.Component">Component</a></code></p>


      <p>Builds the airport trip matrices.</p>
<p>input: nonres/{year}_{tofrom}{airport}.csv
output: five time-of-day-specific OMX files with matrices DA, SR2, SR3</p>
<p>Notes:
These are independent of level-of-service.</p>
<p>Note that the reference names, years, file paths and other key details
are controlled via the config, air_passenger section. See the
AirPassengerConfig doc for details on specifying these inputs.</p>
<p>The following details are based on the default config values.</p>
<p>Creates air passenger vehicle trip tables for the Bay Area&rsquo;s three major
airports, namely SFO, OAK, and SJC.  Geoff Gosling, a consultant, created
vehicle trip tables segmented by time of day, travel mode, and access/egress
direction (i.e. to the airport or from the airport) for years 2007 and 2035.
The tables are based on a 2006 Air Passenger survey, which was conducted
at SFO and OAK (but not SJC).</p>


<details class="the-travel-modes-are-as-follows" open>
  <summary>The travel modes are as follows</summary>
  <p>(a) escort (drive alone, shared ride 2, and shared ride 3+)
(b) park (da, sr2, &amp; sr3+)
&copy; rental car (da, sr2, &amp; sr3+)
(d) taxi ((da, sr2, &amp; sr3+)
(e) limo (da, sr2, &amp; sr3+)
(f) shared ride van (all assumed to be sr3);
(g) hotel shuttle (all assumed to be sr3); and,
(h) charter bus (all assumed to be sr3).</p>
</details>      <p>The shared ride van, hotel shuttle, and charter bus modes are assumed to
have no deadhead travel. The return escort trip is included, as are the
deadhead limo and taxi trips.</p>
<p>The scripts reads in csv files adapted from Mr. Gosling&rsquo;s Excel files,
and creates a highway-assignment ready OMX matrix file for each time-of-day
interval.</p>
<p>Assumes that no air passengers use HOT lanes (probably not exactly true
in certain future year scenarios, but the assumption is made here as a
simplification).  Simple linear interpolations are used to estimate vehicle
demand in years other than 2007 and 2035, including 2015, 2020, 2025, 2030,
and 2040.</p>
<p>Transit travel to the airports is not included in these vehicle trip tables.</p>


<details class="input" open>
  <summary>Input</summary>
  <p>Year-, access/egress-, and airport-specific database file with 90 columns
of data for each TAZ.  There are 18 columns for each time-of-day interval
as follows:
        (1)   Escort, drive alone
        (2)   Escort, shared ride 2
        (3)   Escort, shared ride 3+
        (4)   Park, drive alone
        (5)   Park, shared ride 2
        (6)   Park, shared ride 3+
        (7)   Rental car, drive alone
        (8)   Rental car, shared ride 2
        (9)   Rental car, shared ride 3+
        (10)  Taxi, drive alone
        (11)  Taxi, shared ride 2
        (12)  Taxi, shared ride 3+
        (13)  Limo, drive alone
        (14)  Limo, shared ride 2
        (15)  Limo, shared ride 3+
        (16)  Shared ride van, shared ride 3+
        (17)  Hotel shuttle, shared ride 3+
        (18)  Charter bus, shared ride 3+</p>
</details>      <p>Five time-of-day-specific tables, each containing origin/destination vehicle
 matrices for the following modes:
           (1) drive alone (DA)
           (2) shared ride 2 (SR2)
           (3) shared ride 3+ (SR3)</p>


<details class="internal-properties" open>
  <summary>Internal properties</summary>
  <p>_start_year
_end_year
_mode_groups:
_out_names:</p>
</details>
              <details class="quote">
                <summary>Source code in <code>tm2py/components/demand/air_passenger.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">AirPassenger</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Builds the airport trip matrices.</span>

<span class="sd">    input: nonres/{year}_{tofrom}{airport}.csv</span>
<span class="sd">    output: five time-of-day-specific OMX files with matrices DA, SR2, SR3</span>

<span class="sd">    Notes:</span>
<span class="sd">    These are independent of level-of-service.</span>

<span class="sd">    Note that the reference names, years, file paths and other key details</span>
<span class="sd">    are controlled via the config, air_passenger section. See the</span>
<span class="sd">    AirPassengerConfig doc for details on specifying these inputs.</span>

<span class="sd">    The following details are based on the default config values.</span>

<span class="sd">    Creates air passenger vehicle trip tables for the Bay Area&#39;s three major</span>
<span class="sd">    airports, namely SFO, OAK, and SJC.  Geoff Gosling, a consultant, created</span>
<span class="sd">    vehicle trip tables segmented by time of day, travel mode, and access/egress</span>
<span class="sd">    direction (i.e. to the airport or from the airport) for years 2007 and 2035.</span>
<span class="sd">    The tables are based on a 2006 Air Passenger survey, which was conducted</span>
<span class="sd">    at SFO and OAK (but not SJC).</span>

<span class="sd">    The travel modes are as follows:</span>
<span class="sd">        (a) escort (drive alone, shared ride 2, and shared ride 3+)</span>
<span class="sd">        (b) park (da, sr2, &amp; sr3+)</span>
<span class="sd">        (c) rental car (da, sr2, &amp; sr3+)</span>
<span class="sd">        (d) taxi ((da, sr2, &amp; sr3+)</span>
<span class="sd">        (e) limo (da, sr2, &amp; sr3+)</span>
<span class="sd">        (f) shared ride van (all assumed to be sr3);</span>
<span class="sd">        (g) hotel shuttle (all assumed to be sr3); and,</span>
<span class="sd">        (h) charter bus (all assumed to be sr3).</span>

<span class="sd">    The shared ride van, hotel shuttle, and charter bus modes are assumed to</span>
<span class="sd">    have no deadhead travel. The return escort trip is included, as are the</span>
<span class="sd">    deadhead limo and taxi trips.</span>

<span class="sd">    The scripts reads in csv files adapted from Mr. Gosling&#39;s Excel files,</span>
<span class="sd">    and creates a highway-assignment ready OMX matrix file for each time-of-day</span>
<span class="sd">    interval.</span>

<span class="sd">    Assumes that no air passengers use HOT lanes (probably not exactly true</span>
<span class="sd">    in certain future year scenarios, but the assumption is made here as a</span>
<span class="sd">    simplification).  Simple linear interpolations are used to estimate vehicle</span>
<span class="sd">    demand in years other than 2007 and 2035, including 2015, 2020, 2025, 2030,</span>
<span class="sd">    and 2040.</span>

<span class="sd">    Transit travel to the airports is not included in these vehicle trip tables.</span>

<span class="sd">    Input:</span>
<span class="sd">        Year-, access/egress-, and airport-specific database file with 90 columns</span>
<span class="sd">        of data for each TAZ.  There are 18 columns for each time-of-day interval</span>
<span class="sd">        as follows:</span>
<span class="sd">                (1)   Escort, drive alone</span>
<span class="sd">                (2)   Escort, shared ride 2</span>
<span class="sd">                (3)   Escort, shared ride 3+</span>
<span class="sd">                (4)   Park, drive alone</span>
<span class="sd">                (5)   Park, shared ride 2</span>
<span class="sd">                (6)   Park, shared ride 3+</span>
<span class="sd">                (7)   Rental car, drive alone</span>
<span class="sd">                (8)   Rental car, shared ride 2</span>
<span class="sd">                (9)   Rental car, shared ride 3+</span>
<span class="sd">                (10)  Taxi, drive alone</span>
<span class="sd">                (11)  Taxi, shared ride 2</span>
<span class="sd">                (12)  Taxi, shared ride 3+</span>
<span class="sd">                (13)  Limo, drive alone</span>
<span class="sd">                (14)  Limo, shared ride 2</span>
<span class="sd">                (15)  Limo, shared ride 3+</span>
<span class="sd">                (16)  Shared ride van, shared ride 3+</span>
<span class="sd">                (17)  Hotel shuttle, shared ride 3+</span>
<span class="sd">                (18)  Charter bus, shared ride 3+</span>

<span class="sd">     Output:</span>
<span class="sd">     Five time-of-day-specific tables, each containing origin/destination vehicle</span>
<span class="sd">     matrices for the following modes:</span>
<span class="sd">               (1) drive alone (DA)</span>
<span class="sd">               (2) shared ride 2 (SR2)</span>
<span class="sd">               (3) shared ride 3+ (SR3)</span>

<span class="sd">    Internal properties:</span>
<span class="sd">        _start_year</span>
<span class="sd">        _end_year</span>
<span class="sd">        _mode_groups:</span>
<span class="sd">        _out_names:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Build the airport trip matrices.</span>

<span class="sd">        Args:</span>
<span class="sd">            controller: parent Controller object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">air_passenger</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">start_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">reference_start_year</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">reference_end_year</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scenario_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">scenario</span><span class="o">.</span><span class="n">year</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">airports</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">air_passenger</span><span class="o">.</span><span class="n">airport_names</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_demand_classes</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_access_mode_groups</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_class_modes</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">classes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">demand_aggregation</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">demand_classes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_demand_classes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_demand_classes</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">demand_aggregation</span><span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_demand_classes</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">access_mode_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_access_mode_groups</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_access_mode_groups</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">c_name</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">access_modes</span> <span class="k">for</span> <span class="n">c_name</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">demand_classes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_access_mode_groups</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">class_modes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_class_modes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_class_modes</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">c_name</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">mode</span> <span class="k">for</span> <span class="n">c_name</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">demand_classes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_class_modes</span>

    <span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate the inputs.&quot;&quot;&quot;</span>
        <span class="c1"># TODO</span>
        <span class="k">pass</span>

    <span class="nd">@LogStartEnd</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run the Air Passenger Demand model to generate the demand matrices.</span>

<span class="sd">        Steps:</span>
<span class="sd">            1. Load the demand data from the CSV files.</span>
<span class="sd">            2. Aggregate the demand data into the assignable classes.</span>
<span class="sd">            3. Create the demand matrices be interpolating the demand data.</span>
<span class="sd">            4. Write the demand matrices to OMX files.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">input_demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_air_pax_demand</span><span class="p">()</span>
        <span class="n">aggr_demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggregate_demand</span><span class="p">(</span><span class="n">input_demand</span><span class="p">)</span>

        <span class="n">demand</span> <span class="o">=</span> <span class="n">interpolate_dfs</span><span class="p">(</span>
            <span class="n">aggr_demand</span><span class="p">,</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start_year</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_year</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scenario_year</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_export_result</span><span class="p">(</span><span class="n">demand</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_load_air_pax_demand</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Loads demand from the CSV files into single pandas dataframe.</span>

<span class="sd">        Uses the following configs to determine the input file names and paths:</span>
<span class="sd">        - self.config.air_passenger.input_demand_folder</span>
<span class="sd">        - self.config.air_passenger.airport_names</span>
<span class="sd">        - self.config.air_passenger.reference_start_year</span>
<span class="sd">        - self.config.air_passenger.reference_end_year</span>

<span class="sd">        Using the pattern: f&quot;{year}_{direction}{airport}.csv&quot;</span>

<span class="sd">        Returns: pandas dataframe with the following columns:</span>
<span class="sd">            (1) airport</span>
<span class="sd">            (2) time_of_day</span>
<span class="sd">            (3) access_mode</span>
<span class="sd">            (4) demand</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">_start_demand_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_air_demand_for_year</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_year</span><span class="p">)</span>
        <span class="n">_end_demand_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_air_demand_for_year</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_year</span><span class="p">)</span>

        <span class="n">_air_pax_demand_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
            <span class="n">_start_demand_df</span><span class="p">,</span>
            <span class="n">_end_demand_df</span><span class="p">,</span>
            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;outer&quot;</span><span class="p">,</span>
            <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">start_year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">end_year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">),</span>
            <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;ORIG&quot;</span><span class="p">,</span> <span class="s2">&quot;DEST&quot;</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="n">_grouped_air_pax_demand_df</span> <span class="o">=</span> <span class="n">_air_pax_demand_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;ORIG&quot;</span><span class="p">,</span> <span class="s2">&quot;DEST&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">_grouped_air_pax_demand_df</span>

    <span class="k">def</span> <span class="nf">_input_demand_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">airport</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">direction</span><span class="p">):</span>
        <span class="n">_file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">input_demand_filename_tmpl</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">airport</span><span class="o">=</span><span class="n">airport</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="n">year</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="n">direction</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">input_demand_folder</span><span class="p">),</span> <span class="n">_file_name</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_air_demand_for_year</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a dataframe of concatenated data from CSVs for all airport x direction combos.</span>

<span class="sd">        Args:</span>
<span class="sd">            year (str): year of demand</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: concatenation of all CSVs that were read in as a dataframe</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_airport_direction</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">airports</span><span class="p">,</span>
            <span class="p">[</span><span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="s2">&quot;from&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">demand_df</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">airport</span><span class="p">,</span> <span class="n">direction</span> <span class="ow">in</span> <span class="n">_airport_direction</span><span class="p">:</span>
            <span class="n">_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_input_demand_filename</span><span class="p">(</span><span class="n">airport</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">direction</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">demand_df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">demand_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">demand_df</span><span class="p">,</span> <span class="n">_df</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">demand_df</span> <span class="o">=</span> <span class="n">_df</span>

        <span class="k">return</span> <span class="n">demand_df</span>

    <span class="k">def</span> <span class="nf">_aggregate_demand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_demand</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Aggregate demand accross access modes to assignable classes for each year.</span>

<span class="sd">        Args:</span>
<span class="sd">            input_demand: pandas dataframe with the columns for each combo of:</span>
<span class="sd">                {_period}_{_access}_{_group}_{_year}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">aggr_demand</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="n">_year_tp_group_accessmode</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start_year</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_year</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">access_mode_groups</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span>
        <span class="p">)</span>

        <span class="c1"># TODO This should be done entirely in pandas using group-by</span>
        <span class="k">for</span> <span class="n">_year</span><span class="p">,</span> <span class="n">_period</span><span class="p">,</span> <span class="p">(</span><span class="n">_class</span><span class="p">,</span> <span class="n">_access_modes</span><span class="p">)</span> <span class="ow">in</span> <span class="n">_year_tp_group_accessmode</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">input_demand</span><span class="p">[</span>
                <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">_access</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">_class</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">_year</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">_access</span> <span class="ow">in</span> <span class="n">_access_modes</span><span class="p">]</span>
            <span class="p">]</span>
            <span class="n">aggr_demand</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">_class</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">_year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">aggr_demand</span>

    <span class="k">def</span> <span class="nf">_export_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">demand_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Export resulting model year demand to OMX files by period.&quot;&quot;&quot;</span>
        <span class="n">path_tmplt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">output_trip_table_directory</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path_tmplt</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">_period</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">:</span>
            <span class="n">_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">path_tmplt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">outfile_trip_table_tmp</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="n">_period</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">df_to_omx</span><span class="p">(</span>
                <span class="n">demand_df</span><span class="p">,</span>
                <span class="p">{</span>
                    <span class="n">_mode</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">_class</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="k">for</span> <span class="n">_class</span><span class="p">,</span> <span class="n">_mode</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_modes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="p">},</span>
                <span class="n">_file_path</span><span class="p">,</span>
                <span class="n">orig_column</span><span class="o">=</span><span class="s2">&quot;ORIG&quot;</span><span class="p">,</span>
                <span class="n">dest_column</span><span class="o">=</span><span class="s2">&quot;DEST&quot;</span><span class="p">,</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tm2py.components.demand.air_passenger.AirPassenger.__init__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span></code>

<a href="#tm2py.components.demand.air_passenger.AirPassenger.__init__" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Build the airport trip matrices.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>controller</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="RunController (tm2py.controller.RunController)" href="#tm2py.controller.RunController">RunController</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>parent Controller object</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/demand/air_passenger.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Build the airport trip matrices.</span>

<span class="sd">    Args:</span>
<span class="sd">        controller: parent Controller object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">air_passenger</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">start_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">reference_start_year</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">end_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">reference_end_year</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">scenario_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">scenario</span><span class="o">.</span><span class="n">year</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">airports</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">air_passenger</span><span class="o">.</span><span class="n">airport_names</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_demand_classes</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_access_mode_groups</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_class_modes</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.demand.air_passenger.AirPassenger.run" class="doc doc-heading">
            <code class=" language-python"><span class="n">run</span><span class="p">()</span></code>

<a href="#tm2py.components.demand.air_passenger.AirPassenger.run" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Run the Air Passenger Demand model to generate the demand matrices.</p>


<details class="steps" open>
  <summary>Steps</summary>
  <ol>
<li>Load the demand data from the CSV files.</li>
<li>Aggregate the demand data into the assignable classes.</li>
<li>Create the demand matrices be interpolating the demand data.</li>
<li>Write the demand matrices to OMX files.</li>
</ol>
</details>
            <details class="quote">
              <summary>Source code in <code>tm2py/components/demand/air_passenger.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@LogStartEnd</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run the Air Passenger Demand model to generate the demand matrices.</span>

<span class="sd">    Steps:</span>
<span class="sd">        1. Load the demand data from the CSV files.</span>
<span class="sd">        2. Aggregate the demand data into the assignable classes.</span>
<span class="sd">        3. Create the demand matrices be interpolating the demand data.</span>
<span class="sd">        4. Write the demand matrices to OMX files.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">input_demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_air_pax_demand</span><span class="p">()</span>
    <span class="n">aggr_demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggregate_demand</span><span class="p">(</span><span class="n">input_demand</span><span class="p">)</span>

    <span class="n">demand</span> <span class="o">=</span> <span class="n">interpolate_dfs</span><span class="p">(</span>
        <span class="n">aggr_demand</span><span class="p">,</span>
        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start_year</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_year</span><span class="p">],</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scenario_year</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_export_result</span><span class="p">(</span><span class="n">demand</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.demand.air_passenger.AirPassenger.validate_inputs" class="doc doc-heading">
            <code class=" language-python"><span class="n">validate_inputs</span><span class="p">()</span></code>

<a href="#tm2py.components.demand.air_passenger.AirPassenger.validate_inputs" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Validate the inputs.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/demand/air_passenger.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate the inputs.&quot;&quot;&quot;</span>
    <span class="c1"># TODO</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<a id="tm2py.config.AirPassengerDemandAggregationConfig"></a>
    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Air passenger demand aggregation input parameters.</p>


<details class="properties" open>
  <summary>Properties</summary>
  
</details>
              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">AirPassengerDemandAggregationConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Air passenger demand aggregation input parameters.</span>

<span class="sd">    Properties:</span>
<span class="sd">        name: (src_group_name) name used for the class group in the input columns</span>
<span class="sd">            for the trip tables,</span>
<span class="sd">        mode: (result_class_name) name used in the output OMX matrix names, note</span>
<span class="sd">            that this should match the expected naming convention in the</span>
<span class="sd">            HighwayClassDemandConfig name(s)</span>
<span class="sd">        access_modes: list of names used for the access modes in the input</span>
<span class="sd">            columns for the trip tables</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">access_modes</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div><h4 id="commercial-demand">Commercial Demand<a class="headerlink" href="#commercial-demand" title="Permanent link"> </a></h4>


<div class="doc doc-object doc-module">



<a id="tm2py.components.demand.commercial"></a>
    <div class="doc doc-contents first">

      <p>Commercial vehicle / truck model module.</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="tm2py.components.demand.commercial.CommercialVehicleModel" class="doc doc-heading">
            <code>CommercialVehicleModel</code>


<a href="#tm2py.components.demand.commercial.CommercialVehicleModel" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="Component (tm2py.components.component.Component)" href="#tm2py.components.component.Component">Component</a></code></p>


      <p>Commercial Vehicle demand model.</p>


<details class="generates-truck-demand-matrices-from" open>
  <summary>Generates truck demand matrices from</summary>
  <ul>
<li>land use</li>
<li>highway network impedances</li>
<li>parameters</li>
</ul>
</details>

<details class="segmented-into-four-truck-types" open>
  <summary>Segmented into four truck types</summary>
  <p>(1) very small trucks (two-axle, four-tire),
(2) small trucks (two-axle, six-tire),
(3) medium trucks (three-axle),
(4) large or combination (four or more axle) trucks.</p>
</details>

<details class="input" open>
  <summary>(1) MAZ csv data file with the employment and household counts.</summary>
  <p>(2) Skims
(3) K-Factors
(4)</p>
</details>      <p>Notes:
(1) Based on the BAYCAST truck model, no significant updates.
(2) Combined Chuck&rsquo;s calibration adjustments into the NAICS-based model coefficients.</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">CommercialVehicleModel</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Commercial Vehicle demand model.</span>

<span class="sd">    Generates truck demand matrices from:</span>
<span class="sd">        - land use</span>
<span class="sd">        - highway network impedances</span>
<span class="sd">        - parameters</span>

<span class="sd">    Segmented into four truck types:</span>
<span class="sd">        (1) very small trucks (two-axle, four-tire),</span>
<span class="sd">        (2) small trucks (two-axle, six-tire),</span>
<span class="sd">        (3) medium trucks (three-axle),</span>
<span class="sd">        (4) large or combination (four or more axle) trucks.</span>

<span class="sd">    Input:  (1) MAZ csv data file with the employment and household counts.</span>
<span class="sd">            (2) Skims</span>
<span class="sd">            (3) K-Factors</span>
<span class="sd">            (4)</span>
<span class="sd">    Output:</span>

<span class="sd">    Notes:</span>
<span class="sd">    (1) Based on the BAYCAST truck model, no significant updates.</span>
<span class="sd">    (2) Combined Chuck&#39;s calibration adjustments into the NAICS-based model coefficients.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor for the CommercialVehicleTripGeneration component.</span>

<span class="sd">        Args:</span>
<span class="sd">            controller (RunController): Run controller for model run.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">truck</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;trip generation&quot;</span><span class="p">:</span> <span class="n">CommercialVehicleTripGeneration</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="bp">self</span><span class="p">),</span>
            <span class="s2">&quot;trip distribution&quot;</span><span class="p">:</span> <span class="n">CommercialVehicleTripDistribution</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="bp">self</span><span class="p">),</span>
            <span class="s2">&quot;time of day&quot;</span><span class="p">:</span> <span class="n">CommercialVehicleTimeOfDay</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="bp">self</span><span class="p">),</span>
            <span class="s2">&quot;toll choice&quot;</span><span class="p">:</span> <span class="n">CommercialVehicleTollChoice</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="bp">self</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">trk_impedances</span> <span class="o">=</span> <span class="p">{</span><span class="n">imp</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">imp</span> <span class="k">for</span> <span class="n">imp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">impedances</span><span class="p">}</span>

        <span class="c1"># Emme matrix management (lazily evaluated)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Interim Results</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_tripends_df</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daily_demand_dict</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trkclass_tp_demand_dict</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trkclass_tp_toll_demand_dict</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">purposes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span>
            <span class="nb">set</span><span class="p">([</span><span class="n">trk_class</span><span class="o">.</span><span class="n">purpose</span> <span class="k">for</span> <span class="n">trk_class</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">trip_gen</span><span class="o">.</span><span class="n">classes</span><span class="p">])</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">classes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">trk_class</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">trk_class</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate the inputs.&quot;&quot;&quot;</span>
        <span class="c1"># TODO</span>

    <span class="nd">@LogStartEnd</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run commercial vehicle model.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_tripends_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span><span class="p">[</span><span class="s2">&quot;trip generation&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daily_demand_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span><span class="p">[</span><span class="s2">&quot;trip distribution&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">total_tripends_df</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trkclass_tp_demand_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span><span class="p">[</span><span class="s2">&quot;time of day&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daily_demand_dict</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trkclass_tp_toll_demand_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span><span class="p">[</span><span class="s2">&quot;toll choice&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trkclass_tp_demand_dict</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_export_results_as_omx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trkclass_tp_toll_demand_dict</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">emmebank</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reference to highway assignment Emmebank.</span>

<span class="sd">        TODO</span>
<span class="sd">            This should really be in the controller?</span>
<span class="sd">            Or part of network.skims?</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">highway_emmebank</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">emme_scenario</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return emme scenario from emmebank.</span>

<span class="sd">        Use first valid scenario for reference Zone IDs.</span>

<span class="sd">        TODO</span>
<span class="sd">            This should really be in the controller?</span>
<span class="sd">            Or part of network.skims?</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_ref_scenario_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">time_periods</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">emmebank</span><span class="o">.</span><span class="n">scenario</span><span class="p">(</span><span class="n">_ref_scenario_name</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">matrix_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Access to MatrixCache to Emmebank for given emme_scenario.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span> <span class="o">=</span> <span class="n">MatrixCache</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">emme_scenario</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span>

    <span class="nd">@LogStartEnd</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_export_results_as_omx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">class_demand</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Export assignable class demands to OMX files by time-of-day.&quot;&quot;&quot;</span>
        <span class="n">outdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">output_trip_table_directory</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">outdir</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">period</span><span class="p">,</span> <span class="n">matrices</span> <span class="ow">in</span> <span class="n">class_demand</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">with</span> <span class="n">OMXManager</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="n">outdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">outfile_trip_table_tmp</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="n">period</span><span class="p">)</span>
                <span class="p">),</span>
                <span class="s2">&quot;w&quot;</span><span class="p">,</span>
            <span class="p">)</span> <span class="k">as</span> <span class="n">output_file</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">matrices</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">output_file</span><span class="o">.</span><span class="n">write_array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="tm2py.components.demand.commercial.CommercialVehicleModel.emme_scenario" class="doc doc-heading">
            <code class=" language-python"><span class="n">emme_scenario</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.components.demand.commercial.CommercialVehicleModel.emme_scenario" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Return emme scenario from emmebank.</p>
<p>Use first valid scenario for reference Zone IDs.</p>
<p>TODO
    This should really be in the controller?
    Or part of network.skims?</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tm2py.components.demand.commercial.CommercialVehicleModel.emmebank" class="doc doc-heading">
            <code class=" language-python"><span class="n">emmebank</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.components.demand.commercial.CommercialVehicleModel.emmebank" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Reference to highway assignment Emmebank.</p>
<p>TODO
    This should really be in the controller?
    Or part of network.skims?</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tm2py.components.demand.commercial.CommercialVehicleModel.matrix_cache" class="doc doc-heading">
            <code class=" language-python"><span class="n">matrix_cache</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.components.demand.commercial.CommercialVehicleModel.matrix_cache" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Access to MatrixCache to Emmebank for given emme_scenario.</p>
    </div>

</div>



<div class="doc doc-object doc-function">


<h3 id="tm2py.components.demand.commercial.CommercialVehicleModel.__init__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span></code>

<a href="#tm2py.components.demand.commercial.CommercialVehicleModel.__init__" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Constructor for the CommercialVehicleTripGeneration component.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>controller</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="RunController (tm2py.controller.RunController)" href="#tm2py.controller.RunController">RunController</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Run controller for model run.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Constructor for the CommercialVehicleTripGeneration component.</span>

<span class="sd">    Args:</span>
<span class="sd">        controller (RunController): Run controller for model run.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">truck</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;trip generation&quot;</span><span class="p">:</span> <span class="n">CommercialVehicleTripGeneration</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="bp">self</span><span class="p">),</span>
        <span class="s2">&quot;trip distribution&quot;</span><span class="p">:</span> <span class="n">CommercialVehicleTripDistribution</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="bp">self</span><span class="p">),</span>
        <span class="s2">&quot;time of day&quot;</span><span class="p">:</span> <span class="n">CommercialVehicleTimeOfDay</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="bp">self</span><span class="p">),</span>
        <span class="s2">&quot;toll choice&quot;</span><span class="p">:</span> <span class="n">CommercialVehicleTollChoice</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="bp">self</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">trk_impedances</span> <span class="o">=</span> <span class="p">{</span><span class="n">imp</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">imp</span> <span class="k">for</span> <span class="n">imp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">impedances</span><span class="p">}</span>

    <span class="c1"># Emme matrix management (lazily evaluated)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Interim Results</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">total_tripends_df</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">daily_demand_dict</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">trkclass_tp_demand_dict</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">trkclass_tp_toll_demand_dict</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.demand.commercial.CommercialVehicleModel.run" class="doc doc-heading">
            <code class=" language-python"><span class="n">run</span><span class="p">()</span></code>

<a href="#tm2py.components.demand.commercial.CommercialVehicleModel.run" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Run commercial vehicle model.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@LogStartEnd</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run commercial vehicle model.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">total_tripends_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span><span class="p">[</span><span class="s2">&quot;trip generation&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">daily_demand_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span><span class="p">[</span><span class="s2">&quot;trip distribution&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_tripends_df</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">trkclass_tp_demand_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span><span class="p">[</span><span class="s2">&quot;time of day&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daily_demand_dict</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">trkclass_tp_toll_demand_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span><span class="p">[</span><span class="s2">&quot;toll choice&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trkclass_tp_demand_dict</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_export_results_as_omx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trkclass_tp_toll_demand_dict</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.demand.commercial.CommercialVehicleModel.validate_inputs" class="doc doc-heading">
            <code class=" language-python"><span class="n">validate_inputs</span><span class="p">()</span></code>

<a href="#tm2py.components.demand.commercial.CommercialVehicleModel.validate_inputs" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Validate the inputs.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">120</span>
<span class="normal">121</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate the inputs.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.components.demand.commercial.CommercialVehicleTimeOfDay" class="doc doc-heading">
            <code>CommercialVehicleTimeOfDay</code>


<a href="#tm2py.components.demand.commercial.CommercialVehicleTimeOfDay" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="Subcomponent (tm2py.components.component.Subcomponent)" href="#tm2py.components.component.Subcomponent">Subcomponent</a></code></p>


      <p>Commercial vehicle (truck) Time of Day Split for 4 sizes of truck.</p>
<p>Input:  Trips origin and destination matrices by 4 truck sizes
Ouput:  20 trips origin and destination matrices by 4 truck sizes by 5 times periods</p>


<details class="note" open>
  <summary>Note</summary>
  <p>The diurnal factors are taken from the BAYCAST-90 model with adjustments made</p>
</details>      <p>during calibration to the very small truck values to better match counts.</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">CommercialVehicleTimeOfDay</span><span class="p">(</span><span class="n">Subcomponent</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Commercial vehicle (truck) Time of Day Split for 4 sizes of truck.</span>

<span class="sd">    Input:  Trips origin and destination matrices by 4 truck sizes</span>
<span class="sd">    Ouput:  20 trips origin and destination matrices by 4 truck sizes by 5 times periods</span>

<span class="sd">    Note:</span>
<span class="sd">        The diurnal factors are taken from the BAYCAST-90 model with adjustments made</span>
<span class="sd">    during calibration to the very small truck values to better match counts.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">,</span> <span class="n">component</span><span class="p">:</span> <span class="n">Component</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor for the CommercialVehicleTimeOfDay component.</span>

<span class="sd">        Args:</span>
<span class="sd">            controller (RunController): Run controller for model run.</span>
<span class="sd">            component (Component): Parent component of sub-component</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">component</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">time_of_day</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">split_factor</span> <span class="o">=</span> <span class="s2">&quot;od&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_class_configs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_class_period_splits</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">time_periods</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">time_periods</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">classes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">trk_class</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">trk_class</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">class_configs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_class_configs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_class_configs</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span><span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_class_configs</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">class_period_splits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns split fraction dictonary mapped to [time period class][time period].&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_class_period_splits</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_class_period_splits</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">c_name</span><span class="p">:</span> <span class="p">{</span><span class="n">c</span><span class="o">.</span><span class="n">time_period</span><span class="p">:</span> <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">time_period_split</span><span class="p">}</span>
                <span class="k">for</span> <span class="n">c_name</span><span class="p">,</span> <span class="n">config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_configs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">}</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_class_period_splits</span>

    <span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate the inputs.&quot;&quot;&quot;</span>
        <span class="c1"># TODO</span>
        <span class="k">pass</span>

    <span class="nd">@LogStartEnd</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">daily_demand</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Splits the daily demand by time of day based on factors in the config.</span>

<span class="sd">        Uses self.config.truck.classes.{class_name}.time_of_day_split to split the daily demand.</span>

<span class="sd">        #TODO use TimePeriodSplit</span>
<span class="sd">        Args:</span>
<span class="sd">            daily_demand: dictionary of truck type name to numpy array of</span>
<span class="sd">                truck type daily demand</span>

<span class="sd">        Returns:</span>
<span class="sd">             Nested dictionary of truck class: time period name =&gt; numpy array of demand</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">trkclass_tp_demand_dict</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>

        <span class="n">_class_timeperiod</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">_t_class</span><span class="p">,</span> <span class="n">_tp</span> <span class="ow">in</span> <span class="n">_class_timeperiod</span><span class="p">:</span>
            <span class="n">trkclass_tp_demand_dict</span><span class="p">[</span><span class="n">_t_class</span><span class="p">][</span><span class="n">_tp</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">class_period_splits</span><span class="p">[</span><span class="n">_t_class</span><span class="p">][</span><span class="n">_tp</span><span class="o">.</span><span class="n">lower</span><span class="p">()][</span><span class="bp">self</span><span class="o">.</span><span class="n">split_factor</span><span class="p">]</span>
                <span class="o">*</span> <span class="n">daily_demand</span><span class="p">[</span><span class="n">_t_class</span><span class="p">],</span>
                <span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">trkclass_tp_demand_dict</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="tm2py.components.demand.commercial.CommercialVehicleTimeOfDay.class_period_splits" class="doc doc-heading">
            <code class=" language-python"><span class="n">class_period_splits</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.components.demand.commercial.CommercialVehicleTimeOfDay.class_period_splits" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Returns split fraction dictonary mapped to [time period class][time period].</p>
    </div>

</div>



<div class="doc doc-object doc-function">


<h3 id="tm2py.components.demand.commercial.CommercialVehicleTimeOfDay.__init__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">component</span><span class="p">)</span></code>

<a href="#tm2py.components.demand.commercial.CommercialVehicleTimeOfDay.__init__" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Constructor for the CommercialVehicleTimeOfDay component.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>controller</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="RunController (tm2py.controller.RunController)" href="#tm2py.controller.RunController">RunController</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Run controller for model run.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>component</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Component (tm2py.components.component.Component)" href="#tm2py.components.component.Component">Component</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parent component of sub-component</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">,</span> <span class="n">component</span><span class="p">:</span> <span class="n">Component</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Constructor for the CommercialVehicleTimeOfDay component.</span>

<span class="sd">    Args:</span>
<span class="sd">        controller (RunController): Run controller for model run.</span>
<span class="sd">        component (Component): Parent component of sub-component</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">component</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">time_of_day</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">split_factor</span> <span class="o">=</span> <span class="s2">&quot;od&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_class_configs</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_class_period_splits</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.demand.commercial.CommercialVehicleTimeOfDay.run" class="doc doc-heading">
            <code class=" language-python"><span class="n">run</span><span class="p">(</span><span class="n">daily_demand</span><span class="p">)</span></code>

<a href="#tm2py.components.demand.commercial.CommercialVehicleTimeOfDay.run" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Splits the daily demand by time of day based on factors in the config.</p>
<p>Uses self.config.truck.classes.{class_name}.time_of_day_split to split the daily demand.</p>
<h4 id="tm2py.components.demand.commercial.CommercialVehicleTimeOfDay.run--todo-use-timeperiodsplit">TODO use TimePeriodSplit<a class="headerlink" href="#tm2py.components.demand.commercial.CommercialVehicleTimeOfDay.run--todo-use-timeperiodsplit" title="Permanent link"> </a></h4>
<p>Args:
    daily_demand: dictionary of truck type name to numpy array of
        truck type daily demand</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="tm2py.components.demand.commercial.NumpyArray">NumpyArray</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Nested dictionary of truck class: time period name =&gt; numpy array of demand</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@LogStartEnd</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">daily_demand</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Splits the daily demand by time of day based on factors in the config.</span>

<span class="sd">    Uses self.config.truck.classes.{class_name}.time_of_day_split to split the daily demand.</span>

<span class="sd">    #TODO use TimePeriodSplit</span>
<span class="sd">    Args:</span>
<span class="sd">        daily_demand: dictionary of truck type name to numpy array of</span>
<span class="sd">            truck type daily demand</span>

<span class="sd">    Returns:</span>
<span class="sd">         Nested dictionary of truck class: time period name =&gt; numpy array of demand</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">trkclass_tp_demand_dict</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>

    <span class="n">_class_timeperiod</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">_t_class</span><span class="p">,</span> <span class="n">_tp</span> <span class="ow">in</span> <span class="n">_class_timeperiod</span><span class="p">:</span>
        <span class="n">trkclass_tp_demand_dict</span><span class="p">[</span><span class="n">_t_class</span><span class="p">][</span><span class="n">_tp</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">class_period_splits</span><span class="p">[</span><span class="n">_t_class</span><span class="p">][</span><span class="n">_tp</span><span class="o">.</span><span class="n">lower</span><span class="p">()][</span><span class="bp">self</span><span class="o">.</span><span class="n">split_factor</span><span class="p">]</span>
            <span class="o">*</span> <span class="n">daily_demand</span><span class="p">[</span><span class="n">_t_class</span><span class="p">],</span>
            <span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">trkclass_tp_demand_dict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.demand.commercial.CommercialVehicleTimeOfDay.validate_inputs" class="doc doc-heading">
            <code class=" language-python"><span class="n">validate_inputs</span><span class="p">()</span></code>

<a href="#tm2py.components.demand.commercial.CommercialVehicleTimeOfDay.validate_inputs" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Validate the inputs.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate the inputs.&quot;&quot;&quot;</span>
    <span class="c1"># TODO</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.components.demand.commercial.CommercialVehicleTollChoice" class="doc doc-heading">
            <code>CommercialVehicleTollChoice</code>


<a href="#tm2py.components.demand.commercial.CommercialVehicleTollChoice" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="Subcomponent (tm2py.components.component.Subcomponent)" href="#tm2py.components.component.Subcomponent">Subcomponent</a></code></p>


      <p>Commercial vehicle (truck) toll choice.</p>
<p>A binomial choice model for very small, small, medium, and large trucks.
A separate value toll paying versus no value toll paying path choice
model is applied to each of the twenty time period and vehicle type combinations.</p>


<details class="input" open>
  <summary>(1) Trip tables by time of day and truck class</summary>
  <p>(2) Skims providing the time and cost for value toll and non-value toll paths
for each; the matrix names in the OMX files are:
    &ldquo;{period}<em>{cls_name}_time&rdquo;
    &ldquo;{period}</em>{cls_name}<em>dist&rdquo;
    &ldquo;{period}</em>{cls_name}<em>bridgetoll{grp_name}&rdquo;
    &ldquo;{period}</em>{cls_name}toll_time&rdquo;
    &ldquo;{period}<em>{cls_name}toll_dist&rdquo;
    &ldquo;{period}</em>{cls_name}toll_bridgetoll{grp_name}&rdquo;
    &ldquo;{period}_{cls_name}toll_valuetoll{grp_name}&rdquo;
Where period is the assignment period, cls_name is the truck assignment
class name (as very small, small and medium truck are assigned as the
same class) and grp_name is the truck type name (as the tolls are
calculated separately for very small, small and medium).</p>
</details>      


<details class="notes" open>
  <summary>(1)  TOLLCLASS is a code, 1 through 10 are reserved for bridges; 11 and up is</summary>
  <p>reserved for value toll facilities.</p>
</details>      <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="w">    </span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w">  </span><span class="nx">All</span><span class="w"> </span><span class="nx">costs</span><span class="w"> </span><span class="nx">should</span><span class="w"> </span><span class="nx">be</span><span class="w"> </span><span class="nx">coded</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">year</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="nx">cents</span>
<span class="w">    </span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w">  </span><span class="nx">The</span><span class="w"> </span><span class="mi">2</span><span class="o">-</span><span class="nx">axle</span><span class="w"> </span><span class="nx">fee</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="nx">used</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">very</span><span class="w"> </span><span class="nx">small</span><span class="w"> </span><span class="nx">trucks</span>
<span class="w">    </span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w">  </span><span class="nx">The</span><span class="w"> </span><span class="mi">2</span><span class="o">-</span><span class="nx">axle</span><span class="w"> </span><span class="nx">fee</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="nx">used</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">small</span><span class="w"> </span><span class="nx">trucks</span>
<span class="w">    </span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w">  </span><span class="nx">The</span><span class="w"> </span><span class="mi">3</span><span class="o">-</span><span class="nx">axle</span><span class="w"> </span><span class="nx">fee</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="nx">used</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">medium</span><span class="w"> </span><span class="nx">trucks</span>
<span class="w">    </span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="w">  </span><span class="nx">The</span><span class="w"> </span><span class="nx">average</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="mi">5</span><span class="o">-</span><span class="nx">axle</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="mi">6</span><span class="o">-</span><span class="nx">axle</span><span class="w"> </span><span class="nx">fee</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="nx">used</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">large</span><span class="w"> </span><span class="nx">trucks</span>
<span class="w">         </span><span class="p">(</span><span class="nx">about</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">midpoint</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">fee</span><span class="w"> </span><span class="nx">schedule</span><span class="p">).</span>
<span class="w">    </span><span class="p">(</span><span class="mi">7</span><span class="p">)</span><span class="w">  </span><span class="nx">The</span><span class="w"> </span><span class="k">in</span><span class="o">-</span><span class="nx">vehicle</span><span class="w"> </span><span class="nx">time</span><span class="w"> </span><span class="nx">coefficient</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="nx">from</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">work</span><span class="w"> </span><span class="nx">trip</span><span class="w"> </span><span class="nx">mode</span><span class="w"> </span><span class="kd">choice</span><span class="w"> </span><span class="nx">model</span><span class="p">.</span>
</code></pre></div></td></tr></table></div>

              <details class="quote">
                <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">CommercialVehicleTollChoice</span><span class="p">(</span><span class="n">Subcomponent</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Commercial vehicle (truck) toll choice.</span>

<span class="sd">    A binomial choice model for very small, small, medium, and large trucks.</span>
<span class="sd">    A separate value toll paying versus no value toll paying path choice</span>
<span class="sd">    model is applied to each of the twenty time period and vehicle type combinations.</span>

<span class="sd">    Input:  (1) Trip tables by time of day and truck class</span>
<span class="sd">            (2) Skims providing the time and cost for value toll and non-value toll paths</span>
<span class="sd">            for each; the matrix names in the OMX files are:</span>
<span class="sd">                &quot;{period}_{cls_name}_time&quot;</span>
<span class="sd">                &quot;{period}_{cls_name}_dist&quot;</span>
<span class="sd">                &quot;{period}_{cls_name}_bridgetoll{grp_name}&quot;</span>
<span class="sd">                &quot;{period}_{cls_name}toll_time&quot;</span>
<span class="sd">                &quot;{period}_{cls_name}toll_dist&quot;</span>
<span class="sd">                &quot;{period}_{cls_name}toll_bridgetoll{grp_name}&quot;</span>
<span class="sd">                &quot;{period}_{cls_name}toll_valuetoll{grp_name}&quot;</span>
<span class="sd">            Where period is the assignment period, cls_name is the truck assignment</span>
<span class="sd">            class name (as very small, small and medium truck are assigned as the</span>
<span class="sd">            same class) and grp_name is the truck type name (as the tolls are</span>
<span class="sd">            calculated separately for very small, small and medium).</span>

<span class="sd">    Results: a total of forty demand matrices, by time of day, truck type and toll/non-toll.</span>

<span class="sd">    Notes:  (1)  TOLLCLASS is a code, 1 through 10 are reserved for bridges; 11 and up is</span>
<span class="sd">                 reserved for value toll facilities.</span>
<span class="sd">            (2)  All costs should be coded in year 2000 cents</span>
<span class="sd">            (3)  The 2-axle fee is used for very small trucks</span>
<span class="sd">            (4)  The 2-axle fee is used for small trucks</span>
<span class="sd">            (5)  The 3-axle fee is used for medium trucks</span>
<span class="sd">            (6)  The average of the 5-axle and 6-axle fee is used for large trucks</span>
<span class="sd">                 (about the midpoint of the fee schedule).</span>
<span class="sd">            (7)  The in-vehicle time coefficient is from the work trip mode choice model.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">,</span> <span class="n">component</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor for Commercial Vehicle Toll Choice.</span>

<span class="sd">        Also calls Subclass __init__().</span>

<span class="sd">        Args:</span>
<span class="sd">            controller: model run controller</span>
<span class="sd">            component: parent component</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">component</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">toll_choice</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;toll choice calculator&quot;</span><span class="p">:</span> <span class="n">TollChoiceCalculator</span><span class="p">(</span>
                <span class="n">controller</span><span class="p">,</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">}</span>

        <span class="c1"># shortcut</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_toll_choice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span><span class="p">[</span><span class="s2">&quot;toll choice calculator&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_toll_choice</span><span class="o">.</span><span class="n">toll_skim_suffix</span> <span class="o">=</span> <span class="s2">&quot;trk&quot;</span>

    <span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate the inputs.&quot;&quot;&quot;</span>
        <span class="c1"># TODO</span>
        <span class="k">pass</span>

    <span class="nd">@LogStartEnd</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trkclass_tp_demand_dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Split per-period truck demands into nontoll and toll classes.</span>

<span class="sd">        Uses OMX skims output from highway assignment: traffic_skims_{period}.omx&quot;&quot;&quot;</span>

        <span class="n">_tclass_time_combos</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span>
        <span class="p">)</span>

        <span class="n">class_demands</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">_time_period</span><span class="p">,</span> <span class="n">_tclass</span> <span class="ow">in</span> <span class="n">_tclass_time_combos</span><span class="p">:</span>
            <span class="n">_split_demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toll_choice</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                <span class="n">trkclass_tp_demand_dict</span><span class="p">[</span><span class="n">_tclass</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="n">_time_period</span><span class="p">],</span>
                <span class="n">_tclass</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">_time_period</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">class_demands</span><span class="p">[</span><span class="n">_time_period</span><span class="p">][</span><span class="n">_tclass</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">_split_demand</span><span class="p">[</span><span class="s2">&quot;non toll&quot;</span><span class="p">]</span>
            <span class="n">class_demands</span><span class="p">[</span><span class="n">_time_period</span><span class="p">][</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_tclass</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">toll&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_split_demand</span><span class="p">[</span><span class="s2">&quot;toll&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">class_demands</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tm2py.components.demand.commercial.CommercialVehicleTollChoice.__init__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">component</span><span class="p">)</span></code>

<a href="#tm2py.components.demand.commercial.CommercialVehicleTollChoice.__init__" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Constructor for Commercial Vehicle Toll Choice.</p>
<p>Also calls Subclass <strong>init</strong>().</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>controller</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>model run controller</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>component</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>parent component</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">,</span> <span class="n">component</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Constructor for Commercial Vehicle Toll Choice.</span>

<span class="sd">    Also calls Subclass __init__().</span>

<span class="sd">    Args:</span>
<span class="sd">        controller: model run controller</span>
<span class="sd">        component: parent component</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">component</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">toll_choice</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;toll choice calculator&quot;</span><span class="p">:</span> <span class="n">TollChoiceCalculator</span><span class="p">(</span>
            <span class="n">controller</span><span class="p">,</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">}</span>

    <span class="c1"># shortcut</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_toll_choice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span><span class="p">[</span><span class="s2">&quot;toll choice calculator&quot;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_toll_choice</span><span class="o">.</span><span class="n">toll_skim_suffix</span> <span class="o">=</span> <span class="s2">&quot;trk&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.demand.commercial.CommercialVehicleTollChoice.run" class="doc doc-heading">
            <code class=" language-python"><span class="n">run</span><span class="p">(</span><span class="n">trkclass_tp_demand_dict</span><span class="p">)</span></code>

<a href="#tm2py.components.demand.commercial.CommercialVehicleTollChoice.run" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Split per-period truck demands into nontoll and toll classes.</p>
<p>Uses OMX skims output from highway assignment: traffic_skims_{period}.omx</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@LogStartEnd</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trkclass_tp_demand_dict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Split per-period truck demands into nontoll and toll classes.</span>

<span class="sd">    Uses OMX skims output from highway assignment: traffic_skims_{period}.omx&quot;&quot;&quot;</span>

    <span class="n">_tclass_time_combos</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span>
    <span class="p">)</span>

    <span class="n">class_demands</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_time_period</span><span class="p">,</span> <span class="n">_tclass</span> <span class="ow">in</span> <span class="n">_tclass_time_combos</span><span class="p">:</span>
        <span class="n">_split_demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toll_choice</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
            <span class="n">trkclass_tp_demand_dict</span><span class="p">[</span><span class="n">_tclass</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="n">_time_period</span><span class="p">],</span>
            <span class="n">_tclass</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">_time_period</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">class_demands</span><span class="p">[</span><span class="n">_time_period</span><span class="p">][</span><span class="n">_tclass</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">_split_demand</span><span class="p">[</span><span class="s2">&quot;non toll&quot;</span><span class="p">]</span>
        <span class="n">class_demands</span><span class="p">[</span><span class="n">_time_period</span><span class="p">][</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_tclass</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">toll&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_split_demand</span><span class="p">[</span><span class="s2">&quot;toll&quot;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">class_demands</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.demand.commercial.CommercialVehicleTollChoice.validate_inputs" class="doc doc-heading">
            <code class=" language-python"><span class="n">validate_inputs</span><span class="p">()</span></code>

<a href="#tm2py.components.demand.commercial.CommercialVehicleTollChoice.validate_inputs" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Validate the inputs.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate the inputs.&quot;&quot;&quot;</span>
    <span class="c1"># TODO</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.components.demand.commercial.CommercialVehicleTripDistribution" class="doc doc-heading">
            <code>CommercialVehicleTripDistribution</code>


<a href="#tm2py.components.demand.commercial.CommercialVehicleTripDistribution" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="Subcomponent (tm2py.components.component.Subcomponent)" href="#tm2py.components.component.Subcomponent">Subcomponent</a></code></p>


      <p>Commercial vehicle (truck) Trip Distribution for 4 sizes of truck.</p>


<details class="the-four-truck-types-are" open>
  <summary>The four truck types are</summary>
  <p>(1) very small trucks (two-axle, four-tire),
(2) small trucks (two-axle, six-tire),
(3) medium trucks (three-axle),
(4) large or combination (four or more axle) trucks.</p>
</details>

<details class="input" open>
  <summary>(1) Trips by 4 truck sizes</summary>
  <p>(2) highway skims for truck, time, distance, bridgetoll and value toll
(3) friction factors lookup table
(4) k-factors matrix</p>
</details>      <p>A simple gravity model is used to distribute the truck trips, with
separate friction factors used for each class of truck.</p>
<p>A blended travel time is used as the impedance measure, specifically the weighted average
of the AM travel time (one-third weight) and the midday travel time (two-thirds weight).</p>


<details class="input" open>
  <summary>Input</summary>
  <p>Level-of-service matrices for the AM peak period (6 am to 10 am) and midday
period (10 am to 3 pm) which contain truck-class specific estimates of
congested travel time (in minutes)</p>
<p>A matrix of k-factors, as calibrated by Chuck Purvis.  Note the very small truck model
does not use k-factors; the small, medium, and large trucks use the same k-factors.</p>
<p>A table of friction factors in text format with the following fields, space separated:
- impedance measure (blended travel time);
- friction factors for very small trucks;
- friction factors for small trucks;
- friction factors for medium trucks; and,
- friction factors for large trucks.</p>
</details>

<details class="notes-on-distribution-steps" open>
  <summary>Notes on distribution steps</summary>
  <p>load nonres/truck_kfactors_taz.csv
load nonres/truckFF.dat
Apply friction factors and kfactors to produce balancing matrix
apply the gravity models using friction factors from nonres/truckFF.dat
(note the very small trucks do not use the K-factors)
Can use Emme matrix balancing for this - important note: reference
matrices by name and ensure names are unique
Trips rounded to 0.01, causes some instability in results</p>
</details>      <p>Notes:
(1) Based on the BAYCAST truck model, no significant updates.
(2) Combined Chuck&rsquo;s calibration adjustments into the NAICS-based model coefficients.</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">CommercialVehicleTripDistribution</span><span class="p">(</span><span class="n">Subcomponent</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Commercial vehicle (truck) Trip Distribution for 4 sizes of truck.</span>

<span class="sd">    The four truck types are:</span>
<span class="sd">        (1) very small trucks (two-axle, four-tire),</span>
<span class="sd">        (2) small trucks (two-axle, six-tire),</span>
<span class="sd">        (3) medium trucks (three-axle),</span>
<span class="sd">        (4) large or combination (four or more axle) trucks.</span>

<span class="sd">    Input:  (1) Trips by 4 truck sizes</span>
<span class="sd">            (2) highway skims for truck, time, distance, bridgetoll and value toll</span>
<span class="sd">            (3) friction factors lookup table</span>
<span class="sd">            (4) k-factors matrix</span>
<span class="sd">    Ouput:  Trips origin and destination matrices by 4 truck sizes</span>

<span class="sd">    A simple gravity model is used to distribute the truck trips, with</span>
<span class="sd">    separate friction factors used for each class of truck.</span>

<span class="sd">    A blended travel time is used as the impedance measure, specifically the weighted average</span>
<span class="sd">    of the AM travel time (one-third weight) and the midday travel time (two-thirds weight).</span>

<span class="sd">    Input:</span>
<span class="sd">        Level-of-service matrices for the AM peak period (6 am to 10 am) and midday</span>
<span class="sd">        period (10 am to 3 pm) which contain truck-class specific estimates of</span>
<span class="sd">        congested travel time (in minutes)</span>

<span class="sd">        A matrix of k-factors, as calibrated by Chuck Purvis.  Note the very small truck model</span>
<span class="sd">        does not use k-factors; the small, medium, and large trucks use the same k-factors.</span>

<span class="sd">        A table of friction factors in text format with the following fields, space separated:</span>
<span class="sd">        - impedance measure (blended travel time);</span>
<span class="sd">        - friction factors for very small trucks;</span>
<span class="sd">        - friction factors for small trucks;</span>
<span class="sd">        - friction factors for medium trucks; and,</span>
<span class="sd">        - friction factors for large trucks.</span>

<span class="sd">    Notes on distribution steps:</span>
<span class="sd">        load nonres/truck_kfactors_taz.csv</span>
<span class="sd">        load nonres/truckFF.dat</span>
<span class="sd">        Apply friction factors and kfactors to produce balancing matrix</span>
<span class="sd">        apply the gravity models using friction factors from nonres/truckFF.dat</span>
<span class="sd">        (note the very small trucks do not use the K-factors)</span>
<span class="sd">        Can use Emme matrix balancing for this - important note: reference</span>
<span class="sd">        matrices by name and ensure names are unique</span>
<span class="sd">        Trips rounded to 0.01, causes some instability in results</span>

<span class="sd">    Results: four total daily trips by truck type</span>

<span class="sd">    Notes:</span>
<span class="sd">    (1) Based on the BAYCAST truck model, no significant updates.</span>
<span class="sd">    (2) Combined Chuck&#39;s calibration adjustments into the NAICS-based model coefficients.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">,</span> <span class="n">component</span><span class="p">:</span> <span class="n">Component</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor for the CommercialVehicleTripDistribution component.</span>

<span class="sd">        Args:</span>
<span class="sd">            controller (RunController): Run controller for model run.</span>
<span class="sd">            component (Component): Parent component of sub-component</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">component</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">trip_dist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_k_factors</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_blended_skims</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_friction_factors</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_friction_factor_matrices</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_class_config</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">class_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_class_config</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_class_config</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span><span class="p">}</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_class_config</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">k_factors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Zone-to-zone values of truck K factors.</span>

<span class="sd">        Returns:</span>
<span class="sd">             NumpyArray: Zone-to-zone values of truck K factors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_k_factors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_k_factors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_k_factors</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_k_factors</span>

    <span class="k">def</span> <span class="nf">_load_k_factors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Loads k-factors from self.config.truck.k_factors_file csv file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            NumpyArray: Zone-to-zone values of truck K factors.</span>

<span class="sd">        &quot;&quot;&quot;</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;return zonal_csv_to_matrices(</span>
<span class="sd">            self.get_abs_path(self.config.k_factors_file),</span>
<span class="sd">            i_column=&quot;I_taz_tm2_v2_2&quot;,</span>
<span class="sd">            j_column=&quot;J_taz_tm2_v2_2&quot;,</span>
<span class="sd">            value_columns=&quot;truck_k&quot;,</span>
<span class="sd">            fill_zones=True,</span>
<span class="sd">            default_value=0,</span>
<span class="sd">            max_zone=max(self.component.emme_scenario.zone_numbers),</span>
<span class="sd">        )[&quot;truck_k&quot;].values&quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">k_factors_file</span><span class="p">))</span>
        <span class="n">zones</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;I_taz_tm2_v2_2&quot;</span><span class="p">])</span>
        <span class="n">num_data_zones</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">zones</span><span class="p">)</span>
        <span class="n">row_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">zones</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;I_taz_tm2_v2_2&quot;</span><span class="p">])</span>
        <span class="n">col_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">zones</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;J_taz_tm2_v2_2&quot;</span><span class="p">])</span>
        <span class="n">k_factors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_data_zones</span><span class="p">,</span> <span class="n">num_data_zones</span><span class="p">))</span>
        <span class="n">k_factors</span><span class="p">[</span><span class="n">row_index</span><span class="p">,</span> <span class="n">col_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;truck_k&quot;</span><span class="p">]</span>
        <span class="n">num_zones</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">emme_scenario</span><span class="o">.</span><span class="n">zone_numbers</span><span class="p">)</span>
        <span class="n">padding</span> <span class="o">=</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_zones</span> <span class="o">-</span> <span class="n">num_data_zones</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_zones</span> <span class="o">-</span> <span class="n">num_data_zones</span><span class="p">))</span>
        <span class="n">k_factors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">k_factors</span><span class="p">,</span> <span class="n">padding</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">k_factors</span>

    <span class="k">def</span> <span class="nf">blended_skims</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get blended skim. Creates it if doesn&#39;t already exist.</span>

<span class="sd">        Args:</span>
<span class="sd">            mode (str): Mode for skim</span>

<span class="sd">        Returns:</span>
<span class="sd">            _type_: _description_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_blended_skims</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_blended_skims</span><span class="p">[</span><span class="n">mode</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_blended_skim</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="p">,</span>
                <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
                <span class="n">blend</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">trk_impedances</span><span class="p">[</span><span class="n">mode</span><span class="p">][</span><span class="s2">&quot;time_blend&quot;</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_blended_skims</span><span class="p">[</span><span class="n">mode</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">friction_factor_matrices</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">trk_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">k_factors</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NumpyArray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Zone to zone NumpyArray of impedances for a given truck class.</span>

<span class="sd">        Args:</span>
<span class="sd">            trk_class (str): Truck class abbreviated name</span>
<span class="sd">            k_factors (Union[None,NumpyArray]): If not None, gives an zone-by-zone array of</span>
<span class="sd">                k-factors--additive impedances to be added on top of friciton factors.</span>
<span class="sd">                Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            NumpyArray: Zone-by-zone matrix of friction factors</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">trk_class</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_friction_factor_matrices</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_friction_factor_matrices</span><span class="p">[</span>
                <span class="n">trk_class</span>
            <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_friction_factor_matrix</span><span class="p">(</span>
                <span class="n">trk_class</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">class_config</span><span class="p">[</span><span class="n">trk_class</span><span class="p">]</span><span class="o">.</span><span class="n">impedance</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">k_factors</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">class_config</span><span class="p">[</span><span class="n">trk_class</span><span class="p">]</span><span class="o">.</span><span class="n">use_k_factors</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_friction_factor_matrices</span><span class="p">[</span><span class="n">trk_class</span><span class="p">]</span>

    <span class="nd">@LogStartEnd</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_calculate_friction_factor_matrix</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">segment_name</span><span class="p">,</span>
        <span class="n">blended_skim_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">k_factors</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">use_k_factors</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates friction matrix by interpolating time; optionally multiplying by k_factors.</span>

<span class="sd">        Args:</span>
<span class="sd">            segment_name: Name of the segment to calculate the friction factors for (i.e. vstruck)</span>
<span class="sd">            blended_skim_name (str): Name of blended skim</span>
<span class="sd">            k_factors (Union[None,NumpyArray): Optional k-factors matrix</span>

<span class="sd">        Returns:</span>
<span class="sd">            friction_matrix NumpyArray: friction matrix for a truck class</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_friction_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">blended_skims</span><span class="p">(</span><span class="n">blended_skim_name</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">friction_factors</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">friction_factors</span><span class="p">[</span><span class="n">segment_name</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">use_k_factors</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k_factors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">_friction_matrix</span> <span class="o">=</span> <span class="n">_friction_matrix</span> <span class="o">*</span> <span class="n">k_factors</span>

        <span class="k">return</span> <span class="n">_friction_matrix</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">friction_factors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Table of friction factors for each time band by truck class.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: DataFrame of friction factors read from disk.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_friction_factors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_friction_factors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_ffactors</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_friction_factors</span>

    <span class="k">def</span> <span class="nf">_read_ffactors</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load friction factors lookup tables from csv file to dataframe.</span>

<span class="sd">        Reads from file: config.truck.friction_factors_file with following assumed column order:</span>
<span class="sd">            time: Time</span>
<span class="sd">            vsmtrk: Very Small Truck FF</span>
<span class="sd">            smltrk: Small Truck FF</span>
<span class="sd">            medtrk: Medium Truck FF</span>
<span class="sd">            lrgtrk: Large Truck FF</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">friction_factors_file</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">_file_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate the inputs.&quot;&quot;&quot;</span>
        <span class="c1"># TODO</span>
        <span class="k">pass</span>

    <span class="nd">@LogStartEnd</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tripends_df</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run commercial vehicle trip distribution.&quot;&quot;&quot;</span>
        <span class="n">daily_demand_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">tc</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_distribute_ods</span><span class="p">(</span><span class="n">tripends_df</span><span class="p">,</span> <span class="n">tc</span><span class="p">)</span> <span class="k">for</span> <span class="n">tc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">classes</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">daily_demand_dict</span>

    <span class="nd">@LogStartEnd</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_distribute_ods</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">tripends_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">trk_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">orig_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="n">dest_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NumpyArray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Distribute a trip ends for a given a truck class.</span>

<span class="sd">        Args:</span>
<span class="sd">            tripends_df: dataframe with trip ends as &quot;{trk_class}_prod&quot; and{trk_class}_attr&quot;.</span>
<span class="sd">            trk_class: name of truck class to distribute.</span>
<span class="sd">            orig_factor (float, optional): Amount to factor towards origins. Defaults to 0.5.</span>
<span class="sd">            dest_factor (float, optional): Amount to factor towards destinations. Defaults to 0.5.</span>

<span class="sd">        Returns:</span>
<span class="sd">            NumpyArray: Distributed trip ends for given truck class</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">orig_factor</span> <span class="o">+</span> <span class="n">dest_factor</span> <span class="o">!=</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;orig_factor (</span><span class="si">{orig_factor}</span><span class="s2">) and dest_factor (</span><span class="si">{dest_factor}</span><span class="s2">) must</span><span class="se">\</span>
<span class="s2">                sum to 1.0&quot;</span>
            <span class="p">)</span>

        <span class="n">_prod_attr_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_balancing</span><span class="p">(</span>
            <span class="n">tripends_df</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">trk_class</span><span class="si">}</span><span class="s2">_productions&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
            <span class="n">tripends_df</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">trk_class</span><span class="si">}</span><span class="s2">_attractions&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
            <span class="n">trk_class</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">daily_demand</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">orig_factor</span> <span class="o">*</span> <span class="n">_prod_attr_matrix</span>
            <span class="o">+</span> <span class="n">dest_factor</span> <span class="o">*</span> <span class="n">_prod_attr_matrix</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">trk_class</span><span class="si">}</span><span class="s2">, prod sum: </span><span class="si">{</span><span class="n">_prod_attr_matrix</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s2">, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;daily sum: </span><span class="si">{</span><span class="n">daily_demand</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">daily_demand</span>

    <span class="k">def</span> <span class="nf">_matrix_balancing</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">orig_totals</span><span class="p">:</span> <span class="n">NumpyArray</span><span class="p">,</span>
        <span class="n">dest_totals</span><span class="p">:</span> <span class="n">NumpyArray</span><span class="p">,</span>
        <span class="n">trk_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NumpyArray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Distribute origins and destinations based on friction factors for a givein truck class.</span>

<span class="sd">        Args:</span>
<span class="sd">            orig_totals: Total demand for origins as a numpy array</span>
<span class="sd">            dest_totals: Total demand for destinations as a numpy array</span>
<span class="sd">            trk_class (str): Truck class name</span>



<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">matrix_balancing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">modeller</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span>
            <span class="s2">&quot;inro.emme.matrix_calculation.matrix_balancing&quot;</span>
        <span class="p">)</span>
        <span class="n">matrix_round</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">modeller</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span>
            <span class="s2">&quot;inro.emme.matrix_calculation.matrix_controlled_rounding&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Transfer numpy to emmebank</span>
        <span class="n">_ff_emme_mx_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">matrix_cache</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">trk_class</span><span class="si">}</span><span class="s2">_friction&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">friction_factor_matrices</span><span class="p">(</span><span class="n">trk_class</span><span class="p">),</span>
            <span class="n">matrix_type</span><span class="o">=</span><span class="s2">&quot;FULL&quot;</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">name</span>

        <span class="n">_orig_tots_emme_mx_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">matrix_cache</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">trk_class</span><span class="si">}</span><span class="s2">_prod&quot;</span><span class="p">,</span> <span class="n">orig_totals</span><span class="p">,</span> <span class="n">matrix_type</span><span class="o">=</span><span class="s2">&quot;ORIGIN&quot;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">name</span>

        <span class="n">_dest_tots_emme_mx_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">matrix_cache</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">trk_class</span><span class="si">}</span><span class="s2">_attr&quot;</span><span class="p">,</span> <span class="n">dest_totals</span><span class="p">,</span> <span class="n">matrix_type</span><span class="o">=</span><span class="s2">&quot;DESTINATION&quot;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">name</span>

        <span class="c1"># Create a destination matrix for output to live in Emmebank</span>
        <span class="n">_result_emme_mx_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">matrix_cache</span><span class="o">.</span><span class="n">get_or_init_matrix</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">trk_class</span><span class="si">}</span><span class="s2">_daily_demand&quot;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">name</span>

        <span class="n">spec</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;od_values_to_balance&quot;</span><span class="p">:</span> <span class="n">_ff_emme_mx_name</span><span class="p">,</span>
            <span class="s2">&quot;origin_totals&quot;</span><span class="p">:</span> <span class="n">_orig_tots_emme_mx_name</span><span class="p">,</span>
            <span class="s2">&quot;destination_totals&quot;</span><span class="p">:</span> <span class="n">_dest_tots_emme_mx_name</span><span class="p">,</span>
            <span class="s2">&quot;allowable_difference&quot;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span>
            <span class="s2">&quot;max_relative_error&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_balance_relative_error</span><span class="p">,</span>
            <span class="s2">&quot;max_iterations&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_balance_iterations</span><span class="p">,</span>
            <span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;od_balanced_values&quot;</span><span class="p">:</span> <span class="n">_result_emme_mx_name</span><span class="p">},</span>
            <span class="s2">&quot;performance_settings&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;allowed_memory&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;number_of_processors&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">num_processors</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;MATRIX_BALANCING&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">matrix_balancing</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">scenario</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">emme_scenario</span><span class="p">)</span>

        <span class="n">matrix_round</span><span class="p">(</span>
            <span class="n">_result_emme_mx_name</span><span class="p">,</span>
            <span class="n">_result_emme_mx_name</span><span class="p">,</span>
            <span class="n">min_demand</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
            <span class="n">values_to_round</span><span class="o">=</span><span class="s2">&quot;ALL_NON_ZERO&quot;</span><span class="p">,</span>
            <span class="n">scenario</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">emme_scenario</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">matrix_cache</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">_result_emme_mx_name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="tm2py.components.demand.commercial.CommercialVehicleTripDistribution.friction_factors" class="doc doc-heading">
            <code class=" language-python"><span class="n">friction_factors</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.components.demand.commercial.CommercialVehicleTripDistribution.friction_factors" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Table of friction factors for each time band by truck class.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: DataFrame of friction factors read from disk.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tm2py.components.demand.commercial.CommercialVehicleTripDistribution.k_factors" class="doc doc-heading">
            <code class=" language-python"><span class="n">k_factors</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.components.demand.commercial.CommercialVehicleTripDistribution.k_factors" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Zone-to-zone values of truck K factors.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>NumpyArray</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Zone-to-zone values of truck K factors.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
    </div>

</div>



<div class="doc doc-object doc-function">


<h3 id="tm2py.components.demand.commercial.CommercialVehicleTripDistribution.__init__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">component</span><span class="p">)</span></code>

<a href="#tm2py.components.demand.commercial.CommercialVehicleTripDistribution.__init__" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Constructor for the CommercialVehicleTripDistribution component.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>controller</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="RunController (tm2py.controller.RunController)" href="#tm2py.controller.RunController">RunController</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Run controller for model run.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>component</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Component (tm2py.components.component.Component)" href="#tm2py.components.component.Component">Component</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parent component of sub-component</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">,</span> <span class="n">component</span><span class="p">:</span> <span class="n">Component</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Constructor for the CommercialVehicleTripDistribution component.</span>

<span class="sd">    Args:</span>
<span class="sd">        controller (RunController): Run controller for model run.</span>
<span class="sd">        component (Component): Parent component of sub-component</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">component</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">trip_dist</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_k_factors</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_blended_skims</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_friction_factors</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_friction_factor_matrices</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_class_config</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.demand.commercial.CommercialVehicleTripDistribution.blended_skims" class="doc doc-heading">
            <code class=" language-python"><span class="n">blended_skims</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span></code>

<a href="#tm2py.components.demand.commercial.CommercialVehicleTripDistribution.blended_skims" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Get blended skim. Creates it if doesn&rsquo;t already exist.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>mode</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mode for skim</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>_type_</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p><em>description</em></p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">blended_skims</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get blended skim. Creates it if doesn&#39;t already exist.</span>

<span class="sd">    Args:</span>
<span class="sd">        mode (str): Mode for skim</span>

<span class="sd">    Returns:</span>
<span class="sd">        _type_: _description_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_blended_skims</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_blended_skims</span><span class="p">[</span><span class="n">mode</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_blended_skim</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
            <span class="n">blend</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">trk_impedances</span><span class="p">[</span><span class="n">mode</span><span class="p">][</span><span class="s2">&quot;time_blend&quot;</span><span class="p">],</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_blended_skims</span><span class="p">[</span><span class="n">mode</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.demand.commercial.CommercialVehicleTripDistribution.friction_factor_matrices" class="doc doc-heading">
            <code class=" language-python"><span class="n">friction_factor_matrices</span><span class="p">(</span><span class="n">trk_class</span><span class="p">,</span> <span class="n">k_factors</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#tm2py.components.demand.commercial.CommercialVehicleTripDistribution.friction_factor_matrices" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Zone to zone NumpyArray of impedances for a given truck class.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>trk_class</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Truck class abbreviated name</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>k_factors</code></td>
            <td>
                  <code><span title="typing.Union">Union</span>[None, <span title="tm2py.components.demand.commercial.NumpyArray">NumpyArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If not None, gives an zone-by-zone array of
k-factors&ndash;additive impedances to be added on top of friciton factors.
Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>NumpyArray</code></td>            <td>
                  <code><span title="tm2py.components.demand.commercial.NumpyArray">NumpyArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Zone-by-zone matrix of friction factors</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">friction_factor_matrices</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">trk_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">k_factors</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NumpyArray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Zone to zone NumpyArray of impedances for a given truck class.</span>

<span class="sd">    Args:</span>
<span class="sd">        trk_class (str): Truck class abbreviated name</span>
<span class="sd">        k_factors (Union[None,NumpyArray]): If not None, gives an zone-by-zone array of</span>
<span class="sd">            k-factors--additive impedances to be added on top of friciton factors.</span>
<span class="sd">            Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        NumpyArray: Zone-by-zone matrix of friction factors</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">trk_class</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_friction_factor_matrices</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_friction_factor_matrices</span><span class="p">[</span>
            <span class="n">trk_class</span>
        <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_friction_factor_matrix</span><span class="p">(</span>
            <span class="n">trk_class</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">class_config</span><span class="p">[</span><span class="n">trk_class</span><span class="p">]</span><span class="o">.</span><span class="n">impedance</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">k_factors</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">class_config</span><span class="p">[</span><span class="n">trk_class</span><span class="p">]</span><span class="o">.</span><span class="n">use_k_factors</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_friction_factor_matrices</span><span class="p">[</span><span class="n">trk_class</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.demand.commercial.CommercialVehicleTripDistribution.run" class="doc doc-heading">
            <code class=" language-python"><span class="n">run</span><span class="p">(</span><span class="n">tripends_df</span><span class="p">)</span></code>

<a href="#tm2py.components.demand.commercial.CommercialVehicleTripDistribution.run" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Run commercial vehicle trip distribution.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@LogStartEnd</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tripends_df</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run commercial vehicle trip distribution.&quot;&quot;&quot;</span>
    <span class="n">daily_demand_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">tc</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_distribute_ods</span><span class="p">(</span><span class="n">tripends_df</span><span class="p">,</span> <span class="n">tc</span><span class="p">)</span> <span class="k">for</span> <span class="n">tc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">classes</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">daily_demand_dict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.demand.commercial.CommercialVehicleTripDistribution.validate_inputs" class="doc doc-heading">
            <code class=" language-python"><span class="n">validate_inputs</span><span class="p">()</span></code>

<a href="#tm2py.components.demand.commercial.CommercialVehicleTripDistribution.validate_inputs" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Validate the inputs.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate the inputs.&quot;&quot;&quot;</span>
    <span class="c1"># TODO</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.components.demand.commercial.CommercialVehicleTripGeneration" class="doc doc-heading">
            <code>CommercialVehicleTripGeneration</code>


<a href="#tm2py.components.demand.commercial.CommercialVehicleTripGeneration" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="Subcomponent (tm2py.components.component.Subcomponent)" href="#tm2py.components.component.Subcomponent">Subcomponent</a></code></p>


      <p>Commercial vehicle (truck) Trip Generation for 4 sizes of truck.</p>


<details class="the-four-truck-types-are" open>
  <summary>The four truck types are</summary>
  <p>(1) very small trucks (two-axle, four-tire),
(2) small trucks (two-axle, six-tire),
(3) medium trucks (three-axle),
(4) large or combination (four or more axle) trucks.</p>
</details>      <h4 id="tm2py.components.demand.commercial.CommercialVehicleTripGeneration--trip-generation">Trip generation<a class="headerlink" href="#tm2py.components.demand.commercial.CommercialVehicleTripGeneration--trip-generation" title="Permanent link"> </a></h4>
<p>Use linear regression models to generate trip ends,
balancing attractions to productions. Based on BAYCAST truck model.</p>
<p>The truck trip generation models for small trucks (two-axle, six tire),
medium trucks (three-axle), and large or combination (four or more axle)
trucks are taken directly from the study: &ldquo;I-880 Intermodal Corridor Study:
Truck Travel in the San Francisco Bay Area&rdquo;, prepared by Barton Aschman in
December 1992.  The coefficients are on page 223 of this report.</p>
<p>The very small truck generation model is based on the Phoenix four-tire
truck model documented in the TMIP Quick Response Freight Manual.</p>
<p>Note that certain production models previously used SIC-based employment
categories.  To both maintain consistency with the BAYCAST truck model and
update the model to use NAICS-based employment categories, new regression
models were estimated relating the NAICS-based employment data with the
SIC-based-predicted trips.  The goal here is not to create a new truck
model, but to mimic the old model with the available data.  Please see
the excel spreadsheet TruckModel.xlsx for details.  The NAICS-based model
results replicate the SIC-based model results quite well.</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">CommercialVehicleTripGeneration</span><span class="p">(</span><span class="n">Subcomponent</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Commercial vehicle (truck) Trip Generation for 4 sizes of truck.</span>

<span class="sd">    The four truck types are:</span>
<span class="sd">        (1) very small trucks (two-axle, four-tire),</span>
<span class="sd">        (2) small trucks (two-axle, six-tire),</span>
<span class="sd">        (3) medium trucks (three-axle),</span>
<span class="sd">        (4) large or combination (four or more axle) trucks.</span>

<span class="sd">    Input:  (1) MAZ csv data file with the employment and household counts.</span>
<span class="sd">    Ouput:  Trips by 4 truck sizes</span>

<span class="sd">    Trip generation</span>
<span class="sd">    ---------------</span>
<span class="sd">    Use linear regression models to generate trip ends,</span>
<span class="sd">    balancing attractions to productions. Based on BAYCAST truck model.</span>

<span class="sd">    The truck trip generation models for small trucks (two-axle, six tire),</span>
<span class="sd">    medium trucks (three-axle), and large or combination (four or more axle)</span>
<span class="sd">    trucks are taken directly from the study: &quot;I-880 Intermodal Corridor Study:</span>
<span class="sd">    Truck Travel in the San Francisco Bay Area&quot;, prepared by Barton Aschman in</span>
<span class="sd">    December 1992.  The coefficients are on page 223 of this report.</span>

<span class="sd">    The very small truck generation model is based on the Phoenix four-tire</span>
<span class="sd">    truck model documented in the TMIP Quick Response Freight Manual.</span>

<span class="sd">    Note that certain production models previously used SIC-based employment</span>
<span class="sd">    categories.  To both maintain consistency with the BAYCAST truck model and</span>
<span class="sd">    update the model to use NAICS-based employment categories, new regression</span>
<span class="sd">    models were estimated relating the NAICS-based employment data with the</span>
<span class="sd">    SIC-based-predicted trips.  The goal here is not to create a new truck</span>
<span class="sd">    model, but to mimic the old model with the available data.  Please see</span>
<span class="sd">    the excel spreadsheet TruckModel.xlsx for details.  The NAICS-based model</span>
<span class="sd">    results replicate the SIC-based model results quite well.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">,</span> <span class="n">component</span><span class="p">:</span> <span class="n">Component</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor for the CommercialVehicleTripGeneration component.</span>

<span class="sd">        Args:</span>
<span class="sd">            controller (RunController): Run controller for model run.</span>
<span class="sd">            component (Component): Parent component of sub-component</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">component</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">trip_gen</span>

    <span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate the inputs.&quot;&quot;&quot;</span>
        <span class="c1"># TODO</span>
        <span class="k">pass</span>

    <span class="nd">@LogStartEnd</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run commercial vehicle trip distribution.&quot;&quot;&quot;</span>
        <span class="n">_landuse_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggregate_landuse</span><span class="p">()</span>
        <span class="n">_unbalanced_tripends_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_trip_ends</span><span class="p">(</span><span class="n">_landuse_df</span><span class="p">)</span>
        <span class="n">_balanced_tripends_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_balance_pa</span><span class="p">(</span><span class="n">_unbalanced_tripends_df</span><span class="p">)</span>
        <span class="n">total_tripends_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggregate_by_class</span><span class="p">(</span><span class="n">_balanced_tripends_df</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">total_tripends_df</span>

    <span class="nd">@LogStartEnd</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_aggregate_landuse</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Aggregates landuse data from input CSV by MAZ to TAZ and employment groups.</span>

<span class="sd">        TOTEMP, total employment (same regardless of classification system)</span>
<span class="sd">        RETEMPN, retail trade employment per the NAICS classification system</span>
<span class="sd">        FPSEMPN, financial and professional services employment per NAICS</span>
<span class="sd">        HEREMPN, health, educational, and recreational employment per  NAICS</span>
<span class="sd">        OTHEMPN, other employment per the NAICS classification system</span>
<span class="sd">        AGREMPN, agricultural employment per the NAICS classificatin system</span>
<span class="sd">        MWTEMPN, manufacturing, warehousing, and transportation employment per NAICS</span>
<span class="sd">        TOTHH, total households</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">maz_data_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">scenario</span><span class="o">.</span><span class="n">maz_landuse_file</span>
        <span class="p">)</span>
        <span class="n">maz_input_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">maz_data_file</span><span class="p">)</span>
        <span class="n">zones</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">emme_scenario</span><span class="o">.</span><span class="n">zone_numbers</span>
        <span class="n">maz_input_data</span> <span class="o">=</span> <span class="n">maz_input_data</span><span class="p">[</span><span class="n">maz_input_data</span><span class="p">[</span><span class="s2">&quot;TAZ_ORIGINAL&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">zones</span><span class="p">)]</span>
        <span class="n">taz_input_data</span> <span class="o">=</span> <span class="n">maz_input_data</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;TAZ_ORIGINAL&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">taz_input_data</span> <span class="o">=</span> <span class="n">taz_input_data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;TAZ_ORIGINAL&quot;</span><span class="p">)</span>
        <span class="c1"># combine categories</span>
        <span class="n">taz_landuse</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">total_column</span><span class="p">,</span> <span class="n">sub_categories</span> <span class="ow">in</span> <span class="n">_land_use_aggregation</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">taz_landuse</span><span class="p">[</span><span class="n">total_column</span><span class="p">]</span> <span class="o">=</span> <span class="n">taz_input_data</span><span class="p">[</span><span class="n">sub_categories</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">taz_landuse</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">taz_landuse</span>

    <span class="nd">@LogStartEnd</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_generate_trip_ends</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">landuse_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate productions and attractions by class based on landuse and truck trip rates.</span>

<span class="sd">        Args:</span>
<span class="sd">            landuse_df (pd.DataFrame): DataFrame with aggregated landuse data.</span>
<span class="sd">                Expected columns for landuse are: AGREMPN, RETEMPN, FPSEMPN, HEREMPN,</span>
<span class="sd">                MWTEMPN, OTHEMPN, TOTEMP, TOTHH</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: DataFrame with unbalanced production and attraction trip ends.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tripends_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="n">_class_pa</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span><span class="p">,</span>
            <span class="p">[</span><span class="s2">&quot;production_formula&quot;</span><span class="p">,</span> <span class="s2">&quot;attraction_formula&quot;</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="c1"># TODO Do this with multi-indexing rather than relying on column naming</span>

        <span class="k">for</span> <span class="n">_c</span><span class="p">,</span> <span class="n">_pa</span> <span class="ow">in</span> <span class="n">_class_pa</span><span class="p">:</span>
            <span class="n">_trip_type</span> <span class="o">=</span> <span class="n">_c</span><span class="o">.</span><span class="n">purpose</span>
            <span class="n">_trk_class</span> <span class="o">=</span> <span class="n">_c</span><span class="o">.</span><span class="n">name</span>

            <span class="k">if</span> <span class="n">_pa</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_formula&quot;</span><span class="p">):</span>
                <span class="n">_pa_short</span> <span class="o">=</span> <span class="n">_pa</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># linked trips (non-garage-based) - attractions (equal productions)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">_trip_type</span> <span class="o">==</span> <span class="s2">&quot;linked&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">_pa_short</span> <span class="o">==</span> <span class="s2">&quot;attraction&quot;</span><span class="p">):</span>
                <span class="n">tripends_df</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_trip_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">_trk_class</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">_pa_short</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tripends_df</span><span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_trip_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">_trk_class</span><span class="si">}</span><span class="s2">_productions&quot;</span>
                <span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_constant</span> <span class="o">=</span> <span class="n">_c</span><span class="p">[</span><span class="n">_pa</span><span class="p">]</span><span class="o">.</span><span class="n">constant</span>
                <span class="n">_multiplier</span> <span class="o">=</span> <span class="n">_c</span><span class="p">[</span><span class="n">_pa</span><span class="p">]</span><span class="o">.</span><span class="n">multiplier</span>

                <span class="n">land_use_rates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">_c</span><span class="p">[</span><span class="n">_pa</span><span class="p">]</span><span class="o">.</span><span class="n">land_use_rates</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
                <span class="n">land_use_rates</span> <span class="o">=</span> <span class="n">land_use_rates</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
                    <span class="n">columns</span><span class="o">=</span><span class="n">land_use_rates</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;property&quot;</span><span class="p">]</span>
                <span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;property&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

                <span class="n">_rate_trips_df</span> <span class="o">=</span> <span class="n">landuse_df</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">land_use_rates</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">_trips_df</span> <span class="o">=</span> <span class="n">_rate_trips_df</span> <span class="o">*</span> <span class="n">_multiplier</span> <span class="o">+</span> <span class="n">_constant</span>

                <span class="c1"># TODO fix this at the source</span>
                <span class="c1"># at this point our data frame is completely object types (not numeric) </span>
                <span class="c1"># it is a series of float objects not a float series</span>
                <span class="c1"># for now we can call pd to_numeric but maybe fix at source if it causes errors</span>
                <span class="c1"># update: this is because pandas 2.x is stricter about types</span>
                <span class="n">tripends_df</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_trip_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">_trk_class</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">_pa_short</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span>
                    <span class="n">_trips_df</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">tripends_df</span>

    <span class="nd">@LogStartEnd</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_balance_pa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tripends_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Balance production and attractions.</span>

<span class="sd">        Args:</span>
<span class="sd">            tripends_df (pd.DataFrame): DataFrame with unbalanced production and attraction</span>
<span class="sd">                trip ends.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: DataFrame with balanced production and attraction trip ends.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">_c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span><span class="p">:</span>
            <span class="n">_trip_type</span> <span class="o">=</span> <span class="n">_c</span><span class="o">.</span><span class="n">purpose</span>
            <span class="n">_trk_class</span> <span class="o">=</span> <span class="n">_c</span><span class="o">.</span><span class="n">name</span>
            <span class="n">_balance_to</span> <span class="o">=</span> <span class="n">_c</span><span class="o">.</span><span class="n">balance_to</span>

            <span class="n">_tots</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;attractions&quot;</span><span class="p">:</span> <span class="n">tripends_df</span><span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_trip_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">_trk_class</span><span class="si">}</span><span class="s2">_attractions&quot;</span>
                <span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
                <span class="s2">&quot;productions&quot;</span><span class="p">:</span> <span class="n">tripends_df</span><span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_trip_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">_trk_class</span><span class="si">}</span><span class="s2">_productions&quot;</span>
                <span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
            <span class="p">}</span>

            <span class="c1"># if productions OR attractions are zero, fill one with other</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_tots</span><span class="p">[</span><span class="s2">&quot;attractions&quot;</span><span class="p">]:</span>
                <span class="n">tripends_df</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_trip_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">_trk_class</span><span class="si">}</span><span class="s2">_attractions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tripends_df</span><span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_trip_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">_trk_class</span><span class="si">}</span><span class="s2">_productions&quot;</span>
                <span class="p">]</span>

            <span class="k">elif</span> <span class="ow">not</span> <span class="n">_tots</span><span class="p">[</span><span class="s2">&quot;productions&quot;</span><span class="p">]:</span>
                <span class="n">tripends_df</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_trip_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">_trk_class</span><span class="si">}</span><span class="s2">_productions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tripends_df</span><span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_trip_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">_trk_class</span><span class="si">}</span><span class="s2">_attractions&quot;</span>
                <span class="p">]</span>

            <span class="c1"># otherwise balance based on sums</span>
            <span class="k">elif</span> <span class="n">_balance_to</span> <span class="o">==</span> <span class="s2">&quot;productions&quot;</span><span class="p">:</span>
                <span class="n">tripends_df</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_trip_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">_trk_class</span><span class="si">}</span><span class="s2">_attractions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tripends_df</span><span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_trip_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">_trk_class</span><span class="si">}</span><span class="s2">_attractions&quot;</span>
                <span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">_tots</span><span class="p">[</span><span class="s2">&quot;productions&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">_tots</span><span class="p">[</span><span class="s2">&quot;attractions&quot;</span><span class="p">])</span>

            <span class="k">elif</span> <span class="n">_balance_to</span> <span class="o">==</span> <span class="s2">&quot;attractions&quot;</span><span class="p">:</span>
                <span class="n">tripends_df</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_trip_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">_trk_class</span><span class="si">}</span><span class="s2">_productions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tripends_df</span><span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_trip_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">_trk_class</span><span class="si">}</span><span class="s2">_productions&quot;</span>
                <span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">_tots</span><span class="p">[</span><span class="s2">&quot;attractions&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">_tots</span><span class="p">[</span><span class="s2">&quot;productions&quot;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_balance_to</span><span class="si">}</span><span class="s2"> is not a valid balance_to value&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tripends_df</span>

    <span class="nd">@LogStartEnd</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_aggregate_by_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tripends_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sum tripends by class across trip purpose.</span>

<span class="sd">        Args:</span>
<span class="sd">            tripends_df (pd.DataFrame): DataFrame with balanced production and attraction</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: DataFrame with aggregated tripends by truck class. Returned columns are:</span>
<span class="sd">                vsmtrk_prod, vsmtrk_attr,</span>
<span class="sd">                smltrk_prod, smltrk_attr,</span>
<span class="sd">                medtrk_prod, medtrk_attr,</span>
<span class="sd">                lrgtrk_prod, lrgtrk_attr</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">agg_tripends_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="n">_class_pa</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">classes</span><span class="p">,</span>
            <span class="p">[</span><span class="s2">&quot;productions&quot;</span><span class="p">,</span> <span class="s2">&quot;attractions&quot;</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">_trk_class</span><span class="p">,</span> <span class="n">_pa</span> <span class="ow">in</span> <span class="n">_class_pa</span><span class="p">:</span>
            <span class="n">_sum_cols</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">tripends_df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">_trk_class</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">_pa</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="n">agg_tripends_df</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_trk_class</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">_pa</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
                <span class="n">tripends_df</span><span class="p">[</span><span class="n">_sum_cols</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="n">agg_tripends_df</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">agg_tripends_df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">to_string</span><span class="p">(),</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">agg_tripends_df</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tm2py.components.demand.commercial.CommercialVehicleTripGeneration.__init__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">component</span><span class="p">)</span></code>

<a href="#tm2py.components.demand.commercial.CommercialVehicleTripGeneration.__init__" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Constructor for the CommercialVehicleTripGeneration component.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>controller</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="RunController (tm2py.controller.RunController)" href="#tm2py.controller.RunController">RunController</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Run controller for model run.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>component</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Component (tm2py.components.component.Component)" href="#tm2py.components.component.Component">Component</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parent component of sub-component</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">,</span> <span class="n">component</span><span class="p">:</span> <span class="n">Component</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Constructor for the CommercialVehicleTripGeneration component.</span>

<span class="sd">    Args:</span>
<span class="sd">        controller (RunController): Run controller for model run.</span>
<span class="sd">        component (Component): Parent component of sub-component</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">component</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">trip_gen</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.demand.commercial.CommercialVehicleTripGeneration.run" class="doc doc-heading">
            <code class=" language-python"><span class="n">run</span><span class="p">()</span></code>

<a href="#tm2py.components.demand.commercial.CommercialVehicleTripGeneration.run" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Run commercial vehicle trip distribution.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@LogStartEnd</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run commercial vehicle trip distribution.&quot;&quot;&quot;</span>
    <span class="n">_landuse_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggregate_landuse</span><span class="p">()</span>
    <span class="n">_unbalanced_tripends_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_trip_ends</span><span class="p">(</span><span class="n">_landuse_df</span><span class="p">)</span>
    <span class="n">_balanced_tripends_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_balance_pa</span><span class="p">(</span><span class="n">_unbalanced_tripends_df</span><span class="p">)</span>
    <span class="n">total_tripends_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggregate_by_class</span><span class="p">(</span><span class="n">_balanced_tripends_df</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">total_tripends_df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.demand.commercial.CommercialVehicleTripGeneration.validate_inputs" class="doc doc-heading">
            <code class=" language-python"><span class="n">validate_inputs</span><span class="p">()</span></code>

<a href="#tm2py.components.demand.commercial.CommercialVehicleTripGeneration.validate_inputs" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Validate the inputs.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate the inputs.&quot;&quot;&quot;</span>
    <span class="c1"># TODO</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<a id="tm2py.config.TruckConfig"></a>
    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Truck model parameters.</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TruckConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Truck model parameters.&quot;&quot;&quot;</span>

    <span class="n">classes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">TruckClassConfig</span><span class="p">]</span>
    <span class="n">impedances</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ImpedanceConfig</span><span class="p">]</span>
    <span class="n">trip_gen</span><span class="p">:</span> <span class="n">TripGenerationConfig</span>
    <span class="n">trip_dist</span><span class="p">:</span> <span class="n">TripDistributionConfig</span>
    <span class="n">time_of_day</span><span class="p">:</span> <span class="n">TimeOfDayConfig</span>
    <span class="n">toll_choice</span><span class="p">:</span> <span class="n">TollChoiceConfig</span>
    <span class="n">output_trip_table_directory</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">outfile_trip_table_tmp</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">highway_demand_file</span><span class="p">:</span> <span class="nb">str</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    @validator(&quot;classes&quot;)</span>
<span class="sd">    def class_consistency(cls, v, values):</span>
<span class="sd">        # TODO Can&#39;t get to work righ tnow</span>
<span class="sd">        _class_names = [c.name for c in v]</span>
<span class="sd">        _gen_classes = [c.name for c in values[&quot;trip_gen&quot;]]</span>
<span class="sd">        _dist_classes = [c.name for c in values[&quot;trip_dist&quot;]]</span>
<span class="sd">        _time_classes = [c.name for c in values[&quot;time_split&quot;]]</span>
<span class="sd">        _toll_classes = [c.name for c in values[&quot;toll_choice&quot;]]</span>

<span class="sd">        assert (</span>
<span class="sd">            _class_names == _gen_classes</span>
<span class="sd">        ), &quot;truck.classes ({_class_names}) doesn&#39;t equal\</span>
<span class="sd">            class names in truck.trip_gen ({_gen_classes}).&quot;</span>
<span class="sd">        assert (</span>
<span class="sd">            _class_names == _dist_classes</span>
<span class="sd">        ), &quot;truck.classes ({_class_names}) doesn&#39;t  equal\</span>
<span class="sd">            class names in truck.trip_dist ({_dist_classes}).&quot;</span>
<span class="sd">        assert (</span>
<span class="sd">            _class_names == _time_classes</span>
<span class="sd">        ), &quot;truck.classes ({_class_names}) doesn&#39;t  equal\</span>
<span class="sd">            class names in truck.time_split ({_time_classes}).&quot;</span>
<span class="sd">        assert (</span>
<span class="sd">            _class_names == _toll_classes</span>
<span class="sd">        ), &quot;truck.classes ({_class_names}) doesn&#39;t equal\</span>
<span class="sd">            class names in truck.toll_choice ({_toll_classes}).&quot;</span>

<span class="sd">        return v</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h2 id="tm2py.config.TruckConfig.highway_demand_file" class="doc doc-heading">
            <code class=" language-python"><span class="n">highway_demand_file</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#tm2py.config.TruckConfig.highway_demand_file" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">

      <p>@validator(&ldquo;classes&rdquo;)
def class_consistency(cls, v, values):
    # TODO Can&rsquo;t get to work righ tnow
    _class_names = [c.name for c in v]
    _gen_classes = [c.name for c in values[&ldquo;trip_gen&rdquo;]]
    _dist_classes = [c.name for c in values[&ldquo;trip_dist&rdquo;]]
    _time_classes = [c.name for c in values[&ldquo;time_split&rdquo;]]
    _toll_classes = [c.name for c in values[&ldquo;toll_choice&rdquo;]]</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nx">assert</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">_class_names</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">_gen_classes</span>
<span class="p">),</span><span class="w"> </span><span class="s">&quot;truck.classes ({_class_names}) doesn&#39;t equal            class names in truck.trip_gen ({_gen_classes}).&quot;</span>
<span class="nx">assert</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">_class_names</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">_dist_classes</span>
<span class="p">),</span><span class="w"> </span><span class="s">&quot;truck.classes ({_class_names}) doesn&#39;t  equal            class names in truck.trip_dist ({_dist_classes}).&quot;</span>
<span class="nx">assert</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">_class_names</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">_time_classes</span>
<span class="p">),</span><span class="w"> </span><span class="s">&quot;truck.classes ({_class_names}) doesn&#39;t  equal            class names in truck.time_split ({_time_classes}).&quot;</span>
<span class="nx">assert</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">_class_names</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">_toll_classes</span>
<span class="p">),</span><span class="w"> </span><span class="s">&quot;truck.classes ({_class_names}) doesn&#39;t equal            class names in truck.toll_choice ({_toll_classes}).&quot;</span>

<span class="k">return</span><span class="w"> </span><span class="nx">v</span>
</code></pre></div></td></tr></table></div>
    </div>

</div>





  </div>

    </div>

</div><h4 id="inter-regional-demand">Inter-regional Demand<a class="headerlink" href="#inter-regional-demand" title="Permanent link"> </a></h4>


<div class="doc doc-object doc-module">



<a id="tm2py.components.demand.internal_external"></a>
    <div class="doc doc-contents first">

      <p>Module containing Internal &lt;-&gt; External trip model.</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="tm2py.components.demand.internal_external.ExternalDemand" class="doc doc-heading">
            <code>ExternalDemand</code>


<a href="#tm2py.components.demand.internal_external.ExternalDemand" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="Subcomponent (tm2py.components.component.Subcomponent)" href="#tm2py.components.component.Subcomponent">Subcomponent</a></code></p>


      <p>Forecast of daily internal&lt;-&gt;external demand based on growth from a base year.</p>
<p>Create a daily matrix that includes internal/external, external/internal,
and external/external passenger vehicle travel (based on Census 2000 journey-to-work flows).
These trip tables are based on total traffic counts, which include trucks, but trucks are
not explicitly segmented from passenger vehicles.  This short-coming is a hold-over from
BAYCAST and will be addressed in the next model update.</p>
<p>The row and column totals are taken from count station data provided by Caltrans.  The
BAYCAST 2006 IX matrix is used as the base matrix and scaled to match forecast year growth
assumptions. The script generates estimates for the model forecast year; the growth rates
were discussed with neighboring MPOs as part of the SB 375 target setting process.</p>
<p>Input:  (1)  Station-specific assumed growth rates for each forecast year (the lack of
              external/external movements through the region allows simple factoring of
              cells without re-balancing);
         (2)  An input base matrix derived from the Census journey-to-work data.</p>
<p>Output: (1) Four-table, forecast-year specific trip tables containing internal/external,
             external/internal, and external/external vehicle (xxx or person xxx) travel.</p>
<p>Governed by class DemandGrowth Config:
<div class="highlight"><pre><span></span><code>    highway_demand_file:
    input_demand_file:
    input_demand_matrixname_tmpl:
    modes:
    reference_year:
    annual_growth_rate:
    special_gateway_adjust:
</code></pre></div></p>

              <details class="quote">
                <summary>Source code in <code>tm2py/components/demand/internal_external.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ExternalDemand</span><span class="p">(</span><span class="n">Subcomponent</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Forecast of daily internal&lt;-&gt;external demand based on growth from a base year.</span>

<span class="sd">    Create a daily matrix that includes internal/external, external/internal,</span>
<span class="sd">    and external/external passenger vehicle travel (based on Census 2000 journey-to-work flows).</span>
<span class="sd">    These trip tables are based on total traffic counts, which include trucks, but trucks are</span>
<span class="sd">    not explicitly segmented from passenger vehicles.  This short-coming is a hold-over from</span>
<span class="sd">    BAYCAST and will be addressed in the next model update.</span>

<span class="sd">    The row and column totals are taken from count station data provided by Caltrans.  The</span>
<span class="sd">    BAYCAST 2006 IX matrix is used as the base matrix and scaled to match forecast year growth</span>
<span class="sd">    assumptions. The script generates estimates for the model forecast year; the growth rates</span>
<span class="sd">    were discussed with neighboring MPOs as part of the SB 375 target setting process.</span>

<span class="sd">     Input:  (1)  Station-specific assumed growth rates for each forecast year (the lack of</span>
<span class="sd">                  external/external movements through the region allows simple factoring of</span>
<span class="sd">                  cells without re-balancing);</span>
<span class="sd">             (2)  An input base matrix derived from the Census journey-to-work data.</span>

<span class="sd">     Output: (1) Four-table, forecast-year specific trip tables containing internal/external,</span>
<span class="sd">                 external/internal, and external/external vehicle (xxx or person xxx) travel.</span>


<span class="sd">    Governed by class DemandGrowth Config:</span>
<span class="sd">    ```</span>
<span class="sd">        highway_demand_file:</span>
<span class="sd">        input_demand_file:</span>
<span class="sd">        input_demand_matrixname_tmpl:</span>
<span class="sd">        modes:</span>
<span class="sd">        reference_year:</span>
<span class="sd">        annual_growth_rate:</span>
<span class="sd">        special_gateway_adjust:</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">,</span> <span class="n">component</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">component</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">demand</span>
        <span class="c1"># Loaded lazily</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_demand</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">year</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">scenario</span><span class="o">.</span><span class="n">year</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">modes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">classes</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">input_demand_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">input_demand_file</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">base_demand</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_base_demand</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_load_base_demand</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_base_demand</span>

    <span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># TODO</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_load_base_demand</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load reference matrices from .omx to self._base_demand</span>

<span class="sd">        input file template: self.config.internal_external.input_demand_matrixname_tmpl</span>
<span class="sd">        modes: self.config.internal_external.modes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_mx_name_tmpl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">input_demand_matrixname_tmpl</span>
        <span class="n">_matrices</span> <span class="o">=</span> <span class="p">{</span><span class="n">m</span><span class="p">:</span> <span class="n">_mx_name_tmpl</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_base_demand</span> <span class="o">=</span> <span class="n">omx_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_demand_file</span><span class="p">,</span> <span class="n">matrices</span><span class="o">=</span><span class="n">_matrices</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_demand</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate adjusted demand based on scenario year and growth rates.</span>

<span class="sd">        Steps:</span>
<span class="sd">        - 1.1 apply special factors to certain gateways based on ID</span>
<span class="sd">        - 1.2 apply gateway-specific annual growth rates to results of step 1</span>
<span class="sd">           to generate year specific forecast</span>

<span class="sd">        Args:</span>
<span class="sd">            demand: dictionary of input daily demand matrices (numpy arrays)</span>

<span class="sd">        Returns:</span>
<span class="sd">             Dictionary of Numpy matrices of daily PA by class mode</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Build adjustment matrix to be applied to all input matrices</span>
        <span class="c1"># special gateway adjustments based on zone index</span>
        <span class="k">if</span> <span class="n">base_demand</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">base_demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_demand</span>
        <span class="n">_num_years</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">year</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">reference_year</span>
        <span class="n">_adj_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">base_demand</span><span class="p">[</span><span class="s2">&quot;da&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="n">_adj_matrix</span> <span class="o">=</span> <span class="n">create_matrix_factors</span><span class="p">(</span>
            <span class="n">default_matrix</span><span class="o">=</span><span class="n">_adj_matrix</span><span class="p">,</span>
            <span class="n">matrix_factors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">special_gateway_adjust</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">_adj_matrix</span> <span class="o">=</span> <span class="n">create_matrix_factors</span><span class="p">(</span>
            <span class="n">default_matrix</span><span class="o">=</span><span class="n">_adj_matrix</span><span class="p">,</span>
            <span class="n">matrix_factors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">annual_growth_rate</span><span class="p">,</span>
            <span class="n">periods</span><span class="o">=</span><span class="n">_num_years</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">daily_prod_attract</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="p">(</span><span class="n">_mode</span><span class="p">,</span> <span class="n">_demand</span> <span class="o">*</span> <span class="n">_adj_matrix</span><span class="p">)</span> <span class="k">for</span> <span class="n">_mode</span><span class="p">,</span> <span class="n">_demand</span> <span class="ow">in</span> <span class="n">base_demand</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">daily_prod_attract</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tm2py.components.demand.internal_external.ExternalDemand.run" class="doc doc-heading">
            <code class=" language-python"><span class="n">run</span><span class="p">(</span><span class="n">base_demand</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#tm2py.components.demand.internal_external.ExternalDemand.run" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Calculate adjusted demand based on scenario year and growth rates.</p>
<p>Steps:
- 1.1 apply special factors to certain gateways based on ID
- 1.2 apply gateway-specific annual growth rates to results of step 1
   to generate year specific forecast</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>demand</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dictionary of input daily demand matrices (numpy arrays)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="tm2py.components.demand.internal_external.NumpyArray">NumpyArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary of Numpy matrices of daily PA by class mode</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/demand/internal_external.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_demand</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate adjusted demand based on scenario year and growth rates.</span>

<span class="sd">    Steps:</span>
<span class="sd">    - 1.1 apply special factors to certain gateways based on ID</span>
<span class="sd">    - 1.2 apply gateway-specific annual growth rates to results of step 1</span>
<span class="sd">       to generate year specific forecast</span>

<span class="sd">    Args:</span>
<span class="sd">        demand: dictionary of input daily demand matrices (numpy arrays)</span>

<span class="sd">    Returns:</span>
<span class="sd">         Dictionary of Numpy matrices of daily PA by class mode</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Build adjustment matrix to be applied to all input matrices</span>
    <span class="c1"># special gateway adjustments based on zone index</span>
    <span class="k">if</span> <span class="n">base_demand</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">base_demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_demand</span>
    <span class="n">_num_years</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">year</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">reference_year</span>
    <span class="n">_adj_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">base_demand</span><span class="p">[</span><span class="s2">&quot;da&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="n">_adj_matrix</span> <span class="o">=</span> <span class="n">create_matrix_factors</span><span class="p">(</span>
        <span class="n">default_matrix</span><span class="o">=</span><span class="n">_adj_matrix</span><span class="p">,</span>
        <span class="n">matrix_factors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">special_gateway_adjust</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">_adj_matrix</span> <span class="o">=</span> <span class="n">create_matrix_factors</span><span class="p">(</span>
        <span class="n">default_matrix</span><span class="o">=</span><span class="n">_adj_matrix</span><span class="p">,</span>
        <span class="n">matrix_factors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">annual_growth_rate</span><span class="p">,</span>
        <span class="n">periods</span><span class="o">=</span><span class="n">_num_years</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">daily_prod_attract</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="p">(</span><span class="n">_mode</span><span class="p">,</span> <span class="n">_demand</span> <span class="o">*</span> <span class="n">_adj_matrix</span><span class="p">)</span> <span class="k">for</span> <span class="n">_mode</span><span class="p">,</span> <span class="n">_demand</span> <span class="ow">in</span> <span class="n">base_demand</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">daily_prod_attract</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.components.demand.internal_external.ExternalTollChoice" class="doc doc-heading">
            <code>ExternalTollChoice</code>


<a href="#tm2py.components.demand.internal_external.ExternalTollChoice" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="Subcomponent (tm2py.components.component.Subcomponent)" href="#tm2py.components.component.Subcomponent">Subcomponent</a></code></p>


      <h4 id="tm2py.components.demand.internal_external.ExternalTollChoice--toll-choice">Toll choice<a class="headerlink" href="#tm2py.components.demand.internal_external.ExternalTollChoice--toll-choice" title="Permanent link"> </a></h4>
<p>Apply a binomial choice model for drive alone, shared ride 2, and shared ride 3
internal/external personal vehicle travel.</p>


<details class="input" open>
  <summary>(1) Time-period-specific origin/destination matrices of drive alone, shared ride 2,</summary>
  <p>and share ride 3+ internal/external trip tables.</p>
</details>      <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div><pre><span></span><code>    (2) Skims providing the time and cost for value toll and non-value toll paths for each

        traffic_skims_{period}.omx, where {period} is the time period ID,
        {class} is the class name da, sr2, sr2, with the following matrix names
          Non-value-toll paying time: {period}_{class}_time,
          Non-value-toll distance: {period}_{class}_dist,
          Non-value-toll bridge toll is: {period}_{class}_bridgetoll_{class},
          Value-toll paying time is: {period}_{class}toll_time,
          Value-toll paying distance is: {period}_{class}toll_dist,
          Value-toll bridge toll is: {period}_{class}toll_bridgetoll_{class},
          Value-toll value toll is: {period}_{class}toll_valuetoll_{class},
</code></pre></div></td></tr></table></div>

<p>Output: Five, six-table trip matrices, one for each time period.  Two tables for each vehicle
         class representing value-toll paying path trips and non-value-toll paying path trips</p>
<p>Governed by TollClassConfig:</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="s">```</span>
classes:
value_of_time:
operating_cost_per_mile:
property_to_skim_toll:
property_to_skim_notoll:
utility:
<span class="s">```</span>
</code></pre></div></td></tr></table></div>

              <details class="quote">
                <summary>Source code in <code>tm2py/components/demand/internal_external.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ExternalTollChoice</span><span class="p">(</span><span class="n">Subcomponent</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Toll choice</span>
<span class="sd">    -----------</span>
<span class="sd">    Apply a binomial choice model for drive alone, shared ride 2, and shared ride 3</span>
<span class="sd">    internal/external personal vehicle travel.</span>

<span class="sd">    Input:  (1) Time-period-specific origin/destination matrices of drive alone, shared ride 2,</span>
<span class="sd">                and share ride 3+ internal/external trip tables.</span>
<span class="sd">            (2) Skims providing the time and cost for value toll and non-value toll paths for each</span>

<span class="sd">                traffic_skims_{period}.omx, where {period} is the time period ID,</span>
<span class="sd">                {class} is the class name da, sr2, sr2, with the following matrix names</span>
<span class="sd">                  Non-value-toll paying time: {period}_{class}_time,</span>
<span class="sd">                  Non-value-toll distance: {period}_{class}_dist,</span>
<span class="sd">                  Non-value-toll bridge toll is: {period}_{class}_bridgetoll_{class},</span>
<span class="sd">                  Value-toll paying time is: {period}_{class}toll_time,</span>
<span class="sd">                  Value-toll paying distance is: {period}_{class}toll_dist,</span>
<span class="sd">                  Value-toll bridge toll is: {period}_{class}toll_bridgetoll_{class},</span>
<span class="sd">                  Value-toll value toll is: {period}_{class}toll_valuetoll_{class},</span>

<span class="sd">     Output: Five, six-table trip matrices, one for each time period.  Two tables for each vehicle</span>
<span class="sd">             class representing value-toll paying path trips and non-value-toll paying path trips</span>

<span class="sd">    Governed by TollClassConfig:</span>

<span class="sd">        ```</span>
<span class="sd">        classes:</span>
<span class="sd">        value_of_time:</span>
<span class="sd">        operating_cost_per_mile:</span>
<span class="sd">        property_to_skim_toll:</span>
<span class="sd">        property_to_skim_notoll:</span>
<span class="sd">        utility:</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">,</span> <span class="n">component</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">component</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">toll_choice</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;toll choice calculator&quot;</span><span class="p">:</span> <span class="n">TollChoiceCalculator</span><span class="p">(</span>
                <span class="n">controller</span><span class="p">,</span> <span class="n">component</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span>
            <span class="p">),</span>
        <span class="p">}</span>

        <span class="c1"># shortcut</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_toll_choice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span><span class="p">[</span><span class="s2">&quot;toll choice calculator&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_toll_choice</span><span class="o">.</span><span class="n">toll_skim_suffix</span> <span class="o">=</span> <span class="s2">&quot;trk&quot;</span>

    <span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># TODO</span>
        <span class="k">pass</span>

    <span class="nd">@LogStartEnd</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">period_demand</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Binary toll / non-toll choice model by class.</span>

<span class="sd">        input: result of _ix_time_of_day</span>
<span class="sd">        skims:</span>
<span class="sd">            traffic_skims_{period}.omx, where {period} is the time period ID,</span>
<span class="sd">            {class} is the class name da, sr2, sr2, with the following matrix names</span>
<span class="sd">              Non-value-toll paying time: {period}_{class}_time,</span>
<span class="sd">              Non-value-toll distance: {period}_{class}_dist,</span>
<span class="sd">              Non-value-toll bridge toll is: {period}_{class}_bridgetoll_{class},</span>
<span class="sd">              Value-toll paying time is: {period}_{class}toll_time,</span>
<span class="sd">              Value-toll paying distance is: {period}_{class}toll_dist,</span>
<span class="sd">              Value-toll bridge toll is: {period}_{class}toll_bridgetoll_{class},</span>
<span class="sd">              Value-toll value toll is: {period}_{class}toll_valuetoll_{class},</span>

<span class="sd">        STEPS:</span>
<span class="sd">        3.1: For each time of day, for each da, sr2, sr3, calculate</span>
<span class="sd">             - utility of toll and nontoll</span>
<span class="sd">             - probability of toll / nontoll</span>
<span class="sd">             - split demand into toll and nontoll matrices</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">_time_class_combos</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">classes</span>
        <span class="p">)</span>

        <span class="n">class_demands</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">_time_period</span><span class="p">,</span> <span class="n">_class</span> <span class="ow">in</span> <span class="n">_time_class_combos</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_time_period</span> <span class="ow">in</span> <span class="n">period_demand</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="kc">None</span>
            <span class="k">elif</span> <span class="n">_time_period</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">period_demand</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">_time_period</span> <span class="o">=</span> <span class="n">_time_period</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">_time_period</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">period_demand</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">_time_period</span> <span class="o">=</span> <span class="n">_time_period</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Period </span><span class="si">{</span><span class="n">_time_period</span><span class="si">}</span><span class="s2"> not an available time period.</span><span class="se">\</span>
<span class="s2">                    Available periods are:  </span><span class="si">{</span><span class="n">period_demand</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

            <span class="n">_split_demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toll_choice</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                <span class="n">period_demand</span><span class="p">[</span><span class="n">_time_period</span><span class="p">][</span><span class="n">_class</span><span class="p">],</span> <span class="n">_class</span><span class="p">,</span> <span class="n">_time_period</span>
            <span class="p">)</span>

            <span class="n">class_demands</span><span class="p">[</span><span class="n">_time_period</span><span class="p">][</span><span class="n">_class</span><span class="p">]</span> <span class="o">=</span> <span class="n">_split_demand</span><span class="p">[</span><span class="s2">&quot;non toll&quot;</span><span class="p">]</span>
            <span class="n">class_demands</span><span class="p">[</span><span class="n">_time_period</span><span class="p">][</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_class</span><span class="si">}</span><span class="s2">toll&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_split_demand</span><span class="p">[</span><span class="s2">&quot;toll&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">class_demands</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tm2py.components.demand.internal_external.ExternalTollChoice.run" class="doc doc-heading">
            <code class=" language-python"><span class="n">run</span><span class="p">(</span><span class="n">period_demand</span><span class="p">)</span></code>

<a href="#tm2py.components.demand.internal_external.ExternalTollChoice.run" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Binary toll / non-toll choice model by class.</p>
<p>input: result of <em>ix_time_of_day
skims:
    traffic_skims</em>{period}.omx, where {period} is the time period ID,
    {class} is the class name da, sr2, sr2, with the following matrix names
      Non-value-toll paying time: {period}<em>{class}_time,
      Non-value-toll distance: {period}</em>{class}<em>dist,
      Non-value-toll bridge toll is: {period}</em>{class}<em>bridgetoll</em>{class},
      Value-toll paying time is: {period}<em>{class}toll_time,
      Value-toll paying distance is: {period}</em>{class}toll_dist,
      Value-toll bridge toll is: {period}<em>{class}toll_bridgetoll</em>{class},
      Value-toll value toll is: {period}<em>{class}toll_valuetoll</em>{class},</p>
<p>STEPS:
3.1: For each time of day, for each da, sr2, sr3, calculate
     - utility of toll and nontoll
     - probability of toll / nontoll
     - split demand into toll and nontoll matrices</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/demand/internal_external.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@LogStartEnd</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">period_demand</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Binary toll / non-toll choice model by class.</span>

<span class="sd">    input: result of _ix_time_of_day</span>
<span class="sd">    skims:</span>
<span class="sd">        traffic_skims_{period}.omx, where {period} is the time period ID,</span>
<span class="sd">        {class} is the class name da, sr2, sr2, with the following matrix names</span>
<span class="sd">          Non-value-toll paying time: {period}_{class}_time,</span>
<span class="sd">          Non-value-toll distance: {period}_{class}_dist,</span>
<span class="sd">          Non-value-toll bridge toll is: {period}_{class}_bridgetoll_{class},</span>
<span class="sd">          Value-toll paying time is: {period}_{class}toll_time,</span>
<span class="sd">          Value-toll paying distance is: {period}_{class}toll_dist,</span>
<span class="sd">          Value-toll bridge toll is: {period}_{class}toll_bridgetoll_{class},</span>
<span class="sd">          Value-toll value toll is: {period}_{class}toll_valuetoll_{class},</span>

<span class="sd">    STEPS:</span>
<span class="sd">    3.1: For each time of day, for each da, sr2, sr3, calculate</span>
<span class="sd">         - utility of toll and nontoll</span>
<span class="sd">         - probability of toll / nontoll</span>
<span class="sd">         - split demand into toll and nontoll matrices</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_time_class_combos</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">classes</span>
    <span class="p">)</span>

    <span class="n">class_demands</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_time_period</span><span class="p">,</span> <span class="n">_class</span> <span class="ow">in</span> <span class="n">_time_class_combos</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">_time_period</span> <span class="ow">in</span> <span class="n">period_demand</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">_time_period</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">period_demand</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">_time_period</span> <span class="o">=</span> <span class="n">_time_period</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">_time_period</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">period_demand</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">_time_period</span> <span class="o">=</span> <span class="n">_time_period</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Period </span><span class="si">{</span><span class="n">_time_period</span><span class="si">}</span><span class="s2"> not an available time period.</span><span class="se">\</span>
<span class="s2">                Available periods are:  </span><span class="si">{</span><span class="n">period_demand</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="n">_split_demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toll_choice</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
            <span class="n">period_demand</span><span class="p">[</span><span class="n">_time_period</span><span class="p">][</span><span class="n">_class</span><span class="p">],</span> <span class="n">_class</span><span class="p">,</span> <span class="n">_time_period</span>
        <span class="p">)</span>

        <span class="n">class_demands</span><span class="p">[</span><span class="n">_time_period</span><span class="p">][</span><span class="n">_class</span><span class="p">]</span> <span class="o">=</span> <span class="n">_split_demand</span><span class="p">[</span><span class="s2">&quot;non toll&quot;</span><span class="p">]</span>
        <span class="n">class_demands</span><span class="p">[</span><span class="n">_time_period</span><span class="p">][</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_class</span><span class="si">}</span><span class="s2">toll&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_split_demand</span><span class="p">[</span><span class="s2">&quot;toll&quot;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">class_demands</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.components.demand.internal_external.InternalExternal" class="doc doc-heading">
            <code>InternalExternal</code>


<a href="#tm2py.components.demand.internal_external.InternalExternal" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="Component (tm2py.components.component.Component)" href="#tm2py.components.component.Component">Component</a></code></p>


      <p>Develop Internal &lt;-&gt; External trip tables from land use and impedances.</p>
<ol>
<li>Grow demand from base year using static rates ::ExternalDemand</li>
<li>Split by time of day using static factors ::TimePeriodSplit</li>
<li>Apply basic toll binomial choice model: ::ExternalTollChoice</li>
</ol>


<details class="governed-by-internalexternalconfig" open>
  <summary>Governed by InternalExternalConfig</summary>
  
</details>
              <details class="quote">
                <summary>Source code in <code>tm2py/components/demand/internal_external.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">InternalExternal</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Develop Internal &lt;-&gt; External trip tables from land use and impedances.</span>

<span class="sd">    1. Grow demand from base year using static rates ::ExternalDemand</span>
<span class="sd">    2. Split by time of day using static factors ::TimePeriodSplit</span>
<span class="sd">    3. Apply basic toll binomial choice model: ::ExternalTollChoice</span>

<span class="sd">    Governed by InternalExternalConfig:</span>
<span class="sd">        highway_demand_file:</span>
<span class="sd">        input_demand_file:</span>
<span class="sd">        input_demand_matrixname_tmpl:</span>
<span class="sd">        modes:</span>
<span class="sd">        reference_year:</span>
<span class="sd">        annual_growth_rate: List[MatrixFactorConfig]</span>
<span class="sd">        time_of_day: TimeOfDayConfig</span>
<span class="sd">        toll_choice: TollChoiceConfig</span>
<span class="sd">        special_gateway_adjust: Optional[List[MatrixFactorConfig]]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="s2">&quot;RunController&quot;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">internal_external</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;demand forecast&quot;</span><span class="p">:</span> <span class="n">ExternalDemand</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="bp">self</span><span class="p">),</span>
            <span class="s2">&quot;time of day&quot;</span><span class="p">:</span> <span class="n">TimePeriodSplit</span><span class="p">(</span>
                <span class="n">controller</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">time_of_day</span><span class="o">.</span><span class="n">classes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">time_period_split</span>
            <span class="p">),</span>
            <span class="s2">&quot;toll choice&quot;</span><span class="p">:</span> <span class="n">ExternalTollChoice</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="bp">self</span><span class="p">),</span>
        <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">classes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">modes</span>

    <span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate inputs to component.&quot;&quot;&quot;</span>
        <span class="c1">## TODO</span>
        <span class="k">pass</span>

    <span class="nd">@LogStartEnd</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run internal/external travel demand component.&quot;&quot;&quot;</span>

        <span class="n">daily_demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span><span class="p">[</span><span class="s2">&quot;demand forecast&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="n">period_demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span><span class="p">[</span><span class="s2">&quot;time of day&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">daily_demand</span><span class="p">)</span>
        <span class="n">class_demands</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span><span class="p">[</span><span class="s2">&quot;toll choice&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">period_demand</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_export_results</span><span class="p">(</span><span class="n">class_demands</span><span class="p">)</span>

    <span class="nd">@LogStartEnd</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_export_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">demand</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Export assignable class demands to OMX files by time-of-day.&quot;&quot;&quot;</span>
        <span class="n">outdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">output_trip_table_directory</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">period</span><span class="p">,</span> <span class="n">matrices</span> <span class="ow">in</span> <span class="n">demand</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">with</span> <span class="n">OMXManager</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="n">outdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">outfile_trip_table_tmp</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="n">period</span><span class="p">)</span>
                <span class="p">),</span>
                <span class="s2">&quot;w&quot;</span><span class="p">,</span>
            <span class="p">)</span> <span class="k">as</span> <span class="n">output_file</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">matrices</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">output_file</span><span class="o">.</span><span class="n">write_array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tm2py.components.demand.internal_external.InternalExternal.run" class="doc doc-heading">
            <code class=" language-python"><span class="n">run</span><span class="p">()</span></code>

<a href="#tm2py.components.demand.internal_external.InternalExternal.run" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Run internal/external travel demand component.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/demand/internal_external.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@LogStartEnd</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run internal/external travel demand component.&quot;&quot;&quot;</span>

    <span class="n">daily_demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span><span class="p">[</span><span class="s2">&quot;demand forecast&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">period_demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span><span class="p">[</span><span class="s2">&quot;time of day&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">daily_demand</span><span class="p">)</span>
    <span class="n">class_demands</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span><span class="p">[</span><span class="s2">&quot;toll choice&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">period_demand</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_export_results</span><span class="p">(</span><span class="n">class_demands</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.demand.internal_external.InternalExternal.validate_inputs" class="doc doc-heading">
            <code class=" language-python"><span class="n">validate_inputs</span><span class="p">()</span></code>

<a href="#tm2py.components.demand.internal_external.InternalExternal.validate_inputs" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Validate inputs to component.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/demand/internal_external.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate inputs to component.&quot;&quot;&quot;</span>
    <span class="c1">## TODO</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<a id="tm2py.config.InternalExternalConfig"></a>
    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Internal &lt;-&gt; External model parameters.</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">InternalExternalConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Internal &lt;-&gt; External model parameters.&quot;&quot;&quot;</span>

    <span class="n">output_trip_table_directory</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">outfile_trip_table_tmp</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">highway_demand_file</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">modes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">demand</span><span class="p">:</span> <span class="n">DemandGrowth</span>
    <span class="n">time_of_day</span><span class="p">:</span> <span class="n">TimeOfDayConfig</span>
    <span class="n">toll_choice</span><span class="p">:</span> <span class="n">TollChoiceConfig</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div><h4 id="visitor-demand">Visitor Demand<a class="headerlink" href="#visitor-demand" title="Permanent link"> </a></h4>


<div class="doc doc-object doc-module">



<a id="tm2py.components.demand.visitor"></a>
    <div class="doc doc-contents first">

      <p>Visitor module.</p>

    </div>

</div><h3 id="highway-network-components">Highway Network Components<a class="headerlink" href="#highway-network-components" title="Permanent link"> </a></h3>


<div class="doc doc-object doc-module">



<a id="tm2py.components.network.highway.highway_network"></a>
    <div class="doc doc-contents first">

      <p>Module for highway network preparation steps.</p>
<p>Creates required attributes and populates input values needed
for highway assignments. The toll values, VDFs, per-class cost
(tolls+operating costs), modes and skim link attributes are calculated.</p>


<details class="the-following-link-attributes-are-used-as-input" open>
  <summary>The following link attributes are used as input</summary>
  <ul>
<li>&ldquo;@capclass&rdquo;: link capclass index</li>
<li>&ldquo;length&rdquo;: standard link length, in miles</li>
<li>&ldquo;@tollbooth&rdquo;: label to separate bridgetolls from valuetolls</li>
<li>&ldquo;@tollseg&rdquo;: toll segment, used to index toll value lookups from the toll file
    (under config.highway.tolls.file_path)</li>
<li>&ldquo;@ft&rdquo;: functional class, used to assign VDFs</li>
</ul>
</details>

<details class="the-following-keys-and-tables-are-used-from-the-config" open>
  <summary>The following keys and tables are used from the config</summary>
  <p>highway.tolls.file_path: relative path to input toll file
highway.tolls.src_vehicle_group_names: names used in tolls file for
    toll class values
highway.tolls.dst_vehicle_group_names: corresponding names used in
    network attributes toll classes
highway.tolls.valuetoll_start_tollbooth_code: index to split point bridge tolls
    (&lt; this value) from distance value tolls (&gt;= this value)
highway.classes: the list of assignment classes, see the notes under
    highway_assign for detailed explanation
highway.capclass_lookup: the lookup table mapping the link @capclass setting
    to capacity (@capacity), free_flow_speed (@free_flow_speec) and
    critical_speed (used to calculate @ja for akcelik type functions)
highway.generic_highway_mode_code: unique (with other mode_codes) single
    character used to label entire auto network in Emme
highway.maz_to_maz.mode_code: unique (with other mode_codes) single
    character used to label MAZ local auto network including connectors</p>
</details>      <p>The following link attributes are created (overwritten) and are subsequently used in
the highway assignments.
    - &ldquo;@flow_XX&rdquo;: link PCE flows per class, where XX is the class name in the config
    - &ldquo;@maz_flow&rdquo;: Assigned MAZ-to-MAZ flow</p>


<details class="the-following-attributes-are-calculated" open>
  <summary>The following attributes are calculated</summary>
  <ul>
<li>vdf: volume delay function to use</li>
<li>&ldquo;@capacity&rdquo;: total link capacity</li>
<li>&ldquo;@ja&rdquo;: akcelik delay parameter</li>
<li>&ldquo;@hov_length&rdquo;: length with HOV lanes</li>
<li>&ldquo;@toll_length&rdquo;: length with tolls</li>
<li>&ldquo;@bridgetoll_YY&rdquo;: the bridge toll for class subgroup YY</li>
<li>&ldquo;@valuetoll_YY&rdquo;: the &ldquo;value&rdquo;, non-bridge toll for class subgroup YY</li>
<li>&ldquo;@cost_YY&rdquo;: total cost for class YY</li>
</ul>
</details>


  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="tm2py.components.network.highway.highway_network.PrepareNetwork" class="doc doc-heading">
            <code>PrepareNetwork</code>


<a href="#tm2py.components.network.highway.highway_network.PrepareNetwork" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="Component (tm2py.components.component.Component)" href="#tm2py.components.component.Component">Component</a></code></p>


      <p>Highway network preparation.</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/components/network/highway/highway_network.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">PrepareNetwork</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Highway network preparation.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="s2">&quot;RunController&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor for PPrepareNetwork.</span>

<span class="sd">        Args:</span>
<span class="sd">            controller (RunController): Reference to run controller object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_emme_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_highway_emmebank</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_highway_scenarios</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@LogStartEnd</span><span class="p">(</span><span class="s2">&quot;Prepare network attributes and modes&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run network preparation step.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">logbook_trace</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;prepare for highway assignment </span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">):</span>
                <span class="n">scenario</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">highway_emmebank</span><span class="o">.</span><span class="n">scenario</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_create_class_attributes</span><span class="p">(</span><span class="n">scenario</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
                <span class="n">network</span> <span class="o">=</span> <span class="n">scenario</span><span class="o">.</span><span class="n">get_network</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_tolls</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_vdf_attributes</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_link_modes</span><span class="p">(</span><span class="n">network</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_calc_link_skim_lengths</span><span class="p">(</span><span class="n">network</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_calc_link_class_costs</span><span class="p">(</span><span class="n">network</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_calc_interchange_distance</span><span class="p">(</span><span class="n">network</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_calc_link_static_reliability</span><span class="p">(</span><span class="n">network</span><span class="p">)</span>
                <span class="n">scenario</span><span class="o">.</span><span class="n">publish_network</span><span class="p">(</span><span class="n">network</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">highway_emmebank</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_highway_emmebank</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_highway_emmebank</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">highway_emmebank</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_highway_emmebank</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">highway_scenarios</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_highway_scenarios</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_highway_scenarios</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">tp</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">highway_emmebank</span><span class="o">.</span><span class="n">scenario</span><span class="p">(</span><span class="n">tp</span><span class="p">)</span> <span class="k">for</span> <span class="n">tp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span>
            <span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_highway_scenarios</span>

    <span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate inputs files are correct, raise if an error is found.&quot;&quot;&quot;</span>
        <span class="n">toll_file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">tolls</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">toll_file_path</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Tolls file (config.highway.tolls.file_path) does not exist: </span><span class="si">{</span><span class="n">toll_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">level</span><span class="o">=</span><span class="s2">&quot;ERROR&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tolls file does not exist: </span><span class="si">{</span><span class="n">toll_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">src_veh_groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">tolls</span><span class="o">.</span><span class="n">src_vehicle_group_names</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;fac_index&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">time_periods</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">vehicle</span> <span class="ow">in</span> <span class="n">src_veh_groups</span><span class="p">:</span>
                <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;toll</span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">vehicle</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">toll_file_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">toll_file</span><span class="p">:</span>
            <span class="n">header</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">next</span><span class="p">(</span><span class="n">toll_file</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">))</span>
            <span class="n">missing</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">header</span><span class="p">:</span>
                    <span class="n">missing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Tolls file missing column: </span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;ERROR&quot;</span>
                    <span class="p">)</span>
        <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FileFormatError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Tolls file missing </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span><span class="si">}</span><span class="s2"> columns: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_class_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scenario</span><span class="p">:</span> <span class="n">EmmeScenario</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create required network attributes including per-class cost and flow attributes.&quot;&quot;&quot;</span>
        <span class="n">create_attribute</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span>
            <span class="s2">&quot;inro.emme.data.extra_attribute.create_extra_attribute&quot;</span>
        <span class="p">)</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;LINK&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;@capacity&quot;</span><span class="p">,</span> <span class="s2">&quot;total link capacity&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;@ja&quot;</span><span class="p">,</span> <span class="s2">&quot;akcelik delay parameter&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;@maz_flow&quot;</span><span class="p">,</span> <span class="s2">&quot;Assigned MAZ-to-MAZ flow&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;@hov_length&quot;</span><span class="p">,</span> <span class="s2">&quot;length with HOV lanes&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;@toll_length&quot;</span><span class="p">,</span> <span class="s2">&quot;length with tolls&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;@intdist_down&quot;</span><span class="p">,</span> <span class="s2">&quot;dist to the closest d-stream interchange&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;@intdist_up&quot;</span><span class="p">,</span> <span class="s2">&quot;dist from the closest upstream int&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;@static_rel&quot;</span><span class="p">,</span> <span class="s2">&quot;static reliability&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;@reliability&quot;</span><span class="p">,</span> <span class="s2">&quot;link total reliability&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;@reliability_sq&quot;</span><span class="p">,</span> <span class="s2">&quot;link total reliability variance&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;@auto_time&quot;</span><span class="p">,</span> <span class="s2">&quot;link total reliability&quot;</span><span class="p">),</span>
            <span class="p">],</span>
            <span class="s2">&quot;NODE&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;@interchange&quot;</span><span class="p">,</span> <span class="s2">&quot;interchange&quot;</span><span class="p">),</span>
            <span class="p">],</span>
        <span class="p">}</span>
        <span class="c1"># toll field attributes by bridge and value and toll definition</span>
        <span class="n">dst_veh_groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">tolls</span><span class="o">.</span><span class="n">dst_vehicle_group_names</span>
        <span class="k">for</span> <span class="n">dst_veh</span> <span class="ow">in</span> <span class="n">dst_veh_groups</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">toll_type</span> <span class="ow">in</span> <span class="s2">&quot;bridge&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span>
                <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;LINK&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;@</span><span class="si">{</span><span class="n">toll_type</span><span class="si">}</span><span class="s2">toll_</span><span class="si">{</span><span class="n">dst_veh</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">toll_type</span><span class="si">}</span><span class="s2"> toll value for </span><span class="si">{</span><span class="n">dst_veh</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
        <span class="c1"># results for link cost and assigned flow</span>
        <span class="k">for</span> <span class="n">assign_class</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span><span class="p">:</span>
            <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;LINK&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;@cost_</span><span class="si">{</span><span class="n">assign_class</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">time_period</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">assign_class</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> total costs&#39;</span><span class="p">[:</span><span class="mi">40</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;LINK&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;@flow_</span><span class="si">{</span><span class="n">assign_class</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">time_period</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">assign_class</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> link volume&#39;</span><span class="p">[:</span><span class="mi">40</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">domain</span><span class="p">,</span> <span class="n">attrs</span> <span class="ow">in</span> <span class="n">attributes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">desc</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
                <span class="n">create_attribute</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">desc</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scenario</span><span class="o">=</span><span class="n">scenario</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_tolls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">network</span><span class="p">:</span> <span class="n">EmmeNetwork</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the tolls in the network from the toll reference file.&quot;&quot;&quot;</span>
        <span class="n">toll_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_toll_indices</span><span class="p">()</span>
        <span class="n">src_veh_groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">tolls</span><span class="o">.</span><span class="n">src_vehicle_group_names</span>
        <span class="n">dst_veh_groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">tolls</span><span class="o">.</span><span class="n">dst_vehicle_group_names</span>
        <span class="n">valuetoll_start_tollbooth_code</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">tolls</span><span class="o">.</span><span class="n">valuetoll_start_tollbooth_code</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">network</span><span class="o">.</span><span class="n">links</span><span class="p">():</span>
            <span class="c1"># set bridgetoll</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@tollbooth&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
                <span class="ow">and</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@tollbooth&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">valuetoll_start_tollbooth_code</span>
            <span class="p">):</span>
                <span class="n">index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                    <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@tollbooth&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1000</span>
                    <span class="o">+</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@tollseg&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">10</span>
                    <span class="o">+</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@useclass&quot;</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">data_row</span> <span class="o">=</span> <span class="n">toll_index</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">data_row</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;set tolls failed index lookup </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">, link </span><span class="si">{</span><span class="n">link</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="n">indent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="k">continue</span>  <span class="c1"># tolls will remain at zero</span>
                <span class="k">for</span> <span class="n">src_veh</span><span class="p">,</span> <span class="n">dst_veh</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">src_veh_groups</span><span class="p">,</span> <span class="n">dst_veh_groups</span><span class="p">):</span>
                    <span class="n">link</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;@bridgetoll_</span><span class="si">{</span><span class="n">dst_veh</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="nb">float</span><span class="p">(</span><span class="n">data_row</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;toll</span><span class="si">{</span><span class="n">time_period</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">src_veh</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span>
                    <span class="p">)</span>
            <span class="c1"># set valuetoll</span>
            <span class="k">elif</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@tollbooth&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">valuetoll_start_tollbooth_code</span><span class="p">:</span>
                <span class="n">data_row</span> <span class="o">=</span> <span class="n">toll_index</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">data_row</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;set tolls failed index lookup </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">, link </span><span class="si">{</span><span class="n">link</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="n">indent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="k">continue</span>  <span class="c1"># tolls will remain at zero</span>
                <span class="k">for</span> <span class="n">src_veh</span><span class="p">,</span> <span class="n">dst_veh</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">src_veh_groups</span><span class="p">,</span> <span class="n">dst_veh_groups</span><span class="p">):</span>
                    <span class="n">link</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;@valuetoll_</span><span class="si">{</span><span class="n">dst_veh</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="nb">float</span><span class="p">(</span><span class="n">data_row</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;toll</span><span class="si">{</span><span class="n">time_period</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">src_veh</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">])</span>
                        <span class="o">*</span> <span class="n">link</span><span class="o">.</span><span class="n">length</span>
                        <span class="o">*</span> <span class="mi">100</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">continue</span>

    <span class="k">def</span> <span class="nf">_get_toll_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the mapping of toll lookup table from the toll reference file.&quot;&quot;&quot;</span>
        <span class="n">toll_file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">tolls</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;toll_file_path </span><span class="si">{</span><span class="n">toll_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">tolls</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">toll_file_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">toll_file</span><span class="p">:</span>
            <span class="n">header</span> <span class="o">=</span> <span class="p">[</span><span class="n">h</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">next</span><span class="p">(</span><span class="n">toll_file</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">toll_file</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)))</span>
                <span class="n">tolls</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;fac_index&quot;</span><span class="p">])]</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">return</span> <span class="n">tolls</span>

    <span class="k">def</span> <span class="nf">_set_vdf_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">network</span><span class="p">:</span> <span class="n">EmmeNetwork</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set capacity, VDF and critical speed on links.&quot;&quot;&quot;</span>
        <span class="n">capacity_map</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">critical_speed_map</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">capclass_lookup</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">capacity_map</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;capclass&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;critical_speed&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">critical_speed_map</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;capclass&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;critical_speed&quot;</span><span class="p">)</span>
        <span class="n">tp_mapping</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">tp</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span> <span class="n">tp</span><span class="o">.</span><span class="n">highway_capacity_factor</span>
            <span class="k">for</span> <span class="n">tp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">time_periods</span>
        <span class="p">}</span>
        <span class="n">period_capacity_factor</span> <span class="o">=</span> <span class="n">tp_mapping</span><span class="p">[</span><span class="n">time_period</span><span class="p">]</span>
        <span class="n">akcelik_vdfs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">network</span><span class="o">.</span><span class="n">links</span><span class="p">():</span>
            <span class="n">cap_lanehour</span> <span class="o">=</span> <span class="n">capacity_map</span><span class="p">[</span><span class="n">link</span><span class="p">[</span><span class="s2">&quot;@capclass&quot;</span><span class="p">]]</span>
            <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@capacity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cap_lanehour</span> <span class="o">*</span> <span class="n">period_capacity_factor</span> <span class="o">*</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@lanes&quot;</span><span class="p">]</span>
            <span class="n">link</span><span class="o">.</span><span class="n">volume_delay_func</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">link</span><span class="p">[</span><span class="s2">&quot;@ft&quot;</span><span class="p">])</span>
            <span class="c1"># re-mapping links with type 99 to type 7 &quot;local road of minor importance&quot;</span>
            <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">volume_delay_func</span> <span class="o">==</span> <span class="mi">99</span><span class="p">:</span>
                <span class="n">link</span><span class="o">.</span><span class="n">volume_delay_func</span> <span class="o">=</span> <span class="mi">7</span>
            <span class="c1"># num_lanes not used directly, but set for reference</span>
            <span class="n">link</span><span class="o">.</span><span class="n">num_lanes</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="mf">9.9</span><span class="p">,</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@lanes&quot;</span><span class="p">]),</span> <span class="mf">1.0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">volume_delay_func</span> <span class="ow">in</span> <span class="n">akcelik_vdfs</span> <span class="ow">and</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@free_flow_speed&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">dist</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">length</span>
                <span class="n">critical_speed</span> <span class="o">=</span> <span class="n">critical_speed_map</span><span class="p">[</span><span class="n">link</span><span class="p">[</span><span class="s2">&quot;@capclass&quot;</span><span class="p">]]</span>
                <span class="n">t_c</span> <span class="o">=</span> <span class="n">dist</span> <span class="o">/</span> <span class="n">critical_speed</span>
                <span class="n">t_o</span> <span class="o">=</span> <span class="n">dist</span> <span class="o">/</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@free_flow_speed&quot;</span><span class="p">]</span>
                <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@ja&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">16</span> <span class="o">*</span> <span class="p">(</span><span class="n">t_c</span> <span class="o">-</span> <span class="n">t_o</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>

    <span class="k">def</span> <span class="nf">_set_link_modes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">network</span><span class="p">:</span> <span class="n">EmmeNetwork</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the link modes based on the per-class &#39;excluded_links&#39; set.&quot;&quot;&quot;</span>
        <span class="c1"># first reset link modes (script run more than once)</span>
        <span class="c1"># &quot;generic_highway_mode_code&quot; must already be created (in import to Emme script)</span>
        <span class="n">auto_mode</span> <span class="o">=</span> <span class="p">{</span><span class="n">network</span><span class="o">.</span><span class="n">mode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">generic_highway_mode_code</span><span class="p">)}</span>
        <span class="n">used_modes</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">network</span><span class="o">.</span><span class="n">mode</span><span class="p">(</span><span class="n">assign_class</span><span class="o">.</span><span class="n">mode_code</span><span class="p">)</span> <span class="k">for</span> <span class="n">assign_class</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span>
        <span class="p">}</span>
        <span class="n">used_modes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">network</span><span class="o">.</span><span class="n">mode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">maz_to_maz</span><span class="o">.</span><span class="n">mode_code</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">network</span><span class="o">.</span><span class="n">links</span><span class="p">():</span>
            <span class="n">link</span><span class="o">.</span><span class="n">modes</span> <span class="o">-=</span> <span class="n">used_modes</span>
            <span class="k">if</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@drive_link&quot;</span><span class="p">]:</span>
                <span class="n">link</span><span class="o">.</span><span class="n">modes</span> <span class="o">|=</span> <span class="n">auto_mode</span>
        <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">used_modes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">network</span><span class="o">.</span><span class="n">delete_mode</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>

        <span class="c1"># Create special access/egress mode for MAZ connectors</span>
        <span class="n">maz_access_mode</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">create_mode</span><span class="p">(</span>
            <span class="s2">&quot;AUX_AUTO&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">maz_to_maz</span><span class="o">.</span><span class="n">mode_code</span>
        <span class="p">)</span>
        <span class="n">maz_access_mode</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;MAZ access&quot;</span>
        <span class="c1"># create modes from class spec</span>
        <span class="c1"># (duplicate mode codes allowed provided the excluded_links is the same)</span>
        <span class="n">mode_excluded_links</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">assign_class</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">assign_class</span><span class="o">.</span><span class="n">mode_code</span> <span class="ow">in</span> <span class="n">mode_excluded_links</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">assign_class</span><span class="o">.</span><span class="n">excluded_links</span>
                    <span class="o">!=</span> <span class="n">mode_excluded_links</span><span class="p">[</span><span class="n">assign_class</span><span class="o">.</span><span class="n">mode_code</span><span class="p">]</span>
                <span class="p">):</span>
                    <span class="n">ex_links1</span> <span class="o">=</span> <span class="n">mode_excluded_links</span><span class="p">[</span><span class="n">assign_class</span><span class="o">.</span><span class="n">mode_code</span><span class="p">]</span>
                    <span class="n">ex_links2</span> <span class="o">=</span> <span class="n">assign_class</span><span class="o">.</span><span class="n">excluded_links</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;config error: highway.classes, duplicated mode codes &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;(&#39;</span><span class="si">{</span><span class="n">assign_class</span><span class="o">.</span><span class="n">mode_code</span><span class="si">}</span><span class="s2">&#39;) with different excluded &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;links: </span><span class="si">{</span><span class="n">ex_links1</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">ex_links2</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                <span class="k">continue</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">create_mode</span><span class="p">(</span><span class="s2">&quot;AUX_AUTO&quot;</span><span class="p">,</span> <span class="n">assign_class</span><span class="o">.</span><span class="n">mode_code</span><span class="p">)</span>
            <span class="n">mode</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">assign_class</span><span class="o">.</span><span class="n">name</span>
            <span class="n">mode_excluded_links</span><span class="p">[</span><span class="n">mode</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">assign_class</span><span class="o">.</span><span class="n">excluded_links</span>

        <span class="n">dst_veh_groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">tolls</span><span class="o">.</span><span class="n">dst_vehicle_group_names</span>
        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">network</span><span class="o">.</span><span class="n">links</span><span class="p">():</span>
            <span class="n">modes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">link</span><span class="o">.</span><span class="n">modes</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">i_node</span><span class="p">[</span><span class="s2">&quot;@maz_id&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">link</span><span class="o">.</span><span class="n">j_node</span><span class="p">[</span><span class="s2">&quot;@maz_id&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">modes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">maz_access_mode</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                <span class="n">link</span><span class="o">.</span><span class="n">modes</span> <span class="o">=</span> <span class="n">modes</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@drive_link&quot;</span><span class="p">]:</span>
                <span class="k">continue</span>
            <span class="n">exclude_links_map</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;is_sr&quot;</span><span class="p">:</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@useclass&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
                <span class="s2">&quot;is_sr2&quot;</span><span class="p">:</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@useclass&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span>
                <span class="s2">&quot;is_sr3&quot;</span><span class="p">:</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@useclass&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">,</span>
                <span class="s2">&quot;is_auto_only&quot;</span><span class="p">:</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@useclass&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">dst_veh</span> <span class="ow">in</span> <span class="n">dst_veh_groups</span><span class="p">:</span>
                <span class="n">exclude_links_map</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;is_toll_</span><span class="si">{</span><span class="n">dst_veh</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">link</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;@valuetoll_</span><span class="si">{</span><span class="n">dst_veh</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_apply_exclusions</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">maz_to_maz</span><span class="o">.</span><span class="n">excluded_links</span><span class="p">,</span>
                <span class="n">maz_access_mode</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="n">modes</span><span class="p">,</span>
                <span class="n">exclude_links_map</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">assign_class</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_apply_exclusions</span><span class="p">(</span>
                    <span class="n">assign_class</span><span class="o">.</span><span class="n">excluded_links</span><span class="p">,</span>
                    <span class="n">assign_class</span><span class="o">.</span><span class="n">mode_code</span><span class="p">,</span>
                    <span class="n">modes</span><span class="p">,</span>
                    <span class="n">exclude_links_map</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="n">link</span><span class="o">.</span><span class="n">modes</span> <span class="o">=</span> <span class="n">modes</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_apply_exclusions</span><span class="p">(</span>
        <span class="n">excluded_links_criteria</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">mode_code</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">modes_set</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">link_values</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">],</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply the exclusion criteria to set the link modes.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">criteria</span> <span class="ow">in</span> <span class="n">excluded_links_criteria</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">link_values</span><span class="p">[</span><span class="n">criteria</span><span class="p">]:</span>
                <span class="k">return</span>
        <span class="n">modes_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">mode_code</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_calc_link_skim_lengths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">network</span><span class="p">:</span> <span class="n">EmmeNetwork</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate the length attributes used in the highway skims.&quot;&quot;&quot;</span>
        <span class="n">valuetoll_start_tollbooth_code</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">tolls</span><span class="o">.</span><span class="n">valuetoll_start_tollbooth_code</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">network</span><span class="o">.</span><span class="n">links</span><span class="p">():</span>
            <span class="c1"># distance in hov lanes / facilities</span>
            <span class="k">if</span> <span class="mi">2</span> <span class="o">&lt;=</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@useclass&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@hov_length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">length</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@hov_length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c1"># distance on non-bridge toll facilities</span>
            <span class="k">if</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@tollbooth&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">valuetoll_start_tollbooth_code</span><span class="p">:</span>
                <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@toll_length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">length</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@toll_length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_calc_link_class_costs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">network</span><span class="p">:</span> <span class="n">EmmeNetwork</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate the per-class link cost from the tolls and operating costs.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">assign_class</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span><span class="p">:</span>
            <span class="n">cost_attr</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;@cost_</span><span class="si">{</span><span class="n">assign_class</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">op_cost</span> <span class="o">=</span> <span class="n">assign_class</span><span class="p">[</span><span class="s2">&quot;operating_cost_per_mile&quot;</span><span class="p">]</span>
            <span class="n">toll_factor</span> <span class="o">=</span> <span class="n">assign_class</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;toll_factor&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">toll_factor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">toll_factor</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">network</span><span class="o">.</span><span class="n">links</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">toll_value</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
                        <span class="n">link</span><span class="p">[</span><span class="n">toll_attr</span><span class="p">]</span> <span class="k">for</span> <span class="n">toll_attr</span> <span class="ow">in</span> <span class="n">assign_class</span><span class="p">[</span><span class="s2">&quot;toll&quot;</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">link</span>
                <span class="n">link</span><span class="p">[</span><span class="n">cost_attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">length</span> <span class="o">*</span> <span class="n">op_cost</span> <span class="o">+</span> <span class="n">toll_value</span> <span class="o">*</span> <span class="n">toll_factor</span>

    <span class="k">def</span> <span class="nf">_calc_interchange_distance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">network</span><span class="p">:</span> <span class="n">EmmeNetwork</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For highway reliability</span>
<span class="sd">        Calculate upstream and downstream interchange distance</span>
<span class="sd">        First, label the intersection nodes as nodes with freeway and freeway-to-freeway ramp</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># input interchange nodes file</span>
        <span class="c1"># This is a file inherited from https://app.box.com/folder/148342877307, as implemented in the tm2.1</span>
        <span class="n">interchange_nodes_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">interchange_nodes_file</span><span class="p">)</span>
        <span class="n">interchange_nodes_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">interchange_nodes_file</span><span class="p">)</span>
        <span class="n">interchange_nodes_df</span> <span class="o">=</span> <span class="n">interchange_nodes_df</span><span class="p">[</span><span class="n">interchange_nodes_df</span><span class="o">.</span><span class="n">intx</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">interchange_points</span> <span class="o">=</span> <span class="n">interchange_nodes_df</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">network</span><span class="o">.</span><span class="n">create_attribute</span><span class="p">(</span><span class="s2">&quot;NODE&quot;</span><span class="p">,</span> <span class="s2">&quot;is_interchange&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">network</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;#node_id&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">interchange_points</span><span class="p">:</span>
                <span class="n">node</span><span class="o">.</span><span class="n">is_interchange</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">node</span><span class="p">[</span><span class="s2">&quot;@interchange&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">is_interchange</span>

        <span class="n">mode_c</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">mode</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">network</span><span class="o">.</span><span class="n">links</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@ft&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="ow">and</span> <span class="n">mode_c</span> <span class="ow">in</span> <span class="n">link</span><span class="o">.</span><span class="n">modes</span><span class="p">:</span>
                <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@intdist_down&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PrepareNetwork</span><span class="o">.</span><span class="n">interchange_distance</span><span class="p">(</span>
                    <span class="n">link</span><span class="p">,</span> <span class="s2">&quot;DOWNSTREAM&quot;</span>
                <span class="p">)</span>
                <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@intdist_up&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PrepareNetwork</span><span class="o">.</span><span class="n">interchange_distance</span><span class="p">(</span>
                    <span class="n">link</span><span class="p">,</span> <span class="s2">&quot;UPSTREAM&quot;</span>
                <span class="p">)</span>

        <span class="n">network</span><span class="o">.</span><span class="n">delete_attribute</span><span class="p">(</span><span class="s2">&quot;NODE&quot;</span><span class="p">,</span> <span class="s2">&quot;is_interchange&quot;</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">interchange_distance</span><span class="p">(</span><span class="n">orig_link</span><span class="p">,</span> <span class="n">direction</span><span class="p">):</span>
        <span class="n">visited</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        <span class="n">visited_add</span> <span class="o">=</span> <span class="n">visited</span><span class="o">.</span><span class="n">add</span>
        <span class="n">back_links</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">heap</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;DOWNSTREAM&quot;</span><span class="p">:</span>
            <span class="n">get_links</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">l</span><span class="o">.</span><span class="n">j_node</span><span class="o">.</span><span class="n">outgoing_links</span><span class="p">()</span>
            <span class="n">check_far_node</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">l</span><span class="o">.</span><span class="n">j_node</span><span class="o">.</span><span class="n">is_interchange</span>
        <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;UPSTREAM&quot;</span><span class="p">:</span>
            <span class="n">get_links</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">l</span><span class="o">.</span><span class="n">i_node</span><span class="o">.</span><span class="n">incoming_links</span><span class="p">()</span>
            <span class="n">check_far_node</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">l</span><span class="o">.</span><span class="n">i_node</span><span class="o">.</span><span class="n">is_interchange</span>
        <span class="c1"># Shortest path search for nearest interchange node along freeway</span>
        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">get_links</span><span class="p">(</span><span class="n">orig_link</span><span class="p">):</span>
            <span class="n">_heapq</span><span class="o">.</span><span class="n">heappush</span><span class="p">(</span><span class="n">heap</span><span class="p">,</span> <span class="p">(</span><span class="n">link</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">],</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;#link_id&quot;</span><span class="p">],</span> <span class="n">link</span><span class="p">))</span>
        <span class="n">interchange_found</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Check first node</span>
        <span class="k">if</span> <span class="n">check_far_node</span><span class="p">(</span><span class="n">orig_link</span><span class="p">):</span>
            <span class="n">interchange_found</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">link_cost</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">while</span> <span class="ow">not</span> <span class="n">interchange_found</span><span class="p">:</span>
                <span class="n">link_cost</span><span class="p">,</span> <span class="n">link_id</span><span class="p">,</span> <span class="n">link</span> <span class="o">=</span> <span class="n">_heapq</span><span class="o">.</span><span class="n">heappop</span><span class="p">(</span><span class="n">heap</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">visited</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">visited_add</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">check_far_node</span><span class="p">(</span><span class="n">link</span><span class="p">):</span>
                    <span class="n">interchange_found</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>
                <span class="n">get_links_return</span> <span class="o">=</span> <span class="n">get_links</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">next_link</span> <span class="ow">in</span> <span class="n">get_links_return</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">next_link</span> <span class="ow">in</span> <span class="n">visited</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">next_cost</span> <span class="o">=</span> <span class="n">link_cost</span> <span class="o">+</span> <span class="n">next_link</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">]</span>
                    <span class="n">_heapq</span><span class="o">.</span><span class="n">heappush</span><span class="p">(</span><span class="n">heap</span><span class="p">,</span> <span class="p">(</span><span class="n">next_cost</span><span class="p">,</span> <span class="n">next_link</span><span class="p">[</span><span class="s2">&quot;#link_id&quot;</span><span class="p">],</span> <span class="n">next_link</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="c1"># TypeError if the link type objects are compared in the tuples</span>
            <span class="c1"># case where the path cost are the same</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Path cost are the same, cannot compare Link objects&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="c1"># IndexError if heap is empty</span>
            <span class="c1"># case where start / end of highway, dist = 99</span>
            <span class="k">return</span> <span class="mi">99</span>
        <span class="k">return</span> <span class="n">orig_link</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">+</span> <span class="n">link_cost</span>

    <span class="k">def</span> <span class="nf">_calc_link_static_reliability</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">network</span><span class="p">:</span> <span class="n">EmmeNetwork</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For highway reliability</span>
<span class="sd">        consists of: lane factor, interchange distance, speed factor</span>
<span class="sd">        differentiated by freeway, artertial, and others</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Static reliability parameters</span>
        <span class="c1"># freeway coefficients</span>
        <span class="n">freeway_rel</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;intercept&quot;</span><span class="p">:</span> <span class="mf">0.1078</span><span class="p">,</span>
            <span class="s2">&quot;speed&gt;70&quot;</span><span class="p">:</span> <span class="mf">0.01393</span><span class="p">,</span>
            <span class="s2">&quot;upstream&quot;</span><span class="p">:</span> <span class="mf">0.011</span><span class="p">,</span>
            <span class="s2">&quot;downstream&quot;</span><span class="p">:</span> <span class="mf">0.0005445</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="c1"># arterial/ramp/other coefficients</span>
        <span class="n">road_rel</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;intercept&quot;</span><span class="p">:</span> <span class="mf">0.0546552</span><span class="p">,</span>
            <span class="s2">&quot;lanes&quot;</span><span class="p">:</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mf">0.0103589</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="mf">0.0361211</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="mf">0.0446958</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">},</span>
            <span class="s2">&quot;speed&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;&lt;35&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="mi">35</span><span class="p">:</span> <span class="mf">0.0075674</span><span class="p">,</span>
                <span class="mi">40</span><span class="p">:</span> <span class="mf">0.0091012</span><span class="p">,</span>
                <span class="mi">45</span><span class="p">:</span> <span class="mf">0.0080996</span><span class="p">,</span>
                <span class="mi">50</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0022938</span><span class="p">,</span>
                <span class="s2">&quot;&gt;50&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0046211</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">network</span><span class="o">.</span><span class="n">links</span><span class="p">():</span>
            <span class="c1"># if freeway apply freeway parameters to this link</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">link</span><span class="p">[</span><span class="s2">&quot;@ft&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="n">link</span><span class="p">[</span><span class="s2">&quot;@lanes&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">high_speed_factor</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">freeway_rel</span><span class="p">[</span><span class="s2">&quot;speed&gt;70&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@free_flow_speed&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">70</span> <span class="k">else</span> <span class="mi">0</span>
                <span class="p">)</span>
                <span class="n">upstream_factor</span> <span class="o">=</span> <span class="n">freeway_rel</span><span class="p">[</span><span class="s2">&quot;upstream&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@intdist_up&quot;</span><span class="p">]</span>
                <span class="n">downstream_factor</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">freeway_rel</span><span class="p">[</span><span class="s2">&quot;downstream&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@intdist_down&quot;</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@static_rel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">freeway_rel</span><span class="p">[</span><span class="s2">&quot;intercept&quot;</span><span class="p">]</span>
                    <span class="o">+</span> <span class="n">high_speed_factor</span>
                    <span class="o">+</span> <span class="n">upstream_factor</span>
                    <span class="o">+</span> <span class="n">downstream_factor</span>
                <span class="p">)</span>
            <span class="c1"># arterial/ramp/other apply road parameters</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">link</span><span class="p">[</span><span class="s2">&quot;@ft&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">link</span><span class="p">[</span><span class="s2">&quot;@lanes&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">lane_factor</span> <span class="o">=</span> <span class="n">road_rel</span><span class="p">[</span><span class="s2">&quot;lanes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">link</span><span class="p">[</span><span class="s2">&quot;@lanes&quot;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">speed_bin</span> <span class="o">=</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@free_flow_speed&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">speed_bin</span> <span class="o">&lt;</span> <span class="mi">35</span><span class="p">:</span>
                    <span class="n">speed_bin</span> <span class="o">=</span> <span class="s2">&quot;&lt;35&quot;</span>
                <span class="k">elif</span> <span class="n">speed_bin</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>
                    <span class="n">speed_bin</span> <span class="o">=</span> <span class="s2">&quot;&gt;50&quot;</span>
                <span class="n">speed_factor</span> <span class="o">=</span> <span class="n">road_rel</span><span class="p">[</span><span class="s2">&quot;speed&quot;</span><span class="p">][</span><span class="n">speed_bin</span><span class="p">]</span>
                <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@static_rel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">road_rel</span><span class="p">[</span><span class="s2">&quot;intercept&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">lane_factor</span> <span class="o">+</span> <span class="n">speed_factor</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@static_rel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tm2py.components.network.highway.highway_network.PrepareNetwork.__init__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span></code>

<a href="#tm2py.components.network.highway.highway_network.PrepareNetwork.__init__" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Constructor for PPrepareNetwork.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>controller</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="RunController (tm2py.controller.RunController)" href="#tm2py.controller.RunController">RunController</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reference to run controller object.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/network/highway/highway_network.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="s2">&quot;RunController&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Constructor for PPrepareNetwork.</span>

<span class="sd">    Args:</span>
<span class="sd">        controller (RunController): Reference to run controller object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_emme_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_highway_emmebank</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_highway_scenarios</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.network.highway.highway_network.PrepareNetwork.run" class="doc doc-heading">
            <code class=" language-python"><span class="n">run</span><span class="p">()</span></code>

<a href="#tm2py.components.network.highway.highway_network.PrepareNetwork.run" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Run network preparation step.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/network/highway/highway_network.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@LogStartEnd</span><span class="p">(</span><span class="s2">&quot;Prepare network attributes and modes&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run network preparation step.&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">:</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">logbook_trace</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;prepare for highway assignment </span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">):</span>
            <span class="n">scenario</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">highway_emmebank</span><span class="o">.</span><span class="n">scenario</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_class_attributes</span><span class="p">(</span><span class="n">scenario</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
            <span class="n">network</span> <span class="o">=</span> <span class="n">scenario</span><span class="o">.</span><span class="n">get_network</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_tolls</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_vdf_attributes</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_link_modes</span><span class="p">(</span><span class="n">network</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_calc_link_skim_lengths</span><span class="p">(</span><span class="n">network</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_calc_link_class_costs</span><span class="p">(</span><span class="n">network</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_calc_interchange_distance</span><span class="p">(</span><span class="n">network</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_calc_link_static_reliability</span><span class="p">(</span><span class="n">network</span><span class="p">)</span>
            <span class="n">scenario</span><span class="o">.</span><span class="n">publish_network</span><span class="p">(</span><span class="n">network</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.network.highway.highway_network.PrepareNetwork.validate_inputs" class="doc doc-heading">
            <code class=" language-python"><span class="n">validate_inputs</span><span class="p">()</span></code>

<a href="#tm2py.components.network.highway.highway_network.PrepareNetwork.validate_inputs" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Validate inputs files are correct, raise if an error is found.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/network/highway/highway_network.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate inputs files are correct, raise if an error is found.&quot;&quot;&quot;</span>
    <span class="n">toll_file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">tolls</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">toll_file_path</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Tolls file (config.highway.tolls.file_path) does not exist: </span><span class="si">{</span><span class="n">toll_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">level</span><span class="o">=</span><span class="s2">&quot;ERROR&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tolls file does not exist: </span><span class="si">{</span><span class="n">toll_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">src_veh_groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">tolls</span><span class="o">.</span><span class="n">src_vehicle_group_names</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;fac_index&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">time_periods</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">vehicle</span> <span class="ow">in</span> <span class="n">src_veh_groups</span><span class="p">:</span>
            <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;toll</span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">vehicle</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">toll_file_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">toll_file</span><span class="p">:</span>
        <span class="n">header</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">next</span><span class="p">(</span><span class="n">toll_file</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">))</span>
        <span class="n">missing</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">header</span><span class="p">:</span>
                <span class="n">missing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Tolls file missing column: </span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;ERROR&quot;</span>
                <span class="p">)</span>
    <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">FileFormatError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Tolls file missing </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span><span class="si">}</span><span class="s2"> columns: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="tm2py.components.network.highway.highway_assign"></a>
    <div class="doc doc-contents first">

      <p>Highway assignment and skim component.</p>
<p>Performs equilibrium traffic assignment and generates resulting skims.
The assignmend is configured using the &ldquo;highway&rdquo; table in the source config.
See the config documentation for details. The traffic assignment runs according
to the list of assignment classes under highway.classes.</p>
<p>Other relevant parameters from the config are:
- emme.num_processors: number of processors as integer or &ldquo;MAX&rdquo; or &ldquo;MAX-N&rdquo;
- time_periods[].emme_scenario_id: Emme scenario number to use for each period
- time_periods[].highway_capacity_factor</p>
<p>The Emme network must have the following attributes available:</p>
<p>Link - attributes:
- &ldquo;length&rdquo; in feet
- &ldquo;vdf&rdquo;, volume delay function (volume delay functions must also be setup)
- &ldquo;@useclass&rdquo;, vehicle-class restrictions classification, auto-only, HOV only
- &ldquo;@free_flow_time&rdquo;, the free flow time (in minutes)
- &ldquo;@tollXX_YY&rdquo;, the toll for period XX and class subgroup (see truck
    class) named YY, used together with @tollbooth to generate @bridgetoll_YY
    and @valuetoll_YY
- &ldquo;@maz_flow&rdquo;, the background traffic MAZ-to-MAZ SP assigned flow from highway_maz,
    if controller.iteration &gt; 0
- modes: must be set on links and match the specified mode codes in
    the traffic config</p>
<p>Network results - attributes:
- @flow_XX: link PCE flows per class, where XX is the class name in the config
- timau: auto travel time
- volau: total assigned flow in PCE</p>
<p>Notes:
- Output matrices are in miles, minutes, and cents (2010 dollars) and are stored/
as real values;
- Intrazonal distance/time is one half the distance/time to the nearest neighbor;
- Intrazonal bridge and value tolls are assumed to be zero</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="tm2py.components.network.highway.highway_assign.AssignmentLauncher" class="doc doc-heading">
            <code>AssignmentLauncher</code>


<a href="#tm2py.components.network.highway.highway_assign.AssignmentLauncher" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="tm2py.emme.manager.BaseAssignmentLauncher">BaseAssignmentLauncher</span></code></p>


      <p>Manages Emme-related data (matrices and scenarios) for multiple time periods
and kicks off assignment in a subprocess.</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/components/network/highway/highway_assign.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">AssignmentLauncher</span><span class="p">(</span><span class="n">BaseAssignmentLauncher</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Manages Emme-related data (matrices and scenarios) for multiple time periods</span>
<span class="sd">    and kicks off assignment in a subprocess.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">get_assign_script_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="vm">__file__</span>

    <span class="k">def</span> <span class="nf">get_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">configs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">params</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_times</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scenarios</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_assign_specs</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_skim_matrices</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_demand_matrices</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_omx_file_paths</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">time</span><span class="p">,</span> <span class="n">scenario</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">skims</span><span class="p">,</span> <span class="n">demands</span><span class="p">,</span> <span class="n">omx_path</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="n">configs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;project_path&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_project_path</span><span class="p">,</span>
                    <span class="s2">&quot;emmebank_path&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_emmebank_path</span><span class="p">,</span>
                    <span class="s2">&quot;scenario_id&quot;</span><span class="p">:</span> <span class="n">scenario</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                    <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">time</span><span class="p">,</span>
                    <span class="s2">&quot;iteration&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iteration</span><span class="p">,</span>
                    <span class="s2">&quot;assign_spec&quot;</span><span class="p">:</span> <span class="n">spec</span><span class="p">,</span>
                    <span class="s2">&quot;demand_matrices&quot;</span><span class="p">:</span> <span class="n">demands</span><span class="p">,</span>
                    <span class="s2">&quot;skim_matrices&quot;</span><span class="p">:</span> <span class="n">skims</span><span class="p">,</span>
                    <span class="s2">&quot;omx_file_path&quot;</span><span class="p">:</span> <span class="n">omx_path</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">configs</span>

    <span class="k">def</span> <span class="nf">get_result_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scenario_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;auto_time&quot;</span><span class="p">,</span> <span class="s2">&quot;auto_volume&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">scenario</span><span class="p">,</span> <span class="n">spec</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scenarios</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assign_specs</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">scenario</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">scenario_id</span><span class="p">:</span>
                <span class="n">attrs</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">][</span><span class="s2">&quot;link_volumes&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">]])</span>
        <span class="k">return</span> <span class="n">attrs</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.components.network.highway.highway_assign.AssignmentRunner" class="doc doc-heading">
            <code>AssignmentRunner</code>


<a href="#tm2py.components.network.highway.highway_assign.AssignmentRunner" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">


              <details class="quote">
                <summary>Source code in <code>tm2py/components/network/highway/highway_assign.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">AssignmentRunner</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">emmebank_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">scenario_id</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
        <span class="n">time</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">iteration</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">assign_spec</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
        <span class="n">demand_matrices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">skim_matrices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">omx_file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor to run the highway assignment for the specified time period.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_path (str): path to existing EMME project (*.emp file)</span>
<span class="sd">            emmebank_path (str): path to existing EMME databsae (emmebank) file</span>
<span class="sd">            scenario_id (str): existing scenario ID for assignment run</span>
<span class="sd">            time (str): time period ID (only used for logging messages)</span>
<span class="sd">            iteration (List[str]): global iteration number</span>
<span class="sd">            assign_spec (Dict): EMME SOLA assignment specification</span>
<span class="sd">            skim_matrices (List[str]): list of skim matrix ID.</span>
<span class="sd">            omx_file_path (str): path to resulting output of skim matrices to OMX</span>
<span class="sd">            logger (Logger): optional logger object if running in process.</span>
<span class="sd">                If not specified a new logger reference is created.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emme_manager</span> <span class="o">=</span> <span class="n">EmmeManagerLight</span><span class="p">(</span><span class="n">project_path</span><span class="p">,</span> <span class="n">emmebank_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emmebank</span> <span class="o">=</span> <span class="n">Emmebank</span><span class="p">(</span><span class="n">emmebank_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scenario</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emmebank</span><span class="o">.</span><span class="n">scenario</span><span class="p">(</span><span class="n">scenario_id</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iteration</span> <span class="o">=</span> <span class="n">iteration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assign_spec</span> <span class="o">=</span> <span class="n">assign_spec</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skim_matrix_ids</span> <span class="o">=</span> <span class="n">skim_matrices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">demand_matrix_ids</span> <span class="o">=</span> <span class="n">demand_matrices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">omx_file_path</span> <span class="o">=</span> <span class="n">omx_file_path</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_network_calculator</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_skim_matrix_objs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">logger</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">root</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">project_path</span><span class="p">))</span>
            <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;run_highway_</span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">iteration</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">run_log_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.log&quot;</span><span class="p">)</span>
            <span class="n">log_on_error_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_error.log&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">ProcessLogger</span><span class="p">(</span>
                <span class="n">run_log_file_path</span><span class="p">,</span> <span class="n">log_on_error_file_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">emme_manager</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Run time period highway assignment&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setup</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iteration</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_copy_maz_flow</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_reset_background_traffic</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">matrix_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">demand_matrix_ids</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">emmebank</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">matrix_name</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;demand matrix </span><span class="si">{</span><span class="n">matrix_name</span><span class="si">}</span><span class="s2"> does not exist&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_create_skim_matrices</span><span class="p">()</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">_skip_emme_logging</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assign_spec</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log_start_end</span><span class="p">(</span>
                <span class="s2">&quot;Run SOLA assignment (no path analyses)&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;INFO&quot;</span>
            <span class="p">):</span>
                <span class="n">assign</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span>
                    <span class="s2">&quot;inro.emme.traffic_assignment.sola_traffic_assignment&quot;</span>
                <span class="p">)</span>
                <span class="n">assign</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assign_spec_no_analysis</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scenario</span><span class="p">,</span> <span class="n">chart_log_interval</span><span class="o">=</span><span class="mi">1</span>
                <span class="p">)</span>

            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log_start_end</span><span class="p">(</span>
                <span class="s2">&quot;Calculates link level LOS based reliability&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DETAIL&quot;</span>
            <span class="p">):</span>
                <span class="n">exf_pars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scenario</span><span class="o">.</span><span class="n">emmebank</span><span class="o">.</span><span class="n">extra_function_parameters</span>
                <span class="n">vdfs</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">emmebank</span><span class="o">.</span><span class="n">functions</span><span class="p">()</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;VOLUME_DELAY&quot;</span>
                <span class="p">]</span>
                <span class="n">net_calc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_network_calculator</span>
                <span class="k">for</span> <span class="n">function</span> <span class="ow">in</span> <span class="n">vdfs</span><span class="p">:</span>
                    <span class="n">expression</span> <span class="o">=</span> <span class="n">function</span><span class="o">.</span><span class="n">expression</span>
                    <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;el1&quot;</span><span class="p">,</span> <span class="s2">&quot;el2&quot;</span><span class="p">,</span> <span class="s2">&quot;el3&quot;</span><span class="p">,</span> <span class="s2">&quot;el4&quot;</span><span class="p">]:</span>
                        <span class="n">expression</span> <span class="o">=</span> <span class="n">expression</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">exf_pars</span><span class="p">,</span> <span class="n">el</span><span class="p">))</span>
                    <span class="k">if</span> <span class="s2">&quot;@static_rel&quot;</span> <span class="ow">in</span> <span class="n">expression</span><span class="p">:</span>
                        <span class="c1"># split function into time component and reliability component</span>
                        <span class="n">time_expr</span><span class="p">,</span> <span class="n">reliability_expr</span> <span class="o">=</span> <span class="n">expression</span><span class="o">.</span><span class="n">split</span><span class="p">(</span>
                            <span class="s2">&quot;*(1+@static_rel+&quot;</span>
                        <span class="p">)</span>
                        <span class="n">net_calc</span><span class="o">.</span><span class="n">add_calc</span><span class="p">(</span>
                            <span class="s2">&quot;@auto_time&quot;</span><span class="p">,</span>
                            <span class="n">time_expr</span><span class="p">,</span>
                            <span class="p">{</span><span class="s2">&quot;link&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;vdf=</span><span class="si">{</span><span class="n">function</span><span class="o">.</span><span class="n">id</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">},</span>
                        <span class="p">)</span>
                        <span class="n">net_calc</span><span class="o">.</span><span class="n">add_calc</span><span class="p">(</span>
                            <span class="s2">&quot;@reliability&quot;</span><span class="p">,</span>
                            <span class="sa">f</span><span class="s2">&quot;(@static_rel+</span><span class="si">{</span><span class="n">reliability_expr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="p">{</span><span class="s2">&quot;link&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;vdf=</span><span class="si">{</span><span class="n">function</span><span class="o">.</span><span class="n">id</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">},</span>
                        <span class="p">)</span>
                <span class="n">net_calc</span><span class="o">.</span><span class="n">add_calc</span><span class="p">(</span><span class="s2">&quot;@reliability_sq&quot;</span><span class="p">,</span> <span class="s2">&quot;@reliability**2&quot;</span><span class="p">)</span>
                <span class="n">net_calc</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log_start_end</span><span class="p">(</span>
                <span class="s2">&quot;Run SOLA assignment with path analyses and highway reliability&quot;</span><span class="p">,</span>
                <span class="n">level</span><span class="o">=</span><span class="s2">&quot;INFO&quot;</span><span class="p">,</span>
            <span class="p">):</span>
                <span class="n">assign</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assign_spec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scenario</span><span class="p">,</span> <span class="n">chart_log_interval</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="c1"># Subtract non-time costs from gen cost to get the raw travel time</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_calc_time_skims</span><span class="p">()</span>
            <span class="c1"># Set intra-zonal for time and dist to be 1/2 nearest neighbour</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_intrazonal_values</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_export_skims</span><span class="p">()</span>
            <span class="c1"># if self.logger.debug_enabled:</span>
            <span class="c1">#     self._log_debug_report(scenario, time)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">assign_spec_no_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return modified SOLA assignment specification with no analyses.&quot;&quot;&quot;</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">_copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assign_spec</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">emme_cls_spec</span> <span class="ow">in</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">]:</span>
            <span class="k">del</span> <span class="n">emme_cls_spec</span><span class="p">[</span><span class="s2">&quot;path_analyses&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">spec</span>

    <span class="nd">@_context</span>
    <span class="k">def</span> <span class="nf">_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setup and teardown for Emme Matrix cache and list of skim matrices.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log_start_end</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Run </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="si">}</span><span class="s2"> highway assignment&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;STATUS&quot;</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span> <span class="o">=</span> <span class="n">MatrixCache</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scenario</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_skim_matrix_objs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_network_calculator</span> <span class="o">=</span> <span class="n">NetworkCalculator</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">emme_manager</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scenario</span>
            <span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">yield</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_skim_matrix_objs</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_network_calculator</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_copy_maz_flow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Copy maz_flow from MAZ demand assignment to ul1 for background traffic.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_network_calculator</span><span class="p">(</span><span class="s2">&quot;ul1&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_reset_background_traffic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set ul1 for background traffic to 0 (no maz-maz flow).&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
            <span class="s2">&quot;Set ul1 to 0 for background traffic&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DETAIL&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_network_calculator</span><span class="p">(</span><span class="s2">&quot;ul1&quot;</span><span class="p">,</span> <span class="s2">&quot;@maz_flow&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_skim_matrices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create matrices to store skim results in Emme database.</span>

<span class="sd">        Also add the matrices to list of self._skim_matrix_objs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">create_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span><span class="s2">&quot;inro.emme.data.matrix.create_matrix&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log_start_end</span><span class="p">(</span><span class="s2">&quot;Creating skim matrices&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DETAIL&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">matrix_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">skim_matrix_ids</span><span class="p">:</span>
                <span class="n">matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emmebank</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">matrix_name</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">matrix</span><span class="p">:</span>
                    <span class="n">matrix</span> <span class="o">=</span> <span class="n">create_matrix</span><span class="p">(</span>
                        <span class="s2">&quot;mf&quot;</span><span class="p">,</span> <span class="n">matrix_name</span><span class="p">,</span> <span class="n">scenario</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scenario</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span>
                    <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_skim_matrix_objs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_calc_time_skims</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate the real time skim =gen_cost-per_fac*link_costs.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">emme_class_spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">assign_spec</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">]:</span>
            <span class="n">od_travel_times</span> <span class="o">=</span> <span class="n">emme_class_spec</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">][</span><span class="s2">&quot;od_travel_times&quot;</span><span class="p">][</span>
                <span class="s2">&quot;shortest_paths&quot;</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="n">od_travel_times</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Total link costs is always the first analysis</span>
                <span class="n">cost</span> <span class="o">=</span> <span class="n">emme_class_spec</span><span class="p">[</span><span class="s2">&quot;path_analyses&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;results&quot;</span><span class="p">][</span><span class="s2">&quot;od_values&quot;</span><span class="p">]</span>
                <span class="n">factor</span> <span class="o">=</span> <span class="n">emme_class_spec</span><span class="p">[</span><span class="s2">&quot;generalized_cost&quot;</span><span class="p">][</span><span class="s2">&quot;perception_factor&quot;</span><span class="p">]</span>
                <span class="n">gencost_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">od_travel_times</span><span class="p">)</span>
                <span class="n">cost_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">cost</span><span class="p">)</span>
                <span class="n">time_data</span> <span class="o">=</span> <span class="n">gencost_data</span> <span class="o">-</span> <span class="p">(</span><span class="n">factor</span> <span class="o">*</span> <span class="n">cost_data</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">od_travel_times</span><span class="p">,</span> <span class="n">time_data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_intrazonal_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the intrazonal values to 1/2 nearest neighbour for time and distance skims.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">matrix</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skim_matrix_objs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">matrix</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">((</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;dist&quot;</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Setting intrazonals to 0.5*min for </span><span class="si">{</span><span class="n">matrix</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="c1"># NOTE: sets values for external zones as well</span>
                <span class="n">np</span><span class="o">.</span><span class="n">fill_diagonal</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
                <span class="n">data</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">diag_indices_from</span><span class="p">(</span><span class="n">data</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_export_skims</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Export skims to OMX files by period.&quot;&quot;&quot;</span>
        <span class="c1"># NOTE: skims in separate file by period</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;export </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_skim_matrix_objs</span><span class="p">)</span><span class="si">}</span><span class="s2"> skim matrices to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">omx_file_path</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">omx_file_path</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">OMXManager</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">omx_file_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scenario</span><span class="p">,</span> <span class="n">matrix_cache</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">omx_file</span><span class="p">:</span>
            <span class="n">omx_file</span><span class="o">.</span><span class="n">write_matrices</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_skim_matrix_objs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_log_debug_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scenario</span><span class="p">:</span> <span class="n">EmmeScenario</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">num_zones</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">scenario</span><span class="o">.</span><span class="n">zone_numbers</span><span class="p">)</span>
        <span class="n">num_cells</span> <span class="o">=</span> <span class="n">num_zones</span> <span class="o">*</span> <span class="n">num_zones</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Highway skim summary for period </span><span class="si">{</span><span class="n">time_period</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Number of zones: </span><span class="si">{</span><span class="n">num_zones</span><span class="si">}</span><span class="s2">. Number of O-D pairs: </span><span class="si">{</span><span class="n">num_cells</span><span class="si">}</span><span class="s2">. &quot;</span>
            <span class="s2">&quot;Values outside -9999999, 9999999 are masked in summaries.&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;name                            min       max      mean           sum&quot;</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">matrix</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skim_matrix_objs</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_outside</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="o">-</span><span class="mi">9999999</span><span class="p">,</span> <span class="mi">9999999</span><span class="p">)</span>
            <span class="n">stats</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">matrix</span><span class="o">.</span><span class="n">name</span><span class="si">:</span><span class="s2">25</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">9.4g</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">9.4g</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">9.4g</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">:</span><span class="s2"> 13.7g</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">stats</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="tm2py.components.network.highway.highway_assign.AssignmentRunner.assign_spec_no_analysis" class="doc doc-heading">
            <code class=" language-python"><span class="n">assign_spec_no_analysis</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.components.network.highway.highway_assign.AssignmentRunner.assign_spec_no_analysis" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Return modified SOLA assignment specification with no analyses.</p>
    </div>

</div>



<div class="doc doc-object doc-function">


<h3 id="tm2py.components.network.highway.highway_assign.AssignmentRunner.__init__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">project_path</span><span class="p">,</span> <span class="n">emmebank_path</span><span class="p">,</span> <span class="n">scenario_id</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">iteration</span><span class="p">,</span> <span class="n">assign_spec</span><span class="p">,</span> <span class="n">demand_matrices</span><span class="p">,</span> <span class="n">skim_matrices</span><span class="p">,</span> <span class="n">omx_file_path</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#tm2py.components.network.highway.highway_assign.AssignmentRunner.__init__" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Constructor to run the highway assignment for the specified time period.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>project_path</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>path to existing EMME project (*.emp file)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>emmebank_path</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>path to existing EMME databsae (emmebank) file</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>scenario_id</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>existing scenario ID for assignment run</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>time</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>time period ID (only used for logging messages)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>iteration</code></td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>global iteration number</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>assign_spec</code></td>
            <td>
                  <code><span title="typing.Dict">Dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>EMME SOLA assignment specification</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>skim_matrices</code></td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of skim matrix ID.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>omx_file_path</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>path to resulting output of skim matrices to OMX</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>logger</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Logger (tm2py.logger.Logger)" href="#tm2py.logger.Logger">Logger</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>optional logger object if running in process.
If not specified a new logger reference is created.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/network/highway/highway_assign.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">project_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">emmebank_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">scenario_id</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
    <span class="n">time</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">iteration</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">assign_spec</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
    <span class="n">demand_matrices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">skim_matrices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">omx_file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Constructor to run the highway assignment for the specified time period.</span>

<span class="sd">    Args:</span>
<span class="sd">        project_path (str): path to existing EMME project (*.emp file)</span>
<span class="sd">        emmebank_path (str): path to existing EMME databsae (emmebank) file</span>
<span class="sd">        scenario_id (str): existing scenario ID for assignment run</span>
<span class="sd">        time (str): time period ID (only used for logging messages)</span>
<span class="sd">        iteration (List[str]): global iteration number</span>
<span class="sd">        assign_spec (Dict): EMME SOLA assignment specification</span>
<span class="sd">        skim_matrices (List[str]): list of skim matrix ID.</span>
<span class="sd">        omx_file_path (str): path to resulting output of skim matrices to OMX</span>
<span class="sd">        logger (Logger): optional logger object if running in process.</span>
<span class="sd">            If not specified a new logger reference is created.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">emme_manager</span> <span class="o">=</span> <span class="n">EmmeManagerLight</span><span class="p">(</span><span class="n">project_path</span><span class="p">,</span> <span class="n">emmebank_path</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">emmebank</span> <span class="o">=</span> <span class="n">Emmebank</span><span class="p">(</span><span class="n">emmebank_path</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">scenario</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emmebank</span><span class="o">.</span><span class="n">scenario</span><span class="p">(</span><span class="n">scenario_id</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">time</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">iteration</span> <span class="o">=</span> <span class="n">iteration</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assign_spec</span> <span class="o">=</span> <span class="n">assign_spec</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">skim_matrix_ids</span> <span class="o">=</span> <span class="n">skim_matrices</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">demand_matrix_ids</span> <span class="o">=</span> <span class="n">demand_matrices</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">omx_file_path</span> <span class="o">=</span> <span class="n">omx_file_path</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_network_calculator</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_skim_matrix_objs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">logger</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">project_path</span><span class="p">))</span>
        <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;run_highway_</span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">iteration</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">run_log_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.log&quot;</span><span class="p">)</span>
        <span class="n">log_on_error_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_error.log&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">ProcessLogger</span><span class="p">(</span>
            <span class="n">run_log_file_path</span><span class="p">,</span> <span class="n">log_on_error_file_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">emme_manager</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.network.highway.highway_assign.AssignmentRunner.run" class="doc doc-heading">
            <code class=" language-python"><span class="n">run</span><span class="p">()</span></code>

<a href="#tm2py.components.network.highway.highway_assign.AssignmentRunner.run" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Run time period highway assignment</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/network/highway/highway_assign.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s2">&quot;Run time period highway assignment&quot;</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setup</span><span class="p">():</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iteration</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_copy_maz_flow</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_reset_background_traffic</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">matrix_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">demand_matrix_ids</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">emmebank</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">matrix_name</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;demand matrix </span><span class="si">{</span><span class="n">matrix_name</span><span class="si">}</span><span class="s2"> does not exist&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_create_skim_matrices</span><span class="p">()</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">_skip_emme_logging</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assign_spec</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log_start_end</span><span class="p">(</span>
            <span class="s2">&quot;Run SOLA assignment (no path analyses)&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;INFO&quot;</span>
        <span class="p">):</span>
            <span class="n">assign</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span>
                <span class="s2">&quot;inro.emme.traffic_assignment.sola_traffic_assignment&quot;</span>
            <span class="p">)</span>
            <span class="n">assign</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assign_spec_no_analysis</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scenario</span><span class="p">,</span> <span class="n">chart_log_interval</span><span class="o">=</span><span class="mi">1</span>
            <span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log_start_end</span><span class="p">(</span>
            <span class="s2">&quot;Calculates link level LOS based reliability&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DETAIL&quot;</span>
        <span class="p">):</span>
            <span class="n">exf_pars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scenario</span><span class="o">.</span><span class="n">emmebank</span><span class="o">.</span><span class="n">extra_function_parameters</span>
            <span class="n">vdfs</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">emmebank</span><span class="o">.</span><span class="n">functions</span><span class="p">()</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;VOLUME_DELAY&quot;</span>
            <span class="p">]</span>
            <span class="n">net_calc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_network_calculator</span>
            <span class="k">for</span> <span class="n">function</span> <span class="ow">in</span> <span class="n">vdfs</span><span class="p">:</span>
                <span class="n">expression</span> <span class="o">=</span> <span class="n">function</span><span class="o">.</span><span class="n">expression</span>
                <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;el1&quot;</span><span class="p">,</span> <span class="s2">&quot;el2&quot;</span><span class="p">,</span> <span class="s2">&quot;el3&quot;</span><span class="p">,</span> <span class="s2">&quot;el4&quot;</span><span class="p">]:</span>
                    <span class="n">expression</span> <span class="o">=</span> <span class="n">expression</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">exf_pars</span><span class="p">,</span> <span class="n">el</span><span class="p">))</span>
                <span class="k">if</span> <span class="s2">&quot;@static_rel&quot;</span> <span class="ow">in</span> <span class="n">expression</span><span class="p">:</span>
                    <span class="c1"># split function into time component and reliability component</span>
                    <span class="n">time_expr</span><span class="p">,</span> <span class="n">reliability_expr</span> <span class="o">=</span> <span class="n">expression</span><span class="o">.</span><span class="n">split</span><span class="p">(</span>
                        <span class="s2">&quot;*(1+@static_rel+&quot;</span>
                    <span class="p">)</span>
                    <span class="n">net_calc</span><span class="o">.</span><span class="n">add_calc</span><span class="p">(</span>
                        <span class="s2">&quot;@auto_time&quot;</span><span class="p">,</span>
                        <span class="n">time_expr</span><span class="p">,</span>
                        <span class="p">{</span><span class="s2">&quot;link&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;vdf=</span><span class="si">{</span><span class="n">function</span><span class="o">.</span><span class="n">id</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">},</span>
                    <span class="p">)</span>
                    <span class="n">net_calc</span><span class="o">.</span><span class="n">add_calc</span><span class="p">(</span>
                        <span class="s2">&quot;@reliability&quot;</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s2">&quot;(@static_rel+</span><span class="si">{</span><span class="n">reliability_expr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="p">{</span><span class="s2">&quot;link&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;vdf=</span><span class="si">{</span><span class="n">function</span><span class="o">.</span><span class="n">id</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">},</span>
                    <span class="p">)</span>
            <span class="n">net_calc</span><span class="o">.</span><span class="n">add_calc</span><span class="p">(</span><span class="s2">&quot;@reliability_sq&quot;</span><span class="p">,</span> <span class="s2">&quot;@reliability**2&quot;</span><span class="p">)</span>
            <span class="n">net_calc</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log_start_end</span><span class="p">(</span>
            <span class="s2">&quot;Run SOLA assignment with path analyses and highway reliability&quot;</span><span class="p">,</span>
            <span class="n">level</span><span class="o">=</span><span class="s2">&quot;INFO&quot;</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="n">assign</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assign_spec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scenario</span><span class="p">,</span> <span class="n">chart_log_interval</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Subtract non-time costs from gen cost to get the raw travel time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_calc_time_skims</span><span class="p">()</span>
        <span class="c1"># Set intra-zonal for time and dist to be 1/2 nearest neighbour</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_intrazonal_values</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_export_skims</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.components.network.highway.highway_assign.HighwayAssignment" class="doc doc-heading">
            <code>HighwayAssignment</code>


<a href="#tm2py.components.network.highway.highway_assign.HighwayAssignment" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="Component (tm2py.components.component.Component)" href="#tm2py.components.component.Component">Component</a></code></p>


      <p>Highway assignment and skims.
Args:
    controller: parent RunController object</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/components/network/highway/highway_assign.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">HighwayAssignment</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Highway assignment and skims.</span>
<span class="sd">    Args:</span>
<span class="sd">        controller: parent RunController object</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="s2">&quot;RunController&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor for HighwayAssignment components.</span>

<span class="sd">        Args:</span>
<span class="sd">            controller (RunController): Reference to current run controller.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_highway_emmebank</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_class_config</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">highway_emmebank</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;The ProxyEmmebank object connect to the EMMEBANK for the highway assignment.&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_highway_emmebank</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_highway_emmebank</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">highway_emmebank</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_highway_emmebank</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">classes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;The list of class names in the highway config&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">class_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Mapping of class names and config objs in the highway config.&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_class_config</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_class_config</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span><span class="p">}</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_class_config</span>

    <span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate inputs files are correct, raise if an error is found.&quot;&quot;&quot;</span>

    <span class="nd">@LogStartEnd</span><span class="p">(</span><span class="s2">&quot;Highway assignment and skims&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;STATUS&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run highway assignment.&quot;&quot;&quot;</span>
        <span class="n">demand</span> <span class="o">=</span> <span class="n">PrepareHighwayDemand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">iteration</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">highway_emmebank</span><span class="o">.</span><span class="n">create_zero_matrix</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">warmstart</span><span class="o">.</span><span class="n">warmstart</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">warmstart</span><span class="o">.</span><span class="n">use_warmstart_demand</span><span class="p">:</span>
                    <span class="n">demand</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">demand</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

        <span class="n">distribution</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">emme</span><span class="o">.</span><span class="n">highway_distribution</span>
        <span class="k">if</span> <span class="n">distribution</span><span class="p">:</span>
            <span class="n">launchers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setup_process_launchers</span><span class="p">(</span><span class="n">distribution</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_proccesses</span><span class="p">(</span><span class="n">launchers</span><span class="p">)</span>
            <span class="c1"># Run last configuration in process</span>
            <span class="n">in_process_times</span> <span class="o">=</span> <span class="n">distribution</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">time_periods</span>
            <span class="n">num_processors</span> <span class="o">=</span> <span class="n">distribution</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">num_processors</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_in_process</span><span class="p">(</span><span class="n">in_process_times</span><span class="p">,</span> <span class="n">num_processors</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_processes</span><span class="p">(</span><span class="n">launchers</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">num_processors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">num_processors</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_in_process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">,</span> <span class="n">num_processors</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">run_in_process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">times</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">num_processors</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]):</span>
        <span class="s2">&quot;Start highway assignments in same process&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">status</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Running highway assignments in process: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">times</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">iteration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">iteration</span>
        <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">times</span><span class="p">:</span>
            <span class="n">project_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">project_path</span>
            <span class="n">emmebank_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">highway_emmebank</span><span class="o">.</span><span class="n">path</span>
            <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_assign_params</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">num_processors</span><span class="p">)</span>
            <span class="n">runner</span> <span class="o">=</span> <span class="n">AssignmentRunner</span><span class="p">(</span>
                <span class="n">project_path</span><span class="p">,</span>
                <span class="n">emmebank_path</span><span class="p">,</span>
                <span class="n">iteration</span><span class="o">=</span><span class="n">iteration</span><span class="p">,</span>
                <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span>
                <span class="o">**</span><span class="n">params</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">runner</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">setup_process_launchers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distribution</span><span class="p">):</span>
        <span class="s2">&quot;Setup (copy data) databases for running assignments in separate processes&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">status</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Running highway assignments in </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">distribution</span><span class="p">)</span><span class="si">}</span><span class="s2"> separate processes&quot;</span>
        <span class="p">)</span>
        <span class="n">iteration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">iteration</span>
        <span class="n">launchers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">time_params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">config</span> <span class="ow">in</span> <span class="n">distribution</span><span class="p">:</span>
            <span class="n">assign_launcher</span> <span class="o">=</span> <span class="n">AssignmentLauncher</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">highway_emmebank</span><span class="o">.</span><span class="n">emmebank</span><span class="p">,</span> <span class="n">iteration</span>
            <span class="p">)</span>
            <span class="n">launchers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">assign_launcher</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">time_periods</span><span class="p">:</span>
                <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_assign_params</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">num_processors</span><span class="p">)</span>
                <span class="n">assign_launcher</span><span class="o">.</span><span class="n">add_run</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
                <span class="n">time_params</span><span class="p">[</span><span class="n">time</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span>

        <span class="c1"># initialize all skim matrices - complete all periods in order</span>
        <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="n">time_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">params</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">matrix_name</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;skim_matrices&quot;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">highway_emmebank</span><span class="o">.</span><span class="n">create_matrix</span><span class="p">(</span><span class="n">matrix_name</span><span class="p">,</span> <span class="s2">&quot;FULL&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">launchers</span>

    <span class="k">def</span> <span class="nf">start_proccesses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">launchers</span><span class="p">):</span>
        <span class="s2">&quot;Start separate processes for running assignments&quot;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">assign_launcher</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">launchers</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">status</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Starting highway assignment process </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">assign_launcher</span><span class="o">.</span><span class="n">times</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="n">assign_launcher</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
            <span class="n">assign_launcher</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">wait_for_processes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">launchers</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">status</span><span class="p">(</span><span class="s2">&quot;Waiting for highway assignments to complete...&quot;</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">launchers</span><span class="p">:</span>
            <span class="n">_time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">assign_launcher</span> <span class="ow">in</span> <span class="n">launchers</span><span class="p">[:]:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">assign_launcher</span><span class="o">.</span><span class="n">is_running</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">status</span><span class="p">(</span>
                        <span class="s2">&quot;... assignment process complete for time(s): &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">assign_launcher</span><span class="o">.</span><span class="n">times</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                    <span class="n">assign_launcher</span><span class="o">.</span><span class="n">teardown</span><span class="p">()</span>
                    <span class="n">launchers</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">assign_launcher</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_assign_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">num_processors</span><span class="p">):</span>
        <span class="n">iteration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">iteration</span>
        <span class="n">warmstart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">warmstart</span><span class="o">.</span><span class="n">warmstart</span>
        <span class="n">builder</span> <span class="o">=</span> <span class="n">AssignmentSpecBuilder</span><span class="p">(</span>
            <span class="n">time</span><span class="p">,</span> <span class="n">iteration</span><span class="p">,</span> <span class="n">warmstart</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">num_processors</span>
        <span class="p">)</span>
        <span class="c1"># Must match signature of manager.BaseAssignmentLauncher.add_run</span>
        <span class="c1">#       time, scenario, assign_spec, demand_matrices, skim_matrices, omx_file_path</span>
        <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span>
            <span class="n">scenario_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">highway_emmebank</span><span class="o">.</span><span class="n">scenario</span><span class="p">(</span><span class="n">time</span><span class="p">)</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">assign_spec</span><span class="o">=</span><span class="n">builder</span><span class="o">.</span><span class="n">assignment_spec</span><span class="p">,</span>
            <span class="n">demand_matrices</span><span class="o">=</span><span class="n">builder</span><span class="o">.</span><span class="n">demand_matrices</span><span class="p">,</span>
            <span class="n">skim_matrices</span><span class="o">=</span><span class="n">builder</span><span class="o">.</span><span class="n">skim_matrices</span><span class="p">,</span>
            <span class="n">omx_file_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">output_skim_path</span>
                <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">output_skim_filename_tmpl</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time_period</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;_get_assign_params: self.config.output_skim_path:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">output_skim_path</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">_skip_emme_logging</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;_get_assign_params: params dictionary&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log_dict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">params</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="tm2py.components.network.highway.highway_assign.HighwayAssignment.class_config" class="doc doc-heading">
            <code class=" language-python"><span class="n">class_config</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.components.network.highway.highway_assign.HighwayAssignment.class_config" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Mapping of class names and config objs in the highway config.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tm2py.components.network.highway.highway_assign.HighwayAssignment.classes" class="doc doc-heading">
            <code class=" language-python"><span class="n">classes</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.components.network.highway.highway_assign.HighwayAssignment.classes" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>The list of class names in the highway config</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tm2py.components.network.highway.highway_assign.HighwayAssignment.highway_emmebank" class="doc doc-heading">
            <code class=" language-python"><span class="n">highway_emmebank</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.components.network.highway.highway_assign.HighwayAssignment.highway_emmebank" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>The ProxyEmmebank object connect to the EMMEBANK for the highway assignment.</p>
    </div>

</div>



<div class="doc doc-object doc-function">


<h3 id="tm2py.components.network.highway.highway_assign.HighwayAssignment.__init__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span></code>

<a href="#tm2py.components.network.highway.highway_assign.HighwayAssignment.__init__" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Constructor for HighwayAssignment components.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>controller</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="RunController (tm2py.controller.RunController)" href="#tm2py.controller.RunController">RunController</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reference to current run controller.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/network/highway/highway_assign.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="s2">&quot;RunController&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Constructor for HighwayAssignment components.</span>

<span class="sd">    Args:</span>
<span class="sd">        controller (RunController): Reference to current run controller.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_highway_emmebank</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_class_config</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.network.highway.highway_assign.HighwayAssignment.run" class="doc doc-heading">
            <code class=" language-python"><span class="n">run</span><span class="p">()</span></code>

<a href="#tm2py.components.network.highway.highway_assign.HighwayAssignment.run" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Run highway assignment.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/network/highway/highway_assign.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@LogStartEnd</span><span class="p">(</span><span class="s2">&quot;Highway assignment and skims&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;STATUS&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run highway assignment.&quot;&quot;&quot;</span>
    <span class="n">demand</span> <span class="o">=</span> <span class="n">PrepareHighwayDemand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">iteration</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">highway_emmebank</span><span class="o">.</span><span class="n">create_zero_matrix</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">warmstart</span><span class="o">.</span><span class="n">warmstart</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">warmstart</span><span class="o">.</span><span class="n">use_warmstart_demand</span><span class="p">:</span>
                <span class="n">demand</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">demand</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="n">distribution</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">emme</span><span class="o">.</span><span class="n">highway_distribution</span>
    <span class="k">if</span> <span class="n">distribution</span><span class="p">:</span>
        <span class="n">launchers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setup_process_launchers</span><span class="p">(</span><span class="n">distribution</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_proccesses</span><span class="p">(</span><span class="n">launchers</span><span class="p">)</span>
        <span class="c1"># Run last configuration in process</span>
        <span class="n">in_process_times</span> <span class="o">=</span> <span class="n">distribution</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">time_periods</span>
        <span class="n">num_processors</span> <span class="o">=</span> <span class="n">distribution</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">num_processors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_in_process</span><span class="p">(</span><span class="n">in_process_times</span><span class="p">,</span> <span class="n">num_processors</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_processes</span><span class="p">(</span><span class="n">launchers</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">num_processors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">num_processors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_in_process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">,</span> <span class="n">num_processors</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.network.highway.highway_assign.HighwayAssignment.run_in_process" class="doc doc-heading">
            <code class=" language-python"><span class="n">run_in_process</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">num_processors</span><span class="p">)</span></code>

<a href="#tm2py.components.network.highway.highway_assign.HighwayAssignment.run_in_process" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Start highway assignments in same process</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/network/highway/highway_assign.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_in_process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">times</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">num_processors</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]):</span>
    <span class="s2">&quot;Start highway assignments in same process&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">status</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Running highway assignments in process: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">times</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
    <span class="n">iteration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">iteration</span>
    <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">times</span><span class="p">:</span>
        <span class="n">project_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">project_path</span>
        <span class="n">emmebank_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">highway_emmebank</span><span class="o">.</span><span class="n">path</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_assign_params</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">num_processors</span><span class="p">)</span>
        <span class="n">runner</span> <span class="o">=</span> <span class="n">AssignmentRunner</span><span class="p">(</span>
            <span class="n">project_path</span><span class="p">,</span>
            <span class="n">emmebank_path</span><span class="p">,</span>
            <span class="n">iteration</span><span class="o">=</span><span class="n">iteration</span><span class="p">,</span>
            <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span>
            <span class="o">**</span><span class="n">params</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">runner</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.network.highway.highway_assign.HighwayAssignment.setup_process_launchers" class="doc doc-heading">
            <code class=" language-python"><span class="n">setup_process_launchers</span><span class="p">(</span><span class="n">distribution</span><span class="p">)</span></code>

<a href="#tm2py.components.network.highway.highway_assign.HighwayAssignment.setup_process_launchers" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Setup (copy data) databases for running assignments in separate processes</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/network/highway/highway_assign.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">setup_process_launchers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distribution</span><span class="p">):</span>
    <span class="s2">&quot;Setup (copy data) databases for running assignments in separate processes&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">status</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Running highway assignments in </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">distribution</span><span class="p">)</span><span class="si">}</span><span class="s2"> separate processes&quot;</span>
    <span class="p">)</span>
    <span class="n">iteration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">iteration</span>
    <span class="n">launchers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">time_params</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">config</span> <span class="ow">in</span> <span class="n">distribution</span><span class="p">:</span>
        <span class="n">assign_launcher</span> <span class="o">=</span> <span class="n">AssignmentLauncher</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">highway_emmebank</span><span class="o">.</span><span class="n">emmebank</span><span class="p">,</span> <span class="n">iteration</span>
        <span class="p">)</span>
        <span class="n">launchers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">assign_launcher</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">time_periods</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_assign_params</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">num_processors</span><span class="p">)</span>
            <span class="n">assign_launcher</span><span class="o">.</span><span class="n">add_run</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
            <span class="n">time_params</span><span class="p">[</span><span class="n">time</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span>

    <span class="c1"># initialize all skim matrices - complete all periods in order</span>
    <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">:</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">time_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">params</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">matrix_name</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;skim_matrices&quot;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">highway_emmebank</span><span class="o">.</span><span class="n">create_matrix</span><span class="p">(</span><span class="n">matrix_name</span><span class="p">,</span> <span class="s2">&quot;FULL&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">launchers</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.network.highway.highway_assign.HighwayAssignment.start_proccesses" class="doc doc-heading">
            <code class=" language-python"><span class="n">start_proccesses</span><span class="p">(</span><span class="n">launchers</span><span class="p">)</span></code>

<a href="#tm2py.components.network.highway.highway_assign.HighwayAssignment.start_proccesses" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Start separate processes for running assignments</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/network/highway/highway_assign.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">start_proccesses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">launchers</span><span class="p">):</span>
    <span class="s2">&quot;Start separate processes for running assignments&quot;</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">assign_launcher</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">launchers</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">status</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Starting highway assignment process </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">assign_launcher</span><span class="o">.</span><span class="n">times</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">assign_launcher</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
        <span class="n">assign_launcher</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.network.highway.highway_assign.HighwayAssignment.validate_inputs" class="doc doc-heading">
            <code class=" language-python"><span class="n">validate_inputs</span><span class="p">()</span></code>

<a href="#tm2py.components.network.highway.highway_assign.HighwayAssignment.validate_inputs" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Validate inputs files are correct, raise if an error is found.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/network/highway/highway_assign.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">108</span>
<span class="normal">109</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate inputs files are correct, raise if an error is found.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<a id="tm2py.config.HighwayConfig"></a>
    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Highway assignment and skims parameters.</p>


<details class="properties" open>
  <summary>Properties</summary>
  
</details>
              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">HighwayConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Highway assignment and skims parameters.</span>

<span class="sd">    Properties:</span>
<span class="sd">        generic_highway_mode_code: single character unique mode ID for entire</span>
<span class="sd">            highway network (no excluded_links)</span>
<span class="sd">        relative_gaps: relative gaps for assignment convergence, specific to global iteration, see HighwayRelativeGapConfig</span>
<span class="sd">        max_iterations: maximum iterations stopping criteria</span>
<span class="sd">        area_type_buffer_dist_miles: used to in calculation to categorize link @areatype</span>
<span class="sd">            The area type is determined based on the average density of nearby</span>
<span class="sd">            (within this buffer distance) MAZs, using (pop+jobs*2.5)/acres</span>
<span class="sd">        drive_access_output_skim_path: relative path for drive access to transit skims</span>
<span class="sd">        output_skim_path: relative path template from run dir for OMX output skims</span>
<span class="sd">        output_skim_filename_tmpl: template for OMX filename for a time period. Must include</span>
<span class="sd">            {time_period} in the string and end in &#39;.omx&#39;.</span>
<span class="sd">        output_skim_matrixname_tmpl: template for matrix names within OMX output skims.</span>
<span class="sd">            Should include {time_period}, {mode}, and {property}</span>
<span class="sd">        tolls: input toll specification, see HighwayTollsConfig</span>
<span class="sd">        maz_to_maz: maz-to-maz shortest path assignment and skim specification,</span>
<span class="sd">            see HighwayMazToMazConfig</span>
<span class="sd">        classes: highway assignment multi-class setup and skim specification,</span>
<span class="sd">            see HighwayClassConfig</span>
<span class="sd">        capclass_lookup: index cross-reference table from the link @capclass value</span>
<span class="sd">            to the free-flow speed, capacity, and critical speed values</span>
<span class="sd">        interchange_nodes_file: relative path to the interchange nodes file, this is</span>
<span class="sd">            used for calculating highway reliability</span>
<span class="sd">        apply_msa_demand: average highway demand with previous iterations&#39;. Default to True.</span>
<span class="sd">        reliability: bool to skim highway reliability. Default to true. If true, assignment</span>
<span class="sd">            will be run twice in global iterations 0 (warmstart) and 1, to calculate reliability,</span>
<span class="sd">            assignment will be run only once in global iterations 2 and 3,</span>
<span class="sd">            reliability skim will stay the same as global iteration 1.</span>
<span class="sd">            If false, reliability will not be calculated nor skimmed in all global</span>
<span class="sd">            iterations, and the resulting reliability skims will be 0.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">generic_highway_mode_code</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">relative_gaps</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">HighwayRelativeGapConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">max_iterations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">network_acceleration</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">area_type_buffer_dist_miles</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">drive_access_output_skim_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">output_skim_path</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">output_skim_filename_tmpl</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">output_skim_matrixname_tmpl</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">tolls</span><span class="p">:</span> <span class="n">HighwayTollsConfig</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">maz_to_maz</span><span class="p">:</span> <span class="n">HighwayMazToMazConfig</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">classes</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">HighwayClassConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">capclass_lookup</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">HighwayCapClassConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">interchange_nodes_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">apply_msa_demand</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">reliability</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;output_skim_filename_tmpl&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">valid_skim_template</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate skim template has correct {} and extension.&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="s2">&quot;{time_period&quot;</span> <span class="ow">in</span> <span class="n">value</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;-&gt; output_skim_filename_tmpl must have </span><span class="se">{{</span><span class="s2">time_period</span><span class="se">}}</span><span class="s2">&#39;, found </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">value</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;.omx&quot;</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;-&gt; &#39;output_skim_filename_tmpl must end in &#39;.omx&#39;, found </span><span class="si">{</span><span class="n">value</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="w"> </span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;output_skim_matrixname_tmpl&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">valid_skim_matrix_name_template</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate skim matrix template has correct {}.&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="s2">&quot;{time_period&quot;</span> <span class="ow">in</span> <span class="n">value</span>
        <span class="p">),</span> <span class="s2">&quot;-&gt; &#39;output_skim_matrixname_tmpl must have </span><span class="si">{time_period}</span><span class="s2">, found </span><span class="si">{value}</span><span class="s2">.&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="s2">&quot;{property&quot;</span> <span class="ow">in</span> <span class="n">value</span>
        <span class="p">),</span> <span class="s2">&quot;-&gt; &#39;output_skim_matrixname_tmpl must have </span><span class="si">{property}</span><span class="s2">, found </span><span class="si">{value}</span><span class="s2">.&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="s2">&quot;{mode&quot;</span> <span class="ow">in</span> <span class="n">value</span>
        <span class="p">),</span> <span class="s2">&quot;-&gt; &#39;output_skim_matrixname_tmpl must have </span><span class="si">{mode}</span><span class="s2">, found </span><span class="si">{value}</span><span class="s2">.&quot;</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;capclass_lookup&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">unique_capclass_numbers</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate list of capclass_lookup has unique .capclass values.&quot;&quot;&quot;</span>
        <span class="n">capclass_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">capclass</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
        <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;-&gt; capclass value must be unique in list&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">capclass_ids</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">capclass_ids</span><span class="p">)),</span> <span class="n">error_msg</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;classes&quot;</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">unique_class_names</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate list of classes has unique .name values.&quot;&quot;&quot;</span>
        <span class="n">class_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">highway_class</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
        <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;-&gt; name value must be unique in list&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">class_names</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">class_names</span><span class="p">)),</span> <span class="n">error_msg</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;classes&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">validate_class_mode_excluded_links</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate list of classes has unique .mode_code or .excluded_links match.&quot;&quot;&quot;</span>
        <span class="c1"># validate if any mode IDs are used twice, that they have the same excluded links sets</span>
        <span class="n">mode_excluded_links</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">highway_class</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="c1"># maz_to_maz.mode_code must be unique</span>
            <span class="k">if</span> <span class="s2">&quot;maz_to_maz&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;mode_code&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;maz_to_maz&quot;</span><span class="p">][</span><span class="s2">&quot;mode_code&quot;</span><span class="p">]</span>
                <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;-&gt; </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> -&gt; mode_code: cannot be the same as the highway.maz_to_maz.mode_code&quot;</span>
            <span class="c1"># make sure that if any mode IDs are used twice, they have the same excluded links sets</span>
            <span class="k">if</span> <span class="n">highway_class</span><span class="o">.</span><span class="n">mode_code</span> <span class="ow">in</span> <span class="n">mode_excluded_links</span><span class="p">:</span>
                <span class="n">ex_links1</span> <span class="o">=</span> <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;excluded_links&quot;</span><span class="p">]</span>
                <span class="n">ex_links2</span> <span class="o">=</span> <span class="n">mode_excluded_links</span><span class="p">[</span><span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;mode_code&quot;</span><span class="p">]]</span>
                <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;-&gt; </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: duplicated mode codes (&#39;</span><span class="si">{</span><span class="n">highway_class</span><span class="p">[</span><span class="s1">&#39;mode_code&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;) &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;with different excluded links: </span><span class="si">{</span><span class="n">ex_links1</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">ex_links2</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="k">assert</span> <span class="n">ex_links1</span> <span class="o">==</span> <span class="n">ex_links2</span><span class="p">,</span> <span class="n">error_msg</span>
            <span class="n">mode_excluded_links</span><span class="p">[</span><span class="n">highway_class</span><span class="o">.</span><span class="n">mode_code</span><span class="p">]</span> <span class="o">=</span> <span class="n">highway_class</span><span class="o">.</span><span class="n">excluded_links</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;classes&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">validate_class_keyword_lists</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate classes .skims, .toll, and .excluded_links values.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;tolls&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="n">avail_skims</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;time&quot;</span><span class="p">,</span>
            <span class="s2">&quot;dist&quot;</span><span class="p">,</span>
            <span class="s2">&quot;hovdist&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tolldist&quot;</span><span class="p">,</span>
            <span class="s2">&quot;freeflowtime&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rlbty&quot;</span><span class="p">,</span>
            <span class="s2">&quot;autotime&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">available_link_sets</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;is_sr&quot;</span><span class="p">,</span> <span class="s2">&quot;is_sr2&quot;</span><span class="p">,</span> <span class="s2">&quot;is_sr3&quot;</span><span class="p">,</span> <span class="s2">&quot;is_auto_only&quot;</span><span class="p">]</span>
        <span class="n">avail_toll_attrs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;tolls&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dst_vehicle_group_names</span><span class="p">:</span>
            <span class="n">toll_types</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;bridgetoll_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;valuetoll_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
            <span class="n">avail_skims</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">toll_types</span><span class="p">)</span>
            <span class="n">avail_toll_attrs</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;@&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">toll_types</span><span class="p">])</span>
            <span class="n">available_link_sets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;is_toll_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># validate class skim name list and toll attribute against toll setup</span>
        <span class="k">def</span> <span class="nf">check_keywords</span><span class="p">(</span><span class="n">class_num</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">available</span><span class="p">):</span>
            <span class="n">extra_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">available</span><span class="p">)</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot; -&gt; </span><span class="si">{</span><span class="n">class_num</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: unrecognized </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> name(s): &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">extra_keys</span><span class="p">)</span><span class="si">}</span><span class="s2">.  Available names are: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">available</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="n">extra_keys</span><span class="p">,</span> <span class="n">error_msg</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">highway_class</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="n">check_keywords</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;skim&quot;</span><span class="p">,</span> <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;skims&quot;</span><span class="p">],</span> <span class="n">avail_skims</span><span class="p">)</span>
            <span class="n">check_keywords</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;toll&quot;</span><span class="p">,</span> <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;toll&quot;</span><span class="p">],</span> <span class="n">avail_toll_attrs</span><span class="p">)</span>
            <span class="n">check_keywords</span><span class="p">(</span>
                <span class="n">i</span><span class="p">,</span>
                <span class="s2">&quot;excluded_links&quot;</span><span class="p">,</span>
                <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;excluded_links&quot;</span><span class="p">],</span>
                <span class="n">available_link_sets</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="tm2py.config.HighwayConfig.unique_capclass_numbers" class="doc doc-heading">
            <code class=" language-python"><span class="n">unique_capclass_numbers</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

<a href="#tm2py.config.HighwayConfig.unique_capclass_numbers" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">

      <p>Validate list of capclass_lookup has unique .capclass values.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/config.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;capclass_lookup&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">unique_capclass_numbers</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate list of capclass_lookup has unique .capclass values.&quot;&quot;&quot;</span>
    <span class="n">capclass_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">capclass</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
    <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;-&gt; capclass value must be unique in list&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">capclass_ids</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">capclass_ids</span><span class="p">)),</span> <span class="n">error_msg</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tm2py.config.HighwayConfig.unique_class_names" class="doc doc-heading">
            <code class=" language-python"><span class="n">unique_class_names</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

<a href="#tm2py.config.HighwayConfig.unique_class_names" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">

      <p>Validate list of classes has unique .name values.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/config.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;classes&quot;</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">unique_class_names</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate list of classes has unique .name values.&quot;&quot;&quot;</span>
    <span class="n">class_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">highway_class</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
    <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;-&gt; name value must be unique in list&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">class_names</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">class_names</span><span class="p">)),</span> <span class="n">error_msg</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tm2py.config.HighwayConfig.valid_skim_matrix_name_template" class="doc doc-heading">
            <code class=" language-python"><span class="n">valid_skim_matrix_name_template</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

<a href="#tm2py.config.HighwayConfig.valid_skim_matrix_name_template" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">

      <p>Validate skim matrix template has correct {}.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/config.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;output_skim_matrixname_tmpl&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">valid_skim_matrix_name_template</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate skim matrix template has correct {}.&quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="s2">&quot;{time_period&quot;</span> <span class="ow">in</span> <span class="n">value</span>
    <span class="p">),</span> <span class="s2">&quot;-&gt; &#39;output_skim_matrixname_tmpl must have </span><span class="si">{time_period}</span><span class="s2">, found </span><span class="si">{value}</span><span class="s2">.&quot;</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="s2">&quot;{property&quot;</span> <span class="ow">in</span> <span class="n">value</span>
    <span class="p">),</span> <span class="s2">&quot;-&gt; &#39;output_skim_matrixname_tmpl must have </span><span class="si">{property}</span><span class="s2">, found </span><span class="si">{value}</span><span class="s2">.&quot;</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="s2">&quot;{mode&quot;</span> <span class="ow">in</span> <span class="n">value</span>
    <span class="p">),</span> <span class="s2">&quot;-&gt; &#39;output_skim_matrixname_tmpl must have </span><span class="si">{mode}</span><span class="s2">, found </span><span class="si">{value}</span><span class="s2">.&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tm2py.config.HighwayConfig.valid_skim_template" class="doc doc-heading">
            <code class=" language-python"><span class="n">valid_skim_template</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

<a href="#tm2py.config.HighwayConfig.valid_skim_template" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">

      <p>Validate skim template has correct {} and extension.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/config.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">982</span>
<span class="normal">983</span>
<span class="normal">984</span>
<span class="normal">985</span>
<span class="normal">986</span>
<span class="normal">987</span>
<span class="normal">988</span>
<span class="normal">989</span>
<span class="normal">990</span>
<span class="normal">991</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;output_skim_filename_tmpl&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">valid_skim_template</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate skim template has correct {} and extension.&quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="s2">&quot;{time_period&quot;</span> <span class="ow">in</span> <span class="n">value</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;-&gt; output_skim_filename_tmpl must have </span><span class="se">{{</span><span class="s2">time_period</span><span class="se">}}</span><span class="s2">&#39;, found </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">.&quot;</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">value</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;.omx&quot;</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;-&gt; &#39;output_skim_filename_tmpl must end in &#39;.omx&#39;, found </span><span class="si">{</span><span class="n">value</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="w"> </span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tm2py.config.HighwayConfig.validate_class_keyword_lists" class="doc doc-heading">
            <code class=" language-python"><span class="n">validate_class_keyword_lists</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>

<a href="#tm2py.config.HighwayConfig.validate_class_keyword_lists" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">

      <p>Validate classes .skims, .toll, and .excluded_links values.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/config.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;classes&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">validate_class_keyword_lists</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate classes .skims, .toll, and .excluded_links values.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;tolls&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">value</span>
    <span class="n">avail_skims</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;time&quot;</span><span class="p">,</span>
        <span class="s2">&quot;dist&quot;</span><span class="p">,</span>
        <span class="s2">&quot;hovdist&quot;</span><span class="p">,</span>
        <span class="s2">&quot;tolldist&quot;</span><span class="p">,</span>
        <span class="s2">&quot;freeflowtime&quot;</span><span class="p">,</span>
        <span class="s2">&quot;rlbty&quot;</span><span class="p">,</span>
        <span class="s2">&quot;autotime&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">available_link_sets</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;is_sr&quot;</span><span class="p">,</span> <span class="s2">&quot;is_sr2&quot;</span><span class="p">,</span> <span class="s2">&quot;is_sr3&quot;</span><span class="p">,</span> <span class="s2">&quot;is_auto_only&quot;</span><span class="p">]</span>
    <span class="n">avail_toll_attrs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;tolls&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dst_vehicle_group_names</span><span class="p">:</span>
        <span class="n">toll_types</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;bridgetoll_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;valuetoll_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="n">avail_skims</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">toll_types</span><span class="p">)</span>
        <span class="n">avail_toll_attrs</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;@&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">toll_types</span><span class="p">])</span>
        <span class="n">available_link_sets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;is_toll_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># validate class skim name list and toll attribute against toll setup</span>
    <span class="k">def</span> <span class="nf">check_keywords</span><span class="p">(</span><span class="n">class_num</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">available</span><span class="p">):</span>
        <span class="n">extra_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">available</span><span class="p">)</span>
        <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot; -&gt; </span><span class="si">{</span><span class="n">class_num</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: unrecognized </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> name(s): &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">extra_keys</span><span class="p">)</span><span class="si">}</span><span class="s2">.  Available names are: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">available</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">extra_keys</span><span class="p">,</span> <span class="n">error_msg</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">highway_class</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="n">check_keywords</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;skim&quot;</span><span class="p">,</span> <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;skims&quot;</span><span class="p">],</span> <span class="n">avail_skims</span><span class="p">)</span>
        <span class="n">check_keywords</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;toll&quot;</span><span class="p">,</span> <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;toll&quot;</span><span class="p">],</span> <span class="n">avail_toll_attrs</span><span class="p">)</span>
        <span class="n">check_keywords</span><span class="p">(</span>
            <span class="n">i</span><span class="p">,</span>
            <span class="s2">&quot;excluded_links&quot;</span><span class="p">,</span>
            <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;excluded_links&quot;</span><span class="p">],</span>
            <span class="n">available_link_sets</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tm2py.config.HighwayConfig.validate_class_mode_excluded_links" class="doc doc-heading">
            <code class=" language-python"><span class="n">validate_class_mode_excluded_links</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>

<a href="#tm2py.config.HighwayConfig.validate_class_mode_excluded_links" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">

      <p>Validate list of classes has unique .mode_code or .excluded_links match.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/config.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;classes&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">validate_class_mode_excluded_links</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate list of classes has unique .mode_code or .excluded_links match.&quot;&quot;&quot;</span>
    <span class="c1"># validate if any mode IDs are used twice, that they have the same excluded links sets</span>
    <span class="n">mode_excluded_links</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">highway_class</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="c1"># maz_to_maz.mode_code must be unique</span>
        <span class="k">if</span> <span class="s2">&quot;maz_to_maz&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;mode_code&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;maz_to_maz&quot;</span><span class="p">][</span><span class="s2">&quot;mode_code&quot;</span><span class="p">]</span>
            <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;-&gt; </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> -&gt; mode_code: cannot be the same as the highway.maz_to_maz.mode_code&quot;</span>
        <span class="c1"># make sure that if any mode IDs are used twice, they have the same excluded links sets</span>
        <span class="k">if</span> <span class="n">highway_class</span><span class="o">.</span><span class="n">mode_code</span> <span class="ow">in</span> <span class="n">mode_excluded_links</span><span class="p">:</span>
            <span class="n">ex_links1</span> <span class="o">=</span> <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;excluded_links&quot;</span><span class="p">]</span>
            <span class="n">ex_links2</span> <span class="o">=</span> <span class="n">mode_excluded_links</span><span class="p">[</span><span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;mode_code&quot;</span><span class="p">]]</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;-&gt; </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: duplicated mode codes (&#39;</span><span class="si">{</span><span class="n">highway_class</span><span class="p">[</span><span class="s1">&#39;mode_code&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;) &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;with different excluded links: </span><span class="si">{</span><span class="n">ex_links1</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">ex_links2</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">assert</span> <span class="n">ex_links1</span> <span class="o">==</span> <span class="n">ex_links2</span><span class="p">,</span> <span class="n">error_msg</span>
        <span class="n">mode_excluded_links</span><span class="p">[</span><span class="n">highway_class</span><span class="o">.</span><span class="n">mode_code</span><span class="p">]</span> <span class="o">=</span> <span class="n">highway_class</span><span class="o">.</span><span class="n">excluded_links</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<a id="tm2py.config.HighwayClassConfig"></a>
    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Highway assignment class definition.</p>
<p>Note that excluded_links, skims and toll attribute names include
vehicle groups (&ldquo;{vehicle}&rdquo;) which reference the list of
highway.toll.dst_vehicle_group_names (see HighwayTollsConfig).
The default example model config uses:
&ldquo;da&rdquo;, &ldquo;sr2&rdquo;, &ldquo;sr3&rdquo;, &ldquo;vsm&rdquo;, sml&rdquo;, &ldquo;med&rdquo;, &ldquo;lrg&rdquo;</p>


<details class="example-single-class-config" open>
  <summary>Example single class config</summary>
  <p>name = &ldquo;da&rdquo;
description= &ldquo;drive alone&rdquo;
mode_code= &ldquo;d&rdquo;
[[highway.classes.demand]]
    source = &ldquo;household&rdquo;
    name = &ldquo;SOV_GP_{period}&rdquo;
[[highway.classes.demand]]
    source = &ldquo;air_passenger&rdquo;
    name = &ldquo;da&rdquo;
[[highway.classes.demand]]
    source = &ldquo;internal_external&rdquo;
    name = &ldquo;da&rdquo;
excluded_links = [&ldquo;is_toll_da&rdquo;, &ldquo;is_sr2&rdquo;],
value_of_time = 18.93,  # $ / hr
operating_cost_per_mile = 17.23,  # cents / mile
toll = [&ldquo;@bridgetoll_da&rdquo;]
skims = [&ldquo;time&rdquo;, &ldquo;dist&rdquo;, &ldquo;freeflowtime&rdquo;, &ldquo;bridgetoll_da&rdquo;],</p>
</details>

<details class="properties" open>
  <summary>Properties</summary>
  
</details>
              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">HighwayClassConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Highway assignment class definition.</span>

<span class="sd">    Note that excluded_links, skims and toll attribute names include</span>
<span class="sd">    vehicle groups (&quot;{vehicle}&quot;) which reference the list of</span>
<span class="sd">    highway.toll.dst_vehicle_group_names (see HighwayTollsConfig).</span>
<span class="sd">    The default example model config uses:</span>
<span class="sd">    &quot;da&quot;, &quot;sr2&quot;, &quot;sr3&quot;, &quot;vsm&quot;, sml&quot;, &quot;med&quot;, &quot;lrg&quot;</span>

<span class="sd">    Example single class config:</span>
<span class="sd">        name = &quot;da&quot;</span>
<span class="sd">        description= &quot;drive alone&quot;</span>
<span class="sd">        mode_code= &quot;d&quot;</span>
<span class="sd">        [[highway.classes.demand]]</span>
<span class="sd">            source = &quot;household&quot;</span>
<span class="sd">            name = &quot;SOV_GP_{period}&quot;</span>
<span class="sd">        [[highway.classes.demand]]</span>
<span class="sd">            source = &quot;air_passenger&quot;</span>
<span class="sd">            name = &quot;da&quot;</span>
<span class="sd">        [[highway.classes.demand]]</span>
<span class="sd">            source = &quot;internal_external&quot;</span>
<span class="sd">            name = &quot;da&quot;</span>
<span class="sd">        excluded_links = [&quot;is_toll_da&quot;, &quot;is_sr2&quot;],</span>
<span class="sd">        value_of_time = 18.93,  # $ / hr</span>
<span class="sd">        operating_cost_per_mile = 17.23,  # cents / mile</span>
<span class="sd">        toll = [&quot;@bridgetoll_da&quot;]</span>
<span class="sd">        skims = [&quot;time&quot;, &quot;dist&quot;, &quot;freeflowtime&quot;, &quot;bridgetoll_da&quot;],</span>

<span class="sd">    Properties:</span>
<span class="sd">        name: short (up to 10 character) unique reference name for the class.</span>
<span class="sd">            used in attribute and matrix names</span>
<span class="sd">        description: longer text used in attribute and matrix descriptions</span>
<span class="sd">        mode_code: single character mode, used to generate link.modes to</span>
<span class="sd">            identify subnetwork, generated from &quot;excluded_links&quot; keywords.</span>
<span class="sd">            Should be unique in list of :es, unless multiple classes</span>
<span class="sd">            have identical excluded_links specification. Cannot be the</span>
<span class="sd">            same as used for highway.maz_to_maz.mode_code.</span>
<span class="sd">        value_of_time: value of time for this class in $ / hr</span>
<span class="sd">        operating_cost_per_mile: vehicle operating cost in cents / mile</span>
<span class="sd">        demand: list of OMX file and matrix keyname references,</span>
<span class="sd">            see ClassDemandConfig</span>
<span class="sd">        excluded_links: list of keywords to identify links to exclude from</span>
<span class="sd">            this class&#39; available subnetwork (generate link.modes)</span>
<span class="sd">            Options are:</span>
<span class="sd">                - &quot;is_sr&quot;: is reserved for shared ride (@useclass in 2,3)</span>
<span class="sd">                - &quot;is_sr2&quot;: is reserved for shared ride 2+ (@useclass == 2)</span>
<span class="sd">                - &quot;is_sr3&quot;: is reserved for shared ride 3+ (@useclass == 3)</span>
<span class="sd">                - &quot;is_auto_only&quot;: is reserved for autos (non-truck) (@useclass != 1)</span>
<span class="sd">                - &quot;is_toll_{vehicle}&quot;: has a value (non-bridge) toll for the {vehicle} toll group</span>
<span class="sd">        toll: list of additional toll cost link attribute (values stored in cents),</span>
<span class="sd">            summed, one of &quot;@bridgetoll_{vehicle}&quot;, &quot;@valuetoll_{vehicle}&quot;</span>
<span class="sd">        toll_factor: optional, factor to apply to toll values in cost calculation</span>
<span class="sd">        pce: optional, passenger car equivalent to convert assigned demand in</span>
<span class="sd">            PCE units to vehicles for total assigned vehicle calculations</span>
<span class="sd">        skims: list of skim matrices to generate</span>
<span class="sd">            Options are:</span>
<span class="sd">                &quot;time&quot;: pure travel time in minutes</span>
<span class="sd">                &quot;dist&quot;: distance in miles</span>
<span class="sd">                &quot;hovdist&quot;: distance on HOV facilities (is_sr2 or is_sr3)</span>
<span class="sd">                &quot;tolldist&quot;: distance on toll facilities</span>
<span class="sd">                    (@tollbooth &gt; highway.tolls.valuetoll_start_tollbooth_code)</span>
<span class="sd">                &quot;freeflowtime&quot;: free flow travel time in minutes</span>
<span class="sd">                &quot;bridgetoll_{vehicle}&quot;: bridge tolls, {vehicle} refers to toll group</span>
<span class="sd">                &quot;valuetoll_{vehicle}&quot;: other, non-bridge tolls, {vehicle} refers to toll group</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">veh_group_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">mode_code</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">value_of_time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">operating_cost_per_mile</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">pce</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># Note that excluded_links, skims, and tolls validated under HighwayConfig to include</span>
    <span class="c1"># highway.toll.dst_vehicle_group_names names</span>
    <span class="n">excluded_links</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">skims</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">toll</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">toll_factor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">demand</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">ClassDemandConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<a id="tm2py.config.HighwayTollsConfig"></a>
    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Highway assignment and skim input tolls and related parameters.</p>


<details class="properties" open>
  <summary>Properties</summary>
  
</details>
              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">HighwayTollsConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Highway assignment and skim input tolls and related parameters.</span>

<span class="sd">    Properties:</span>
<span class="sd">        file_path: source relative file path for the highway tolls index CSV</span>
<span class="sd">        valuetoll_start_tollbooth_code: tollbooth separates links with &quot;bridge&quot; tolls</span>
<span class="sd">            (index &lt; this value) vs. &quot;value&quot; tolls. These toll attributes</span>
<span class="sd">            can then be referenced separately in the highway.classes[].tolls</span>
<span class="sd">            list</span>
<span class="sd">        src_vehicle_group_names: name used for the vehicle toll CSV column IDs,</span>
<span class="sd">            of the form &quot;toll{period}_{vehicle}&quot;</span>
<span class="sd">        dst_vehicle_group_names: list of names used in destination network</span>
<span class="sd">            for the corresponding vehicle group. Length of list must be the same</span>
<span class="sd">            as src_vehicle_group_names. Used for toll related attributes and</span>
<span class="sd">            resulting skim matrices. Cross-referenced in list of highway.classes[],</span>
<span class="sd">            valid keywords for:</span>
<span class="sd">                excluded_links: &quot;is_toll_{vehicle}&quot;</span>
<span class="sd">                tolls: &quot;@bridgetoll_{vehicle}&quot;, &quot;@valuetoll_{vehicle}&quot;</span>
<span class="sd">                skims: &quot;bridgetoll_{vehicle}&quot;, &quot;valuetoll_{vehicle}&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">file_path</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">valuetoll_start_tollbooth_code</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">src_vehicle_group_names</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">dst_vehicle_group_names</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;dst_vehicle_group_names&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">dst_vehicle_group_names_length</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate dst_vehicle_group_names has same length as src_vehicle_group_names.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;src_vehicle_group_names&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span>
                <span class="n">values</span><span class="p">[</span><span class="s2">&quot;src_vehicle_group_names&quot;</span><span class="p">]</span>
            <span class="p">),</span> <span class="s2">&quot;dst_vehicle_group_names must be same length as src_vehicle_group_names&quot;</span>
            <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span>
                <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">4</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
            <span class="p">),</span> <span class="s2">&quot;dst_vehicle_group_names must be 4 characters or less&quot;</span>
        <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="tm2py.config.HighwayTollsConfig.dst_vehicle_group_names_length" class="doc doc-heading">
            <code class=" language-python"><span class="n">dst_vehicle_group_names_length</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>

<a href="#tm2py.config.HighwayTollsConfig.dst_vehicle_group_names_length" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">

      <p>Validate dst_vehicle_group_names has same length as src_vehicle_group_names.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/config.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;dst_vehicle_group_names&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">dst_vehicle_group_names_length</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate dst_vehicle_group_names has same length as src_vehicle_group_names.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;src_vehicle_group_names&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span>
            <span class="n">values</span><span class="p">[</span><span class="s2">&quot;src_vehicle_group_names&quot;</span><span class="p">]</span>
        <span class="p">),</span> <span class="s2">&quot;dst_vehicle_group_names must be same length as src_vehicle_group_names&quot;</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span>
            <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">4</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
        <span class="p">),</span> <span class="s2">&quot;dst_vehicle_group_names must be 4 characters or less&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<a id="tm2py.config.DemandCountyGroupConfig"></a>
    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Grouping of counties for assignment and demand files.</p>


<details class="properties" open>
  <summary>Properties</summary>
  
</details>
              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">DemandCountyGroupConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Grouping of counties for assignment and demand files.</span>

<span class="sd">    Properties:</span>
<span class="sd">        number: id number for this group, must be unique</span>
<span class="sd">        counties: list of one or more county names</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">number</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">counties</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">COUNTY_NAMES</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="tm2py.components.network.highway.highway_maz"></a>
    <div class="doc doc-contents first">

      <p>Assigns and skims MAZ-to-MAZ demand along shortest generalized cost path.</p>
<p>MAZ to MAZ demand is read in from separate OMX matrices as defined under
the config table highway.maz_to_maz.demand_county_groups,</p>
<p>The demand is expected to be short distance (e.g. &lt;0.5 miles), or within the
same TAZ. The demand is grouped into bins of origin -&gt; all destinations, by
distance (straight-line) to furthest destination. This limits the size of the
shortest path calculated to the minimum required.
The bin edges have been predefined after testing as (in miles):
    [0.0, 0.9, 1.2, 1.8, 2.5, 5.0, 10.0, max_dist]</p>
<p>Input:
Emme network with:
    Link attributes:
        - time attribute, either timau (resulting VDF congested time)
          or @free_flow_time
    Node attributes: @maz_id, x, y, and #node_county
Demand matrices under highway.maz_to_maz.demand_file,
and can have a placeholder
    auto_{period}<em>MAZ_AUTO</em>{number}_{period}.omx</p>
<p>Output:
The resulting MAZ-MAZ flows are saved in link @maz_flow which is
used as background traffic in the equilibrium Highway assignment.</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="tm2py.components.network.highway.highway_maz.AssignMAZSPDemand" class="doc doc-heading">
            <code>AssignMAZSPDemand</code>


<a href="#tm2py.components.network.highway.highway_maz.AssignMAZSPDemand" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="Component (tm2py.components.component.Component)" href="#tm2py.components.component.Component">Component</a></code></p>


      <p>MAZ-to-MAZ shortest-path highway assignment.</p>
<p>Calculates shortest path between MAZs with demand in the Emme network
and assigns flow.</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/components/network/highway/highway_maz.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">AssignMAZSPDemand</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;MAZ-to-MAZ shortest-path highway assignment.</span>

<span class="sd">    Calculates shortest path between MAZs with demand in the Emme network</span>
<span class="sd">    and assigns flow.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># skip Too many instance attributes recommendation, it is OK as is</span>
    <span class="c1"># pylint: disable=R0902</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;MAZ-to-MAZ shortest-path highway assignment.</span>

<span class="sd">        Args:</span>
<span class="sd">            controller: parent Controller object</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">maz_to_maz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_debug</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># bins: performance parameter: crow-fly distance bins</span>
        <span class="c1">#       to limit shortest path calculation by origin to furthest destination</span>
        <span class="c1">#       semi-exposed for performance testing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bin_edges</span> <span class="o">=</span> <span class="n">_default_bin_edges</span>

        <span class="c1"># Lazily-loaded Emme Properties</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_highway_emmebank</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eb_dir</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Internal attributes to track data through the sequence of steps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mazs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_demand</span> <span class="o">=</span> <span class="n">_defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max_dist</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_network</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_root_index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_leaf_index</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">highway_emmebank</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_highway_emmebank</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_highway_emmebank</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">highway_emmebank</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_highway_emmebank</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">eb_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eb_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_eb_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">highway_emmebank</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eb_dir</span>

    <span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate inputs files are correct, raise if an error is found.&quot;&quot;&quot;</span>
        <span class="c1"># TODO</span>
        <span class="k">pass</span>

    <span class="nd">@LogStartEnd</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run MAZ-to-MAZ shortest path assignment.&quot;&quot;&quot;</span>

        <span class="n">county_groups</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">demand_county_groups</span><span class="p">:</span>
            <span class="n">county_groups</span><span class="p">[</span><span class="n">group</span><span class="o">.</span><span class="n">number</span><span class="p">]</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">counties</span>
        <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">highway_emmebank</span><span class="o">.</span><span class="n">scenario</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setup</span><span class="p">(</span><span class="n">time</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_network</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">names</span> <span class="ow">in</span> <span class="n">county_groups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">maz_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_county_mazs</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">maz_ids</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;warning: no mazs for counties </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">names</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>
                        <span class="k">continue</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_process_demand</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">maz_ids</span><span class="p">)</span>
                <span class="n">demand_bins</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group_demand</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">demand_group</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">demand_bins</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_find_roots_and_leaves</span><span class="p">(</span><span class="n">demand_group</span><span class="p">[</span><span class="s2">&quot;demand&quot;</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_set_link_cost_maz</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_run_shortest_path</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">demand_group</span><span class="p">[</span><span class="s2">&quot;dist&quot;</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_assign_flow</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">demand_group</span><span class="p">[</span><span class="s2">&quot;demand&quot;</span><span class="p">])</span>

    <span class="nd">@_context</span>
    <span class="k">def</span> <span class="nf">_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Context setup / teardown, initializes internal attributes.</span>

<span class="sd">        Args:</span>
<span class="sd">            time: name of the time period</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mazs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_demand</span> <span class="o">=</span> <span class="n">_defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max_dist</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_network</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_root_index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_leaf_index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;LINK&quot;</span><span class="p">,</span> <span class="s2">&quot;@link_cost&quot;</span><span class="p">,</span> <span class="s2">&quot;total cost MAZ-MAZ&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;LINK&quot;</span><span class="p">,</span> <span class="s2">&quot;@link_cost_maz&quot;</span><span class="p">,</span> <span class="s2">&quot;cost MAZ-MAZ, unused MAZs blocked&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;NODE&quot;</span><span class="p">,</span> <span class="s2">&quot;@maz_root&quot;</span><span class="p">,</span> <span class="s2">&quot;Flag for MAZs which are roots&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;NODE&quot;</span><span class="p">,</span> <span class="s2">&quot;@maz_leaf&quot;</span><span class="p">,</span> <span class="s2">&quot;Flag for MAZs which are leaves&quot;</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">domain</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">desc</span> <span class="ow">in</span> <span class="n">attributes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Create temp </span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2"> attr: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">desc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;TRACE&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">temp_attributes_and_restore</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="p">,</span> <span class="n">attributes</span>
        <span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log_start_end</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;MAZ assign for period </span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s2"> scenario </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">):</span>
                    <span class="k">yield</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_debug</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_mazs</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_demand</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_network</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_root_index</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_leaf_index</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="c1"># delete sp path files</span>
                    <span class="k">for</span> <span class="n">bin_no</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bin_edges</span><span class="p">)):</span>
                        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eb_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;sp_</span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">bin_no</span><span class="si">}</span><span class="s2">.ebp&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_prepare_network</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate link cost (travel time + bridge tolls + operating cost) and load network.</span>

<span class="sd">        Reads Emme network from disk for later node lookups. Optimized to only load</span>
<span class="sd">        attribute values of interest, additional attributes must be added in</span>
<span class="sd">        order to be read from disk.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="o">.</span><span class="n">has_traffic_results</span><span class="p">:</span>
            <span class="n">time_attr</span> <span class="o">=</span> <span class="s2">&quot;(@free_flow_time.max.timau)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">time_attr</span> <span class="o">=</span> <span class="s2">&quot;@free_flow_time&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Calculating link costs using time </span><span class="si">{</span><span class="n">time_attr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>
        <span class="n">vot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">value_of_time</span>
        <span class="n">op_cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">operating_cost_per_mile</span>
        <span class="n">net_calc</span> <span class="o">=</span> <span class="n">NetworkCalculator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="p">)</span>
        <span class="n">report</span> <span class="o">=</span> <span class="n">net_calc</span><span class="p">(</span>
            <span class="s2">&quot;@link_cost&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time_attr</span><span class="si">}</span><span class="s2"> + 0.6 / </span><span class="si">{</span><span class="n">vot</span><span class="si">}</span><span class="s2"> * (length * </span><span class="si">{</span><span class="n">op_cost</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Link cost calculation report&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;TRACE&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log_dict</span><span class="p">(</span><span class="n">report</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;TRACE&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_network</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">get_network</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;NODE&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;@maz_id&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;#node_county&quot;</span><span class="p">],</span> <span class="s2">&quot;LINK&quot;</span><span class="p">:</span> <span class="p">[]}</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_network</span><span class="o">.</span><span class="n">create_attribute</span><span class="p">(</span><span class="s2">&quot;LINK&quot;</span><span class="p">,</span> <span class="s2">&quot;temp_flow&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_county_mazs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">counties</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">EmmeNode</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all MAZ nodes which are located in one of these counties.</span>

<span class="sd">        Used the node attribute #node_county to identify the node location.</span>
<span class="sd">        Name must be an exact match. Catches a mapping of the county names</span>
<span class="sd">        to nodes so nodes are processed only once.</span>

<span class="sd">        Args:</span>
<span class="sd">            counties: list of county names</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of MAZ nodes (Emme Node) which are in these counties.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Processing county MAZs for </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">counties</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DETAIL&quot;</span>
        <span class="p">)</span>
        <span class="n">network</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_network</span>
        <span class="c1"># maz data</span>
        <span class="c1"># maz_file = self.get_abs_path(self.controller.config.scenario.maz_landuse_file)</span>
        <span class="c1"># maz_df = pd.read_csv(maz_file)</span>
        <span class="c1"># maz_county_dict = dict(zip(maz_df[&quot;MAZ_ORIGINAL&quot;], maz_df[&quot;CountyName&quot;]))</span>
        <span class="c1"># NOTE: every maz must have a valid #node_county</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mazs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mazs</span> <span class="o">=</span> <span class="n">_defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[])</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">network</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;@maz_id&quot;</span><span class="p">]:</span>
                    <span class="c1"># self._mazs[maz_county_dict[node[&quot;@maz_id&quot;]]].append(node)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_mazs</span><span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;#node_county&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">mazs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">county</span> <span class="ow">in</span> <span class="n">counties</span><span class="p">:</span>
            <span class="n">mazs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mazs</span><span class="p">[</span><span class="n">county</span><span class="p">])</span>
        <span class="c1"># highway emme network does not include the 5 inaccessiable MAZs, but the trip table is indexed by the full MAZ list</span>
        <span class="c1"># https://app.asana.com/0/12291104512575/1199091221400653/f</span>
        <span class="k">if</span> <span class="s2">&quot;San Francisco&quot;</span> <span class="ow">in</span> <span class="n">counties</span><span class="p">:</span>
            <span class="n">mazs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="p">{</span><span class="s2">&quot;@maz_id&quot;</span><span class="p">:</span> <span class="mi">10186</span><span class="p">},</span>
                    <span class="p">{</span><span class="s2">&quot;@maz_id&quot;</span><span class="p">:</span> <span class="mi">16084</span><span class="p">},</span>
                    <span class="p">{</span><span class="s2">&quot;@maz_id&quot;</span><span class="p">:</span> <span class="mi">111432</span><span class="p">},</span>
                    <span class="p">{</span><span class="s2">&quot;@maz_id&quot;</span><span class="p">:</span> <span class="mi">111433</span><span class="p">},</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;Contra Costa&quot;</span> <span class="ow">in</span> <span class="n">counties</span><span class="p">:</span>
            <span class="n">mazs</span><span class="o">.</span><span class="n">extend</span><span class="p">([{</span><span class="s2">&quot;@maz_id&quot;</span><span class="p">:</span> <span class="mi">411178</span><span class="p">}])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Num MAZs </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">mazs</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">mazs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="n">n</span><span class="p">[</span><span class="s2">&quot;@maz_id&quot;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_process_demand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">maz_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">EmmeNode</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Loads the demand from file and groups by origin node.</span>

<span class="sd">        Sets the demand to self._demand for later processing, grouping the demand in</span>
<span class="sd">        a dictionary by origin node (Emme Node object) to list of dictionaries</span>
<span class="sd">        {&quot;orig&quot;: orig_node, &quot;dest&quot;: dest_node, &quot;dem&quot;: demand, &quot;dist&quot;: dist}</span>

<span class="sd">        Args:</span>
<span class="sd">            time: time period name</span>
<span class="sd">            index: group index of the demand file, used to find the file by name</span>
<span class="sd">            maz_ids: indexed list of MAZ ID nodes for the county group</span>
<span class="sd">                (active counties for this demand file)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Process demand for time period </span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s2"> index </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DETAIL&quot;</span>
        <span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_demand_array</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
        <span class="n">origins</span><span class="p">,</span> <span class="n">destinations</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;non-zero origins </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">origins</span><span class="p">)</span><span class="si">}</span><span class="s2"> destinations </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">destinations</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">total_demand</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">orig</span><span class="p">,</span> <span class="n">dest</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">origins</span><span class="p">,</span> <span class="n">destinations</span><span class="p">):</span>
            <span class="c1"># skip intra-maz demand</span>
            <span class="k">if</span> <span class="n">orig</span> <span class="o">==</span> <span class="n">dest</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">orig</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">maz_ids</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Network MAZ @maz_id=</span><span class="si">{</span><span class="n">orig</span><span class="si">}</span><span class="s2"> #county_name does not match its county name in the input MAZ SE data.&quot;</span><span class="p">,</span>
                    <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">dest</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">maz_ids</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Network MAZ @maz_id=</span><span class="si">{</span><span class="n">dest</span><span class="si">}</span><span class="s2"> #county_name does not match its county name in the input MAZ SE data.&quot;</span><span class="p">,</span>
                    <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">continue</span>
            <span class="n">check</span> <span class="o">=</span> <span class="n">maz_ids</span><span class="p">[</span><span class="mi">99</span><span class="p">]</span>
            <span class="n">orig_node</span> <span class="o">=</span> <span class="n">maz_ids</span><span class="p">[</span><span class="n">orig</span><span class="p">]</span>
            <span class="n">dest_node</span> <span class="o">=</span> <span class="n">maz_ids</span><span class="p">[</span><span class="n">dest</span><span class="p">]</span>
            <span class="n">dist</span> <span class="o">=</span> <span class="n">_sqrt</span><span class="p">(</span>
                <span class="p">(</span><span class="n">dest_node</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">orig_node</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">dest_node</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">orig_node</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">dist</span> <span class="o">/</span> <span class="mi">5280</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_distance</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;MAZ demand from </span><span class="si">{</span><span class="n">orig</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">dest</span><span class="si">}</span><span class="s2"> is over </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_distance</span><span class="si">}</span><span class="s2"> miles, do not assign&quot;</span><span class="p">,</span>
                    <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">dist</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_dist</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_max_dist</span> <span class="o">=</span> <span class="n">dist</span>
            <span class="n">demand</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">orig</span><span class="p">][</span><span class="n">dest</span><span class="p">]</span>
            <span class="n">total_demand</span> <span class="o">+=</span> <span class="n">demand</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_demand</span><span class="p">[</span><span class="n">orig_node</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;orig&quot;</span><span class="p">:</span> <span class="n">orig_node</span><span class="p">,</span>
                    <span class="s2">&quot;dest&quot;</span><span class="p">:</span> <span class="n">dest_node</span><span class="p">,</span>
                    <span class="s2">&quot;dem&quot;</span><span class="p">:</span> <span class="n">demand</span><span class="p">,</span>
                    <span class="s2">&quot;dist&quot;</span><span class="p">:</span> <span class="n">dist</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Max distance found </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_dist</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total inter-zonal demand </span><span class="si">{</span><span class="n">total_demand</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_read_demand_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NumpyArray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load the demand from file with the specified time and index name.</span>

<span class="sd">        Args:</span>
<span class="sd">            time: time period name</span>
<span class="sd">            index: group index of the demand file, used to find the file by name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">file_path_tmplt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">demand_file</span><span class="p">)</span>
        <span class="n">omx_file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span>
            <span class="n">file_path_tmplt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">period</span><span class="o">=</span><span class="n">time</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="nb">iter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">iteration</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reading demand from </span><span class="si">{</span><span class="n">omx_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">OMXManager</span><span class="p">(</span><span class="n">omx_file_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">omx_file</span><span class="p">:</span>
            <span class="n">demand_array</span> <span class="o">=</span> <span class="n">omx_file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MAZ_AUTO_</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">omx_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">demand_array</span>

    <span class="k">def</span> <span class="nf">_group_demand</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">EmmeNode</span><span class="p">]]]]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process the demand loaded from files \</span>
<span class="sd">            and create groups based on the origin to the furthest destination with demand.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of dictionaries, containing the demand in the format</span>
<span class="sd">                {&quot;orig&quot;: EmmeNode, &quot;dest&quot;: EmmeNode, &quot;dem&quot;: float (demand value)}</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Grouping demand in distance buckets&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DETAIL&quot;</span><span class="p">)</span>
        <span class="c1"># group demand from same origin into distance bins by furthest</span>
        <span class="c1"># distance destination to limit shortest path search radius</span>
        <span class="n">bin_edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bin_edges</span><span class="p">[:]</span>
        <span class="k">if</span> <span class="n">bin_edges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_dist</span> <span class="o">/</span> <span class="mf">5280.0</span><span class="p">:</span>
            <span class="n">bin_edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_dist</span> <span class="o">/</span> <span class="mf">5280.0</span><span class="p">)</span>

        <span class="n">demand_groups</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;dist&quot;</span><span class="p">:</span> <span class="n">edge</span><span class="p">,</span> <span class="s2">&quot;demand&quot;</span><span class="p">:</span> <span class="p">[]}</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">edge</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bin_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_demand</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">max_dist</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="s2">&quot;dist&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">data</span><span class="p">)</span> <span class="o">/</span> <span class="mf">5280.0</span>
            <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">demand_groups</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">max_dist</span> <span class="o">&lt;</span> <span class="n">group</span><span class="p">[</span><span class="s2">&quot;dist&quot;</span><span class="p">]:</span>
                    <span class="n">group</span><span class="p">[</span><span class="s2">&quot;demand&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                    <span class="k">break</span>
        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">demand_groups</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;bin dist </span><span class="si">{</span><span class="n">group</span><span class="p">[</span><span class="s1">&#39;dist&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, size </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">group</span><span class="p">[</span><span class="s1">&#39;demand&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span>
            <span class="p">)</span>
        <span class="c1"># Filter out groups without any demand</span>
        <span class="n">demand_groups</span> <span class="o">=</span> <span class="p">[</span><span class="n">group</span> <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">demand_groups</span> <span class="k">if</span> <span class="n">group</span><span class="p">[</span><span class="s2">&quot;demand&quot;</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">demand_groups</span>

    <span class="k">def</span> <span class="nf">_find_roots_and_leaves</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">demand</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">EmmeNode</span><span class="p">]]]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Label available MAZ root nodes and leaf nodes for the path calculation.</span>

<span class="sd">        The MAZ nodes which are found as origins in the demand are &quot;activated&quot;</span>
<span class="sd">        by setting @maz_root to non-zero, and similarly the leaves have @maz_leaf</span>
<span class="sd">        set to non-zero.</span>

<span class="sd">        Args:</span>
<span class="sd">            demand: list of dictionaries, containing the demand in the format</span>
<span class="sd">                {&quot;orig&quot;: EmmeNode, &quot;dest&quot;: EmmeNode, &quot;dem&quot;: float (demand value)}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">network</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_network</span>
        <span class="n">attrs_to_init</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;NODE&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;@maz_root&quot;</span><span class="p">,</span> <span class="s2">&quot;@maz_leaf&quot;</span><span class="p">]),</span> <span class="p">(</span><span class="s2">&quot;LINK&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;maz_cost&quot;</span><span class="p">])]</span>
        <span class="k">for</span> <span class="n">domain</span><span class="p">,</span> <span class="n">attrs</span> <span class="ow">in</span> <span class="n">attrs_to_init</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">network</span><span class="o">.</span><span class="n">attributes</span><span class="p">(</span><span class="n">domain</span><span class="p">):</span>
                    <span class="n">network</span><span class="o">.</span><span class="n">delete_attribute</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                <span class="n">network</span><span class="o">.</span><span class="n">create_attribute</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">root_maz_ids</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">leaf_maz_ids</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">demand</span><span class="p">:</span>
            <span class="n">o_node</span><span class="p">,</span> <span class="n">d_node</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;orig&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;dest&quot;</span><span class="p">]</span>
            <span class="n">root_maz_ids</span><span class="p">[</span><span class="n">o_node</span><span class="o">.</span><span class="n">number</span><span class="p">]</span> <span class="o">=</span> <span class="n">o_node</span><span class="p">[</span><span class="s2">&quot;@maz_root&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">o_node</span><span class="p">[</span><span class="s2">&quot;@maz_id&quot;</span><span class="p">]</span>
            <span class="n">leaf_maz_ids</span><span class="p">[</span><span class="n">d_node</span><span class="o">.</span><span class="n">number</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_node</span><span class="p">[</span><span class="s2">&quot;@maz_leaf&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_node</span><span class="p">[</span><span class="s2">&quot;@maz_id&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_root_index</span> <span class="o">=</span> <span class="p">{</span><span class="n">p</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">root_maz_ids</span><span class="o">.</span><span class="n">keys</span><span class="p">()))}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_leaf_index</span> <span class="o">=</span> <span class="p">{</span><span class="n">q</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">q</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">leaf_maz_ids</span><span class="o">.</span><span class="n">keys</span><span class="p">()))}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">copy_attribute_values</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_network</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;NODE&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;@maz_root&quot;</span><span class="p">,</span> <span class="s2">&quot;@maz_leaf&quot;</span><span class="p">]}</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_link_cost_maz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set link cost used in the shortest path forbidden using unavailable connectors.</span>

<span class="sd">        Copy the pre-calculated cost @link_cost to @link_cost_maz,</span>
<span class="sd">        setting value to 1e20 on connectors to unused zone leaves / from</span>
<span class="sd">        unused roots.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># forbid egress from MAZ nodes which are not demand roots /</span>
        <span class="c1">#        access to MAZ nodes which are not demand leafs</span>
        <span class="n">net_calc</span> <span class="o">=</span> <span class="n">NetworkCalculator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="p">)</span>
        <span class="n">net_calc</span><span class="o">.</span><span class="n">add_calc</span><span class="p">(</span><span class="s2">&quot;@link_cost_maz&quot;</span><span class="p">,</span> <span class="s2">&quot;@link_cost&quot;</span><span class="p">)</span>
        <span class="n">net_calc</span><span class="o">.</span><span class="n">add_calc</span><span class="p">(</span><span class="s2">&quot;@link_cost_maz&quot;</span><span class="p">,</span> <span class="s2">&quot;1e20&quot;</span><span class="p">,</span> <span class="s2">&quot;@maz_root=0 and !@maz_id=0&quot;</span><span class="p">)</span>
        <span class="n">net_calc</span><span class="o">.</span><span class="n">add_calc</span><span class="p">(</span><span class="s2">&quot;@link_cost_maz&quot;</span><span class="p">,</span> <span class="s2">&quot;1e20&quot;</span><span class="p">,</span> <span class="s2">&quot;@maz_leafj=0 and !@maz_idj=0&quot;</span><span class="p">)</span>
        <span class="n">net_calc</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="nd">@LogStartEnd</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s2">&quot;DETAIL&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_run_shortest_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">bin_no</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">max_radius</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run the shortest path tool to generate paths between the marked nodes.</span>

<span class="sd">        Args:</span>
<span class="sd">            time: time period name</span>
<span class="sd">            bin_no: bin number (id) for this demand segment</span>
<span class="sd">            max_radius: max unit coordinate distance to limit search tree</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">shortest_paths_tool</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span>
            <span class="s2">&quot;inro.emme.network_calculation.shortest_path&quot;</span>
        <span class="p">)</span>
        <span class="n">max_radius</span> <span class="o">=</span> <span class="n">max_radius</span> <span class="o">*</span> <span class="mi">5280</span> <span class="o">+</span> <span class="mi">100</span>  <span class="c1"># add some buffer for rounding error</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="s2">&quot;ebp&quot;</span> <span class="k">if</span> <span class="n">_USE_BINARY</span> <span class="k">else</span> <span class="s2">&quot;txt&quot;</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;sp_</span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">bin_no</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">spec</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;SHORTEST_PATH&quot;</span><span class="p">,</span>
            <span class="s2">&quot;modes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">mode_code</span><span class="p">],</span>
            <span class="s2">&quot;root_nodes&quot;</span><span class="p">:</span> <span class="s2">&quot;@maz_root&quot;</span><span class="p">,</span>
            <span class="s2">&quot;leaf_nodes&quot;</span><span class="p">:</span> <span class="s2">&quot;@maz_leaf&quot;</span><span class="p">,</span>
            <span class="s2">&quot;link_cost&quot;</span><span class="p">:</span> <span class="s2">&quot;@link_cost_maz&quot;</span><span class="p">,</span>
            <span class="s2">&quot;path_constraints&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;max_radius&quot;</span><span class="p">:</span> <span class="n">max_radius</span><span class="p">,</span>
                <span class="s2">&quot;uturn_allowed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;through_leaves&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;through_centroids&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;exclude_forbidden_turns&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;skim_output&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;TEXT&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;return_numpy&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                    <span class="s2">&quot;analyses&quot;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="p">},</span>
                <span class="s2">&quot;path_output&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;BINARY&quot;</span> <span class="k">if</span> <span class="n">_USE_BINARY</span> <span class="k">else</span> <span class="s2">&quot;TEXT&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eb_dir</span><span class="p">,</span> <span class="n">file_name</span><span class="p">),</span>
                <span class="p">},</span>
            <span class="p">},</span>
            <span class="s2">&quot;performance_settings&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;number_of_processors&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">num_processors</span><span class="p">,</span>
                <span class="s2">&quot;direction&quot;</span><span class="p">:</span> <span class="s2">&quot;FORWARD&quot;</span><span class="p">,</span>
                <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;STANDARD&quot;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">}</span>
        <span class="n">shortest_paths_tool</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_assign_flow</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">bin_no</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">demand</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">EmmeNode</span><span class="p">]]]</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Assign the demand along the paths generated from the shortest path tool.</span>

<span class="sd">        Args:</span>
<span class="sd">            time: time period name</span>
<span class="sd">            bin_no: bin number (id) for this demand segment</span>
<span class="sd">            demand: list of dictionaries, containing the demand in the format</span>
<span class="sd">                {&quot;orig&quot;: EmmeNode, &quot;dest&quot;: EmmeNode, &quot;dem&quot;: float (demand value)}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">_USE_BINARY</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_assign_flow_binary</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">bin_no</span><span class="p">,</span> <span class="n">demand</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_assign_flow_text</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">bin_no</span><span class="p">,</span> <span class="n">demand</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_assign_flow_text</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">bin_no</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">demand</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">EmmeNode</span><span class="p">]]]</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Assign the demand along the paths generated from the shortest path tool.</span>

<span class="sd">        The paths are read from a text format file, see Emme help for details.</span>
<span class="sd">        Demand is summed in self._network (in memory) using temp_flow attribute</span>
<span class="sd">        and written to scenario (Emmebank / disk) @maz_flow.</span>

<span class="sd">        Args:</span>
<span class="sd">            time: time period name</span>
<span class="sd">            bin_no: bin number (id) for this demand segment</span>
<span class="sd">            demand: list of dictionaries, containin the demand in the format</span>
<span class="sd">                {&quot;orig&quot;: EmmeNode, &quot;dest&quot;: EmmeNode, &quot;dem&quot;: float (demand value)}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_text_format_paths</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">bin_no</span><span class="p">)</span>
        <span class="n">not_assigned</span><span class="p">,</span> <span class="n">assigned</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">demand</span><span class="p">:</span>
            <span class="n">orig</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">dem</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;orig&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;dest&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;dem&quot;</span><span class="p">]</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">paths</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">orig</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">not_assigned</span> <span class="o">+=</span> <span class="n">dem</span>
                <span class="k">continue</span>
            <span class="n">i_node</span> <span class="o">=</span> <span class="n">orig</span>
            <span class="k">for</span> <span class="n">j_node</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
                <span class="n">link</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_network</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">i_node</span><span class="p">,</span> <span class="n">j_node</span><span class="p">)</span>
                <span class="n">link</span><span class="p">[</span><span class="s2">&quot;temp_flow&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">dem</span>
                <span class="n">i_node</span> <span class="o">=</span> <span class="n">j_node</span>
            <span class="n">assigned</span> <span class="o">+=</span> <span class="n">dem</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ASSIGN bin </span><span class="si">{</span><span class="n">bin_no</span><span class="si">}</span><span class="s2">: total: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">demand</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;assigned: </span><span class="si">{</span><span class="n">assigned</span><span class="si">}</span><span class="s2">, not assigned: </span><span class="si">{</span><span class="n">not_assigned</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">copy_attribute_values</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_network</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;LINK&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;temp_flow&quot;</span><span class="p">]},</span> <span class="p">{</span><span class="s2">&quot;LINK&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;data1&quot;</span><span class="p">]}</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_load_text_format_paths</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">bin_no</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load all paths from text file and return as nested dictionary.</span>

<span class="sd">        Args:</span>
<span class="sd">            time: time period name</span>
<span class="sd">            bin_no: bin number (id) for this demand segment</span>

<span class="sd">        Returns:</span>
<span class="sd">            All paths as a nested dictionary, path = paths[origin][destination],</span>
<span class="sd">            using the node IDs as integers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="n">_defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">{})</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eb_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;sp_</span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">bin_no</span><span class="si">}</span><span class="s2">.txt&quot;</span><span class="p">),</span>
            <span class="s2">&quot;r&quot;</span><span class="p">,</span>
            <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">,</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">paths_file</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">paths_file</span><span class="p">:</span>
                <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
                <span class="n">paths</span><span class="p">[</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">nodes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">return</span> <span class="n">paths</span>

    <span class="k">def</span> <span class="nf">_assign_flow_binary</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">bin_no</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">demand</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">EmmeNode</span><span class="p">]]]</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Assign the demand along the paths generated from the shortest path tool.</span>

<span class="sd">        The paths are read from a binary format file, see Emme help for details.</span>
<span class="sd">        Demand is summed in self._network (in memory) using temp_flow attribute</span>
<span class="sd">        and written to scenario (Emmebank / disk) @maz_flow.</span>

<span class="sd">        Args:</span>
<span class="sd">            time: time period name</span>
<span class="sd">            bin_no: bin number (id) for this demand segment</span>
<span class="sd">            demand: list of dictionaries, containin the demand in the format</span>
<span class="sd">                {&quot;orig&quot;: EmmeNode, &quot;dest&quot;: EmmeNode, &quot;dem&quot;: float (demand value)}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;sp_</span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">bin_no</span><span class="si">}</span><span class="s2">.ebp&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eb_dir</span><span class="p">,</span> <span class="n">file_name</span><span class="p">),</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">paths_file</span><span class="p">:</span>
            <span class="c1"># read set of path pointers by Orig-Dest sequence from file</span>
            <span class="n">offset</span><span class="p">,</span> <span class="n">leaves_nb</span><span class="p">,</span> <span class="n">path_indicies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_path_indices</span><span class="p">(</span><span class="n">paths_file</span><span class="p">)</span>
            <span class="n">assigned</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">not_assigned</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">bytes_read</span> <span class="o">=</span> <span class="n">offset</span> <span class="o">*</span> <span class="mi">8</span>
            <span class="c1"># for all orig-dest pairs with demand, load path from file</span>
            <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">demand</span><span class="p">:</span>
                <span class="c1"># get file position based on orig-dest index</span>
                <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_path_location</span><span class="p">(</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;orig&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;dest&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">leaves_nb</span><span class="p">,</span> <span class="n">path_indicies</span>
                <span class="p">)</span>
                <span class="c1"># no path found, disconnected zone</span>
                <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="n">end</span><span class="p">:</span>
                    <span class="n">not_assigned</span> <span class="o">+=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;dem&quot;</span><span class="p">]</span>
                    <span class="k">continue</span>
                <span class="n">paths_file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">start</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">offset</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_assign_path_flow</span><span class="p">(</span><span class="n">paths_file</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;dem&quot;</span><span class="p">])</span>
                <span class="n">assigned</span> <span class="o">+=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;dem&quot;</span><span class="p">]</span>
                <span class="n">bytes_read</span> <span class="o">+=</span> <span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">copy_attribute_values</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_network</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="p">,</span>
            <span class="p">{</span><span class="s2">&quot;LINK&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;temp_flow&quot;</span><span class="p">]},</span>
            <span class="p">{</span><span class="s2">&quot;LINK&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;@maz_flow&quot;</span><span class="p">]},</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;ASSIGN bin </span><span class="si">{</span><span class="n">bin_no</span><span class="si">}</span><span class="s2">, total </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">demand</span><span class="p">)</span><span class="si">}</span><span class="s2">, assign &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">assigned</span><span class="si">}</span><span class="s2">, not assign </span><span class="si">{</span><span class="n">not_assigned</span><span class="si">}</span><span class="s2">, bytes </span><span class="si">{</span><span class="n">bytes_read</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_path_indices</span><span class="p">(</span><span class="n">paths_file</span><span class="p">:</span> <span class="n">BinaryIO</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">_array</span><span class="o">.</span><span class="n">array</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the path header indices.</span>

<span class="sd">        See the Emme Shortest path tool doc for additional details on reading</span>
<span class="sd">        this file.</span>

<span class="sd">        Args:</span>
<span class="sd">            paths_file: binary file access to the generated paths file</span>

<span class="sd">        Returns:</span>
<span class="sd">            2 ints + array of ints: offset, leafs_nb, path_indicies</span>
<span class="sd">            offset: starting index to read the paths</span>
<span class="sd">            leafs_nb: number of leafs in the shortest path file</span>
<span class="sd">            path_indicies: array of the start index for each root, leaf path in paths_file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># read first 4 integers from file (Q=64-bit unsigned integers)</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">_array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s2">&quot;Q&quot;</span><span class="p">)</span>
        <span class="n">header</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">paths_file</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">roots_nb</span><span class="p">,</span> <span class="n">leaves_nb</span> <span class="o">=</span> <span class="n">header</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
        <span class="c1"># Load sequence of path indices (positions by orig-dest index),</span>
        <span class="c1"># pointing to list of path node IDs in file</span>
        <span class="n">path_indicies</span> <span class="o">=</span> <span class="n">_array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s2">&quot;Q&quot;</span><span class="p">)</span>
        <span class="n">path_indicies</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">paths_file</span><span class="p">,</span> <span class="n">roots_nb</span> <span class="o">*</span> <span class="n">leaves_nb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="n">roots_nb</span> <span class="o">*</span> <span class="n">leaves_nb</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">4</span>
        <span class="k">return</span> <span class="n">offset</span><span class="p">,</span> <span class="n">leaves_nb</span><span class="p">,</span> <span class="n">path_indicies</span>

    <span class="k">def</span> <span class="nf">_get_path_location</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">orig</span><span class="p">:</span> <span class="n">EmmeNode</span><span class="p">,</span>
        <span class="n">dest</span><span class="p">:</span> <span class="n">EmmeNode</span><span class="p">,</span>
        <span class="n">leaves_nb</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">path_indicies</span><span class="p">:</span> <span class="n">_array</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the location in the paths_file to read.</span>

<span class="sd">        Args:</span>
<span class="sd">            orig: Emme Node object, origin MAZ to query the path</span>
<span class="sd">            dest: Emme Node object, destination MAZ to query the path</span>
<span class="sd">            leaves_nb: number of leaves</span>
<span class="sd">            path_indicies: array of the start index for each root, leaf path in paths_file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Two integers, start, end</span>
<span class="sd">            start: starting index to read Node ID bytes from paths_file</span>
<span class="sd">            end: ending index to read bytes from paths_file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_index</span><span class="p">[</span><span class="n">orig</span><span class="p">]</span>
        <span class="n">q_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_leaf_index</span><span class="p">[</span><span class="n">dest</span><span class="p">]</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">p_index</span> <span class="o">*</span> <span class="n">leaves_nb</span> <span class="o">+</span> <span class="n">q_index</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">path_indicies</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">path_indicies</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span>

    <span class="k">def</span> <span class="nf">_assign_path_flow</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">paths_file</span><span class="p">:</span> <span class="n">BinaryIO</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">demand</span><span class="p">:</span> <span class="nb">float</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add demand to link temp_flow for the path.</span>

<span class="sd">        Args:</span>
<span class="sd">            paths_file: binary file access to read path from</span>
<span class="sd">            start: starting index to read Node ID bytes from paths_file</span>
<span class="sd">            end: ending index to read bytes from paths_file</span>
<span class="sd">            demand: flow demand to add on link</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># load sequence of Node IDs which define the path (L=32-bit unsigned integers)</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">_array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">)</span>
        <span class="n">path</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">paths_file</span><span class="p">,</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>
        <span class="c1"># process path to sequence of links and add flow</span>
        <span class="n">path_iter</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">i_node</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">path_iter</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j_node</span> <span class="ow">in</span> <span class="n">path_iter</span><span class="p">:</span>
            <span class="n">link</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_network</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">i_node</span><span class="p">,</span> <span class="n">j_node</span><span class="p">)</span>
            <span class="n">link</span><span class="p">[</span><span class="s2">&quot;temp_flow&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">demand</span>
            <span class="n">i_node</span> <span class="o">=</span> <span class="n">j_node</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tm2py.components.network.highway.highway_maz.AssignMAZSPDemand.__init__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span></code>

<a href="#tm2py.components.network.highway.highway_maz.AssignMAZSPDemand.__init__" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>MAZ-to-MAZ shortest-path highway assignment.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>controller</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="RunController (tm2py.controller.RunController)" href="#tm2py.controller.RunController">RunController</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>parent Controller object</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/network/highway/highway_maz.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;MAZ-to-MAZ shortest-path highway assignment.</span>

<span class="sd">    Args:</span>
<span class="sd">        controller: parent Controller object</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">maz_to_maz</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_debug</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># bins: performance parameter: crow-fly distance bins</span>
    <span class="c1">#       to limit shortest path calculation by origin to furthest destination</span>
    <span class="c1">#       semi-exposed for performance testing</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_bin_edges</span> <span class="o">=</span> <span class="n">_default_bin_edges</span>

    <span class="c1"># Lazily-loaded Emme Properties</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_highway_emmebank</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_eb_dir</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Internal attributes to track data through the sequence of steps</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_mazs</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_demand</span> <span class="o">=</span> <span class="n">_defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_max_dist</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_network</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_root_index</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_leaf_index</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.network.highway.highway_maz.AssignMAZSPDemand.run" class="doc doc-heading">
            <code class=" language-python"><span class="n">run</span><span class="p">()</span></code>

<a href="#tm2py.components.network.highway.highway_maz.AssignMAZSPDemand.run" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Run MAZ-to-MAZ shortest path assignment.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/network/highway/highway_maz.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@LogStartEnd</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run MAZ-to-MAZ shortest path assignment.&quot;&quot;&quot;</span>

    <span class="n">county_groups</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">demand_county_groups</span><span class="p">:</span>
        <span class="n">county_groups</span><span class="p">[</span><span class="n">group</span><span class="o">.</span><span class="n">number</span><span class="p">]</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">counties</span>
    <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">highway_emmebank</span><span class="o">.</span><span class="n">scenario</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setup</span><span class="p">(</span><span class="n">time</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_network</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">names</span> <span class="ow">in</span> <span class="n">county_groups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">maz_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_county_mazs</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">maz_ids</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;warning: no mazs for counties </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">names</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                    <span class="k">continue</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_process_demand</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">maz_ids</span><span class="p">)</span>
            <span class="n">demand_bins</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group_demand</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">demand_group</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">demand_bins</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_find_roots_and_leaves</span><span class="p">(</span><span class="n">demand_group</span><span class="p">[</span><span class="s2">&quot;demand&quot;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_link_cost_maz</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_run_shortest_path</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">demand_group</span><span class="p">[</span><span class="s2">&quot;dist&quot;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_assign_flow</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">demand_group</span><span class="p">[</span><span class="s2">&quot;demand&quot;</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.network.highway.highway_maz.AssignMAZSPDemand.validate_inputs" class="doc doc-heading">
            <code class=" language-python"><span class="n">validate_inputs</span><span class="p">()</span></code>

<a href="#tm2py.components.network.highway.highway_maz.AssignMAZSPDemand.validate_inputs" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Validate inputs files are correct, raise if an error is found.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/network/highway/highway_maz.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate inputs files are correct, raise if an error is found.&quot;&quot;&quot;</span>
    <span class="c1"># TODO</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.components.network.highway.highway_maz.SkimMAZCosts" class="doc doc-heading">
            <code>SkimMAZCosts</code>


<a href="#tm2py.components.network.highway.highway_maz.SkimMAZCosts" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="Component (tm2py.components.component.Component)" href="#tm2py.components.component.Component">Component</a></code></p>


      <p>MAZ-to-MAZ shortest-path skim of time, distance and toll.</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/components/network/highway/highway_maz.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SkimMAZCosts</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;MAZ-to-MAZ shortest-path skim of time, distance and toll.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;MAZ-to-MAZ shortest-path skim of time, distance and toll.</span>

<span class="sd">        Args:</span>
<span class="sd">            controller: parent RunController object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">maz_to_maz</span>
        <span class="c1"># TODO add config requirement that most be a valid time period</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_network</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_highway_emmebank</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">highway_emmebank</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_highway_emmebank</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_highway_emmebank</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">highway_emmebank</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_highway_emmebank</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">scenario</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">highway_emmebank</span><span class="o">.</span><span class="n">scenario</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">skim_period</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span>

    <span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate inputs files are correct, raise if an error is found.&quot;&quot;&quot;</span>
        <span class="c1"># TODO</span>
        <span class="k">pass</span>

    <span class="nd">@LogStartEnd</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run shortest path skims for all available MAZ-to-MAZ O-D pairs.</span>

<span class="sd">        Runs a shortest path builder for each county, using a maz_skim_cost</span>
<span class="sd">        to limit the search. The valid gen cost (time + cost), distance and toll (drive alone)</span>
<span class="sd">        are written to CSV at the output_skim_file path:</span>
<span class="sd">        FROM_ZONE, TO_ZONE, COST, DISTANCE, BRIDGETOLL</span>

<span class="sd">        The following config inputs are used directly in this component. Note also</span>
<span class="sd">        that the network mode_code is prepared in the highway_network component</span>
<span class="sd">        using the excluded_links.</span>

<span class="sd">        config.highway.maz_to_maz:</span>
<span class="sd">            skim_period: name of the period used for the skim, must match one the</span>
<span class="sd">                defined config.time_periods</span>
<span class="sd">            demand_county_groups: used for the list of counties, creates a list out</span>
<span class="sd">                of all listed counties under [].counties</span>
<span class="sd">            output_skim_file: relative path to save the skims</span>
<span class="sd">            value_of_time: value of time used to convert tolls and auto operating cost</span>
<span class="sd">            operating_cost_per_mile: auto operating cost</span>
<span class="sd">            max_skim_cost: max cost value used to limit the shortest path search</span>
<span class="sd">            mode_code:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># prepare output file and write header</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">output_skim_file</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">output</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output_file</span><span class="p">:</span>
            <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;FROM_ZONE, TO_ZONE, COST, DISTANCE, BRIDGETOLL</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">counties</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">demand_county_groups</span><span class="p">:</span>
            <span class="n">counties</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">counties</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setup</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_network</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">county</span> <span class="ow">in</span> <span class="n">counties</span><span class="p">:</span>
                <span class="n">num_roots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mark_roots</span><span class="p">(</span><span class="n">county</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">num_roots</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">sp_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_shortest_path</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_export_results</span><span class="p">(</span><span class="n">sp_values</span><span class="p">)</span>

    <span class="nd">@_context</span>
    <span class="k">def</span> <span class="nf">_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates the temp attributes used in the component.&quot;&quot;&quot;</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;LINK&quot;</span><span class="p">,</span> <span class="s2">&quot;@link_cost&quot;</span><span class="p">,</span> <span class="s2">&quot;total cost MAZ-MAZ&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;NODE&quot;</span><span class="p">,</span> <span class="s2">&quot;@maz_root&quot;</span><span class="p">,</span> <span class="s2">&quot;selected roots (origins)&quot;</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">temp_attributes_and_restore</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scenario</span><span class="p">,</span> <span class="n">attributes</span>
        <span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">yield</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_network</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># clear network obj ref to free memory</span>

    <span class="nd">@LogStartEnd</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_prepare_network</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates the link cost in @link_cost and loads the network to self._network.&quot;&quot;&quot;</span>
        <span class="n">net_calc</span> <span class="o">=</span> <span class="n">NetworkCalculator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="o">.</span><span class="n">has_traffic_results</span><span class="p">:</span>
            <span class="n">time_attr</span> <span class="o">=</span> <span class="s2">&quot;(@free_flow_time.max.timau)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">time_attr</span> <span class="o">=</span> <span class="s2">&quot;@free_flow_time&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Time attribute </span><span class="si">{</span><span class="n">time_attr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>
        <span class="n">vot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">value_of_time</span>
        <span class="n">op_cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">operating_cost_per_mile</span>
        <span class="n">net_calc</span><span class="p">(</span><span class="s2">&quot;@link_cost&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time_attr</span><span class="si">}</span><span class="s2"> + 0.6 / </span><span class="si">{</span><span class="n">vot</span><span class="si">}</span><span class="s2"> * (length * </span><span class="si">{</span><span class="n">op_cost</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_network</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">get_network</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scenario</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;NODE&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;@maz_id&quot;</span><span class="p">,</span> <span class="s2">&quot;#node_county&quot;</span><span class="p">]}</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_mark_roots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">county</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Mark the available roots in the county.&quot;&quot;&quot;</span>
        <span class="n">count_roots</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_network</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;@maz_id&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;#node_county&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">county</span><span class="p">:</span>
                <span class="n">node</span><span class="p">[</span><span class="s2">&quot;@maz_root&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;@maz_id&quot;</span><span class="p">]</span>
                <span class="n">count_roots</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">node</span><span class="p">[</span><span class="s2">&quot;@maz_root&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_network</span><span class="o">.</span><span class="n">get_attribute_values</span><span class="p">(</span><span class="s2">&quot;NODE&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;@maz_root&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scenario</span><span class="o">.</span><span class="n">set_attribute_values</span><span class="p">(</span><span class="s2">&quot;NODE&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;@maz_root&quot;</span><span class="p">],</span> <span class="n">values</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">count_roots</span>

    <span class="nd">@LogStartEnd</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s2">&quot;DETAIL&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_run_shortest_path</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run shortest paths tool and return dictionary of skim results name, numpy arrays.</span>

<span class="sd">        O-D pairs are limited by a max cost value from config.highway.maz_to_maz.max_skim_cost,</span>
<span class="sd">        from roots marked by @maz_root to all available leaves at @maz_id.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary with keys &quot;COST&quot;, &quot;DISTANCE&quot;, and &quot;BRIDGETOLL&quot;, and numpy</span>
<span class="sd">            arrays of SP values for available O-D pairs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">shortest_paths_tool</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span>
            <span class="s2">&quot;inro.emme.network_calculation.shortest_path&quot;</span>
        <span class="p">)</span>
        <span class="n">max_cost</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_skim_cost</span><span class="p">)</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;SHORTEST_PATH&quot;</span><span class="p">,</span>
            <span class="s2">&quot;modes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">mode_code</span><span class="p">],</span>
            <span class="s2">&quot;root_nodes&quot;</span><span class="p">:</span> <span class="s2">&quot;@maz_root&quot;</span><span class="p">,</span>
            <span class="s2">&quot;leaf_nodes&quot;</span><span class="p">:</span> <span class="s2">&quot;@maz_id&quot;</span><span class="p">,</span>
            <span class="s2">&quot;link_cost&quot;</span><span class="p">:</span> <span class="s2">&quot;@link_cost&quot;</span><span class="p">,</span>
            <span class="s2">&quot;path_constraints&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;max_cost&quot;</span><span class="p">:</span> <span class="n">max_cost</span><span class="p">,</span>
                <span class="s2">&quot;uturn_allowed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;through_leaves&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;through_centroids&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;exclude_forbidden_turns&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;skim_output&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;return_numpy&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="s2">&quot;analyses&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;component&quot;</span><span class="p">:</span> <span class="s2">&quot;SHORTEST_PATH_COST&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;COST&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;component&quot;</span><span class="p">:</span> <span class="s2">&quot;length&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;DISTANCE&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;component&quot;</span><span class="p">:</span> <span class="s2">&quot;@bridgetoll_da&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;BRIDGETOLL&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                        <span class="p">},</span>
                    <span class="p">],</span>
                    <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;OMX&quot;</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="s2">&quot;performance_settings&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;number_of_processors&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">num_processors</span><span class="p">,</span>
                <span class="s2">&quot;direction&quot;</span><span class="p">:</span> <span class="s2">&quot;FORWARD&quot;</span><span class="p">,</span>
                <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;STANDARD&quot;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">}</span>
        <span class="n">sp_values</span> <span class="o">=</span> <span class="n">shortest_paths_tool</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scenario</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sp_values</span>

    <span class="k">def</span> <span class="nf">_export_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sp_values</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write matrix skims to CSV.</span>

<span class="sd">        The matrices are filtered to omit rows for which the COST is</span>
<span class="sd">        &lt; 0 or &gt; 1e19 (Emme uses 1e20 to indicate inaccessible zone pairs).</span>

<span class="sd">        sp_values: dictionary of matrix costs, with the three keys</span>
<span class="sd">            &quot;COST&quot;, &quot;DISTANCE&quot;, and &quot;BRIDGETOLL&quot; and Numpy arrays of values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get list of MAZ IDS</span>
        <span class="n">roots</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">node</span><span class="p">[</span><span class="s2">&quot;@maz_root&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_network</span><span class="o">.</span><span class="n">nodes</span><span class="p">()</span> <span class="k">if</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;@maz_root&quot;</span><span class="p">]</span>
        <span class="p">]</span>
        <span class="n">leaves</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;@maz_id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_network</span><span class="o">.</span><span class="n">nodes</span><span class="p">()</span> <span class="k">if</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;@maz_id&quot;</span><span class="p">]]</span>
        <span class="c1"># build dataframe with output data and to/from MAZ ids</span>
        <span class="n">root_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">roots</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">leaves</span><span class="p">))</span>
        <span class="n">leaf_ids</span> <span class="o">=</span> <span class="n">leaves</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">roots</span><span class="p">)</span>
        <span class="n">result_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;FROM_ZONE&quot;</span><span class="p">:</span> <span class="n">root_ids</span><span class="p">,</span>
                <span class="s2">&quot;TO_ZONE&quot;</span><span class="p">:</span> <span class="n">leaf_ids</span><span class="p">,</span>
                <span class="s2">&quot;COST&quot;</span><span class="p">:</span> <span class="n">sp_values</span><span class="p">[</span><span class="s2">&quot;COST&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
                <span class="s2">&quot;DISTANCE&quot;</span><span class="p">:</span> <span class="n">sp_values</span><span class="p">[</span><span class="s2">&quot;DISTANCE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
                <span class="s2">&quot;BRIDGETOLL&quot;</span><span class="p">:</span> <span class="n">sp_values</span><span class="p">[</span><span class="s2">&quot;BRIDGETOLL&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="c1"># drop 0&#39;s / 1e20</span>
        <span class="n">result_df</span> <span class="o">=</span> <span class="n">result_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;COST &gt; 0 &amp; COST &lt; 1e19&quot;</span><span class="p">)</span>
        <span class="c1"># write remaining values to text file</span>
        <span class="c1"># FROM_ZONE,TO_ZONE,COST,DISTANCE,BRIDGETOLL</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">output_skim_file</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output_file</span><span class="p">:</span>
            <span class="n">result_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tm2py.components.network.highway.highway_maz.SkimMAZCosts.__init__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span></code>

<a href="#tm2py.components.network.highway.highway_maz.SkimMAZCosts.__init__" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>MAZ-to-MAZ shortest-path skim of time, distance and toll.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>controller</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="RunController (tm2py.controller.RunController)" href="#tm2py.controller.RunController">RunController</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>parent RunController object</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/network/highway/highway_maz.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;MAZ-to-MAZ shortest-path skim of time, distance and toll.</span>

<span class="sd">    Args:</span>
<span class="sd">        controller: parent RunController object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">maz_to_maz</span>
    <span class="c1"># TODO add config requirement that most be a valid time period</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_network</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_highway_emmebank</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.network.highway.highway_maz.SkimMAZCosts.run" class="doc doc-heading">
            <code class=" language-python"><span class="n">run</span><span class="p">()</span></code>

<a href="#tm2py.components.network.highway.highway_maz.SkimMAZCosts.run" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Run shortest path skims for all available MAZ-to-MAZ O-D pairs.</p>
<p>Runs a shortest path builder for each county, using a maz_skim_cost
to limit the search. The valid gen cost (time + cost), distance and toll (drive alone)
are written to CSV at the output_skim_file path:
FROM_ZONE, TO_ZONE, COST, DISTANCE, BRIDGETOLL</p>
<p>The following config inputs are used directly in this component. Note also
that the network mode_code is prepared in the highway_network component
using the excluded_links.</p>
<p>config.highway.maz_to_maz:
    skim_period: name of the period used for the skim, must match one the
        defined config.time_periods
    demand_county_groups: used for the list of counties, creates a list out
        of all listed counties under [].counties
    output_skim_file: relative path to save the skims
    value_of_time: value of time used to convert tolls and auto operating cost
    operating_cost_per_mile: auto operating cost
    max_skim_cost: max cost value used to limit the shortest path search
    mode_code:</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/network/highway/highway_maz.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@LogStartEnd</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run shortest path skims for all available MAZ-to-MAZ O-D pairs.</span>

<span class="sd">    Runs a shortest path builder for each county, using a maz_skim_cost</span>
<span class="sd">    to limit the search. The valid gen cost (time + cost), distance and toll (drive alone)</span>
<span class="sd">    are written to CSV at the output_skim_file path:</span>
<span class="sd">    FROM_ZONE, TO_ZONE, COST, DISTANCE, BRIDGETOLL</span>

<span class="sd">    The following config inputs are used directly in this component. Note also</span>
<span class="sd">    that the network mode_code is prepared in the highway_network component</span>
<span class="sd">    using the excluded_links.</span>

<span class="sd">    config.highway.maz_to_maz:</span>
<span class="sd">        skim_period: name of the period used for the skim, must match one the</span>
<span class="sd">            defined config.time_periods</span>
<span class="sd">        demand_county_groups: used for the list of counties, creates a list out</span>
<span class="sd">            of all listed counties under [].counties</span>
<span class="sd">        output_skim_file: relative path to save the skims</span>
<span class="sd">        value_of_time: value of time used to convert tolls and auto operating cost</span>
<span class="sd">        operating_cost_per_mile: auto operating cost</span>
<span class="sd">        max_skim_cost: max cost value used to limit the shortest path search</span>
<span class="sd">        mode_code:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># prepare output file and write header</span>
    <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">output_skim_file</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">output</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output_file</span><span class="p">:</span>
        <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;FROM_ZONE, TO_ZONE, COST, DISTANCE, BRIDGETOLL</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">counties</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">demand_county_groups</span><span class="p">:</span>
        <span class="n">counties</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">counties</span><span class="p">)</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setup</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_network</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">county</span> <span class="ow">in</span> <span class="n">counties</span><span class="p">:</span>
            <span class="n">num_roots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mark_roots</span><span class="p">(</span><span class="n">county</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">num_roots</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">sp_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_shortest_path</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_export_results</span><span class="p">(</span><span class="n">sp_values</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.network.highway.highway_maz.SkimMAZCosts.validate_inputs" class="doc doc-heading">
            <code class=" language-python"><span class="n">validate_inputs</span><span class="p">()</span></code>

<a href="#tm2py.components.network.highway.highway_maz.SkimMAZCosts.validate_inputs" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Validate inputs files are correct, raise if an error is found.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/network/highway/highway_maz.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate inputs files are correct, raise if an error is found.&quot;&quot;&quot;</span>
    <span class="c1"># TODO</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<a id="tm2py.config.HighwayMazToMazConfig"></a>
    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Highway MAZ to MAZ shortest path assignment and skim parameters.</p>


<details class="properties" open>
  <summary>Properties</summary>
  
</details>
              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">HighwayMazToMazConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Highway MAZ to MAZ shortest path assignment and skim parameters.</span>

<span class="sd">    Properties:</span>
<span class="sd">        mode_code: single character mode, used to generate link.modes to</span>
<span class="sd">            identify subnetwork, generated from &quot;excluded_links&quot; keywords,</span>
<span class="sd">            plus including MAZ connectors.</span>
<span class="sd">        value_of_time: value of time for this class in $ / hr</span>
<span class="sd">        operating_cost_per_mile: vehicle operating cost in cents / mile</span>
<span class="sd">        max_skim_cost: max shortest path distance to search for MAZ-to-MAZ</span>
<span class="sd">            skims, in generized costs units (includes operating cost</span>
<span class="sd">            converted to minutes)</span>
<span class="sd">        excluded_links: list of keywords to identify links to exclude from</span>
<span class="sd">            MAZ-to-MAZ paths, see HighwayClassConfig.excluded_links</span>
<span class="sd">        demand_file: relative path to find the input demand files</span>
<span class="sd">            can have use a placeholder for {period} and {number}, where the</span>
<span class="sd">            {period} is the time_period.name (see TimePeriodConfig)</span>
<span class="sd">            and {number} is the demand_count_groups[].number</span>
<span class="sd">            (see DemandCountyGroupConfig)</span>
<span class="sd">            e.g.: auto_{period}_MAZ_AUTO_{number}_{period}.omx</span>
<span class="sd">        demand_county_groups: List of demand county names and</span>
<span class="sd">        skim_period: period name to use for the shotest path skims, must</span>
<span class="sd">            match one of the names listed in the time_periods</span>
<span class="sd">        output_skim_file: relative path to resulting MAZ-to-MAZ skims</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">mode_code</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">value_of_time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">operating_cost_per_mile</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">max_distance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">max_skim_cost</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">excluded_links</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">demand_file</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">demand_county_groups</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">DemandCountyGroupConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">skim_period</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">output_skim_file</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;demand_county_groups&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">unique_group_numbers</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate list of demand_county_groups has unique .number values.&quot;&quot;&quot;</span>
        <span class="n">group_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">group</span><span class="o">.</span><span class="n">number</span> <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_ids</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">group_ids</span><span class="p">)),</span> <span class="s2">&quot;-&gt; number value must be unique&quot;</span>
        <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="tm2py.config.HighwayMazToMazConfig.unique_group_numbers" class="doc doc-heading">
            <code class=" language-python"><span class="n">unique_group_numbers</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

<a href="#tm2py.config.HighwayMazToMazConfig.unique_group_numbers" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">

      <p>Validate list of demand_county_groups has unique .number values.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/config.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;demand_county_groups&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">unique_group_numbers</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate list of demand_county_groups has unique .number values.&quot;&quot;&quot;</span>
    <span class="n">group_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">group</span><span class="o">.</span><span class="n">number</span> <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_ids</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">group_ids</span><span class="p">)),</span> <span class="s2">&quot;-&gt; number value must be unique&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h3 id="transit-network-components">Transit Network Components<a class="headerlink" href="#transit-network-components" title="Permanent link"> </a></h3>


<div class="doc doc-object doc-module">



<a id="tm2py.components.network.transit.transit_assign"></a>
    <div class="doc doc-contents first">

      <p>Transit assignment module.</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="tm2py.components.network.transit.transit_assign.TransitAssignment" class="doc doc-heading">
            <code>TransitAssignment</code>


<a href="#tm2py.components.network.transit.transit_assign.TransitAssignment" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="Component (tm2py.components.component.Component)" href="#tm2py.components.component.Component">Component</a></code></p>


      <p>Run transit assignment.</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/components/network/transit/transit_assign.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 401</span>
<span class="normal"> 402</span>
<span class="normal"> 403</span>
<span class="normal"> 404</span>
<span class="normal"> 405</span>
<span class="normal"> 406</span>
<span class="normal"> 407</span>
<span class="normal"> 408</span>
<span class="normal"> 409</span>
<span class="normal"> 410</span>
<span class="normal"> 411</span>
<span class="normal"> 412</span>
<span class="normal"> 413</span>
<span class="normal"> 414</span>
<span class="normal"> 415</span>
<span class="normal"> 416</span>
<span class="normal"> 417</span>
<span class="normal"> 418</span>
<span class="normal"> 419</span>
<span class="normal"> 420</span>
<span class="normal"> 421</span>
<span class="normal"> 422</span>
<span class="normal"> 423</span>
<span class="normal"> 424</span>
<span class="normal"> 425</span>
<span class="normal"> 426</span>
<span class="normal"> 427</span>
<span class="normal"> 428</span>
<span class="normal"> 429</span>
<span class="normal"> 430</span>
<span class="normal"> 431</span>
<span class="normal"> 432</span>
<span class="normal"> 433</span>
<span class="normal"> 434</span>
<span class="normal"> 435</span>
<span class="normal"> 436</span>
<span class="normal"> 437</span>
<span class="normal"> 438</span>
<span class="normal"> 439</span>
<span class="normal"> 440</span>
<span class="normal"> 441</span>
<span class="normal"> 442</span>
<span class="normal"> 443</span>
<span class="normal"> 444</span>
<span class="normal"> 445</span>
<span class="normal"> 446</span>
<span class="normal"> 447</span>
<span class="normal"> 448</span>
<span class="normal"> 449</span>
<span class="normal"> 450</span>
<span class="normal"> 451</span>
<span class="normal"> 452</span>
<span class="normal"> 453</span>
<span class="normal"> 454</span>
<span class="normal"> 455</span>
<span class="normal"> 456</span>
<span class="normal"> 457</span>
<span class="normal"> 458</span>
<span class="normal"> 459</span>
<span class="normal"> 460</span>
<span class="normal"> 461</span>
<span class="normal"> 462</span>
<span class="normal"> 463</span>
<span class="normal"> 464</span>
<span class="normal"> 465</span>
<span class="normal"> 466</span>
<span class="normal"> 467</span>
<span class="normal"> 468</span>
<span class="normal"> 469</span>
<span class="normal"> 470</span>
<span class="normal"> 471</span>
<span class="normal"> 472</span>
<span class="normal"> 473</span>
<span class="normal"> 474</span>
<span class="normal"> 475</span>
<span class="normal"> 476</span>
<span class="normal"> 477</span>
<span class="normal"> 478</span>
<span class="normal"> 479</span>
<span class="normal"> 480</span>
<span class="normal"> 481</span>
<span class="normal"> 482</span>
<span class="normal"> 483</span>
<span class="normal"> 484</span>
<span class="normal"> 485</span>
<span class="normal"> 486</span>
<span class="normal"> 487</span>
<span class="normal"> 488</span>
<span class="normal"> 489</span>
<span class="normal"> 490</span>
<span class="normal"> 491</span>
<span class="normal"> 492</span>
<span class="normal"> 493</span>
<span class="normal"> 494</span>
<span class="normal"> 495</span>
<span class="normal"> 496</span>
<span class="normal"> 497</span>
<span class="normal"> 498</span>
<span class="normal"> 499</span>
<span class="normal"> 500</span>
<span class="normal"> 501</span>
<span class="normal"> 502</span>
<span class="normal"> 503</span>
<span class="normal"> 504</span>
<span class="normal"> 505</span>
<span class="normal"> 506</span>
<span class="normal"> 507</span>
<span class="normal"> 508</span>
<span class="normal"> 509</span>
<span class="normal"> 510</span>
<span class="normal"> 511</span>
<span class="normal"> 512</span>
<span class="normal"> 513</span>
<span class="normal"> 514</span>
<span class="normal"> 515</span>
<span class="normal"> 516</span>
<span class="normal"> 517</span>
<span class="normal"> 518</span>
<span class="normal"> 519</span>
<span class="normal"> 520</span>
<span class="normal"> 521</span>
<span class="normal"> 522</span>
<span class="normal"> 523</span>
<span class="normal"> 524</span>
<span class="normal"> 525</span>
<span class="normal"> 526</span>
<span class="normal"> 527</span>
<span class="normal"> 528</span>
<span class="normal"> 529</span>
<span class="normal"> 530</span>
<span class="normal"> 531</span>
<span class="normal"> 532</span>
<span class="normal"> 533</span>
<span class="normal"> 534</span>
<span class="normal"> 535</span>
<span class="normal"> 536</span>
<span class="normal"> 537</span>
<span class="normal"> 538</span>
<span class="normal"> 539</span>
<span class="normal"> 540</span>
<span class="normal"> 541</span>
<span class="normal"> 542</span>
<span class="normal"> 543</span>
<span class="normal"> 544</span>
<span class="normal"> 545</span>
<span class="normal"> 546</span>
<span class="normal"> 547</span>
<span class="normal"> 548</span>
<span class="normal"> 549</span>
<span class="normal"> 550</span>
<span class="normal"> 551</span>
<span class="normal"> 552</span>
<span class="normal"> 553</span>
<span class="normal"> 554</span>
<span class="normal"> 555</span>
<span class="normal"> 556</span>
<span class="normal"> 557</span>
<span class="normal"> 558</span>
<span class="normal"> 559</span>
<span class="normal"> 560</span>
<span class="normal"> 561</span>
<span class="normal"> 562</span>
<span class="normal"> 563</span>
<span class="normal"> 564</span>
<span class="normal"> 565</span>
<span class="normal"> 566</span>
<span class="normal"> 567</span>
<span class="normal"> 568</span>
<span class="normal"> 569</span>
<span class="normal"> 570</span>
<span class="normal"> 571</span>
<span class="normal"> 572</span>
<span class="normal"> 573</span>
<span class="normal"> 574</span>
<span class="normal"> 575</span>
<span class="normal"> 576</span>
<span class="normal"> 577</span>
<span class="normal"> 578</span>
<span class="normal"> 579</span>
<span class="normal"> 580</span>
<span class="normal"> 581</span>
<span class="normal"> 582</span>
<span class="normal"> 583</span>
<span class="normal"> 584</span>
<span class="normal"> 585</span>
<span class="normal"> 586</span>
<span class="normal"> 587</span>
<span class="normal"> 588</span>
<span class="normal"> 589</span>
<span class="normal"> 590</span>
<span class="normal"> 591</span>
<span class="normal"> 592</span>
<span class="normal"> 593</span>
<span class="normal"> 594</span>
<span class="normal"> 595</span>
<span class="normal"> 596</span>
<span class="normal"> 597</span>
<span class="normal"> 598</span>
<span class="normal"> 599</span>
<span class="normal"> 600</span>
<span class="normal"> 601</span>
<span class="normal"> 602</span>
<span class="normal"> 603</span>
<span class="normal"> 604</span>
<span class="normal"> 605</span>
<span class="normal"> 606</span>
<span class="normal"> 607</span>
<span class="normal"> 608</span>
<span class="normal"> 609</span>
<span class="normal"> 610</span>
<span class="normal"> 611</span>
<span class="normal"> 612</span>
<span class="normal"> 613</span>
<span class="normal"> 614</span>
<span class="normal"> 615</span>
<span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TransitAssignment</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run transit assignment.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="s2">&quot;RunController&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor for TransitAssignment.</span>

<span class="sd">        Args:</span>
<span class="sd">            controller: RunController object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">transit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;prepare transit demand&quot;</span><span class="p">:</span> <span class="n">PrepareTransitDemand</span><span class="p">(</span><span class="n">controller</span><span class="p">),</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transit_network</span> <span class="o">=</span> <span class="n">PrepareTransitNetwork</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_demand_matrix</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># FIXME</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_num_processors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">num_processors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_time_period</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_transit_emmebank</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate the inputs.&quot;&quot;&quot;</span>
        <span class="c1"># TODO</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">transit_emmebank</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transit_emmebank</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_transit_emmebank</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">transit_emmebank</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transit_emmebank</span>

    <span class="nd">@LogStartEnd</span><span class="p">(</span><span class="s2">&quot;Transit assignments&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run transit assignments.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">iteration</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transit_emmebank</span><span class="o">.</span><span class="n">create_zero_matrix</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">warmstart</span><span class="o">.</span><span class="n">warmstart</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">warmstart</span><span class="o">.</span><span class="n">use_warmstart_demand</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span><span class="p">[</span><span class="s2">&quot;prepare transit demand&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># give error message to user about not warmstarting transit</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;ERROR: transit has to be warmstarted, please either specify use_warmstart_skim or use_warmstart_demand&quot;</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span><span class="p">[</span><span class="s2">&quot;prepare transit demand&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">time_period</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">:</span>
            <span class="c1"># update auto times</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;updating auto time in transit network&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transit_network</span><span class="o">.</span><span class="n">update_auto_times</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">iteration</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># iteration = 0 : run uncongested transit assignment</span>
                <span class="n">use_ccr</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">congested_transit_assignment</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;running uncongested transit assignment with warmstart demand&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">run_transit_assign</span><span class="p">(</span>
                    <span class="n">time_period</span><span class="p">,</span> <span class="n">use_ccr</span><span class="p">,</span> <span class="n">congested_transit_assignment</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">iteration</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">warmstart</span><span class="o">.</span><span class="n">use_warmstart_skim</span><span class="p">):</span>
                <span class="c1"># iteration = 1 and use_warmstart_skim = True : run uncongested transit assignment</span>
                <span class="n">use_ccr</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">congested_transit_assignment</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">run_transit_assign</span><span class="p">(</span>
                    <span class="n">time_period</span><span class="p">,</span> <span class="n">use_ccr</span><span class="p">,</span> <span class="n">congested_transit_assignment</span>
                <span class="p">)</span>               
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># iteration &gt;= 1 and use_warmstart_skim = False : run congested transit assignment</span>
                <span class="n">use_ccr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">use_ccr</span>
                <span class="k">if</span> <span class="n">time_period</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;EA&quot;</span><span class="p">,</span> <span class="s2">&quot;EV&quot;</span><span class="p">,</span> <span class="s2">&quot;MD&quot;</span><span class="p">]:</span>
                    <span class="n">congested_transit_assignment</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">congested_transit_assignment</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">congested_transit_assignment</span>
                    <span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">run_transit_assign</span><span class="p">(</span>
                    <span class="n">time_period</span><span class="p">,</span> <span class="n">use_ccr</span><span class="p">,</span> <span class="n">congested_transit_assignment</span>
                <span class="p">)</span>

            <span class="c1"># output_summaries</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">output_stop_usage_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">network</span><span class="p">,</span> <span class="n">class_stop_attrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_connector_flows</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_export_connector_flows</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">class_stop_attrs</span><span class="p">,</span> <span class="n">time_period</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">iteration</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">end_iteration</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">output_transit_boardings_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_export_boardings_by_line</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">output_transit_segment_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_export_transit_segment</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">output_station_to_station_flow_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_export_boardings_by_station</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">output_transfer_at_station_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_export_transfer_at_stops</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span>

    <span class="nd">@LogStartEnd</span><span class="p">(</span><span class="s2">&quot;Transit assignments for a time period&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">run_transit_assign</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">use_ccr</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">congested_transit_assignment</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">use_ccr</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_run_ccr_assign</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">congested_transit_assignment</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_run_congested_assign</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_run_extended_assign</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_apply_peaking_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ea_df</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;apply peaking factors.</span>

<span class="sd">        Args:</span>
<span class="sd">            time_period: time period name abbreviation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_emme_scenario</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transit_emmebank</span><span class="o">.</span><span class="n">scenario</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span>
        <span class="n">_network</span> <span class="o">=</span> <span class="n">_emme_scenario</span><span class="o">.</span><span class="n">get_network</span><span class="p">()</span>
        <span class="n">_duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_period_durations</span><span class="p">[</span><span class="n">time_period</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>

        <span class="k">if</span> <span class="n">time_period</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;am&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">_network</span><span class="o">.</span><span class="n">transit_lines</span><span class="p">():</span>
                <span class="n">line</span><span class="p">[</span><span class="s2">&quot;@orig_hdw&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">headway</span>
                <span class="n">line_name</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">id</span>
                <span class="n">line_veh</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">vehicle</span>
                <span class="n">line_hdw</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">headway</span>
                <span class="n">line_cap</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">*</span> <span class="n">_duration</span> <span class="o">*</span> <span class="n">line_veh</span><span class="o">.</span><span class="n">total_capacity</span> <span class="o">/</span> <span class="n">line_hdw</span>
                <span class="k">if</span> <span class="n">line_name</span> <span class="ow">in</span> <span class="n">ea_df</span><span class="p">[</span><span class="s2">&quot;line_name_am&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">():</span>
                    <span class="n">ea_boardings</span> <span class="o">=</span> <span class="n">ea_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                        <span class="n">ea_df</span><span class="p">[</span><span class="s2">&quot;line_name_am&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">line_name</span><span class="p">,</span> <span class="s2">&quot;boardings&quot;</span>
                    <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ea_boardings</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">pnr_peaking_factor</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">line_cap</span> <span class="o">-</span> <span class="n">ea_boardings</span>
                <span class="p">)</span> <span class="o">/</span> <span class="n">line_cap</span>  <span class="c1"># substract ea boardings from am parking capacity</span>
                <span class="n">non_pnr_peaking_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">congested</span><span class="o">.</span><span class="n">am_peaking_factor</span>
                <span class="c1"># in Emme transit assignment, the capacity is computed for each transit line as: 60 * _duration * vehicle.total_capacity / line.headway</span>
                <span class="c1"># so instead of applying peaking factor to calculated capacity, we can divide line.headway by this peaking factor</span>
                <span class="c1"># if ea number of parkers exceed the am parking capacity, set the headway to a very large number</span>
                <span class="k">if</span> <span class="n">pnr_peaking_factor</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">pnr_line_hdw</span> <span class="o">=</span> <span class="n">line_hdw</span> <span class="o">/</span> <span class="n">pnr_peaking_factor</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pnr_line_hdw</span> <span class="o">=</span> <span class="mi">999</span>
                <span class="n">non_pnr_line_hdw</span> <span class="o">=</span> <span class="n">line_hdw</span> <span class="o">*</span> <span class="n">non_pnr_peaking_factor</span>
                <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;pnr&quot;</span> <span class="ow">in</span> <span class="n">line_name</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;egr&quot;</span> <span class="ow">in</span> <span class="n">line_name</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="p">(</span><span class="s2">&quot;pnr&quot;</span> <span class="ow">in</span> <span class="n">line_name</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;acc&quot;</span> <span class="ow">in</span> <span class="n">line_name</span><span class="p">):</span>
                    <span class="n">line</span><span class="o">.</span><span class="n">headway</span> <span class="o">=</span> <span class="n">pnr_line_hdw</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">line</span><span class="o">.</span><span class="n">headway</span> <span class="o">=</span> <span class="n">non_pnr_line_hdw</span>

        <span class="k">if</span> <span class="n">time_period</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;pm&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">_network</span><span class="o">.</span><span class="n">transit_lines</span><span class="p">():</span>
                <span class="n">line</span><span class="p">[</span><span class="s2">&quot;@orig_hdw&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">headway</span>
                <span class="n">line_name</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">id</span>
                <span class="n">line_hdw</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">headway</span>
                <span class="n">non_pnr_peaking_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">congested</span><span class="o">.</span><span class="n">pm_peaking_factor</span>
                <span class="n">non_pnr_line_hdw</span> <span class="o">=</span> <span class="n">line_hdw</span> <span class="o">*</span> <span class="n">non_pnr_peaking_factor</span>
                <span class="k">if</span> <span class="s2">&quot;pnr&quot;</span> <span class="ow">in</span> <span class="n">line_name</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">line</span><span class="o">.</span><span class="n">headway</span> <span class="o">=</span> <span class="n">non_pnr_line_hdw</span>

        <span class="k">if</span> <span class="n">time_period</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;ea&quot;</span><span class="p">:</span>
            <span class="n">line_name</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">boards</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">ea_pnr_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">_network</span><span class="o">.</span><span class="n">transit_lines</span><span class="p">():</span>
                <span class="n">boardings</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">segments</span><span class="p">(</span><span class="n">include_hidden</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                    <span class="n">boardings</span> <span class="o">+=</span> <span class="n">segment</span><span class="o">.</span><span class="n">transit_boardings</span>
                <span class="n">line_name</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                <span class="n">boards</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">boardings</span><span class="p">)</span>
            <span class="n">ea_pnr_df</span><span class="p">[</span><span class="s2">&quot;line_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">line_name</span>
            <span class="n">ea_pnr_df</span><span class="p">[</span><span class="s2">&quot;boardings&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">boards</span>
            <span class="n">ea_pnr_df</span><span class="p">[</span><span class="s2">&quot;line_name_am&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ea_pnr_df</span><span class="p">[</span><span class="s2">&quot;line_name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                <span class="s2">&quot;EA&quot;</span><span class="p">,</span> <span class="s2">&quot;AM&quot;</span>
            <span class="p">)</span>  <span class="c1"># will substract ea boardings from am parking capacity</span>
            <span class="n">path_boardings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">output_transit_boardings_path</span>
            <span class="p">)</span>
            <span class="n">ea_pnr_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">path_boardings</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="s2">&quot;ea_pnr&quot;</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">_update_attributes</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;TRANSIT_LINE&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;@orig_hdw&quot;</span><span class="p">,</span> <span class="s2">&quot;headway&quot;</span><span class="p">]}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">copy_attribute_values</span><span class="p">(</span>
            <span class="n">_network</span><span class="p">,</span> <span class="n">_emme_scenario</span><span class="p">,</span> <span class="n">_update_attributes</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_transit_classes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_period</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">TransitAssignmentClass</span><span class="p">]:</span>
        <span class="n">emme_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">use_fares</span><span class="p">:</span>
            <span class="n">fare_modes</span> <span class="o">=</span> <span class="n">_defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="nb">set</span><span class="p">([]))</span>
            <span class="n">network</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transit_emmebank</span><span class="o">.</span><span class="n">scenario</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span><span class="o">.</span><span class="n">get_partial_network</span><span class="p">(</span>
                <span class="p">[</span><span class="s2">&quot;TRANSIT_LINE&quot;</span><span class="p">],</span> <span class="n">include_attributes</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">)</span>
            <span class="n">emme_manager</span><span class="o">.</span><span class="n">copy_attribute_values</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">transit_emmebank</span><span class="o">.</span><span class="n">scenario</span><span class="p">(</span><span class="n">time_period</span><span class="p">),</span>
                <span class="n">network</span><span class="p">,</span>
                <span class="p">{</span><span class="s2">&quot;TRANSIT_LINE&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;#src_mode&quot;</span><span class="p">]},</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">network</span><span class="o">.</span><span class="n">transit_lines</span><span class="p">():</span>
                <span class="n">fare_modes</span><span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="s2">&quot;#src_mode&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fare_modes</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">spec_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">emme</span><span class="o">.</span><span class="n">project_path</span><span class="p">)</span>
            <span class="p">),</span>
            <span class="s2">&quot;Specifications&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">transit_classes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">class_config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span><span class="p">:</span>
            <span class="n">transit_classes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">TransitAssignmentClass</span><span class="p">(</span>
                    <span class="n">class_config</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span>
                    <span class="n">time_period</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">iteration</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_num_processors</span><span class="p">,</span>
                    <span class="n">fare_modes</span><span class="p">,</span>
                    <span class="n">spec_dir</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">transit_classes</span>

    <span class="k">def</span> <span class="nf">_run_ccr_assign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Runs capacity constrained (??) CCR transit assignment for a time period + update penalties.</span>

<span class="sd">        Args:</span>
<span class="sd">            time_period: time period name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_period_durations</span><span class="p">[</span><span class="n">time_period</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
        <span class="n">_ccr_weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">ccr_weights</span>
        <span class="n">_eawt_weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">eawt_weights</span>
        <span class="n">_mode_config</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">mode_config</span><span class="o">.</span><span class="n">mode_id</span><span class="p">:</span> <span class="n">mode_config</span> <span class="k">for</span> <span class="n">mode_config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">modes</span>
        <span class="p">}</span>
        <span class="n">_emme_scenario</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transit_emmebank</span><span class="o">.</span><span class="n">scenario</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span>
        <span class="n">transit_classes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transit_classes</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span>

        <span class="n">assign_transit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span>
            <span class="s2">&quot;inro.emme.transit_assignment.capacitated_transit_assignment&quot;</span>
        <span class="p">)</span>
        <span class="n">_tclass_specs</span> <span class="o">=</span> <span class="p">[</span><span class="n">tclass</span><span class="o">.</span><span class="n">emme_transit_spec</span> <span class="k">for</span> <span class="n">tclass</span> <span class="ow">in</span> <span class="n">transit_classes</span><span class="p">]</span>
        <span class="n">_tclass_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">tclass</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">tclass</span> <span class="ow">in</span> <span class="n">transit_classes</span><span class="p">]</span>

        <span class="n">_cost_func</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;segment&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;CUSTOM&quot;</span><span class="p">,</span>
                <span class="s2">&quot;python_function&quot;</span><span class="p">:</span> <span class="n">func_returns_crowded_segment_cost</span><span class="p">(</span>
                    <span class="n">_duration</span><span class="p">,</span> <span class="n">_ccr_weights</span>
                <span class="p">),</span>
                <span class="s2">&quot;congestion_attribute&quot;</span><span class="p">:</span> <span class="s2">&quot;us3&quot;</span><span class="p">,</span>
                <span class="s2">&quot;orig_func&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;headway&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;CUSTOM&quot;</span><span class="p">,</span>
                <span class="s2">&quot;python_function&quot;</span><span class="p">:</span> <span class="n">func_returns_calc_updated_perceived_headway</span><span class="p">(</span>
                    <span class="n">_duration</span><span class="p">,</span>
                    <span class="n">_eawt_weights</span><span class="p">,</span>
                    <span class="n">_mode_config</span><span class="p">,</span>
                    <span class="n">use_fares</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">use_fares</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="o">+</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="n">calc_extra_wait_time</span><span class="p">))</span>
                <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="o">+</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="n">calc_adjusted_headway</span><span class="p">))</span>
                <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="o">+</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="n">calc_total_offs</span><span class="p">))</span>
                <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="o">+</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="n">calc_offs_thru_segment</span><span class="p">)),</span>
            <span class="p">},</span>
            <span class="s2">&quot;assignment_period&quot;</span><span class="p">:</span> <span class="n">_duration</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">_stop_criteria</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;max_iterations&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">ccr_stop_criteria</span><span class="o">.</span><span class="n">max_iterations</span><span class="p">,</span>
            <span class="s2">&quot;relative_difference&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">ccr_stop_criteria</span><span class="o">.</span><span class="n">relative_difference</span><span class="p">,</span>
            <span class="s2">&quot;percent_segments_over_capacity&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">ccr_stop_criteria</span><span class="o">.</span><span class="n">percent_segments_over_capacity</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">add_volumes</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">assign_transit</span><span class="p">(</span>
            <span class="n">_tclass_specs</span><span class="p">,</span>
            <span class="n">congestion_function</span><span class="o">=</span><span class="n">_cost_func</span><span class="p">,</span>
            <span class="n">stopping_criteria</span><span class="o">=</span><span class="n">_stop_criteria</span><span class="p">,</span>
            <span class="n">class_names</span><span class="o">=</span><span class="n">_tclass_names</span><span class="p">,</span>
            <span class="n">scenario</span><span class="o">=</span><span class="n">_emme_scenario</span><span class="p">,</span>
            <span class="n">log_worksheets</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">add_volumes</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># question - why do we need to do this between iterations AND ALSO give it to the EMME cost function? Does EMME not use it?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_calc_segment_ccr_penalties</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_run_congested_assign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Runs congested transit assignment for a time period.</span>

<span class="sd">        Args:</span>
<span class="sd">            time_period: time period name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_period_durations</span><span class="p">[</span><span class="n">time_period</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
        <span class="n">_congested_weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">congested_weights</span>
        <span class="n">_emme_scenario</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transit_emmebank</span><span class="o">.</span><span class="n">scenario</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span>
        <span class="n">transit_classes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transit_classes</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span>

        <span class="n">assign_transit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span>
            <span class="s2">&quot;inro.emme.transit_assignment.congested_transit_assignment&quot;</span>
        <span class="p">)</span>
        <span class="n">_tclass_specs</span> <span class="o">=</span> <span class="p">[</span><span class="n">tclass</span><span class="o">.</span><span class="n">emme_transit_spec</span> <span class="k">for</span> <span class="n">tclass</span> <span class="ow">in</span> <span class="n">transit_classes</span><span class="p">]</span>
        <span class="n">_tclass_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">tclass</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">tclass</span> <span class="ow">in</span> <span class="n">transit_classes</span><span class="p">]</span>

        <span class="n">_cost_func</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;CUSTOM&quot;</span><span class="p">,</span>
            <span class="s2">&quot;python_function&quot;</span><span class="p">:</span> <span class="n">func_returns_segment_congestion</span><span class="p">(</span>
                <span class="n">_duration</span><span class="p">,</span>
                <span class="n">_emme_scenario</span><span class="p">,</span>
                <span class="n">_congested_weights</span><span class="p">,</span>
                <span class="n">use_fares</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">use_fares</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="s2">&quot;congestion_attribute&quot;</span><span class="p">:</span> <span class="s2">&quot;us3&quot;</span><span class="p">,</span>
            <span class="s2">&quot;orig_func&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;assignment_period&quot;</span><span class="p">:</span> <span class="n">_duration</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">stop_criteria_settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">congested</span><span class="o">.</span><span class="n">stop_criteria</span>
        <span class="c1"># get the corresponding stop criteria for the global iteration</span>
        <span class="n">_stop_criteria</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">stop_criteria_settings</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;global_iteration&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">iteration</span><span class="p">:</span>
                <span class="n">_stop_criteria</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;max_iterations&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="n">time</span><span class="o">.</span><span class="n">max_iteration</span>
                        <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">max_iterations</span>
                        <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">time_period</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">time_period</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                    <span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                    <span class="s2">&quot;normalized_gap&quot;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">normalized_gap</span><span class="p">,</span>
                    <span class="s2">&quot;relative_gap&quot;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">relative_gap</span><span class="p">,</span>
                <span class="p">}</span>
        <span class="k">if</span> <span class="n">_stop_criteria</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;transit.congested.stop_criteria: Must specifify stop criteria for global iteration </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">iteration</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="n">add_volumes</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">assign_transit</span><span class="p">(</span>
            <span class="n">_tclass_specs</span><span class="p">,</span>
            <span class="n">congestion_function</span><span class="o">=</span><span class="n">_cost_func</span><span class="p">,</span>
            <span class="n">stopping_criteria</span><span class="o">=</span><span class="n">_stop_criteria</span><span class="p">,</span>
            <span class="n">class_names</span><span class="o">=</span><span class="n">_tclass_names</span><span class="p">,</span>
            <span class="n">scenario</span><span class="o">=</span><span class="n">_emme_scenario</span><span class="p">,</span>
            <span class="n">log_worksheets</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">add_volumes</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_run_extended_assign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run transit assignment without CCR.</span>

<span class="sd">        Args:</span>
<span class="sd">            time_period (_type_): time period name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">assign_transit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">modeller</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span>
            <span class="s2">&quot;inro.emme.transit_assignment.extended_transit_assignment&quot;</span>
        <span class="p">)</span>
        <span class="n">_emme_scenario</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transit_emmebank</span><span class="o">.</span><span class="n">scenario</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span>

        <span class="c1"># Question for INRO: Why are we only adding subsequent volumes shouldn&#39;t it assume to be</span>
        <span class="c1">#   zero to begin with?</span>
        <span class="c1"># Question for INRO: Can this function be distributed across machines? If so, how would</span>
        <span class="c1">#   that be structured?</span>
        <span class="n">add_volumes</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">tclass</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transit_classes</span><span class="p">(</span><span class="n">time_period</span><span class="p">):</span>
            <span class="n">assign_transit</span><span class="p">(</span>
                <span class="n">tclass</span><span class="o">.</span><span class="n">emme_transit_spec</span><span class="p">,</span>
                <span class="n">class_name</span><span class="o">=</span><span class="n">tclass</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">add_volumes</span><span class="o">=</span><span class="n">add_volumes</span><span class="p">,</span>
                <span class="n">scenario</span><span class="o">=</span><span class="n">_emme_scenario</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">add_volumes</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_get_network_with_boardings</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">emme_scenario</span><span class="p">:</span> <span class="s2">&quot;EmmeScenario&quot;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;EmmeNetwork&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get networkw ith transit boardings by line and segment.</span>

<span class="sd">        Args:</span>
<span class="sd">            emme_scenario (_type_):</span>

<span class="sd">        Returns:</span>
<span class="sd">            EmmeNetwork: with transit boardings by line and segment.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">network</span> <span class="o">=</span> <span class="n">emme_scenario</span><span class="o">.</span><span class="n">get_partial_network</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;TRANSIT_LINE&quot;</span><span class="p">,</span> <span class="s2">&quot;TRANSIT_SEGMENT&quot;</span><span class="p">],</span> <span class="n">include_attributes</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="n">_attributes</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;TRANSIT_LINE&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;#src_mode&quot;</span><span class="p">],</span>
            <span class="s2">&quot;TRANSIT_SEGMENT&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;transit_boardings&quot;</span><span class="p">],</span>
        <span class="p">}</span>
        <span class="n">_emme_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span>
        <span class="n">_emme_manager</span><span class="o">.</span><span class="n">copy_attribute_values</span><span class="p">(</span><span class="n">emme_scenario</span><span class="p">,</span> <span class="n">network</span><span class="p">,</span> <span class="n">_attributes</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">network</span>

    <span class="k">def</span> <span class="nf">_export_boardings_by_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Export total boardings by line to config.transit.output_transit_boardings_file.</span>

<span class="sd">        args:</span>
<span class="sd">            time_period (str): time period abbreviation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_emme_scenario</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transit_emmebank</span><span class="o">.</span><span class="n">scenario</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span>
        <span class="n">network</span> <span class="o">=</span> <span class="n">_emme_scenario</span><span class="o">.</span><span class="n">get_network</span><span class="p">()</span>

        <span class="n">output_transit_boardings_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">output_transit_boardings_path</span>
        <span class="p">)</span>

        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">output_transit_boardings_file</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
            <span class="n">output_transit_boardings_file</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="n">time_period</span><span class="o">.</span><span class="n">lower</span><span class="p">()),</span>
            <span class="s2">&quot;w&quot;</span><span class="p">,</span>
            <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">,</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">out_file</span><span class="p">:</span>
            <span class="n">out_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="s2">&quot;line_name&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;description&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;total_boarding&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;total_hour_cap&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;tm2_mode&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;line_mode&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;headway&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;fare_system&quot;</span><span class="p">,</span>
                    <span class="p">]</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">out_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">network</span><span class="o">.</span><span class="n">transit_lines</span><span class="p">():</span>
                <span class="n">boardings</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">capacity</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">vehicle</span><span class="o">.</span><span class="n">total_capacity</span>
                <span class="n">hdw</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">headway</span>
                <span class="n">line_hour_cap</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">*</span> <span class="n">capacity</span> <span class="o">/</span> <span class="n">hdw</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">use_fares</span><span class="p">:</span>
                    <span class="n">mode</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="s2">&quot;#src_mode&quot;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">mode</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">mode</span>
                <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">segments</span><span class="p">(</span><span class="n">include_hidden</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                    <span class="n">boardings</span> <span class="o">+=</span> <span class="n">segment</span><span class="o">.</span><span class="n">transit_boardings</span>
                <span class="n">out_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                    <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="p">[</span>
                            <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span>
                                <span class="n">line</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                                <span class="n">line</span><span class="p">[</span><span class="s2">&quot;#description&quot;</span><span class="p">],</span>
                                <span class="n">boardings</span><span class="p">,</span>
                                <span class="n">line_hour_cap</span><span class="p">,</span>
                                <span class="n">line</span><span class="p">[</span><span class="s2">&quot;#mode&quot;</span><span class="p">],</span>
                                <span class="n">mode</span><span class="p">,</span>
                                <span class="n">line</span><span class="o">.</span><span class="n">headway</span><span class="p">,</span>
                                <span class="n">line</span><span class="p">[</span><span class="s2">&quot;#faresystem&quot;</span><span class="p">],</span>
                            <span class="p">]</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="n">out_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_calc_connector_flows</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="s2">&quot;EmmeNetwork&quot;</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate boardings and alightings by assignment class.</span>

<span class="sd">        args:</span>
<span class="sd">            time_period (str): time period abbreviation</span>

<span class="sd">        returns:</span>
<span class="sd">            EmmeNetwork with aux_transit_volumes</span>
<span class="sd">            transit class stop attributes: {&lt;transit_class_name&gt;: @aux_volume_&lt;transit_class_name&gt;...}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_emme_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span>
        <span class="n">_emme_scenario</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transit_emmebank</span><span class="o">.</span><span class="n">scenario</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span>
        <span class="n">network_results</span> <span class="o">=</span> <span class="n">_emme_manager</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span>
            <span class="s2">&quot;inro.emme.transit_assignment.extended.network_results&quot;</span>
        <span class="p">)</span>
        <span class="n">create_extra</span> <span class="o">=</span> <span class="n">_emme_manager</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span>
            <span class="s2">&quot;inro.emme.data.extra_attribute.create_extra_attribute&quot;</span>
        <span class="p">)</span>
        <span class="n">tclass_stop_attrs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">tclass</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span><span class="p">:</span>
            <span class="n">attr_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;@aux_vol_</span><span class="si">{</span><span class="n">tclass</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>  <span class="c1"># maximum length 20 limit</span>
            <span class="n">create_extra</span><span class="p">(</span><span class="s2">&quot;LINK&quot;</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scenario</span><span class="o">=</span><span class="n">_emme_scenario</span><span class="p">)</span>
            <span class="n">spec</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;EXTENDED_TRANSIT_NETWORK_RESULTS&quot;</span><span class="p">,</span>
                <span class="s2">&quot;on_links&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;aux_transit_volumes&quot;</span><span class="p">:</span> <span class="n">attr_name</span><span class="p">},</span>
            <span class="p">}</span>
            <span class="n">network_results</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">class_name</span><span class="o">=</span><span class="n">tclass</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">scenario</span><span class="o">=</span><span class="n">_emme_scenario</span><span class="p">)</span>
            <span class="n">tclass_stop_attrs</span><span class="p">[</span><span class="n">tclass</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">attr_name</span>

        <span class="c1"># optimization: partial network to only load links and certain attributes</span>
        <span class="n">network</span> <span class="o">=</span> <span class="n">_emme_scenario</span><span class="o">.</span><span class="n">get_partial_network</span><span class="p">([</span><span class="s2">&quot;LINK&quot;</span><span class="p">],</span> <span class="n">include_attributes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;LINK&quot;</span><span class="p">:</span> <span class="n">tclass_stop_attrs</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span>
            <span class="s2">&quot;NODE&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;@taz_id&quot;</span><span class="p">,</span> <span class="s2">&quot;#node_id&quot;</span><span class="p">],</span>
        <span class="p">}</span>
        <span class="n">_emme_manager</span><span class="o">.</span><span class="n">copy_attribute_values</span><span class="p">(</span><span class="n">_emme_scenario</span><span class="p">,</span> <span class="n">network</span><span class="p">,</span> <span class="n">attributes</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">network</span><span class="p">,</span> <span class="n">tclass_stop_attrs</span>

    <span class="k">def</span> <span class="nf">_export_connector_flows</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">network</span><span class="p">:</span> <span class="n">EmmeNetwork</span><span class="p">,</span> <span class="n">class_stop_attrs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Export boardings and alightings by assignment class, stop(connector) and TAZ.</span>

<span class="sd">        args:</span>
<span class="sd">            network: network to use</span>
<span class="sd">            class_stop_attrs: list of attributes to export</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path_tmplt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">output_stop_usage_path</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path_tmplt</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
            <span class="n">path_tmplt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="n">time_period</span><span class="o">.</span><span class="n">lower</span><span class="p">()),</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">out_file</span><span class="p">:</span>
            <span class="n">out_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;mode&quot;</span><span class="p">,</span> <span class="s2">&quot;taz&quot;</span><span class="p">,</span> <span class="s2">&quot;stop&quot;</span><span class="p">,</span> <span class="s2">&quot;boardings&quot;</span><span class="p">,</span> <span class="s2">&quot;alightings&quot;</span><span class="p">]))</span>
            <span class="n">out_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">zone</span> <span class="ow">in</span> <span class="n">network</span><span class="o">.</span><span class="n">centroids</span><span class="p">():</span>
                <span class="n">taz_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">zone</span><span class="p">[</span><span class="s2">&quot;@taz_id&quot;</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">zone</span><span class="o">.</span><span class="n">outgoing_links</span><span class="p">():</span>
                    <span class="n">stop_id</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">j_node</span><span class="p">[</span><span class="s2">&quot;#node_id&quot;</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">attr_name</span> <span class="ow">in</span> <span class="n">class_stop_attrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">alightings</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">link</span><span class="o">.</span><span class="n">reverse_link</span><span class="p">[</span><span class="n">attr_name</span><span class="p">]</span> <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">reverse_link</span> <span class="k">else</span> <span class="mf">0.0</span>
                        <span class="p">)</span>
                        <span class="n">out_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">taz_id</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">stop_id</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">link</span><span class="p">[</span><span class="n">attr_name</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">alightings</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="p">)</span>
                <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">zone</span><span class="o">.</span><span class="n">incoming_links</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">reverse_link</span><span class="p">:</span>  <span class="c1"># already exported</span>
                        <span class="k">continue</span>
                    <span class="n">stop_id</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">i_node</span><span class="p">[</span><span class="s2">&quot;#node_id&quot;</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">attr_name</span> <span class="ow">in</span> <span class="n">class_stop_attrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">out_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">taz_id</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">stop_id</span><span class="si">}</span><span class="s2">, 0.0, </span><span class="si">{</span><span class="n">link</span><span class="p">[</span><span class="n">attr_name</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_export_transit_segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="c1"># add total boardings by access mode</span>
        <span class="n">_emme_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span>
        <span class="n">_emme_scenario</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transit_emmebank</span><span class="o">.</span><span class="n">scenario</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span>
        <span class="n">network_results</span> <span class="o">=</span> <span class="n">_emme_manager</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span>
            <span class="s2">&quot;inro.emme.transit_assignment.extended.network_results&quot;</span>
        <span class="p">)</span>
        <span class="n">create_extra</span> <span class="o">=</span> <span class="n">_emme_manager</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span>
            <span class="s2">&quot;inro.emme.data.extra_attribute.create_extra_attribute&quot;</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">tclass</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span><span class="p">:</span>
            <span class="n">initial_board_attr_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;@iboard_</span><span class="si">{</span><span class="n">tclass</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">direct_xboard_attr_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;@dboard_</span><span class="si">{</span><span class="n">tclass</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">auxiliary_xboard_attr_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;@aboard_</span><span class="si">{</span><span class="n">tclass</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">create_extra</span><span class="p">(</span>
                <span class="s2">&quot;TRANSIT_SEGMENT&quot;</span><span class="p">,</span>
                <span class="n">initial_board_attr_name</span><span class="p">,</span>
                <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">scenario</span><span class="o">=</span><span class="n">_emme_scenario</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">create_extra</span><span class="p">(</span>
                <span class="s2">&quot;TRANSIT_SEGMENT&quot;</span><span class="p">,</span>
                <span class="n">direct_xboard_attr_name</span><span class="p">,</span>
                <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">scenario</span><span class="o">=</span><span class="n">_emme_scenario</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">create_extra</span><span class="p">(</span>
                <span class="s2">&quot;TRANSIT_SEGMENT&quot;</span><span class="p">,</span>
                <span class="n">auxiliary_xboard_attr_name</span><span class="p">,</span>
                <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">scenario</span><span class="o">=</span><span class="n">_emme_scenario</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">spec</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;EXTENDED_TRANSIT_NETWORK_RESULTS&quot;</span><span class="p">,</span>
                <span class="s2">&quot;on_segments&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;initial_boardings&quot;</span><span class="p">:</span> <span class="n">initial_board_attr_name</span><span class="p">,</span>
                    <span class="s2">&quot;transfer_boardings_direct&quot;</span><span class="p">:</span> <span class="n">direct_xboard_attr_name</span><span class="p">,</span>
                    <span class="s2">&quot;transfer_boardings_indirect&quot;</span><span class="p">:</span> <span class="n">auxiliary_xboard_attr_name</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">}</span>
            <span class="n">network_results</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">class_name</span><span class="o">=</span><span class="n">tclass</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">scenario</span><span class="o">=</span><span class="n">_emme_scenario</span><span class="p">)</span>

        <span class="n">network</span> <span class="o">=</span> <span class="n">_emme_scenario</span><span class="o">.</span><span class="n">get_network</span><span class="p">()</span>
        <span class="n">path_boardings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">output_transit_segment_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path_boardings</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="n">time_period</span><span class="o">.</span><span class="n">lower</span><span class="p">()),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="s2">&quot;line&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;stop_name&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;i_node&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;j_node&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;dwt&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;ttf&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;voltr&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;board&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;con_time&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;uncon_time&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;mode&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;src_mode&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;mdesc&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;hdw&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;orig_hdw&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;speed&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;vauteq&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;vcaps&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;vcapt&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;initial_board_ptw&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;initial_board_wtp&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;initial_board_ktw&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;initial_board_wtk&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;initial_board_wtw&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;direct_transfer_board_ptw&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;direct_transfer_board_wtp&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;direct_transfer_board_ktw&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;direct_transfer_board_wtk&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;direct_transfer_board_wtw&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;auxiliary_transfer_board_ptw&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;auxiliary_transfer_board_wtp&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;auxiliary_transfer_board_ktw&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;auxiliary_transfer_board_wtk&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;auxiliary_transfer_board_wtw&quot;</span><span class="p">,</span>
                    <span class="p">]</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">network</span><span class="o">.</span><span class="n">transit_lines</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">segments</span><span class="p">(</span><span class="n">include_hidden</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">use_fares</span><span class="p">:</span>
                        <span class="n">mode</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s2">&quot;#src_mode&quot;</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">mode</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">mode</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">congested</span><span class="o">.</span><span class="n">use_peaking_factor</span> <span class="ow">and</span> <span class="p">(</span>
                        <span class="n">time_period</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;am&quot;</span><span class="p">,</span> <span class="s2">&quot;pm&quot;</span><span class="p">]</span>
                    <span class="p">):</span>
                        <span class="n">orig_headway</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s2">&quot;@orig_hdw&quot;</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">orig_headway</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">headway</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                        <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                            <span class="p">[</span>
                                <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span>
                                    <span class="n">segment</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                                    <span class="s1">&#39;&quot;</span><span class="si">{0}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">segment</span><span class="p">[</span><span class="s2">&quot;#stop_name&quot;</span><span class="p">]),</span>
                                    <span class="n">segment</span><span class="o">.</span><span class="n">i_node</span><span class="p">,</span>
                                    <span class="n">segment</span><span class="o">.</span><span class="n">j_node</span><span class="p">,</span>
                                    <span class="n">segment</span><span class="o">.</span><span class="n">dwell_time</span><span class="p">,</span>
                                    <span class="n">segment</span><span class="o">.</span><span class="n">transit_time_func</span><span class="p">,</span>
                                    <span class="n">segment</span><span class="o">.</span><span class="n">transit_volume</span><span class="p">,</span>
                                    <span class="n">segment</span><span class="o">.</span><span class="n">transit_boardings</span><span class="p">,</span>
                                    <span class="n">segment</span><span class="o">.</span><span class="n">transit_time</span><span class="p">,</span>
                                    <span class="n">segment</span><span class="p">[</span><span class="s2">&quot;@trantime_seg&quot;</span><span class="p">],</span>
                                    <span class="n">segment</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span>
                                    <span class="n">mode</span><span class="p">,</span>
                                    <span class="n">segment</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
                                    <span class="n">segment</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">headway</span><span class="p">,</span>
                                    <span class="n">orig_headway</span><span class="p">,</span>
                                    <span class="n">segment</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">speed</span><span class="p">,</span>
                                    <span class="n">segment</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">vehicle</span><span class="o">.</span><span class="n">auto_equivalent</span><span class="p">,</span>
                                    <span class="n">segment</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">vehicle</span><span class="o">.</span><span class="n">seated_capacity</span><span class="p">,</span>
                                    <span class="n">segment</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">vehicle</span><span class="o">.</span><span class="n">total_capacity</span><span class="p">,</span>
                                    <span class="n">segment</span><span class="p">[</span><span class="s2">&quot;@iboard_pnr_trn_wlk&quot;</span><span class="p">],</span>
                                    <span class="n">segment</span><span class="p">[</span><span class="s2">&quot;@iboard_wlk_trn_pnr&quot;</span><span class="p">],</span>
                                    <span class="n">segment</span><span class="p">[</span><span class="s2">&quot;@iboard_knr_trn_wlk&quot;</span><span class="p">],</span>
                                    <span class="n">segment</span><span class="p">[</span><span class="s2">&quot;@iboard_wlk_trn_knr&quot;</span><span class="p">],</span>
                                    <span class="n">segment</span><span class="p">[</span><span class="s2">&quot;@iboard_wlk_trn_wlk&quot;</span><span class="p">],</span>
                                    <span class="n">segment</span><span class="p">[</span><span class="s2">&quot;@dboard_pnr_trn_wlk&quot;</span><span class="p">],</span>
                                    <span class="n">segment</span><span class="p">[</span><span class="s2">&quot;@dboard_wlk_trn_pnr&quot;</span><span class="p">],</span>
                                    <span class="n">segment</span><span class="p">[</span><span class="s2">&quot;@dboard_knr_trn_wlk&quot;</span><span class="p">],</span>
                                    <span class="n">segment</span><span class="p">[</span><span class="s2">&quot;@dboard_wlk_trn_knr&quot;</span><span class="p">],</span>
                                    <span class="n">segment</span><span class="p">[</span><span class="s2">&quot;@dboard_wlk_trn_wlk&quot;</span><span class="p">],</span>
                                    <span class="n">segment</span><span class="p">[</span><span class="s2">&quot;@aboard_pnr_trn_wlk&quot;</span><span class="p">],</span>
                                    <span class="n">segment</span><span class="p">[</span><span class="s2">&quot;@aboard_wlk_trn_pnr&quot;</span><span class="p">],</span>
                                    <span class="n">segment</span><span class="p">[</span><span class="s2">&quot;@aboard_knr_trn_wlk&quot;</span><span class="p">],</span>
                                    <span class="n">segment</span><span class="p">[</span><span class="s2">&quot;@aboard_wlk_trn_knr&quot;</span><span class="p">],</span>
                                    <span class="n">segment</span><span class="p">[</span><span class="s2">&quot;@aboard_wlk_trn_wlk&quot;</span><span class="p">],</span>
                                <span class="p">]</span>
                            <span class="p">]</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_export_boardings_by_station</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">_emme_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span>
        <span class="n">_emme_scenario</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transit_emmebank</span><span class="o">.</span><span class="n">scenario</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span>
        <span class="n">network</span> <span class="o">=</span> <span class="n">_emme_scenario</span><span class="o">.</span><span class="n">get_network</span><span class="p">()</span>
        <span class="n">sta2sta</span> <span class="o">=</span> <span class="n">_emme_manager</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span>
            <span class="s2">&quot;inro.emme.transit_assignment.extended.station_to_station_analysis&quot;</span>
        <span class="p">)</span>
        <span class="n">sta2sta_spec</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;EXTENDED_TRANSIT_STATION_TO_STATION_ANALYSIS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;transit_line_selections&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;first_boarding&quot;</span><span class="p">:</span> <span class="s2">&quot;mode=h&quot;</span><span class="p">,</span>
                <span class="s2">&quot;last_alighting&quot;</span><span class="p">:</span> <span class="s2">&quot;mode=h&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;analyzed_demand&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="c1"># map to used modes in apply fares case</span>
        <span class="n">fare_modes</span> <span class="o">=</span> <span class="n">_defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="nb">set</span><span class="p">([]))</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">network</span><span class="o">.</span><span class="n">transit_lines</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">use_fares</span><span class="p">:</span>
                <span class="n">fare_modes</span><span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="s2">&quot;#src_mode&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fare_modes</span><span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">id</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

        <span class="n">operator_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="c1"># mode: network_selection</span>
            <span class="s2">&quot;bart&quot;</span><span class="p">:</span> <span class="s2">&quot;h&quot;</span><span class="p">,</span>
            <span class="s2">&quot;caltrain&quot;</span><span class="p">:</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">tclass</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">op</span><span class="p">,</span> <span class="n">cut</span> <span class="ow">in</span> <span class="n">operator_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">demand_matrix</span> <span class="o">=</span> <span class="s2">&quot;mfTRN_</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tclass</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">time_period</span><span class="p">)</span>
                <span class="n">output_file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">output_station_to_station_flow_path</span>
                <span class="p">)</span>

                <span class="n">sta2sta_spec</span><span class="p">[</span><span class="s2">&quot;transit_line_selections&quot;</span><span class="p">][</span><span class="s2">&quot;first_boarding&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;mode=&quot;</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">fare_modes</span><span class="p">[</span><span class="n">cut</span><span class="p">]))</span>
                <span class="p">)</span>
                <span class="n">sta2sta_spec</span><span class="p">[</span><span class="s2">&quot;transit_line_selections&quot;</span><span class="p">][</span><span class="s2">&quot;last_alighting&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;mode=&quot;</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">fare_modes</span><span class="p">[</span><span class="n">cut</span><span class="p">]))</span>
                <span class="p">)</span>
                <span class="n">sta2sta_spec</span><span class="p">[</span><span class="s2">&quot;analyzed_demand&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">demand_matrix</span>

                <span class="n">output_path</span> <span class="o">=</span> <span class="n">output_file_name</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">operator</span><span class="o">=</span><span class="n">op</span><span class="p">,</span> <span class="n">tclass</span><span class="o">=</span><span class="n">tclass</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="n">time_period</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="p">)</span>
                <span class="n">sta2sta</span><span class="p">(</span>
                    <span class="n">specification</span><span class="o">=</span><span class="n">sta2sta_spec</span><span class="p">,</span>
                    <span class="n">output_file</span><span class="o">=</span><span class="n">output_path</span><span class="p">,</span>
                    <span class="n">scenario</span><span class="o">=</span><span class="n">_emme_scenario</span><span class="p">,</span>
                    <span class="n">append_to_output_file</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">class_name</span><span class="o">=</span><span class="n">tclass</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_export_transfer_at_stops</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">_emme_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span>
        <span class="n">_emme_scenario</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transit_emmebank</span><span class="o">.</span><span class="n">scenario</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span>
        <span class="n">network</span> <span class="o">=</span> <span class="n">_emme_scenario</span><span class="o">.</span><span class="n">get_network</span><span class="p">()</span>
        <span class="n">transfers_at_stops</span> <span class="o">=</span> <span class="n">_emme_manager</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span>
            <span class="s2">&quot;inro.emme.transit_assignment.extended.apps.transfers_at_stops&quot;</span>
        <span class="p">)</span>

        <span class="n">stop_location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">output_transfer_at_station_node_ids</span>
        <span class="n">stop_location_val_key</span> <span class="o">=</span> <span class="p">{</span><span class="n">val</span><span class="p">:</span> <span class="n">key</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">stop_location</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">network</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">stop_location_val_key</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;#node_id&quot;</span><span class="p">]):</span>
                <span class="n">stop_location</span><span class="p">[</span><span class="n">stop_location_val_key</span><span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;#node_id&quot;</span><span class="p">]]]</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">id</span>

        <span class="k">for</span> <span class="n">tclass</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">stop_name</span><span class="p">,</span> <span class="n">stop_id</span> <span class="ow">in</span> <span class="n">stop_location</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">demand_matrix</span> <span class="o">=</span> <span class="s2">&quot;mfTRN_</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tclass</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">time_period</span><span class="p">)</span>
                <span class="n">output_file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">output_transfer_at_station_path</span>
                <span class="p">)</span>
                <span class="n">output_path</span> <span class="o">=</span> <span class="n">output_file_name</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">tclass</span><span class="o">=</span><span class="n">tclass</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">stop_name</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="n">time_period</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="p">)</span>

                <span class="n">transfers_at_stops</span><span class="p">(</span>
                    <span class="n">selection</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;i=</span><span class="si">{</span><span class="n">stop_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">export_path</span><span class="o">=</span><span class="n">output_path</span><span class="p">,</span>
                    <span class="n">scenario</span><span class="o">=</span><span class="n">_emme_scenario</span><span class="p">,</span>
                    <span class="n">class_name</span><span class="o">=</span><span class="n">tclass</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="n">analyzed_demand</span><span class="o">=</span><span class="n">demand_matrix</span><span class="p">,</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_add_ccr_vars_to_scenario</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">emme_scenario</span><span class="p">:</span> <span class="s2">&quot;EmmeScenario&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add Extra Added Wait Time and Capacity Penalty to emme scenario.</span>

<span class="sd">        Args:</span>
<span class="sd">            emme_scenario : EmmeScenario</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">create_extra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span>
            <span class="s2">&quot;inro.emme.data.extra_attribute.create_extra_attribute&quot;</span>
        <span class="p">)</span>
        <span class="n">create_extra</span><span class="p">(</span>
            <span class="s2">&quot;TRANSIT_SEGMENT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;@eawt&quot;</span><span class="p">,</span>
            <span class="s2">&quot;extra added wait time&quot;</span><span class="p">,</span>
            <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">scenario</span><span class="o">=</span><span class="n">emme_scenario</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">create_extra</span><span class="p">(</span>
            <span class="s2">&quot;TRANSIT_SEGMENT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;@capacity_penalty&quot;</span><span class="p">,</span>
            <span class="s2">&quot;capacity penalty at boarding&quot;</span><span class="p">,</span>
            <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">scenario</span><span class="o">=</span><span class="n">emme_scenario</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_network_with_ccr_scenario_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">emme_scenario</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_ccr_vars_to_scenario</span><span class="p">(</span><span class="n">emme_scenario</span><span class="p">)</span>

        <span class="n">_attributes</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;TRANSIT_SEGMENT&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;@phdwy&quot;</span><span class="p">,</span>
                <span class="s2">&quot;transit_volume&quot;</span><span class="p">,</span>
                <span class="s2">&quot;transit_boardings&quot;</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="s2">&quot;TRANSIT_VEHICLE&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;seated_capacity&quot;</span><span class="p">,</span> <span class="s2">&quot;total_capacity&quot;</span><span class="p">],</span>
            <span class="s2">&quot;TRANSIT_LINE&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;headway&quot;</span><span class="p">],</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">use_fares</span><span class="p">:</span>
            <span class="n">_attributes</span><span class="p">[</span><span class="s2">&quot;TRANSIT_LINE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;#src_mode&quot;</span><span class="p">)</span>

        <span class="c1"># load network object from scenario (on disk) and copy some attributes</span>
        <span class="n">network</span> <span class="o">=</span> <span class="n">emme_scenario</span><span class="o">.</span><span class="n">get_partial_network</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;TRANSIT_SEGMENT&quot;</span><span class="p">],</span> <span class="n">include_attributes</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="n">network</span><span class="o">.</span><span class="n">create_attribute</span><span class="p">(</span><span class="s2">&quot;TRANSIT_LINE&quot;</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">copy_attribute_values</span><span class="p">(</span><span class="n">emme_scenario</span><span class="p">,</span> <span class="n">network</span><span class="p">,</span> <span class="n">_attributes</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">network</span>

    <span class="k">def</span> <span class="nf">_calc_segment_ccr_penalties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_period</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate extra average wait time (@eawt) and @capacity_penalty on the segments.</span>

<span class="sd">        TODO: INRO Please document</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_emme_scenario</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transit_emmebank</span><span class="o">.</span><span class="n">scenario</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span>
        <span class="n">_network</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_network_with_ccr_scenario_attributes</span><span class="p">(</span><span class="n">_emme_scenario</span><span class="p">)</span>

        <span class="n">_eawt_weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">eawt_weights</span>
        <span class="n">_mode_config</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">mode_config</span><span class="o">.</span><span class="n">mode_id</span><span class="p">:</span> <span class="n">mode_config</span> <span class="k">for</span> <span class="n">mode_config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">modes</span>
        <span class="p">}</span>

        <span class="n">_duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_period_durations</span><span class="p">[</span><span class="n">time_period</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">_network</span><span class="o">.</span><span class="n">transit_lines</span><span class="p">():</span>
            <span class="n">line</span><span class="o">.</span><span class="n">capacity</span> <span class="o">=</span> <span class="n">time_period_capacity</span><span class="p">(</span>
                <span class="n">line</span><span class="o">.</span><span class="n">vehicle</span><span class="o">.</span><span class="n">total_capacity</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">headway</span><span class="p">,</span> <span class="n">_duration</span>
            <span class="p">)</span>

        <span class="c1"># QUESTION: document origin of this param.</span>
        <span class="n">_hdwy_fraction</span> <span class="o">=</span> <span class="mf">0.5</span>  <span class="c1"># fixed in assignment spec</span>
        <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="n">_network</span><span class="o">.</span><span class="n">transit_segments</span><span class="p">():</span>
            <span class="n">segment</span><span class="p">[</span><span class="s2">&quot;@eawt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">calc_extra_wait_time</span><span class="p">(</span>
                <span class="n">segment</span><span class="p">,</span>
                <span class="n">segment</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">capacity</span><span class="p">,</span>
                <span class="n">_eawt_weights</span><span class="p">,</span>
                <span class="n">_mode_config</span><span class="p">,</span>
                <span class="n">use_fares</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">use_fares</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">segment</span><span class="p">[</span><span class="s2">&quot;@capacity_penalty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">max</span><span class="p">(</span><span class="n">segment</span><span class="p">[</span><span class="s2">&quot;@phdwy&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">segment</span><span class="p">[</span><span class="s2">&quot;@eawt&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">segment</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">headway</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="o">*</span> <span class="n">_hdwy_fraction</span>
            <span class="p">)</span>
        <span class="c1"># copy (save) results back from the network to the scenario (on disk)</span>
        <span class="n">_ccr_attributes</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;TRANSIT_SEGMENT&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;@eawt&quot;</span><span class="p">,</span> <span class="s2">&quot;@capacity_penalty&quot;</span><span class="p">]}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">copy_attribute_values</span><span class="p">(</span>
            <span class="n">_network</span><span class="p">,</span> <span class="n">_emme_scenario</span><span class="p">,</span> <span class="n">_ccr_attributes</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tm2py.components.network.transit.transit_assign.TransitAssignment.__init__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span></code>

<a href="#tm2py.components.network.transit.transit_assign.TransitAssignment.__init__" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Constructor for TransitAssignment.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>controller</code></td>
            <td>
                  <code>&#39;RunController&#39;</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>RunController object.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/network/transit/transit_assign.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="s2">&quot;RunController&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Constructor for TransitAssignment.</span>

<span class="sd">    Args:</span>
<span class="sd">        controller: RunController object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">transit</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;prepare transit demand&quot;</span><span class="p">:</span> <span class="n">PrepareTransitDemand</span><span class="p">(</span><span class="n">controller</span><span class="p">),</span>
    <span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">transit_network</span> <span class="o">=</span> <span class="n">PrepareTransitNetwork</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_demand_matrix</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># FIXME</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_num_processors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">num_processors</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_time_period</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_transit_emmebank</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.network.transit.transit_assign.TransitAssignment.run" class="doc doc-heading">
            <code class=" language-python"><span class="n">run</span><span class="p">()</span></code>

<a href="#tm2py.components.network.transit.transit_assign.TransitAssignment.run" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Run transit assignments.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/network/transit/transit_assign.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@LogStartEnd</span><span class="p">(</span><span class="s2">&quot;Transit assignments&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run transit assignments.&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">iteration</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transit_emmebank</span><span class="o">.</span><span class="n">create_zero_matrix</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">warmstart</span><span class="o">.</span><span class="n">warmstart</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">warmstart</span><span class="o">.</span><span class="n">use_warmstart_demand</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span><span class="p">[</span><span class="s2">&quot;prepare transit demand&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># give error message to user about not warmstarting transit</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;ERROR: transit has to be warmstarted, please either specify use_warmstart_skim or use_warmstart_demand&quot;</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span><span class="p">[</span><span class="s2">&quot;prepare transit demand&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">time_period</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">:</span>
        <span class="c1"># update auto times</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;updating auto time in transit network&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transit_network</span><span class="o">.</span><span class="n">update_auto_times</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">iteration</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># iteration = 0 : run uncongested transit assignment</span>
            <span class="n">use_ccr</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">congested_transit_assignment</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;running uncongested transit assignment with warmstart demand&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_transit_assign</span><span class="p">(</span>
                <span class="n">time_period</span><span class="p">,</span> <span class="n">use_ccr</span><span class="p">,</span> <span class="n">congested_transit_assignment</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">iteration</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">warmstart</span><span class="o">.</span><span class="n">use_warmstart_skim</span><span class="p">):</span>
            <span class="c1"># iteration = 1 and use_warmstart_skim = True : run uncongested transit assignment</span>
            <span class="n">use_ccr</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">congested_transit_assignment</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_transit_assign</span><span class="p">(</span>
                <span class="n">time_period</span><span class="p">,</span> <span class="n">use_ccr</span><span class="p">,</span> <span class="n">congested_transit_assignment</span>
            <span class="p">)</span>               
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># iteration &gt;= 1 and use_warmstart_skim = False : run congested transit assignment</span>
            <span class="n">use_ccr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">use_ccr</span>
            <span class="k">if</span> <span class="n">time_period</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;EA&quot;</span><span class="p">,</span> <span class="s2">&quot;EV&quot;</span><span class="p">,</span> <span class="s2">&quot;MD&quot;</span><span class="p">]:</span>
                <span class="n">congested_transit_assignment</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">congested_transit_assignment</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">congested_transit_assignment</span>
                <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">run_transit_assign</span><span class="p">(</span>
                <span class="n">time_period</span><span class="p">,</span> <span class="n">use_ccr</span><span class="p">,</span> <span class="n">congested_transit_assignment</span>
            <span class="p">)</span>

        <span class="c1"># output_summaries</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">output_stop_usage_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">network</span><span class="p">,</span> <span class="n">class_stop_attrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_connector_flows</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_export_connector_flows</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">class_stop_attrs</span><span class="p">,</span> <span class="n">time_period</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">iteration</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">end_iteration</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">output_transit_boardings_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_export_boardings_by_line</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">output_transit_segment_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_export_transit_segment</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">output_station_to_station_flow_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_export_boardings_by_station</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">output_transfer_at_station_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_export_transfer_at_stops</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.network.transit.transit_assign.TransitAssignment.validate_inputs" class="doc doc-heading">
            <code class=" language-python"><span class="n">validate_inputs</span><span class="p">()</span></code>

<a href="#tm2py.components.network.transit.transit_assign.TransitAssignment.validate_inputs" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Validate the inputs.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/network/transit/transit_assign.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">422</span>
<span class="normal">423</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate the inputs.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.components.network.transit.transit_assign.TransitAssignmentClass" class="doc doc-heading">
            <code>TransitAssignmentClass</code>


<a href="#tm2py.components.network.transit.transit_assign.TransitAssignmentClass" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">


      <p>Transit assignment class, represents data from config and conversion to Emme specs.</p>


<details class="internal-properties" open>
  <summary>Internal properties</summary>
  
</details>
              <details class="quote">
                <summary>Source code in <code>tm2py/components/network/transit/transit_assign.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span>
<span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span>
<span class="normal">1751</span>
<span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span>
<span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span>
<span class="normal">1765</span>
<span class="normal">1766</span>
<span class="normal">1767</span>
<span class="normal">1768</span>
<span class="normal">1769</span>
<span class="normal">1770</span>
<span class="normal">1771</span>
<span class="normal">1772</span>
<span class="normal">1773</span>
<span class="normal">1774</span>
<span class="normal">1775</span>
<span class="normal">1776</span>
<span class="normal">1777</span>
<span class="normal">1778</span>
<span class="normal">1779</span>
<span class="normal">1780</span>
<span class="normal">1781</span>
<span class="normal">1782</span>
<span class="normal">1783</span>
<span class="normal">1784</span>
<span class="normal">1785</span>
<span class="normal">1786</span>
<span class="normal">1787</span>
<span class="normal">1788</span>
<span class="normal">1789</span>
<span class="normal">1790</span>
<span class="normal">1791</span>
<span class="normal">1792</span>
<span class="normal">1793</span>
<span class="normal">1794</span>
<span class="normal">1795</span>
<span class="normal">1796</span>
<span class="normal">1797</span>
<span class="normal">1798</span>
<span class="normal">1799</span>
<span class="normal">1800</span>
<span class="normal">1801</span>
<span class="normal">1802</span>
<span class="normal">1803</span>
<span class="normal">1804</span>
<span class="normal">1805</span>
<span class="normal">1806</span>
<span class="normal">1807</span>
<span class="normal">1808</span>
<span class="normal">1809</span>
<span class="normal">1810</span>
<span class="normal">1811</span>
<span class="normal">1812</span>
<span class="normal">1813</span>
<span class="normal">1814</span>
<span class="normal">1815</span>
<span class="normal">1816</span>
<span class="normal">1817</span>
<span class="normal">1818</span>
<span class="normal">1819</span>
<span class="normal">1820</span>
<span class="normal">1821</span>
<span class="normal">1822</span>
<span class="normal">1823</span>
<span class="normal">1824</span>
<span class="normal">1825</span>
<span class="normal">1826</span>
<span class="normal">1827</span>
<span class="normal">1828</span>
<span class="normal">1829</span>
<span class="normal">1830</span>
<span class="normal">1831</span>
<span class="normal">1832</span>
<span class="normal">1833</span>
<span class="normal">1834</span>
<span class="normal">1835</span>
<span class="normal">1836</span>
<span class="normal">1837</span>
<span class="normal">1838</span>
<span class="normal">1839</span>
<span class="normal">1840</span>
<span class="normal">1841</span>
<span class="normal">1842</span>
<span class="normal">1843</span>
<span class="normal">1844</span>
<span class="normal">1845</span>
<span class="normal">1846</span>
<span class="normal">1847</span>
<span class="normal">1848</span>
<span class="normal">1849</span>
<span class="normal">1850</span>
<span class="normal">1851</span>
<span class="normal">1852</span>
<span class="normal">1853</span>
<span class="normal">1854</span>
<span class="normal">1855</span>
<span class="normal">1856</span>
<span class="normal">1857</span>
<span class="normal">1858</span>
<span class="normal">1859</span>
<span class="normal">1860</span>
<span class="normal">1861</span>
<span class="normal">1862</span>
<span class="normal">1863</span>
<span class="normal">1864</span>
<span class="normal">1865</span>
<span class="normal">1866</span>
<span class="normal">1867</span>
<span class="normal">1868</span>
<span class="normal">1869</span>
<span class="normal">1870</span>
<span class="normal">1871</span>
<span class="normal">1872</span>
<span class="normal">1873</span>
<span class="normal">1874</span>
<span class="normal">1875</span>
<span class="normal">1876</span>
<span class="normal">1877</span>
<span class="normal">1878</span>
<span class="normal">1879</span>
<span class="normal">1880</span>
<span class="normal">1881</span>
<span class="normal">1882</span>
<span class="normal">1883</span>
<span class="normal">1884</span>
<span class="normal">1885</span>
<span class="normal">1886</span>
<span class="normal">1887</span>
<span class="normal">1888</span>
<span class="normal">1889</span>
<span class="normal">1890</span>
<span class="normal">1891</span>
<span class="normal">1892</span>
<span class="normal">1893</span>
<span class="normal">1894</span>
<span class="normal">1895</span>
<span class="normal">1896</span>
<span class="normal">1897</span>
<span class="normal">1898</span>
<span class="normal">1899</span>
<span class="normal">1900</span>
<span class="normal">1901</span>
<span class="normal">1902</span>
<span class="normal">1903</span>
<span class="normal">1904</span>
<span class="normal">1905</span>
<span class="normal">1906</span>
<span class="normal">1907</span>
<span class="normal">1908</span>
<span class="normal">1909</span>
<span class="normal">1910</span>
<span class="normal">1911</span>
<span class="normal">1912</span>
<span class="normal">1913</span>
<span class="normal">1914</span>
<span class="normal">1915</span>
<span class="normal">1916</span>
<span class="normal">1917</span>
<span class="normal">1918</span>
<span class="normal">1919</span>
<span class="normal">1920</span>
<span class="normal">1921</span>
<span class="normal">1922</span>
<span class="normal">1923</span>
<span class="normal">1924</span>
<span class="normal">1925</span>
<span class="normal">1926</span>
<span class="normal">1927</span>
<span class="normal">1928</span>
<span class="normal">1929</span>
<span class="normal">1930</span>
<span class="normal">1931</span>
<span class="normal">1932</span>
<span class="normal">1933</span>
<span class="normal">1934</span>
<span class="normal">1935</span>
<span class="normal">1936</span>
<span class="normal">1937</span>
<span class="normal">1938</span>
<span class="normal">1939</span>
<span class="normal">1940</span>
<span class="normal">1941</span>
<span class="normal">1942</span>
<span class="normal">1943</span>
<span class="normal">1944</span>
<span class="normal">1945</span>
<span class="normal">1946</span>
<span class="normal">1947</span>
<span class="normal">1948</span>
<span class="normal">1949</span>
<span class="normal">1950</span>
<span class="normal">1951</span>
<span class="normal">1952</span>
<span class="normal">1953</span>
<span class="normal">1954</span>
<span class="normal">1955</span>
<span class="normal">1956</span>
<span class="normal">1957</span>
<span class="normal">1958</span>
<span class="normal">1959</span>
<span class="normal">1960</span>
<span class="normal">1961</span>
<span class="normal">1962</span>
<span class="normal">1963</span>
<span class="normal">1964</span>
<span class="normal">1965</span>
<span class="normal">1966</span>
<span class="normal">1967</span>
<span class="normal">1968</span>
<span class="normal">1969</span>
<span class="normal">1970</span>
<span class="normal">1971</span>
<span class="normal">1972</span>
<span class="normal">1973</span>
<span class="normal">1974</span>
<span class="normal">1975</span>
<span class="normal">1976</span>
<span class="normal">1977</span>
<span class="normal">1978</span>
<span class="normal">1979</span>
<span class="normal">1980</span>
<span class="normal">1981</span>
<span class="normal">1982</span>
<span class="normal">1983</span>
<span class="normal">1984</span>
<span class="normal">1985</span>
<span class="normal">1986</span>
<span class="normal">1987</span>
<span class="normal">1988</span>
<span class="normal">1989</span>
<span class="normal">1990</span>
<span class="normal">1991</span>
<span class="normal">1992</span>
<span class="normal">1993</span>
<span class="normal">1994</span>
<span class="normal">1995</span>
<span class="normal">1996</span>
<span class="normal">1997</span>
<span class="normal">1998</span>
<span class="normal">1999</span>
<span class="normal">2000</span>
<span class="normal">2001</span>
<span class="normal">2002</span>
<span class="normal">2003</span>
<span class="normal">2004</span>
<span class="normal">2005</span>
<span class="normal">2006</span>
<span class="normal">2007</span>
<span class="normal">2008</span>
<span class="normal">2009</span>
<span class="normal">2010</span>
<span class="normal">2011</span>
<span class="normal">2012</span>
<span class="normal">2013</span>
<span class="normal">2014</span>
<span class="normal">2015</span>
<span class="normal">2016</span>
<span class="normal">2017</span>
<span class="normal">2018</span>
<span class="normal">2019</span>
<span class="normal">2020</span>
<span class="normal">2021</span>
<span class="normal">2022</span>
<span class="normal">2023</span>
<span class="normal">2024</span>
<span class="normal">2025</span>
<span class="normal">2026</span>
<span class="normal">2027</span>
<span class="normal">2028</span>
<span class="normal">2029</span>
<span class="normal">2030</span>
<span class="normal">2031</span>
<span class="normal">2032</span>
<span class="normal">2033</span>
<span class="normal">2034</span>
<span class="normal">2035</span>
<span class="normal">2036</span>
<span class="normal">2037</span>
<span class="normal">2038</span>
<span class="normal">2039</span>
<span class="normal">2040</span>
<span class="normal">2041</span>
<span class="normal">2042</span>
<span class="normal">2043</span>
<span class="normal">2044</span>
<span class="normal">2045</span>
<span class="normal">2046</span>
<span class="normal">2047</span>
<span class="normal">2048</span>
<span class="normal">2049</span>
<span class="normal">2050</span>
<span class="normal">2051</span>
<span class="normal">2052</span>
<span class="normal">2053</span>
<span class="normal">2054</span>
<span class="normal">2055</span>
<span class="normal">2056</span>
<span class="normal">2057</span>
<span class="normal">2058</span>
<span class="normal">2059</span>
<span class="normal">2060</span>
<span class="normal">2061</span>
<span class="normal">2062</span>
<span class="normal">2063</span>
<span class="normal">2064</span>
<span class="normal">2065</span>
<span class="normal">2066</span>
<span class="normal">2067</span>
<span class="normal">2068</span>
<span class="normal">2069</span>
<span class="normal">2070</span>
<span class="normal">2071</span>
<span class="normal">2072</span>
<span class="normal">2073</span>
<span class="normal">2074</span>
<span class="normal">2075</span>
<span class="normal">2076</span>
<span class="normal">2077</span>
<span class="normal">2078</span>
<span class="normal">2079</span>
<span class="normal">2080</span>
<span class="normal">2081</span>
<span class="normal">2082</span>
<span class="normal">2083</span>
<span class="normal">2084</span>
<span class="normal">2085</span>
<span class="normal">2086</span>
<span class="normal">2087</span>
<span class="normal">2088</span>
<span class="normal">2089</span>
<span class="normal">2090</span>
<span class="normal">2091</span>
<span class="normal">2092</span>
<span class="normal">2093</span>
<span class="normal">2094</span>
<span class="normal">2095</span>
<span class="normal">2096</span>
<span class="normal">2097</span>
<span class="normal">2098</span>
<span class="normal">2099</span>
<span class="normal">2100</span>
<span class="normal">2101</span>
<span class="normal">2102</span>
<span class="normal">2103</span>
<span class="normal">2104</span>
<span class="normal">2105</span>
<span class="normal">2106</span>
<span class="normal">2107</span>
<span class="normal">2108</span>
<span class="normal">2109</span>
<span class="normal">2110</span>
<span class="normal">2111</span>
<span class="normal">2112</span>
<span class="normal">2113</span>
<span class="normal">2114</span>
<span class="normal">2115</span>
<span class="normal">2116</span>
<span class="normal">2117</span>
<span class="normal">2118</span>
<span class="normal">2119</span>
<span class="normal">2120</span>
<span class="normal">2121</span>
<span class="normal">2122</span>
<span class="normal">2123</span>
<span class="normal">2124</span>
<span class="normal">2125</span>
<span class="normal">2126</span>
<span class="normal">2127</span>
<span class="normal">2128</span>
<span class="normal">2129</span>
<span class="normal">2130</span>
<span class="normal">2131</span>
<span class="normal">2132</span>
<span class="normal">2133</span>
<span class="normal">2134</span>
<span class="normal">2135</span>
<span class="normal">2136</span>
<span class="normal">2137</span>
<span class="normal">2138</span>
<span class="normal">2139</span>
<span class="normal">2140</span>
<span class="normal">2141</span>
<span class="normal">2142</span>
<span class="normal">2143</span>
<span class="normal">2144</span>
<span class="normal">2145</span>
<span class="normal">2146</span>
<span class="normal">2147</span>
<span class="normal">2148</span>
<span class="normal">2149</span>
<span class="normal">2150</span>
<span class="normal">2151</span>
<span class="normal">2152</span>
<span class="normal">2153</span>
<span class="normal">2154</span>
<span class="normal">2155</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TransitAssignmentClass</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Transit assignment class, represents data from config and conversion to Emme specs.</span>

<span class="sd">    Internal properties:</span>
<span class="sd">        _name: the class name loaded from config (not to be changed)</span>
<span class="sd">        _class_config: the transit class config (TransitClassConfig)</span>
<span class="sd">        _transit_config: the root transit assignment config (TransitConfig)</span>
<span class="sd">        _time_period: the time period name</span>
<span class="sd">        _iteration: the current iteration</span>
<span class="sd">        _num_processors: the number of processors to use, loaded from config</span>
<span class="sd">        _fare_modes: the mapping from the generated fare mode ID to the original</span>
<span class="sd">            source mode ID</span>
<span class="sd">        _spec_dir: directory to find the generated journey levels tables from</span>
<span class="sd">            the apply fares step</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># disable too many instance attributes and arguments recommendations</span>
    <span class="c1"># pylint: disable=R0902, R0913</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">tclass_config</span><span class="p">:</span> <span class="n">TransitClassConfig</span><span class="p">,</span>
        <span class="n">config</span><span class="p">:</span> <span class="n">TransitConfig</span><span class="p">,</span>
        <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">iteration</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">num_processors</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">fare_modes</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
        <span class="n">spec_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Assignment class constructor.</span>

<span class="sd">        Args:</span>
<span class="sd">            tclass_config: the transit class config (TransitClassConfig)</span>
<span class="sd">            config: the root transit assignment config (TransitConfig)</span>
<span class="sd">            time_period: the time period name</span>
<span class="sd">            iteration: the current iteration</span>
<span class="sd">            num_processors: the number of processors to use, loaded from config</span>
<span class="sd">            fare_modes: the mapping from the generated fare mode ID to the original</span>
<span class="sd">                source mode ID</span>
<span class="sd">            spec_dir: directory to find the generated journey levels tables from</span>
<span class="sd">                the apply fares step</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">tclass_config</span><span class="o">.</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_class_config</span> <span class="o">=</span> <span class="n">tclass_config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_config</span> <span class="o">=</span> <span class="n">config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_time_period</span> <span class="o">=</span> <span class="n">time_period</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_iteration</span> <span class="o">=</span> <span class="n">iteration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_num_processors</span> <span class="o">=</span> <span class="n">num_processors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fare_modes</span> <span class="o">=</span> <span class="n">fare_modes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_spec_dir</span> <span class="o">=</span> <span class="n">spec_dir</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The class name.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">emme_transit_spec</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EmmeTransitSpec</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return Emme Extended transit assignment specification.</span>

<span class="sd">        Converted from input config (transit.classes, with some parameters from</span>
<span class="sd">        transit table), see also Emme Help for</span>
<span class="sd">        Extended transit assignment for specification details.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;EXTENDED_TRANSIT_ASSIGNMENT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;modes&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_modes</span><span class="p">,</span>
            <span class="s2">&quot;demand&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_demand_matrix</span><span class="p">,</span>
            <span class="s2">&quot;waiting_time&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;effective_headways&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">effective_headway_source</span><span class="p">,</span>
                <span class="s2">&quot;headway_fraction&quot;</span><span class="p">:</span> <span class="s2">&quot;@hdw_fraction&quot;</span><span class="p">,</span>
                <span class="s2">&quot;perception_factor&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">initial_wait_perception_factor</span><span class="p">,</span>
                <span class="s2">&quot;spread_factor&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;boarding_cost&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;global&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;penalty&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;perception_factor&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}},</span>
            <span class="s2">&quot;boarding_time&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;on_lines&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;penalty&quot;</span><span class="p">:</span> <span class="s2">&quot;@iboard_penalty&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;perception_factor&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="s2">&quot;in_vehicle_cost&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;in_vehicle_time&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;perception_factor&quot;</span><span class="p">:</span> <span class="s2">&quot;@invehicle_factor&quot;</span><span class="p">},</span>
            <span class="s2">&quot;aux_transit_time&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;perception_factor&quot;</span><span class="p">:</span> <span class="mi">1</span>
            <span class="p">},</span>  <span class="c1"># walk and drive perception factors are specified in mode definition &quot;speed_or_time_factor&quot;</span>
            <span class="s2">&quot;aux_transit_cost&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;journey_levels&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_journey_levels</span><span class="p">,</span>
            <span class="s2">&quot;flow_distribution_between_lines&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;consider_total_impedance&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
            <span class="s2">&quot;flow_distribution_at_origins&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;fixed_proportions_on_connectors&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;choices_at_origins&quot;</span><span class="p">:</span> <span class="s2">&quot;OPTIMAL_STRATEGY&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;flow_distribution_at_regular_nodes_with_aux_transit_choices&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;choices_at_regular_nodes&quot;</span><span class="p">:</span> <span class="s2">&quot;OPTIMAL_STRATEGY&quot;</span>
            <span class="p">},</span>
            <span class="s2">&quot;circular_lines&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;stay&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
            <span class="s2">&quot;connector_to_connector_path_prohibition&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;od_results&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;total_impedance&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span>
            <span class="s2">&quot;performance_settings&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;number_of_processors&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_processors</span><span class="p">},</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">use_fares</span><span class="p">:</span>
            <span class="n">fare_perception</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">value_of_time</span>
            <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;boarding_cost&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;on_segments&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;penalty&quot;</span><span class="p">:</span> <span class="s2">&quot;@board_cost&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;perception_factor&quot;</span><span class="p">:</span> <span class="n">fare_perception</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;in_vehicle_cost&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;penalty&quot;</span><span class="p">:</span> <span class="s2">&quot;@invehicle_cost&quot;</span><span class="p">,</span>
                <span class="s2">&quot;perception_factor&quot;</span><span class="p">:</span> <span class="n">fare_perception</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="c1"># Optional aux_transit_cost, used for walk time on connectors,</span>
        <span class="c1">#          set if override_connector_times is on</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;override_connector_times&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;aux_transit_cost&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;penalty&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;@walk_time_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;perception_factor&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">walk_perception_factor</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="k">return</span> <span class="n">spec</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_demand_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;TRN_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_class_config</span><span class="o">.</span><span class="n">skim_set_id</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_time_period</span><span class="si">}</span><span class="s1">&quot;&#39;</span>

    <span class="k">def</span> <span class="nf">_get_used_mode_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">TransitModeConfig</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get list of assignment Mode IDs from input list of Emme mode objects.</span>

<span class="sd">        Accounts for fare table (mapping from input mode ID to auto-generated</span>
<span class="sd">        set of mode IDs for fare transition table (fares.far input) by applyfares</span>
<span class="sd">        component.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">use_fares</span><span class="p">:</span>
            <span class="n">out_modes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
            <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">modes</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">mode</span><span class="o">.</span><span class="n">assign_type</span> <span class="o">==</span> <span class="s2">&quot;TRANSIT&quot;</span><span class="p">:</span>
                    <span class="n">out_modes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fare_modes</span><span class="p">[</span><span class="n">mode</span><span class="o">.</span><span class="n">mode_id</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">out_modes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">mode</span><span class="o">.</span><span class="n">mode_id</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">out_modes</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">mode</span><span class="o">.</span><span class="n">mode_id</span> <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">modes</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_modes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List of modes IDs (str) to use in assignment for this class.&quot;&quot;&quot;</span>
        <span class="n">all_modes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">modes</span>
        <span class="n">mode_types</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_class_config</span><span class="o">.</span><span class="n">mode_types</span>
        <span class="n">modes</span> <span class="o">=</span> <span class="p">[</span><span class="n">mode</span> <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">all_modes</span> <span class="k">if</span> <span class="n">mode</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="n">mode_types</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_used_mode_ids</span><span class="p">(</span><span class="n">modes</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_transit_modes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List of transit modes IDs (str) to use in assignment for this class.&quot;&quot;&quot;</span>
        <span class="n">all_modes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">modes</span>
        <span class="n">mode_types</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_class_config</span><span class="o">.</span><span class="n">mode_types</span>
        <span class="n">modes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">mode</span>
            <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">all_modes</span>
            <span class="k">if</span> <span class="n">mode</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="n">mode_types</span> <span class="ow">and</span> <span class="n">mode</span><span class="o">.</span><span class="n">assign_type</span> <span class="o">==</span> <span class="s2">&quot;TRANSIT&quot;</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_used_mode_ids</span><span class="p">(</span><span class="n">modes</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fare_perception</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">60</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">value_of_time</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">headway_fraction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.5</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_journey_levels</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EmmeTransitJourneyLevelSpec</span><span class="p">:</span>
        <span class="n">modes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transit_modes</span>
        <span class="n">effective_headway_source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">effective_headway_source</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">use_fares</span><span class="p">:</span>
            <span class="n">fare_perception</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fare_perception</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_time_period</span><span class="si">}</span><span class="s2">_ALLPEN_journey_levels.ems&quot;</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_spec_dir</span><span class="p">,</span> <span class="n">file_name</span><span class="p">),</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span>
            <span class="p">)</span> <span class="k">as</span> <span class="n">jl_spec</span><span class="p">:</span>
                <span class="n">journey_levels</span> <span class="o">=</span> <span class="n">_json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">jl_spec</span><span class="p">)[</span><span class="s2">&quot;journey_levels&quot;</span><span class="p">]</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;PNR_TRN_WLK&quot;</span><span class="p">:</span>
                <span class="n">new_journey_levels</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">journey_levels</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)):</span>
                    <span class="n">jls</span> <span class="o">=</span> <span class="n">new_journey_levels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">jls</span><span class="p">[</span><span class="s2">&quot;transition_rules&quot;</span><span class="p">]:</span>
                        <span class="n">level</span><span class="p">[</span><span class="s2">&quot;next_journey_level&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">level</span><span class="p">[</span><span class="s2">&quot;next_journey_level&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="n">jls</span><span class="p">[</span><span class="s2">&quot;transition_rules&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                        <span class="p">[</span>
                            <span class="p">{</span><span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">},</span>
                            <span class="p">{</span>
                                <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;D&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                            <span class="p">},</span>
                            <span class="p">{</span><span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">},</span>
                            <span class="p">{</span>
                                <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;p&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                            <span class="p">},</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
                <span class="c1"># level 0: drive access</span>
                <span class="n">transition_rules_drive_access</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span>
                    <span class="n">journey_levels</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;transition_rules&quot;</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">transition_rules_drive_access</span><span class="p">:</span>
                    <span class="n">level</span><span class="p">[</span><span class="s2">&quot;next_journey_level&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span>
                <span class="n">transition_rules_drive_access</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;e&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="p">{</span><span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="p">{</span><span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;p&quot;</span><span class="p">,</span> <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
                    <span class="p">]</span>
                <span class="p">)</span>
                <span class="c1"># level 1: use transit</span>
                <span class="n">transition_rules_pnr</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span>
                    <span class="n">journey_levels</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;transition_rules&quot;</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">transition_rules_pnr</span><span class="p">:</span>
                    <span class="n">level</span><span class="p">[</span><span class="s2">&quot;next_journey_level&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
                <span class="n">transition_rules_pnr</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;e&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;D&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="p">{</span><span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;p&quot;</span><span class="p">,</span> <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
                    <span class="p">]</span>
                <span class="p">)</span>
                <span class="c1"># level len(new_journey_levels)+2: every mode is prohibited</span>
                <span class="n">transition_rules_prohibit</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span>
                    <span class="n">journey_levels</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;transition_rules&quot;</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">transition_rules_prohibit</span><span class="p">:</span>
                    <span class="n">level</span><span class="p">[</span><span class="s2">&quot;next_journey_level&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span>
                <span class="n">transition_rules_prohibit</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;e&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;D&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;p&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="p">},</span>
                    <span class="p">]</span>
                <span class="p">)</span>
                <span class="n">new_journey_levels</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                    <span class="mi">0</span><span class="p">,</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;drive access&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;destinations_reachable&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="s2">&quot;transition_rules&quot;</span><span class="p">:</span> <span class="n">transition_rules_drive_access</span><span class="p">,</span>
                        <span class="s2">&quot;waiting_time&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="s2">&quot;boarding_time&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="s2">&quot;boarding_cost&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="p">},</span>
                <span class="p">)</span>
                <span class="n">new_journey_levels</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                    <span class="mi">1</span><span class="p">,</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;pnr&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;destinations_reachable&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="s2">&quot;transition_rules&quot;</span><span class="p">:</span> <span class="n">transition_rules_pnr</span><span class="p">,</span>
                        <span class="s2">&quot;waiting_time&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="s2">&quot;boarding_time&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="s2">&quot;boarding_cost&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="p">},</span>
                <span class="p">)</span>
                <span class="n">new_journey_levels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;prohibit&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;destinations_reachable&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="s2">&quot;transition_rules&quot;</span><span class="p">:</span> <span class="n">transition_rules_prohibit</span><span class="p">,</span>
                        <span class="s2">&quot;waiting_time&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="s2">&quot;boarding_time&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="s2">&quot;boarding_cost&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">new_journey_levels</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">level</span><span class="p">[</span><span class="s2">&quot;waiting_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;headway_fraction&quot;</span><span class="p">:</span> <span class="s2">&quot;@hdw_fraction&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;effective_headways&quot;</span><span class="p">:</span> <span class="n">effective_headway_source</span><span class="p">,</span>
                        <span class="s2">&quot;spread_factor&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="s2">&quot;perception_factor&quot;</span><span class="p">:</span> <span class="s2">&quot;@wait_pfactor&quot;</span><span class="p">,</span>
                    <span class="p">}</span>
                    <span class="n">level</span><span class="p">[</span><span class="s2">&quot;boarding_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;on_lines&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s2">&quot;penalty&quot;</span><span class="p">:</span> <span class="s2">&quot;@xboard_penalty&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;perception_factor&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="s2">&quot;at_nodes&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s2">&quot;penalty&quot;</span><span class="p">:</span> <span class="s2">&quot;@xboard_nodepen&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;perception_factor&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="p">},</span>
                    <span class="p">}</span>
                <span class="c1"># add in the correct value of time parameter</span>
                <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">new_journey_levels</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">level</span><span class="p">[</span><span class="s2">&quot;boarding_cost&quot;</span><span class="p">]:</span>
                        <span class="n">level</span><span class="p">[</span><span class="s2">&quot;boarding_cost&quot;</span><span class="p">][</span><span class="s2">&quot;on_segments&quot;</span><span class="p">][</span>
                            <span class="s2">&quot;perception_factor&quot;</span>
                        <span class="p">]</span> <span class="o">=</span> <span class="n">fare_perception</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;WLK_TRN_PNR&quot;</span><span class="p">:</span>
                <span class="n">new_journey_levels</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">journey_levels</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)):</span>
                    <span class="n">jls</span> <span class="o">=</span> <span class="n">new_journey_levels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">jls</span><span class="p">[</span><span class="s2">&quot;destinations_reachable&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">jls</span><span class="p">[</span><span class="s2">&quot;transition_rules&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                        <span class="p">[</span>
                            <span class="p">{</span>
                                <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;D&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                            <span class="p">},</span>
                            <span class="p">{</span><span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">},</span>
                            <span class="p">{</span>
                                <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;p&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                            <span class="p">},</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
                <span class="c1"># level 0: walk access</span>
                <span class="n">transition_rules_walk_access</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span>
                    <span class="n">journey_levels</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;transition_rules&quot;</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">transition_rules_walk_access</span><span class="p">:</span>
                    <span class="n">level</span><span class="p">[</span><span class="s2">&quot;next_journey_level&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">transition_rules_walk_access</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="p">{</span><span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;D&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;p&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="p">},</span>
                    <span class="p">]</span>
                <span class="p">)</span>
                <span class="c1"># level len(new_journey_levels)+1: drive home</span>
                <span class="n">transition_rules_drive_home</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span>
                    <span class="n">journey_levels</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;transition_rules&quot;</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">transition_rules_drive_home</span><span class="p">:</span>
                    <span class="n">level</span><span class="p">[</span><span class="s2">&quot;next_journey_level&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span>
                <span class="n">transition_rules_drive_home</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;D&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;p&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="p">},</span>
                    <span class="p">]</span>
                <span class="p">)</span>
                <span class="c1"># level len(new_journey_levels)+2: every mode is prohibited</span>
                <span class="n">transition_rules_prohibit</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span>
                    <span class="n">journey_levels</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;transition_rules&quot;</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">transition_rules_prohibit</span><span class="p">:</span>
                    <span class="n">level</span><span class="p">[</span><span class="s2">&quot;next_journey_level&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span>
                <span class="n">transition_rules_prohibit</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;D&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;p&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="p">},</span>
                    <span class="p">]</span>
                <span class="p">)</span>
                <span class="n">new_journey_levels</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                    <span class="mi">0</span><span class="p">,</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;walk access&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;destinations_reachable&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                        <span class="s2">&quot;transition_rules&quot;</span><span class="p">:</span> <span class="n">transition_rules_walk_access</span><span class="p">,</span>
                        <span class="s2">&quot;waiting_time&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="s2">&quot;boarding_time&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="s2">&quot;boarding_cost&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="p">},</span>
                <span class="p">)</span>
                <span class="n">new_journey_levels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;drive home&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;destinations_reachable&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                        <span class="s2">&quot;transition_rules&quot;</span><span class="p">:</span> <span class="n">transition_rules_drive_home</span><span class="p">,</span>
                        <span class="s2">&quot;waiting_time&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="s2">&quot;boarding_time&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="s2">&quot;boarding_cost&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">)</span>
                <span class="n">new_journey_levels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;prohibit&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;destinations_reachable&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="s2">&quot;transition_rules&quot;</span><span class="p">:</span> <span class="n">transition_rules_prohibit</span><span class="p">,</span>
                        <span class="s2">&quot;waiting_time&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="s2">&quot;boarding_time&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="s2">&quot;boarding_cost&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">new_journey_levels</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">]:</span>
                    <span class="n">level</span><span class="p">[</span><span class="s2">&quot;waiting_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;headway_fraction&quot;</span><span class="p">:</span> <span class="s2">&quot;@hdw_fraction&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;effective_headways&quot;</span><span class="p">:</span> <span class="n">effective_headway_source</span><span class="p">,</span>
                        <span class="s2">&quot;spread_factor&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="s2">&quot;perception_factor&quot;</span><span class="p">:</span> <span class="s2">&quot;@wait_pfactor&quot;</span><span class="p">,</span>
                    <span class="p">}</span>
                    <span class="n">level</span><span class="p">[</span><span class="s2">&quot;boarding_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;on_lines&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s2">&quot;penalty&quot;</span><span class="p">:</span> <span class="s2">&quot;@xboard_penalty&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;perception_factor&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="s2">&quot;at_nodes&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s2">&quot;penalty&quot;</span><span class="p">:</span> <span class="s2">&quot;@xboard_nodepen&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;perception_factor&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="p">},</span>
                    <span class="p">}</span>
                <span class="c1"># add in the correct value of time parameter</span>
                <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">new_journey_levels</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">level</span><span class="p">[</span><span class="s2">&quot;boarding_cost&quot;</span><span class="p">]:</span>
                        <span class="n">level</span><span class="p">[</span><span class="s2">&quot;boarding_cost&quot;</span><span class="p">][</span><span class="s2">&quot;on_segments&quot;</span><span class="p">][</span>
                            <span class="s2">&quot;perception_factor&quot;</span>
                        <span class="p">]</span> <span class="o">=</span> <span class="n">fare_perception</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;KNR_TRN_WLK&quot;</span><span class="p">:</span>
                <span class="n">new_journey_levels</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">journey_levels</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)):</span>
                    <span class="n">jls</span> <span class="o">=</span> <span class="n">new_journey_levels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">jls</span><span class="p">[</span><span class="s2">&quot;transition_rules&quot;</span><span class="p">]:</span>
                        <span class="n">level</span><span class="p">[</span><span class="s2">&quot;next_journey_level&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">level</span><span class="p">[</span><span class="s2">&quot;next_journey_level&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="n">jls</span><span class="p">[</span><span class="s2">&quot;transition_rules&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                        <span class="p">[</span>
                            <span class="p">{</span><span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">},</span>
                            <span class="p">{</span>
                                <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;D&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                            <span class="p">},</span>
                            <span class="p">{</span><span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">},</span>
                            <span class="p">{</span>
                                <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;k&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                            <span class="p">},</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
                <span class="c1"># level 0: drive access</span>
                <span class="n">transition_rules_drive_access</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span>
                    <span class="n">journey_levels</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;transition_rules&quot;</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">transition_rules_drive_access</span><span class="p">:</span>
                    <span class="n">level</span><span class="p">[</span><span class="s2">&quot;next_journey_level&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span>
                <span class="n">transition_rules_drive_access</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;e&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="p">{</span><span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="p">{</span><span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
                    <span class="p">]</span>
                <span class="p">)</span>
                <span class="c1"># level 1: use transit</span>
                <span class="n">transition_rules_knr</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span>
                    <span class="n">journey_levels</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;transition_rules&quot;</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">transition_rules_knr</span><span class="p">:</span>
                    <span class="n">level</span><span class="p">[</span><span class="s2">&quot;next_journey_level&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
                <span class="n">transition_rules_knr</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;e&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;D&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="p">{</span><span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
                    <span class="p">]</span>
                <span class="p">)</span>
                <span class="c1"># level len(new_journey_levels)+2: every mode is prohibited</span>
                <span class="n">transition_rules_prohibit</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span>
                    <span class="n">journey_levels</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;transition_rules&quot;</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">transition_rules_prohibit</span><span class="p">:</span>
                    <span class="n">level</span><span class="p">[</span><span class="s2">&quot;next_journey_level&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span>
                <span class="n">transition_rules_prohibit</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;e&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;D&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;k&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="p">},</span>
                    <span class="p">]</span>
                <span class="p">)</span>
                <span class="n">new_journey_levels</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                    <span class="mi">0</span><span class="p">,</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;drive access&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;destinations_reachable&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="s2">&quot;transition_rules&quot;</span><span class="p">:</span> <span class="n">transition_rules_drive_access</span><span class="p">,</span>
                        <span class="s2">&quot;waiting_time&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="s2">&quot;boarding_time&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="s2">&quot;boarding_cost&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="p">},</span>
                <span class="p">)</span>
                <span class="n">new_journey_levels</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                    <span class="mi">1</span><span class="p">,</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;knr&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;destinations_reachable&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="s2">&quot;transition_rules&quot;</span><span class="p">:</span> <span class="n">transition_rules_knr</span><span class="p">,</span>
                        <span class="s2">&quot;waiting_time&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="s2">&quot;boarding_time&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="s2">&quot;boarding_cost&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="p">},</span>
                <span class="p">)</span>
                <span class="n">new_journey_levels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;prohibit&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;destinations_reachable&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="s2">&quot;transition_rules&quot;</span><span class="p">:</span> <span class="n">transition_rules_prohibit</span><span class="p">,</span>
                        <span class="s2">&quot;waiting_time&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="s2">&quot;boarding_time&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="s2">&quot;boarding_cost&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">new_journey_levels</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">level</span><span class="p">[</span><span class="s2">&quot;waiting_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;headway_fraction&quot;</span><span class="p">:</span> <span class="s2">&quot;@hdw_fraction&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;effective_headways&quot;</span><span class="p">:</span> <span class="n">effective_headway_source</span><span class="p">,</span>
                        <span class="s2">&quot;spread_factor&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="s2">&quot;perception_factor&quot;</span><span class="p">:</span> <span class="s2">&quot;@wait_pfactor&quot;</span><span class="p">,</span>
                    <span class="p">}</span>
                    <span class="n">level</span><span class="p">[</span><span class="s2">&quot;boarding_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;on_lines&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s2">&quot;penalty&quot;</span><span class="p">:</span> <span class="s2">&quot;@xboard_penalty&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;perception_factor&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="s2">&quot;at_nodes&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s2">&quot;penalty&quot;</span><span class="p">:</span> <span class="s2">&quot;@xboard_nodepen&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;perception_factor&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="p">},</span>
                    <span class="p">}</span>
                <span class="c1"># add in the correct value of time parameter</span>
                <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">new_journey_levels</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">level</span><span class="p">[</span><span class="s2">&quot;boarding_cost&quot;</span><span class="p">]:</span>
                        <span class="n">level</span><span class="p">[</span><span class="s2">&quot;boarding_cost&quot;</span><span class="p">][</span><span class="s2">&quot;on_segments&quot;</span><span class="p">][</span>
                            <span class="s2">&quot;perception_factor&quot;</span>
                        <span class="p">]</span> <span class="o">=</span> <span class="n">fare_perception</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;WLK_TRN_KNR&quot;</span><span class="p">:</span>
                <span class="n">new_journey_levels</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">journey_levels</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)):</span>
                    <span class="n">jls</span> <span class="o">=</span> <span class="n">new_journey_levels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">jls</span><span class="p">[</span><span class="s2">&quot;destinations_reachable&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">jls</span><span class="p">[</span><span class="s2">&quot;transition_rules&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                        <span class="p">[</span>
                            <span class="p">{</span>
                                <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;D&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                            <span class="p">},</span>
                            <span class="p">{</span><span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">},</span>
                            <span class="p">{</span>
                                <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;k&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                            <span class="p">},</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
                <span class="c1"># level 0: walk access</span>
                <span class="n">transition_rules_walk_access</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span>
                    <span class="n">journey_levels</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;transition_rules&quot;</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">transition_rules_walk_access</span><span class="p">:</span>
                    <span class="n">level</span><span class="p">[</span><span class="s2">&quot;next_journey_level&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">transition_rules_walk_access</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="p">{</span><span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;D&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;k&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="p">},</span>
                    <span class="p">]</span>
                <span class="p">)</span>
                <span class="c1"># level len(new_journey_levels)+1: drive home</span>
                <span class="n">transition_rules_drive_home</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span>
                    <span class="n">journey_levels</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;transition_rules&quot;</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">transition_rules_drive_home</span><span class="p">:</span>
                    <span class="n">level</span><span class="p">[</span><span class="s2">&quot;next_journey_level&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span>
                <span class="n">transition_rules_drive_home</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;D&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;k&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="p">},</span>
                    <span class="p">]</span>
                <span class="p">)</span>
                <span class="c1"># level len(new_journey_levels)+2: every mode is prohibited</span>
                <span class="n">transition_rules_prohibit</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span>
                    <span class="n">journey_levels</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;transition_rules&quot;</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">transition_rules_prohibit</span><span class="p">:</span>
                    <span class="n">level</span><span class="p">[</span><span class="s2">&quot;next_journey_level&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span>
                <span class="n">transition_rules_prohibit</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;D&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;k&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="p">},</span>
                    <span class="p">]</span>
                <span class="p">)</span>
                <span class="n">new_journey_levels</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                    <span class="mi">0</span><span class="p">,</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;walk access&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;destinations_reachable&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                        <span class="s2">&quot;transition_rules&quot;</span><span class="p">:</span> <span class="n">transition_rules_walk_access</span><span class="p">,</span>
                        <span class="s2">&quot;waiting_time&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="s2">&quot;boarding_time&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="s2">&quot;boarding_cost&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="p">},</span>
                <span class="p">)</span>
                <span class="n">new_journey_levels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;drive home&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;destinations_reachable&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                        <span class="s2">&quot;transition_rules&quot;</span><span class="p">:</span> <span class="n">transition_rules_drive_home</span><span class="p">,</span>
                        <span class="s2">&quot;waiting_time&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="s2">&quot;boarding_time&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="s2">&quot;boarding_cost&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">)</span>
                <span class="n">new_journey_levels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;prohibit&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;destinations_reachable&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="s2">&quot;transition_rules&quot;</span><span class="p">:</span> <span class="n">transition_rules_prohibit</span><span class="p">,</span>
                        <span class="s2">&quot;waiting_time&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="s2">&quot;boarding_time&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="s2">&quot;boarding_cost&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">new_journey_levels</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">]:</span>
                    <span class="n">level</span><span class="p">[</span><span class="s2">&quot;waiting_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;headway_fraction&quot;</span><span class="p">:</span> <span class="s2">&quot;@hdw_fraction&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;effective_headways&quot;</span><span class="p">:</span> <span class="n">effective_headway_source</span><span class="p">,</span>
                        <span class="s2">&quot;spread_factor&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="s2">&quot;perception_factor&quot;</span><span class="p">:</span> <span class="s2">&quot;@wait_pfactor&quot;</span><span class="p">,</span>
                    <span class="p">}</span>
                    <span class="n">level</span><span class="p">[</span><span class="s2">&quot;boarding_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;on_lines&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s2">&quot;penalty&quot;</span><span class="p">:</span> <span class="s2">&quot;@xboard_penalty&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;perception_factor&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="s2">&quot;at_nodes&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s2">&quot;penalty&quot;</span><span class="p">:</span> <span class="s2">&quot;@xboard_nodepen&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;perception_factor&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="p">},</span>
                    <span class="p">}</span>
                <span class="c1"># add in the correct value of time parameter</span>
                <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">new_journey_levels</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">level</span><span class="p">[</span><span class="s2">&quot;boarding_cost&quot;</span><span class="p">]:</span>
                        <span class="n">level</span><span class="p">[</span><span class="s2">&quot;boarding_cost&quot;</span><span class="p">][</span><span class="s2">&quot;on_segments&quot;</span><span class="p">][</span>
                            <span class="s2">&quot;perception_factor&quot;</span>
                        <span class="p">]</span> <span class="o">=</span> <span class="n">fare_perception</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;WLK_TRN_WLK&quot;</span><span class="p">:</span>
                <span class="n">new_journey_levels</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">journey_levels</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_journey_levels</span><span class="p">)):</span>
                    <span class="n">jls</span> <span class="o">=</span> <span class="n">new_journey_levels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">jls</span><span class="p">[</span><span class="s2">&quot;transition_rules&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                        <span class="p">[</span>
                            <span class="p">{</span><span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">},</span>
                            <span class="p">{</span><span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">},</span>
                            <span class="p">{</span>
                                <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                            <span class="p">},</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
                <span class="c1"># level 0: only allow walk access and walk auxilary</span>
                <span class="c1"># must use the trasit modes to get onto the next level,</span>
                <span class="n">transition_rules_walk</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span>
                    <span class="n">journey_levels</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;transition_rules&quot;</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">transition_rules_walk</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;e&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="p">{</span><span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
                    <span class="p">]</span>
                <span class="p">)</span>
                <span class="n">new_journey_levels</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                    <span class="mi">0</span><span class="p">,</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;base&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;destinations_reachable&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="s2">&quot;transition_rules&quot;</span><span class="p">:</span> <span class="n">transition_rules_walk</span><span class="p">,</span>
                        <span class="s2">&quot;waiting_time&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="s2">&quot;boarding_time&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="s2">&quot;boarding_cost&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="p">},</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">new_journey_levels</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                    <span class="n">level</span><span class="p">[</span><span class="s2">&quot;waiting_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;headway_fraction&quot;</span><span class="p">:</span> <span class="s2">&quot;@hdw_fraction&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;effective_headways&quot;</span><span class="p">:</span> <span class="n">effective_headway_source</span><span class="p">,</span>
                        <span class="s2">&quot;spread_factor&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="s2">&quot;perception_factor&quot;</span><span class="p">:</span> <span class="s2">&quot;@wait_pfactor&quot;</span><span class="p">,</span>
                    <span class="p">}</span>
                    <span class="n">level</span><span class="p">[</span><span class="s2">&quot;boarding_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;on_lines&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s2">&quot;penalty&quot;</span><span class="p">:</span> <span class="s2">&quot;@xboard_penalty&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;perception_factor&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="s2">&quot;at_nodes&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s2">&quot;penalty&quot;</span><span class="p">:</span> <span class="s2">&quot;@xboard_nodepen&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;perception_factor&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="p">},</span>
                    <span class="p">}</span>
                <span class="c1"># add in the correct value of time parameter</span>
                <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">new_journey_levels</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">level</span><span class="p">[</span><span class="s2">&quot;boarding_cost&quot;</span><span class="p">]:</span>
                        <span class="n">level</span><span class="p">[</span><span class="s2">&quot;boarding_cost&quot;</span><span class="p">][</span><span class="s2">&quot;on_segments&quot;</span><span class="p">][</span>
                            <span class="s2">&quot;perception_factor&quot;</span>
                        <span class="p">]</span> <span class="o">=</span> <span class="n">fare_perception</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_spec_dir</span><span class="p">,</span>
                    <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">_journey_levels.ems&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_time_period</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
                <span class="p">),</span>
                <span class="s2">&quot;w&quot;</span><span class="p">,</span>
            <span class="p">)</span> <span class="k">as</span> <span class="n">jl_spec_file</span><span class="p">:</span>
                <span class="n">spec</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;EXTENDED_TRANSIT_ASSIGNMENT&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;journey_levels&quot;</span><span class="p">:</span> <span class="n">new_journey_levels</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">_json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">jl_spec_file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_journey_levels</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;destinations_reachable&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="s2">&quot;transition_rules&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span><span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="n">m</span><span class="p">,</span> <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">modes</span>
                    <span class="p">],</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;destinations_reachable&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="s2">&quot;transition_rules&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span><span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="n">m</span><span class="p">,</span> <span class="s2">&quot;next_journey_level&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">modes</span>
                    <span class="p">],</span>
                    <span class="s2">&quot;waiting_time&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;headway_fraction&quot;</span><span class="p">:</span> <span class="s2">&quot;@hdw_fraction&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;effective_headways&quot;</span><span class="p">:</span> <span class="n">effective_headway_source</span><span class="p">,</span>
                        <span class="s2">&quot;spread_factor&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="s2">&quot;perception_factor&quot;</span><span class="p">:</span> <span class="s2">&quot;@wait_pfactor&quot;</span><span class="p">,</span>
                    <span class="p">},</span>
                <span class="p">},</span>
            <span class="p">]</span>
            <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">new_journey_levels</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">level</span><span class="p">[</span><span class="s2">&quot;boarding_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;on_lines&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;penalty&quot;</span><span class="p">:</span> <span class="s2">&quot;@xboard_penalty&quot;</span><span class="p">,</span> <span class="s2">&quot;perception_factor&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
                    <span class="s2">&quot;at_nodes&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;penalty&quot;</span><span class="p">:</span> <span class="s2">&quot;@xboard_nodepen&quot;</span><span class="p">,</span> <span class="s2">&quot;perception_factor&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
                <span class="p">}</span>

        <span class="k">return</span> <span class="n">new_journey_levels</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="tm2py.components.network.transit.transit_assign.TransitAssignmentClass.emme_transit_spec" class="doc doc-heading">
            <code class=" language-python"><span class="n">emme_transit_spec</span><span class="p">:</span> <span class="n">EmmeTransitSpec</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.components.network.transit.transit_assign.TransitAssignmentClass.emme_transit_spec" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Return Emme Extended transit assignment specification.</p>
<p>Converted from input config (transit.classes, with some parameters from
transit table), see also Emme Help for
Extended transit assignment for specification details.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tm2py.components.network.transit.transit_assign.TransitAssignmentClass.name" class="doc doc-heading">
            <code class=" language-python"><span class="n">name</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.components.network.transit.transit_assign.TransitAssignmentClass.name" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>The class name.</p>
    </div>

</div>



<div class="doc doc-object doc-function">


<h3 id="tm2py.components.network.transit.transit_assign.TransitAssignmentClass.__init__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">tclass_config</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">time_period</span><span class="p">,</span> <span class="n">iteration</span><span class="p">,</span> <span class="n">num_processors</span><span class="p">,</span> <span class="n">fare_modes</span><span class="p">,</span> <span class="n">spec_dir</span><span class="p">)</span></code>

<a href="#tm2py.components.network.transit.transit_assign.TransitAssignmentClass.__init__" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Assignment class constructor.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>tclass_config</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="TransitClassConfig (tm2py.config.TransitClassConfig)" href="#tm2py.config.TransitClassConfig">TransitClassConfig</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the transit class config (TransitClassConfig)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>config</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="TransitConfig (tm2py.config.TransitConfig)" href="#tm2py.config.TransitConfig">TransitConfig</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the root transit assignment config (TransitConfig)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>time_period</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the time period name</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>iteration</code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the current iteration</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>num_processors</code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the number of processors to use, loaded from config</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>fare_modes</code></td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Set">Set</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the mapping from the generated fare mode ID to the original
source mode ID</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>spec_dir</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>directory to find the generated journey levels tables from
the apply fares step</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/network/transit/transit_assign.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">tclass_config</span><span class="p">:</span> <span class="n">TransitClassConfig</span><span class="p">,</span>
    <span class="n">config</span><span class="p">:</span> <span class="n">TransitConfig</span><span class="p">,</span>
    <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">iteration</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">num_processors</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">fare_modes</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
    <span class="n">spec_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Assignment class constructor.</span>

<span class="sd">    Args:</span>
<span class="sd">        tclass_config: the transit class config (TransitClassConfig)</span>
<span class="sd">        config: the root transit assignment config (TransitConfig)</span>
<span class="sd">        time_period: the time period name</span>
<span class="sd">        iteration: the current iteration</span>
<span class="sd">        num_processors: the number of processors to use, loaded from config</span>
<span class="sd">        fare_modes: the mapping from the generated fare mode ID to the original</span>
<span class="sd">            source mode ID</span>
<span class="sd">        spec_dir: directory to find the generated journey levels tables from</span>
<span class="sd">            the apply fares step</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">tclass_config</span><span class="o">.</span><span class="n">name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_class_config</span> <span class="o">=</span> <span class="n">tclass_config</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_config</span> <span class="o">=</span> <span class="n">config</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_time_period</span> <span class="o">=</span> <span class="n">time_period</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_iteration</span> <span class="o">=</span> <span class="n">iteration</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_num_processors</span> <span class="o">=</span> <span class="n">num_processors</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_fare_modes</span> <span class="o">=</span> <span class="n">fare_modes</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_spec_dir</span> <span class="o">=</span> <span class="n">spec_dir</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="tm2py.components.network.transit.transit_assign.calc_adjusted_headway" class="doc doc-heading">
            <code class=" language-python"><span class="n">calc_adjusted_headway</span><span class="p">(</span><span class="n">segment</span><span class="p">,</span> <span class="n">segment_capacity</span><span class="p">)</span></code>

<a href="#tm2py.components.network.transit.transit_assign.calc_adjusted_headway" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">

      <p>Headway adjusted based on ....?</p>
<p>TODO: add documentation about source and theory behind this.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>segment</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Emme transit segment object</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>segment_capacity</code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><em>description</em></p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Adjusted headway</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/network/transit/transit_assign.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calc_adjusted_headway</span><span class="p">(</span><span class="n">segment</span><span class="p">,</span> <span class="n">segment_capacity</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Headway adjusted based on ....?</span>

<span class="sd">    TODO: add documentation about source and theory behind this.</span>

<span class="sd">    Args:</span>
<span class="sd">        segment: Emme transit segment object</span>
<span class="sd">        segment_capacity (float): _description_</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Adjusted headway</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO add to params</span>
    <span class="n">max_hdwy_growth</span> <span class="o">=</span> <span class="mf">1.5</span>
    <span class="n">max_headway</span> <span class="o">=</span> <span class="mf">999.98</span>
    <span class="c1"># QUESTION FOR INRO: what is the difference between segment[&quot;@phdwy&quot;] and line.headway?</span>
    <span class="c1"># is one the perceived headway?</span>
    <span class="n">_transit_volume</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">transit_volume</span>
    <span class="n">_transit_boardings</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">transit_boardings</span>
    <span class="n">_previous_headway</span> <span class="o">=</span> <span class="n">segment</span><span class="p">[</span><span class="s2">&quot;@phdwy&quot;</span><span class="p">]</span>
    <span class="n">_current_headway</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">headway</span>
    <span class="n">_available_capacity</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
        <span class="n">segment_capacity</span> <span class="o">-</span> <span class="n">_transit_volume</span> <span class="o">+</span> <span class="n">_transit_boardings</span><span class="p">,</span> <span class="mi">0</span>
    <span class="p">)</span>

    <span class="n">adjusted_headway</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
        <span class="n">max_headway</span><span class="p">,</span>
        <span class="n">_previous_headway</span>
        <span class="o">*</span> <span class="nb">min</span><span class="p">((</span><span class="n">_transit_boardings</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">_available_capacity</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="mf">1.5</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">adjusted_headway</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">_current_headway</span><span class="p">,</span> <span class="n">adjusted_headway</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">adjusted_headway</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tm2py.components.network.transit.transit_assign.calc_extra_wait_time" class="doc doc-heading">
            <code class=" language-python"><span class="n">calc_extra_wait_time</span><span class="p">(</span><span class="n">segment</span><span class="p">,</span> <span class="n">segment_capacity</span><span class="p">,</span> <span class="n">eawt_weights</span><span class="p">,</span> <span class="n">mode_config</span><span class="p">,</span> <span class="n">use_fares</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#tm2py.components.network.transit.transit_assign.calc_extra_wait_time" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">

      <p>Calculate extra added wait time based on&hellip;</p>
<h3 id="tm2py.components.network.transit.transit_assign.calc_extra_wait_time--todo-document-fully">TODO document fully.<a class="headerlink" href="#tm2py.components.network.transit.transit_assign.calc_extra_wait_time--todo-document-fully" title="Permanent link"> </a></h3>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>segment</code></td>
            <td>
                  <code><span title="_type_">_type_</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Emme transit segment object.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>segment_capacity</code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><em>description</em></p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>eawt_weights</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>extra added wait time weights</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>mode_config</code></td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>mode character to mode config</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>use_fares</code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><em>description</em>. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>_type_</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p><em>description</em></p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/network/transit/transit_assign.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calc_extra_wait_time</span><span class="p">(</span>
    <span class="n">segment</span><span class="p">,</span>
    <span class="n">segment_capacity</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">eawt_weights</span><span class="p">,</span>
    <span class="n">mode_config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">use_fares</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate extra added wait time based on...</span>

<span class="sd">    # TODO document fully.</span>

<span class="sd">    Args:</span>
<span class="sd">        segment (_type_): Emme transit segment object.</span>
<span class="sd">        segment_capacity (float): _description_</span>
<span class="sd">        eawt_weights: extra added wait time weights</span>
<span class="sd">        mode_config: mode character to mode config</span>
<span class="sd">        use_fares (bool, optional): _description_. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        _type_: _description_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_transit_volume</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">transit_volume</span>
    <span class="n">_headway</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">headway</span> <span class="k">if</span> <span class="n">segment</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">headway</span> <span class="o">&gt;=</span> <span class="mf">0.1</span> <span class="k">else</span> <span class="mi">9999</span>
    <span class="n">_total_offs</span> <span class="o">=</span> <span class="n">calc_total_offs</span><span class="p">(</span><span class="n">segment</span><span class="o">.</span><span class="n">line</span><span class="p">)</span>
    <span class="n">_offs_thru_segment</span> <span class="o">=</span> <span class="n">calc_offs_thru_segment</span><span class="p">(</span><span class="n">segment</span><span class="p">)</span>

    <span class="c1"># TODO Document and add params to config. Have no idea what source is here.</span>
    <span class="n">eawt</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">eawt_weights</span><span class="o">.</span><span class="n">constant</span>
        <span class="o">+</span> <span class="n">eawt_weights</span><span class="o">.</span><span class="n">weight_inverse_headway</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">_headway</span><span class="p">)</span>
        <span class="o">+</span> <span class="n">eawt_weights</span><span class="o">.</span><span class="n">vcr</span> <span class="o">*</span> <span class="p">(</span><span class="n">_transit_volume</span> <span class="o">/</span> <span class="n">segment_capacity</span><span class="p">)</span>
        <span class="o">+</span> <span class="n">eawt_weights</span><span class="o">.</span><span class="n">exit_proportion</span> <span class="o">*</span> <span class="p">(</span><span class="n">_offs_thru_segment</span> <span class="o">/</span> <span class="n">_total_offs</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">use_fares</span><span class="p">:</span>
        <span class="n">eawt_factor</span> <span class="o">=</span> <span class="p">(</span>
            <span class="mi">1</span>
            <span class="k">if</span> <span class="n">segment</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s2">&quot;#src_mode&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span>
            <span class="k">else</span> <span class="n">mode_config</span><span class="p">[</span><span class="n">segment</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="s2">&quot;#src_mode&quot;</span><span class="p">]][</span><span class="s2">&quot;eawt_factor&quot;</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">eawt_factor</span> <span class="o">=</span> <span class="p">(</span>
            <span class="mi">1</span>
            <span class="k">if</span> <span class="n">segment</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span>
            <span class="k">else</span> <span class="n">mode_config</span><span class="p">[</span><span class="n">segment</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">id</span><span class="p">][</span><span class="s2">&quot;eawt_factor&quot;</span><span class="p">]</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">eawt</span> <span class="o">*</span> <span class="n">eawt_factor</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tm2py.components.network.transit.transit_assign.calc_offs_thru_segment" class="doc doc-heading">
            <code class=" language-python"><span class="n">calc_offs_thru_segment</span><span class="p">(</span><span class="n">segment</span><span class="p">)</span></code>

<a href="#tm2py.components.network.transit.transit_assign.calc_offs_thru_segment" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">

      <p><em>summary</em></p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>segment</code></td>
            <td>
                  <code><span title="_type_">_type_</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><em>description</em></p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><em>description</em></p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/network/transit/transit_assign.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calc_offs_thru_segment</span><span class="p">(</span><span class="n">segment</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;_summary_</span>

<span class="sd">    Args:</span>
<span class="sd">        segment (_type_): _description_</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: _description_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># SIJIA TODO check that it should be [:segment.number+1] . Not sure if 0-indexed in emme or 1-indexed?</span>
    <span class="n">segments_thru_this_segment</span> <span class="o">=</span> <span class="p">[</span><span class="n">seg</span> <span class="k">for</span> <span class="n">seg</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="n">segment</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">segments</span><span class="p">(</span><span class="kc">True</span><span class="p">))][</span>
        <span class="p">:</span> <span class="n">segment</span><span class="o">.</span><span class="n">number</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="p">]</span>
    <span class="n">offs_thru_this_seg</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">prev_seg</span><span class="o">.</span><span class="n">transit_volume</span> <span class="o">-</span> <span class="n">this_seg</span><span class="o">.</span><span class="n">transit_volume</span> <span class="o">+</span> <span class="n">this_seg</span><span class="o">.</span><span class="n">transit_boardings</span>
        <span class="k">for</span> <span class="n">prev_seg</span><span class="p">,</span> <span class="n">this_seg</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
            <span class="n">segments_thru_this_segment</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">segments_thru_this_segment</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="p">)</span>
    <span class="p">]</span>
    <span class="n">total_offs_thru_this_seg</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">offs_thru_this_seg</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">total_offs_thru_this_seg</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tm2py.components.network.transit.transit_assign.calc_total_offs" class="doc doc-heading">
            <code class=" language-python"><span class="n">calc_total_offs</span><span class="p">(</span><span class="n">line</span><span class="p">)</span></code>

<a href="#tm2py.components.network.transit.transit_assign.calc_total_offs" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">

      <p>Calculate total alightings for a line.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>line</code></td>
            <td>
                  <code><span title="_type_">_type_</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><em>description</em></p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/network/transit/transit_assign.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calc_total_offs</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate total alightings for a line.</span>

<span class="sd">    Args:</span>
<span class="sd">        line (_type_): _description_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># NOTE This was done previously using:</span>
    <span class="c1"># total_offs += prev_seg.transit_volume - seg.transit_volume + seg.transit_boardings</span>
    <span class="c1"># but offs should equal ons for a whole line, so this seems simpler</span>
    <span class="n">offs</span> <span class="o">=</span> <span class="p">[</span><span class="n">seg</span><span class="o">.</span><span class="n">transit_boardings</span> <span class="k">for</span> <span class="n">seg</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">segments</span><span class="p">(</span><span class="kc">True</span><span class="p">)]</span>
    <span class="n">total_offs</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">offs</span><span class="p">)</span>
    <span class="c1"># added lambda due to divide by zero error</span>
    <span class="k">return</span> <span class="n">total_offs</span> <span class="k">if</span> <span class="n">total_offs</span> <span class="o">&gt;=</span> <span class="mf">0.001</span> <span class="k">else</span> <span class="mi">9999</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tm2py.components.network.transit.transit_assign.func_returns_calc_updated_perceived_headway" class="doc doc-heading">
            <code class=" language-python"><span class="n">func_returns_calc_updated_perceived_headway</span><span class="p">(</span><span class="n">time_period_duration</span><span class="p">,</span> <span class="n">eawt_weights</span><span class="p">,</span> <span class="n">mode_config</span><span class="p">,</span> <span class="n">use_fares</span><span class="p">)</span></code>

<a href="#tm2py.components.network.transit.transit_assign.func_returns_calc_updated_perceived_headway" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">

      <p>function that returns the calc_headway function for emme assignment, with partial preloaded parameters
acts like partial as emme does not take partial</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/network/transit/transit_assign.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">func_returns_calc_updated_perceived_headway</span><span class="p">(</span>
    <span class="n">time_period_duration</span><span class="p">,</span> <span class="n">eawt_weights</span><span class="p">,</span> <span class="n">mode_config</span><span class="p">,</span> <span class="n">use_fares</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    function that returns the calc_headway function for emme assignment, with partial preloaded parameters</span>
<span class="sd">    acts like partial as emme does not take partial</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">calc_headway</span><span class="p">(</span><span class="n">transit_volume</span><span class="p">,</span> <span class="n">transit_boardings</span><span class="p">,</span> <span class="n">headway</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="n">segment</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate perceived (???) headway updated by ... and extra added wait time.</span>

<span class="sd">        # TODO Document more fully.</span>

<span class="sd">        Args:</span>
<span class="sd">            time_period_duration(float): time period duration in minutes</span>
<span class="sd">            segment: Emme Transit segment object</span>
<span class="sd">            eawt_weights:</span>
<span class="sd">            mode_config:</span>
<span class="sd">            use_fares (bool): if true, will use fares</span>

<span class="sd">        Returns:</span>
<span class="sd">            _type_: _description_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># QUESTION FOR INRO: Kevin separately put segment.line.headway and headway as an arg.</span>
        <span class="c1"># Would they be different? Why?</span>
        <span class="c1"># TODO: Either can we label the headways so it is clear what is diff about them or just use single value?</span>

        <span class="kn">from</span> <span class="nn">tm2py.config</span> <span class="kn">import</span> <span class="p">(</span>
            <span class="n">CcrWeightsConfig</span><span class="p">,</span>
            <span class="n">EawtWeightsConfig</span><span class="p">,</span>
            <span class="n">TransitClassConfig</span><span class="p">,</span>
            <span class="n">TransitConfig</span><span class="p">,</span>
            <span class="n">TransitModeConfig</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">_segment_capacity</span> <span class="o">=</span> <span class="n">capacity</span>

        <span class="n">vcr</span> <span class="o">=</span> <span class="n">transit_volume</span> <span class="o">/</span> <span class="n">_segment_capacity</span>

        <span class="n">_extra_added_wait_time</span> <span class="o">=</span> <span class="n">calc_extra_wait_time</span><span class="p">(</span>
            <span class="n">segment</span><span class="p">,</span>
            <span class="n">_segment_capacity</span><span class="p">,</span>
            <span class="p">{</span><span class="n">eawt_weights</span><span class="p">},</span>
            <span class="p">{</span><span class="n">mode_config</span><span class="p">},</span>
            <span class="p">{</span><span class="n">use_fares</span><span class="p">},</span>
        <span class="p">)</span>

        <span class="n">_adjusted_headway</span> <span class="o">=</span> <span class="n">calc_adjusted_headway</span><span class="p">(</span>
            <span class="n">segment</span><span class="p">,</span>
            <span class="n">_segment_capacity</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">_adjusted_headway</span> <span class="o">+</span> <span class="n">_extra_added_wait_time</span>

    <span class="k">return</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="n">calc_headway</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">time_period_duration</span><span class="o">=</span><span class="n">time_period_duration</span><span class="p">,</span>
        <span class="n">eawt_weights</span><span class="o">=</span><span class="n">eawt_weights</span><span class="p">,</span>
        <span class="n">mode_config</span><span class="o">=</span><span class="n">mode_config</span><span class="p">,</span>
        <span class="n">use_fares</span><span class="o">=</span><span class="n">use_fares</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tm2py.components.network.transit.transit_assign.func_returns_crowded_segment_cost" class="doc doc-heading">
            <code class=" language-python"><span class="n">func_returns_crowded_segment_cost</span><span class="p">(</span><span class="n">time_period_duration</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span></code>

<a href="#tm2py.components.network.transit.transit_assign.func_returns_crowded_segment_cost" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">

      <p>function that returns the calc_segment_cost function for emme assignment, with partial preloaded parameters
acts like partial as emme does not take partial</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/network/transit/transit_assign.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">func_returns_crowded_segment_cost</span><span class="p">(</span><span class="n">time_period_duration</span><span class="p">,</span> <span class="n">weights</span><span class="p">:</span> <span class="n">CcrWeightsConfig</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    function that returns the calc_segment_cost function for emme assignment, with partial preloaded parameters</span>
<span class="sd">    acts like partial as emme does not take partial</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">calc_segment_cost</span><span class="p">(</span><span class="n">transit_volume</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="n">segment</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates crowding factor for a segment.</span>

<span class="sd">        Toronto implementation limited factor between 1.0 and 10.0.</span>
<span class="sd">        For use with Emme Capacitated assignment normalize by subtracting 1</span>

<span class="sd">        Args:</span>
<span class="sd">            time_period_duration(float): time period duration in minutes</span>
<span class="sd">            weights (_type_): transit capacity weights</span>
<span class="sd">            segment_pax (float): transit passengers for the segment for the time period</span>
<span class="sd">            segment: emme line segment</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: crowding factor for a segment</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">tm2py.config</span> <span class="kn">import</span> <span class="p">(</span>
            <span class="n">CcrWeightsConfig</span><span class="p">,</span>
            <span class="n">EawtWeightsConfig</span><span class="p">,</span>
            <span class="n">TransitClassConfig</span><span class="p">,</span>
            <span class="n">TransitConfig</span><span class="p">,</span>
            <span class="n">TransitModeConfig</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">transit_volume</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span>

        <span class="n">line</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">line</span>

        <span class="n">seated_capacity</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">line</span><span class="o">.</span><span class="n">vehicle</span><span class="o">.</span><span class="n">seated_capacity</span> <span class="o">*</span> <span class="p">{</span><span class="n">time_period_duration</span><span class="p">}</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">/</span> <span class="n">line</span><span class="o">.</span><span class="n">headway</span>
        <span class="p">)</span>

        <span class="n">seated_pax</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">transit_volume</span><span class="p">,</span> <span class="n">seated_capacity</span><span class="p">)</span>
        <span class="n">standing_pax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">transit_volume</span> <span class="o">-</span> <span class="n">seated_pax</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">seated_cost</span> <span class="o">=</span> <span class="p">{</span><span class="n">weights</span><span class="p">}</span><span class="o">.</span><span class="n">min_seat</span> <span class="o">+</span> <span class="p">({</span><span class="n">weights</span><span class="p">}</span><span class="o">.</span><span class="n">max_seat</span> <span class="o">-</span> <span class="p">{</span><span class="n">weights</span><span class="p">}</span><span class="o">.</span><span class="n">min_seat</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">transit_volume</span> <span class="o">/</span> <span class="n">capacity</span>
        <span class="p">)</span> <span class="o">**</span> <span class="p">{</span><span class="n">weights</span><span class="p">}</span><span class="o">.</span><span class="n">power_seat</span>

        <span class="n">standing_cost</span> <span class="o">=</span> <span class="p">{</span><span class="n">weights</span><span class="p">}</span><span class="o">.</span><span class="n">min_stand</span> <span class="o">+</span> <span class="p">(</span>
            <span class="p">{</span><span class="n">weights</span><span class="p">}</span><span class="o">.</span><span class="n">max_stand</span> <span class="o">-</span> <span class="p">{</span><span class="n">weights</span><span class="p">}</span><span class="o">.</span><span class="n">min_stand</span>
        <span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">transit_volume</span> <span class="o">/</span> <span class="n">capacity</span><span class="p">)</span> <span class="o">**</span> <span class="p">{</span><span class="n">weights</span><span class="p">}</span><span class="o">.</span><span class="n">power_stand</span>

        <span class="n">crowded_cost</span> <span class="o">=</span> <span class="p">(</span><span class="n">seated_cost</span> <span class="o">*</span> <span class="n">seated_pax</span> <span class="o">+</span> <span class="n">standing_cost</span> <span class="o">*</span> <span class="n">standing_pax</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
            <span class="n">transit_volume</span> <span class="o">+</span> <span class="mf">0.01</span>
        <span class="p">)</span>

        <span class="n">normalized_crowded_cost</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">crowded_cost</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">normalized_crowded_cost</span>

    <span class="k">return</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="n">calc_segment_cost</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">time_period_duration</span><span class="o">=</span><span class="n">time_period_duration</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tm2py.components.network.transit.transit_assign.func_returns_segment_congestion" class="doc doc-heading">
            <code class=" language-python"><span class="n">func_returns_segment_congestion</span><span class="p">(</span><span class="n">time_period_duration</span><span class="p">,</span> <span class="n">scenario</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">use_fares</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#tm2py.components.network.transit.transit_assign.func_returns_segment_congestion" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">

      <p>function that returns the calc_segment_cost function for emme assignment, with partial preloaded parameters
acts like partial as emme does not take partial</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/network/transit/transit_assign.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">func_returns_segment_congestion</span><span class="p">(</span>
    <span class="n">time_period_duration</span><span class="p">,</span>
    <span class="n">scenario</span><span class="p">,</span>
    <span class="n">weights</span><span class="p">:</span> <span class="n">CongestedWeightsConfig</span><span class="p">,</span>
    <span class="n">use_fares</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    function that returns the calc_segment_cost function for emme assignment, with partial preloaded parameters</span>
<span class="sd">    acts like partial as emme does not take partial</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">use_fares</span><span class="p">:</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">scenario</span><span class="o">.</span><span class="n">get_attribute_values</span><span class="p">(</span><span class="s2">&quot;TRANSIT_LINE&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;#src_mode&quot;</span><span class="p">])</span>
        <span class="n">scenario</span><span class="o">.</span><span class="n">set_attribute_values</span><span class="p">(</span><span class="s2">&quot;TRANSIT_LINE&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;#src_mode&quot;</span><span class="p">],</span> <span class="n">values</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">calc_segment_cost</span><span class="p">(</span><span class="n">transit_volume</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="n">segment</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates crowding factor for a segment.</span>

<span class="sd">        Toronto implementation limited factor between 1.0 and 10.0.</span>
<span class="sd">        For use with Emme Capacitated assignment normalize by subtracting 1</span>

<span class="sd">        Args:</span>
<span class="sd">            time_period_duration(float): time period duration in minutes</span>
<span class="sd">            weights (_type_): transit capacity weights</span>
<span class="sd">            segment: emme line segment</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: crowding factor for a segment</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">tm2py.config</span> <span class="kn">import</span> <span class="p">(</span>
            <span class="n">CongestedWeightsConfig</span><span class="p">,</span>
            <span class="n">TransitClassConfig</span><span class="p">,</span>
            <span class="n">TransitConfig</span><span class="p">,</span>
            <span class="n">TransitModeConfig</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">transit_volume</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span>

        <span class="n">line</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">line</span>

        <span class="k">if</span> <span class="p">{</span><span class="n">use_fares</span><span class="p">}:</span>
            <span class="n">mode_char</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="s2">&quot;#src_mode&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mode_char</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">id</span>

        <span class="k">if</span> <span class="n">mode_char</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]:</span>
            <span class="n">congestion</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="p">((</span><span class="n">transit_volume</span> <span class="o">/</span> <span class="n">capacity</span><span class="p">)</span> <span class="o">**</span> <span class="mi">10</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">seated_capacity</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">line</span><span class="o">.</span><span class="n">vehicle</span><span class="o">.</span><span class="n">seated_capacity</span>
                <span class="o">*</span> <span class="p">{</span><span class="n">time_period_duration</span><span class="p">}</span>
                <span class="o">*</span> <span class="mi">60</span>
                <span class="o">/</span> <span class="n">line</span><span class="o">.</span><span class="n">headway</span>
            <span class="p">)</span>

            <span class="n">seated_pax</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">transit_volume</span><span class="p">,</span> <span class="n">seated_capacity</span><span class="p">)</span>
            <span class="n">standing_pax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">transit_volume</span> <span class="o">-</span> <span class="n">seated_pax</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="n">seated_cost</span> <span class="o">=</span> <span class="p">{</span><span class="n">weights</span><span class="p">}</span><span class="o">.</span><span class="n">min_seat</span> <span class="o">+</span> <span class="p">(</span>
                <span class="p">{</span><span class="n">weights</span><span class="p">}</span><span class="o">.</span><span class="n">max_seat</span> <span class="o">-</span> <span class="p">{</span><span class="n">weights</span><span class="p">}</span><span class="o">.</span><span class="n">min_seat</span>
            <span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">transit_volume</span> <span class="o">/</span> <span class="n">capacity</span><span class="p">)</span> <span class="o">**</span> <span class="p">{</span><span class="n">weights</span><span class="p">}</span><span class="o">.</span><span class="n">power_seat</span>

            <span class="n">standing_cost</span> <span class="o">=</span> <span class="p">{</span><span class="n">weights</span><span class="p">}</span><span class="o">.</span><span class="n">min_stand</span> <span class="o">+</span> <span class="p">(</span>
                <span class="p">{</span><span class="n">weights</span><span class="p">}</span><span class="o">.</span><span class="n">max_stand</span> <span class="o">-</span> <span class="p">{</span><span class="n">weights</span><span class="p">}</span><span class="o">.</span><span class="n">min_stand</span>
            <span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">transit_volume</span> <span class="o">/</span> <span class="n">capacity</span><span class="p">)</span> <span class="o">**</span> <span class="p">{</span><span class="n">weights</span><span class="p">}</span><span class="o">.</span><span class="n">power_stand</span>

            <span class="n">crowded_cost</span> <span class="o">=</span> <span class="p">(</span><span class="n">seated_cost</span> <span class="o">*</span> <span class="n">seated_pax</span> <span class="o">+</span> <span class="n">standing_cost</span> <span class="o">*</span> <span class="n">standing_pax</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
                <span class="n">transit_volume</span>
            <span class="p">)</span>

            <span class="n">congestion</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">crowded_cost</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0</span>

        <span class="k">return</span> <span class="n">congestion</span>

    <span class="k">return</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="n">calc_segment_cost</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">time_period_duration</span><span class="o">=</span><span class="n">time_period_duration</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span> <span class="n">use_fares</span><span class="o">=</span><span class="n">use_fares</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tm2py.components.network.transit.transit_assign.time_period_capacity" class="doc doc-heading">
            <code class=" language-python"><span class="n">time_period_capacity</span><span class="p">(</span><span class="n">vehicle_capacity</span><span class="p">,</span> <span class="n">headway</span><span class="p">,</span> <span class="n">time_period_duration</span><span class="p">)</span></code>

<a href="#tm2py.components.network.transit.transit_assign.time_period_capacity" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">

      <p><em>summary</em></p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>vehicle_capacity</code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Vehicle capacity per hour. For vehicles with multiple cars
(i.e. trainsets), should be the capacity of all of them that are traveling together.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>headway</code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Vehicle (or train sets) per hour.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>time_period_duration</code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>duration of the time period in minutes</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>capacity for the whole time period</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/network/transit/transit_assign.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">time_period_capacity</span><span class="p">(</span>
    <span class="n">vehicle_capacity</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">headway</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">time_period_duration</span><span class="p">:</span> <span class="nb">float</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;_summary_</span>

<span class="sd">    Args:</span>
<span class="sd">        vehicle_capacity (float): Vehicle capacity per hour. For vehicles with multiple cars</span>
<span class="sd">            (i.e. trainsets), should be the capacity of all of them that are traveling together.</span>
<span class="sd">        headway (float): Vehicle (or train sets) per hour.</span>
<span class="sd">        time_period_duration (float): duration of the time period in minutes</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: capacity for the whole time period</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">vehicle_capacity</span> <span class="o">*</span> <span class="n">time_period_duration</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">/</span> <span class="n">headway</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="tm2py.components.network.transit.transit_skim"></a>
    <div class="doc doc-contents first">

      <p>Transit skims module.</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="tm2py.components.network.transit.transit_skim.TransitSkim" class="doc doc-heading">
            <code>TransitSkim</code>


<a href="#tm2py.components.network.transit.transit_skim.TransitSkim" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="Component (tm2py.components.component.Component)" href="#tm2py.components.component.Component">Component</a></code></p>


      <p>Transit skim calculation methods.</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/components/network/transit/transit_skim.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  27</span>
<span class="normal">  28</span>
<span class="normal">  29</span>
<span class="normal">  30</span>
<span class="normal">  31</span>
<span class="normal">  32</span>
<span class="normal">  33</span>
<span class="normal">  34</span>
<span class="normal">  35</span>
<span class="normal">  36</span>
<span class="normal">  37</span>
<span class="normal">  38</span>
<span class="normal">  39</span>
<span class="normal">  40</span>
<span class="normal">  41</span>
<span class="normal">  42</span>
<span class="normal">  43</span>
<span class="normal">  44</span>
<span class="normal">  45</span>
<span class="normal">  46</span>
<span class="normal">  47</span>
<span class="normal">  48</span>
<span class="normal">  49</span>
<span class="normal">  50</span>
<span class="normal">  51</span>
<span class="normal">  52</span>
<span class="normal">  53</span>
<span class="normal">  54</span>
<span class="normal">  55</span>
<span class="normal">  56</span>
<span class="normal">  57</span>
<span class="normal">  58</span>
<span class="normal">  59</span>
<span class="normal">  60</span>
<span class="normal">  61</span>
<span class="normal">  62</span>
<span class="normal">  63</span>
<span class="normal">  64</span>
<span class="normal">  65</span>
<span class="normal">  66</span>
<span class="normal">  67</span>
<span class="normal">  68</span>
<span class="normal">  69</span>
<span class="normal">  70</span>
<span class="normal">  71</span>
<span class="normal">  72</span>
<span class="normal">  73</span>
<span class="normal">  74</span>
<span class="normal">  75</span>
<span class="normal">  76</span>
<span class="normal">  77</span>
<span class="normal">  78</span>
<span class="normal">  79</span>
<span class="normal">  80</span>
<span class="normal">  81</span>
<span class="normal">  82</span>
<span class="normal">  83</span>
<span class="normal">  84</span>
<span class="normal">  85</span>
<span class="normal">  86</span>
<span class="normal">  87</span>
<span class="normal">  88</span>
<span class="normal">  89</span>
<span class="normal">  90</span>
<span class="normal">  91</span>
<span class="normal">  92</span>
<span class="normal">  93</span>
<span class="normal">  94</span>
<span class="normal">  95</span>
<span class="normal">  96</span>
<span class="normal">  97</span>
<span class="normal">  98</span>
<span class="normal">  99</span>
<span class="normal"> 100</span>
<span class="normal"> 101</span>
<span class="normal"> 102</span>
<span class="normal"> 103</span>
<span class="normal"> 104</span>
<span class="normal"> 105</span>
<span class="normal"> 106</span>
<span class="normal"> 107</span>
<span class="normal"> 108</span>
<span class="normal"> 109</span>
<span class="normal"> 110</span>
<span class="normal"> 111</span>
<span class="normal"> 112</span>
<span class="normal"> 113</span>
<span class="normal"> 114</span>
<span class="normal"> 115</span>
<span class="normal"> 116</span>
<span class="normal"> 117</span>
<span class="normal"> 118</span>
<span class="normal"> 119</span>
<span class="normal"> 120</span>
<span class="normal"> 121</span>
<span class="normal"> 122</span>
<span class="normal"> 123</span>
<span class="normal"> 124</span>
<span class="normal"> 125</span>
<span class="normal"> 126</span>
<span class="normal"> 127</span>
<span class="normal"> 128</span>
<span class="normal"> 129</span>
<span class="normal"> 130</span>
<span class="normal"> 131</span>
<span class="normal"> 132</span>
<span class="normal"> 133</span>
<span class="normal"> 134</span>
<span class="normal"> 135</span>
<span class="normal"> 136</span>
<span class="normal"> 137</span>
<span class="normal"> 138</span>
<span class="normal"> 139</span>
<span class="normal"> 140</span>
<span class="normal"> 141</span>
<span class="normal"> 142</span>
<span class="normal"> 143</span>
<span class="normal"> 144</span>
<span class="normal"> 145</span>
<span class="normal"> 146</span>
<span class="normal"> 147</span>
<span class="normal"> 148</span>
<span class="normal"> 149</span>
<span class="normal"> 150</span>
<span class="normal"> 151</span>
<span class="normal"> 152</span>
<span class="normal"> 153</span>
<span class="normal"> 154</span>
<span class="normal"> 155</span>
<span class="normal"> 156</span>
<span class="normal"> 157</span>
<span class="normal"> 158</span>
<span class="normal"> 159</span>
<span class="normal"> 160</span>
<span class="normal"> 161</span>
<span class="normal"> 162</span>
<span class="normal"> 163</span>
<span class="normal"> 164</span>
<span class="normal"> 165</span>
<span class="normal"> 166</span>
<span class="normal"> 167</span>
<span class="normal"> 168</span>
<span class="normal"> 169</span>
<span class="normal"> 170</span>
<span class="normal"> 171</span>
<span class="normal"> 172</span>
<span class="normal"> 173</span>
<span class="normal"> 174</span>
<span class="normal"> 175</span>
<span class="normal"> 176</span>
<span class="normal"> 177</span>
<span class="normal"> 178</span>
<span class="normal"> 179</span>
<span class="normal"> 180</span>
<span class="normal"> 181</span>
<span class="normal"> 182</span>
<span class="normal"> 183</span>
<span class="normal"> 184</span>
<span class="normal"> 185</span>
<span class="normal"> 186</span>
<span class="normal"> 187</span>
<span class="normal"> 188</span>
<span class="normal"> 189</span>
<span class="normal"> 190</span>
<span class="normal"> 191</span>
<span class="normal"> 192</span>
<span class="normal"> 193</span>
<span class="normal"> 194</span>
<span class="normal"> 195</span>
<span class="normal"> 196</span>
<span class="normal"> 197</span>
<span class="normal"> 198</span>
<span class="normal"> 199</span>
<span class="normal"> 200</span>
<span class="normal"> 201</span>
<span class="normal"> 202</span>
<span class="normal"> 203</span>
<span class="normal"> 204</span>
<span class="normal"> 205</span>
<span class="normal"> 206</span>
<span class="normal"> 207</span>
<span class="normal"> 208</span>
<span class="normal"> 209</span>
<span class="normal"> 210</span>
<span class="normal"> 211</span>
<span class="normal"> 212</span>
<span class="normal"> 213</span>
<span class="normal"> 214</span>
<span class="normal"> 215</span>
<span class="normal"> 216</span>
<span class="normal"> 217</span>
<span class="normal"> 218</span>
<span class="normal"> 219</span>
<span class="normal"> 220</span>
<span class="normal"> 221</span>
<span class="normal"> 222</span>
<span class="normal"> 223</span>
<span class="normal"> 224</span>
<span class="normal"> 225</span>
<span class="normal"> 226</span>
<span class="normal"> 227</span>
<span class="normal"> 228</span>
<span class="normal"> 229</span>
<span class="normal"> 230</span>
<span class="normal"> 231</span>
<span class="normal"> 232</span>
<span class="normal"> 233</span>
<span class="normal"> 234</span>
<span class="normal"> 235</span>
<span class="normal"> 236</span>
<span class="normal"> 237</span>
<span class="normal"> 238</span>
<span class="normal"> 239</span>
<span class="normal"> 240</span>
<span class="normal"> 241</span>
<span class="normal"> 242</span>
<span class="normal"> 243</span>
<span class="normal"> 244</span>
<span class="normal"> 245</span>
<span class="normal"> 246</span>
<span class="normal"> 247</span>
<span class="normal"> 248</span>
<span class="normal"> 249</span>
<span class="normal"> 250</span>
<span class="normal"> 251</span>
<span class="normal"> 252</span>
<span class="normal"> 253</span>
<span class="normal"> 254</span>
<span class="normal"> 255</span>
<span class="normal"> 256</span>
<span class="normal"> 257</span>
<span class="normal"> 258</span>
<span class="normal"> 259</span>
<span class="normal"> 260</span>
<span class="normal"> 261</span>
<span class="normal"> 262</span>
<span class="normal"> 263</span>
<span class="normal"> 264</span>
<span class="normal"> 265</span>
<span class="normal"> 266</span>
<span class="normal"> 267</span>
<span class="normal"> 268</span>
<span class="normal"> 269</span>
<span class="normal"> 270</span>
<span class="normal"> 271</span>
<span class="normal"> 272</span>
<span class="normal"> 273</span>
<span class="normal"> 274</span>
<span class="normal"> 275</span>
<span class="normal"> 276</span>
<span class="normal"> 277</span>
<span class="normal"> 278</span>
<span class="normal"> 279</span>
<span class="normal"> 280</span>
<span class="normal"> 281</span>
<span class="normal"> 282</span>
<span class="normal"> 283</span>
<span class="normal"> 284</span>
<span class="normal"> 285</span>
<span class="normal"> 286</span>
<span class="normal"> 287</span>
<span class="normal"> 288</span>
<span class="normal"> 289</span>
<span class="normal"> 290</span>
<span class="normal"> 291</span>
<span class="normal"> 292</span>
<span class="normal"> 293</span>
<span class="normal"> 294</span>
<span class="normal"> 295</span>
<span class="normal"> 296</span>
<span class="normal"> 297</span>
<span class="normal"> 298</span>
<span class="normal"> 299</span>
<span class="normal"> 300</span>
<span class="normal"> 301</span>
<span class="normal"> 302</span>
<span class="normal"> 303</span>
<span class="normal"> 304</span>
<span class="normal"> 305</span>
<span class="normal"> 306</span>
<span class="normal"> 307</span>
<span class="normal"> 308</span>
<span class="normal"> 309</span>
<span class="normal"> 310</span>
<span class="normal"> 311</span>
<span class="normal"> 312</span>
<span class="normal"> 313</span>
<span class="normal"> 314</span>
<span class="normal"> 315</span>
<span class="normal"> 316</span>
<span class="normal"> 317</span>
<span class="normal"> 318</span>
<span class="normal"> 319</span>
<span class="normal"> 320</span>
<span class="normal"> 321</span>
<span class="normal"> 322</span>
<span class="normal"> 323</span>
<span class="normal"> 324</span>
<span class="normal"> 325</span>
<span class="normal"> 326</span>
<span class="normal"> 327</span>
<span class="normal"> 328</span>
<span class="normal"> 329</span>
<span class="normal"> 330</span>
<span class="normal"> 331</span>
<span class="normal"> 332</span>
<span class="normal"> 333</span>
<span class="normal"> 334</span>
<span class="normal"> 335</span>
<span class="normal"> 336</span>
<span class="normal"> 337</span>
<span class="normal"> 338</span>
<span class="normal"> 339</span>
<span class="normal"> 340</span>
<span class="normal"> 341</span>
<span class="normal"> 342</span>
<span class="normal"> 343</span>
<span class="normal"> 344</span>
<span class="normal"> 345</span>
<span class="normal"> 346</span>
<span class="normal"> 347</span>
<span class="normal"> 348</span>
<span class="normal"> 349</span>
<span class="normal"> 350</span>
<span class="normal"> 351</span>
<span class="normal"> 352</span>
<span class="normal"> 353</span>
<span class="normal"> 354</span>
<span class="normal"> 355</span>
<span class="normal"> 356</span>
<span class="normal"> 357</span>
<span class="normal"> 358</span>
<span class="normal"> 359</span>
<span class="normal"> 360</span>
<span class="normal"> 361</span>
<span class="normal"> 362</span>
<span class="normal"> 363</span>
<span class="normal"> 364</span>
<span class="normal"> 365</span>
<span class="normal"> 366</span>
<span class="normal"> 367</span>
<span class="normal"> 368</span>
<span class="normal"> 369</span>
<span class="normal"> 370</span>
<span class="normal"> 371</span>
<span class="normal"> 372</span>
<span class="normal"> 373</span>
<span class="normal"> 374</span>
<span class="normal"> 375</span>
<span class="normal"> 376</span>
<span class="normal"> 377</span>
<span class="normal"> 378</span>
<span class="normal"> 379</span>
<span class="normal"> 380</span>
<span class="normal"> 381</span>
<span class="normal"> 382</span>
<span class="normal"> 383</span>
<span class="normal"> 384</span>
<span class="normal"> 385</span>
<span class="normal"> 386</span>
<span class="normal"> 387</span>
<span class="normal"> 388</span>
<span class="normal"> 389</span>
<span class="normal"> 390</span>
<span class="normal"> 391</span>
<span class="normal"> 392</span>
<span class="normal"> 393</span>
<span class="normal"> 394</span>
<span class="normal"> 395</span>
<span class="normal"> 396</span>
<span class="normal"> 397</span>
<span class="normal"> 398</span>
<span class="normal"> 399</span>
<span class="normal"> 400</span>
<span class="normal"> 401</span>
<span class="normal"> 402</span>
<span class="normal"> 403</span>
<span class="normal"> 404</span>
<span class="normal"> 405</span>
<span class="normal"> 406</span>
<span class="normal"> 407</span>
<span class="normal"> 408</span>
<span class="normal"> 409</span>
<span class="normal"> 410</span>
<span class="normal"> 411</span>
<span class="normal"> 412</span>
<span class="normal"> 413</span>
<span class="normal"> 414</span>
<span class="normal"> 415</span>
<span class="normal"> 416</span>
<span class="normal"> 417</span>
<span class="normal"> 418</span>
<span class="normal"> 419</span>
<span class="normal"> 420</span>
<span class="normal"> 421</span>
<span class="normal"> 422</span>
<span class="normal"> 423</span>
<span class="normal"> 424</span>
<span class="normal"> 425</span>
<span class="normal"> 426</span>
<span class="normal"> 427</span>
<span class="normal"> 428</span>
<span class="normal"> 429</span>
<span class="normal"> 430</span>
<span class="normal"> 431</span>
<span class="normal"> 432</span>
<span class="normal"> 433</span>
<span class="normal"> 434</span>
<span class="normal"> 435</span>
<span class="normal"> 436</span>
<span class="normal"> 437</span>
<span class="normal"> 438</span>
<span class="normal"> 439</span>
<span class="normal"> 440</span>
<span class="normal"> 441</span>
<span class="normal"> 442</span>
<span class="normal"> 443</span>
<span class="normal"> 444</span>
<span class="normal"> 445</span>
<span class="normal"> 446</span>
<span class="normal"> 447</span>
<span class="normal"> 448</span>
<span class="normal"> 449</span>
<span class="normal"> 450</span>
<span class="normal"> 451</span>
<span class="normal"> 452</span>
<span class="normal"> 453</span>
<span class="normal"> 454</span>
<span class="normal"> 455</span>
<span class="normal"> 456</span>
<span class="normal"> 457</span>
<span class="normal"> 458</span>
<span class="normal"> 459</span>
<span class="normal"> 460</span>
<span class="normal"> 461</span>
<span class="normal"> 462</span>
<span class="normal"> 463</span>
<span class="normal"> 464</span>
<span class="normal"> 465</span>
<span class="normal"> 466</span>
<span class="normal"> 467</span>
<span class="normal"> 468</span>
<span class="normal"> 469</span>
<span class="normal"> 470</span>
<span class="normal"> 471</span>
<span class="normal"> 472</span>
<span class="normal"> 473</span>
<span class="normal"> 474</span>
<span class="normal"> 475</span>
<span class="normal"> 476</span>
<span class="normal"> 477</span>
<span class="normal"> 478</span>
<span class="normal"> 479</span>
<span class="normal"> 480</span>
<span class="normal"> 481</span>
<span class="normal"> 482</span>
<span class="normal"> 483</span>
<span class="normal"> 484</span>
<span class="normal"> 485</span>
<span class="normal"> 486</span>
<span class="normal"> 487</span>
<span class="normal"> 488</span>
<span class="normal"> 489</span>
<span class="normal"> 490</span>
<span class="normal"> 491</span>
<span class="normal"> 492</span>
<span class="normal"> 493</span>
<span class="normal"> 494</span>
<span class="normal"> 495</span>
<span class="normal"> 496</span>
<span class="normal"> 497</span>
<span class="normal"> 498</span>
<span class="normal"> 499</span>
<span class="normal"> 500</span>
<span class="normal"> 501</span>
<span class="normal"> 502</span>
<span class="normal"> 503</span>
<span class="normal"> 504</span>
<span class="normal"> 505</span>
<span class="normal"> 506</span>
<span class="normal"> 507</span>
<span class="normal"> 508</span>
<span class="normal"> 509</span>
<span class="normal"> 510</span>
<span class="normal"> 511</span>
<span class="normal"> 512</span>
<span class="normal"> 513</span>
<span class="normal"> 514</span>
<span class="normal"> 515</span>
<span class="normal"> 516</span>
<span class="normal"> 517</span>
<span class="normal"> 518</span>
<span class="normal"> 519</span>
<span class="normal"> 520</span>
<span class="normal"> 521</span>
<span class="normal"> 522</span>
<span class="normal"> 523</span>
<span class="normal"> 524</span>
<span class="normal"> 525</span>
<span class="normal"> 526</span>
<span class="normal"> 527</span>
<span class="normal"> 528</span>
<span class="normal"> 529</span>
<span class="normal"> 530</span>
<span class="normal"> 531</span>
<span class="normal"> 532</span>
<span class="normal"> 533</span>
<span class="normal"> 534</span>
<span class="normal"> 535</span>
<span class="normal"> 536</span>
<span class="normal"> 537</span>
<span class="normal"> 538</span>
<span class="normal"> 539</span>
<span class="normal"> 540</span>
<span class="normal"> 541</span>
<span class="normal"> 542</span>
<span class="normal"> 543</span>
<span class="normal"> 544</span>
<span class="normal"> 545</span>
<span class="normal"> 546</span>
<span class="normal"> 547</span>
<span class="normal"> 548</span>
<span class="normal"> 549</span>
<span class="normal"> 550</span>
<span class="normal"> 551</span>
<span class="normal"> 552</span>
<span class="normal"> 553</span>
<span class="normal"> 554</span>
<span class="normal"> 555</span>
<span class="normal"> 556</span>
<span class="normal"> 557</span>
<span class="normal"> 558</span>
<span class="normal"> 559</span>
<span class="normal"> 560</span>
<span class="normal"> 561</span>
<span class="normal"> 562</span>
<span class="normal"> 563</span>
<span class="normal"> 564</span>
<span class="normal"> 565</span>
<span class="normal"> 566</span>
<span class="normal"> 567</span>
<span class="normal"> 568</span>
<span class="normal"> 569</span>
<span class="normal"> 570</span>
<span class="normal"> 571</span>
<span class="normal"> 572</span>
<span class="normal"> 573</span>
<span class="normal"> 574</span>
<span class="normal"> 575</span>
<span class="normal"> 576</span>
<span class="normal"> 577</span>
<span class="normal"> 578</span>
<span class="normal"> 579</span>
<span class="normal"> 580</span>
<span class="normal"> 581</span>
<span class="normal"> 582</span>
<span class="normal"> 583</span>
<span class="normal"> 584</span>
<span class="normal"> 585</span>
<span class="normal"> 586</span>
<span class="normal"> 587</span>
<span class="normal"> 588</span>
<span class="normal"> 589</span>
<span class="normal"> 590</span>
<span class="normal"> 591</span>
<span class="normal"> 592</span>
<span class="normal"> 593</span>
<span class="normal"> 594</span>
<span class="normal"> 595</span>
<span class="normal"> 596</span>
<span class="normal"> 597</span>
<span class="normal"> 598</span>
<span class="normal"> 599</span>
<span class="normal"> 600</span>
<span class="normal"> 601</span>
<span class="normal"> 602</span>
<span class="normal"> 603</span>
<span class="normal"> 604</span>
<span class="normal"> 605</span>
<span class="normal"> 606</span>
<span class="normal"> 607</span>
<span class="normal"> 608</span>
<span class="normal"> 609</span>
<span class="normal"> 610</span>
<span class="normal"> 611</span>
<span class="normal"> 612</span>
<span class="normal"> 613</span>
<span class="normal"> 614</span>
<span class="normal"> 615</span>
<span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TransitSkim</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Transit skim calculation methods.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="s2">&quot;RunController&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor for TransitSkim class.</span>

<span class="sd">        Args:</span>
<span class="sd">            controller: The RunController instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">transit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_num_processors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">num_processors_transit_skim</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_networks</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scenarios</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_skim_properties</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_skim_matrices</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">k</span><span class="p">:</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">skim_properties</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_skim_outputs</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate inputs.&quot;&quot;&quot;</span>
        <span class="c1"># TODO add input validation</span>
        <span class="k">pass</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">emmebank</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">transit_emmebank</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">scenarios</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scenarios</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scenarios</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">tp</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">emmebank</span><span class="o">.</span><span class="n">scenario</span><span class="p">(</span><span class="n">tp</span><span class="p">)</span> <span class="k">for</span> <span class="n">tp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span>
            <span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scenarios</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">networks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_networks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_networks</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">tp</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">scenarios</span><span class="p">[</span><span class="n">tp</span><span class="p">]</span><span class="o">.</span><span class="n">get_partial_network</span><span class="p">(</span>
                    <span class="p">[</span><span class="s2">&quot;TRANSIT_SEGMENT&quot;</span><span class="p">],</span> <span class="n">include_attributes</span><span class="o">=</span><span class="kc">False</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">tp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span>
            <span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_networks</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">matrix_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">tp</span><span class="p">:</span> <span class="n">MatrixCache</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scenarios</span><span class="p">[</span><span class="n">tp</span><span class="p">])</span> <span class="k">for</span> <span class="n">tp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span>
            <span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span>

    <span class="nd">@LogStartEnd</span><span class="p">(</span><span class="s2">&quot;Transit skims&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run transit skims.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emmebank_skim_matrices</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">skim_properties</span>
        <span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log_start_end</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;period transit skims&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">_time_period</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">:</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">logbook_trace</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Transit skims for period </span><span class="si">{</span><span class="n">_time_period</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">):</span>
                    <span class="k">for</span> <span class="n">_transit_class</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">run_skim_set</span><span class="p">(</span><span class="n">_time_period</span><span class="p">,</span> <span class="n">_transit_class</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_export_skims</span><span class="p">(</span><span class="n">_time_period</span><span class="p">,</span> <span class="n">_transit_class</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug_enabled</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_log_debug_report</span><span class="p">(</span><span class="n">_time_period</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">skim_matrices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skim_matrices</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">skim_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List of Skim Property named tuples: name, description.</span>

<span class="sd">        TODO put these in config.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skim_properties</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>

            <span class="c1"># TODO config</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_skim_properties</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">_basic_skims</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;IWAIT&quot;</span><span class="p">,</span> <span class="s2">&quot;first wait time&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;XWAIT&quot;</span><span class="p">,</span> <span class="s2">&quot;transfer wait time&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;WAIT&quot;</span><span class="p">,</span> <span class="s2">&quot;total wait time&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;FARE&quot;</span><span class="p">,</span> <span class="s2">&quot;fare&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;BOARDS&quot;</span><span class="p">,</span> <span class="s2">&quot;num boardings&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;WAUX&quot;</span><span class="p">,</span> <span class="s2">&quot;auxiliary walk time&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;DTIME&quot;</span><span class="p">,</span> <span class="s2">&quot;access and egress drive time&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;DDIST&quot;</span><span class="p">,</span> <span class="s2">&quot;access and egress drive distance&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;WACC&quot;</span><span class="p">,</span> <span class="s2">&quot;access walk time&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;WEGR&quot;</span><span class="p">,</span> <span class="s2">&quot;egress walk time&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;IVT&quot;</span><span class="p">,</span> <span class="s2">&quot;total in-vehicle time&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;IN_VEHICLE_COST&quot;</span><span class="p">,</span> <span class="s2">&quot;in-vehicle cost&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;CROWD&quot;</span><span class="p">,</span> <span class="s2">&quot;Crowding penalty&quot;</span><span class="p">),</span>
            <span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_skim_properties</span> <span class="o">+=</span> <span class="p">[</span>
                <span class="n">Skimproperty</span><span class="p">(</span><span class="n">_name</span><span class="p">,</span> <span class="n">_desc</span><span class="p">)</span> <span class="k">for</span> <span class="n">_name</span><span class="p">,</span> <span class="n">_desc</span> <span class="ow">in</span> <span class="n">_basic_skims</span>
            <span class="p">]</span>
            <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">modes</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">mode</span><span class="o">.</span><span class="n">assign_type</span> <span class="o">==</span> <span class="s2">&quot;TRANSIT&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">mode</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s2">&quot;PNR_dummy&quot;</span><span class="p">):</span>
                    <span class="n">desc</span> <span class="o">=</span> <span class="n">mode</span><span class="o">.</span><span class="n">description</span> <span class="ow">or</span> <span class="n">mode</span><span class="o">.</span><span class="n">name</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_skim_properties</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">Skimproperty</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;IVT</span><span class="si">{</span><span class="n">mode</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">desc</span><span class="si">}</span><span class="s2"> in-vehicle travel time&quot;</span><span class="p">[:</span><span class="mi">40</span><span class="p">],</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">use_ccr</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_skim_properties</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="n">Skimproperty</span><span class="p">(</span><span class="s2">&quot;LINKREL&quot;</span><span class="p">,</span> <span class="s2">&quot;Link reliability&quot;</span><span class="p">),</span>
                        <span class="n">Skimproperty</span><span class="p">(</span><span class="s2">&quot;EAWT&quot;</span><span class="p">,</span> <span class="s2">&quot;Extra added wait time&quot;</span><span class="p">),</span>
                        <span class="n">Skimproperty</span><span class="p">(</span><span class="s2">&quot;CAPPEN&quot;</span><span class="p">,</span> <span class="s2">&quot;Capacity penalty&quot;</span><span class="p">),</span>
                    <span class="p">]</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">congested_transit_assignment</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_skim_properties</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="n">Skimproperty</span><span class="p">(</span><span class="s2">&quot;TRIM&quot;</span><span class="p">,</span> <span class="s2">&quot;used to trim demands&quot;</span><span class="p">),</span>
                        <span class="n">Skimproperty</span><span class="p">(</span><span class="s2">&quot;XBOATIME&quot;</span><span class="p">,</span> <span class="s2">&quot;transfer boarding time penalty&quot;</span><span class="p">),</span>
                        <span class="n">Skimproperty</span><span class="p">(</span><span class="s2">&quot;DTOLL&quot;</span><span class="p">,</span> <span class="s2">&quot;drive access or egress toll price&quot;</span><span class="p">),</span>
                    <span class="p">]</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skim_properties</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">skim_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List of Skim Property named tuples: name, description.</span>

<span class="sd">        TODO put these in config.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skim_outputs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>

            <span class="c1"># TODO config</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_skim_outputs</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">_write_skims_to_omx</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s2">&quot;IWAIT&quot;</span><span class="p">,</span>
                <span class="s2">&quot;XWAIT&quot;</span><span class="p">,</span>
                <span class="s2">&quot;FARE&quot;</span><span class="p">,</span>
                <span class="s2">&quot;BOARDS&quot;</span><span class="p">,</span>
                <span class="s2">&quot;WAUX&quot;</span><span class="p">,</span>
                <span class="s2">&quot;DTIME&quot;</span><span class="p">,</span>
                <span class="s2">&quot;DDIST&quot;</span><span class="p">,</span>
                <span class="s2">&quot;WACC&quot;</span><span class="p">,</span>
                <span class="s2">&quot;WEGR&quot;</span><span class="p">,</span>
                <span class="s2">&quot;IVT&quot;</span><span class="p">,</span>
                <span class="s2">&quot;CROWD&quot;</span>
            <span class="p">]</span>

            <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">modes</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">mode</span><span class="o">.</span><span class="n">assign_type</span> <span class="o">==</span> <span class="s2">&quot;TRANSIT&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">mode</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s2">&quot;PNR_dummy&quot;</span><span class="p">):</span>
                    <span class="n">_write_skims_to_omx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;IVT</span><span class="si">{</span><span class="n">mode</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_skim_outputs</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">Skimproperty</span><span class="p">(</span><span class="n">_name</span><span class="p">,</span> <span class="n">_desc</span><span class="p">)</span> 
                <span class="k">for</span> <span class="n">_name</span><span class="p">,</span> <span class="n">_desc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skim_properties</span>
                <span class="k">if</span> <span class="n">_name</span> <span class="ow">in</span> <span class="n">_write_skims_to_omx</span>
            <span class="p">]</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skim_outputs</span>

    <span class="k">def</span> <span class="nf">emmebank_skim_matrices</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">time_periods</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">transit_classes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">skim_properties</span><span class="p">:</span> <span class="n">Skimproperty</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets skim matrices from emmebank, or lazily creates them if they don&#39;t already exist.&quot;&quot;&quot;</span>
        <span class="n">create_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span>
            <span class="s2">&quot;inro.emme.data.matrix.create_matrix&quot;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">time_periods</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">time_periods</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">time_periods</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;time_periods (</span><span class="si">{</span><span class="n">time_periods</span><span class="si">}</span><span class="s2">) must be subset of time_period_names (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="si">}</span><span class="s2">).&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">transit_classes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">transit_classes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">transit_classes</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;time_periods (</span><span class="si">{</span><span class="n">transit_classes</span><span class="si">}</span><span class="s2">) must be subset of time_period_names (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">transit_classes</span><span class="si">}</span><span class="s2">).&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">skim_properties</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">skim_properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">skim_properties</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">skim_properties</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">skim_properties</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;time_periods (</span><span class="si">{</span><span class="n">skim_properties</span><span class="si">}</span><span class="s2">) must be subset of time_period_names (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">skim_properties</span><span class="si">}</span><span class="s2">).&quot;</span>
            <span class="p">)</span>

        <span class="n">_tp_tclass_skprop</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span>
            <span class="n">time_periods</span><span class="p">,</span> <span class="n">transit_classes</span><span class="p">,</span> <span class="n">skim_properties</span>
        <span class="p">)</span>
        <span class="n">_tp_tclass_skprop_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">_tp</span><span class="p">,</span> <span class="n">_tclass</span><span class="p">,</span> <span class="n">_skprop</span> <span class="ow">in</span> <span class="n">_tp_tclass_skprop</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_tp</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">_tclass</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">_skprop</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">_desc</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_tp</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">_tclass</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">_skprop</span><span class="o">.</span><span class="n">desc</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scenarios</span><span class="p">[</span><span class="n">_tp</span><span class="p">]</span><span class="o">.</span><span class="n">emmebank</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_name</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_matrix</span><span class="p">:</span>
                <span class="n">_matrix</span> <span class="o">=</span> <span class="n">create_matrix</span><span class="p">(</span>
                    <span class="s2">&quot;mf&quot;</span><span class="p">,</span> <span class="n">_name</span><span class="p">,</span> <span class="n">_desc</span><span class="p">,</span> <span class="n">scenario</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scenarios</span><span class="p">[</span><span class="n">_tp</span><span class="p">],</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_matrix</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">_desc</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_skim_matrices</span><span class="p">[</span><span class="n">_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">_matrix</span>
            <span class="n">_tp_tclass_skprop_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_name</span><span class="p">)</span>

        <span class="n">skim_matrices</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">k</span><span class="p">:</span> <span class="n">v</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skim_matrices</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">_tp_tclass_skprop_list</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">skim_matrices</span>

    <span class="k">def</span> <span class="nf">run_skim_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run the transit skim calculations for a given time period and assignment class.</span>

<span class="sd">        Results are stored in transit emmebank.</span>

<span class="sd">        Steps:</span>
<span class="sd">            1. determine if using transit capacity constraint</span>
<span class="sd">            2. skim walk, wait time, boardings, and fares</span>
<span class="sd">            3. skim in vehicle time by mode</span>
<span class="sd">            4. mask transfers above max amount</span>
<span class="sd">            5. mask if doesn&#39;t have required modes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">use_ccr</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">congested_transit_assignment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">congested_transit_assignment</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">iteration</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">use_ccr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">use_ccr</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">logbook_trace</span><span class="p">(</span>
            <span class="s2">&quot;First and total wait time, number of boardings, &quot;</span>
            <span class="s2">&quot;fares, and total and transfer walk time&quot;</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">skim_walk_wait_boards_fares</span><span class="p">(</span><span class="n">time_period</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">logbook_trace</span><span class="p">(</span><span class="s2">&quot;In-vehicle time by mode&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">skim_invehicle_time_by_mode</span><span class="p">(</span><span class="n">time_period</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">,</span> <span class="n">use_ccr</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">logbook_trace</span><span class="p">(</span>
            <span class="s2">&quot;Drive distance and time&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Walk auxiliary time, walk access time and walk egress time&quot;</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">skim_drive_walk</span><span class="p">(</span><span class="n">time_period</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">logbook_trace</span><span class="p">(</span><span class="s2">&quot;Calculate crowding&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">skim_crowding</span><span class="p">(</span><span class="n">time_period</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">use_ccr</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">logbook_trace</span><span class="p">(</span><span class="s2">&quot;CCR related skims&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">skim_reliability_crowding_capacity</span><span class="p">(</span><span class="n">time_period</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">skim_walk_wait_boards_fares</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Skim wait, walk, board, and fares for a given time period and transit assignment class.</span>

<span class="sd">        Skim the first and total wait time, number of boardings, (transfers + 1)</span>
<span class="sd">        fares, total walk time, total in-vehicle time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_tp_tclass</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time_period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">transit_class</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">_network</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">time_period</span><span class="p">]</span>
        <span class="n">_transit_mode_ids</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">m</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">_network</span><span class="o">.</span><span class="n">modes</span><span class="p">()</span> <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;TRANSIT&quot;</span><span class="p">,</span> <span class="s2">&quot;AUX_TRANSIT&quot;</span><span class="p">]</span>
        <span class="p">]</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;EXTENDED_TRANSIT_MATRIX_RESULTS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;actual_first_waiting_times&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_IWAIT&quot;&#39;</span><span class="p">,</span>
            <span class="s2">&quot;actual_total_waiting_times&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_WAIT&quot;&#39;</span><span class="p">,</span>
            <span class="s2">&quot;by_mode_subset&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;modes&quot;</span><span class="p">:</span> <span class="n">_transit_mode_ids</span><span class="p">,</span>
                <span class="s2">&quot;avg_boardings&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_BOARDS&quot;&#39;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">use_fares</span><span class="p">:</span>
            <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;by_mode_subset&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;actual_in_vehicle_costs&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_IN_VEHICLE_COST&quot;&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;actual_total_boarding_costs&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_FARE&quot;&#39;</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">matrix_results</span><span class="p">(</span>
            <span class="n">spec</span><span class="p">,</span>
            <span class="n">class_name</span><span class="o">=</span><span class="n">transit_class</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">scenario</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scenarios</span><span class="p">[</span><span class="n">time_period</span><span class="p">],</span>
            <span class="n">num_processors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_processors</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_calc_xfer_wait</span><span class="p">(</span><span class="n">time_period</span><span class="p">,</span> <span class="n">transit_class</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_calc_boardings</span><span class="p">(</span><span class="n">time_period</span><span class="p">,</span> <span class="n">transit_class</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">use_fares</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_calc_fares</span><span class="p">(</span><span class="n">time_period</span><span class="p">,</span> <span class="n">transit_class</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_calc_xfer_walk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_period</span><span class="p">,</span> <span class="n">transit_class_name</span><span class="p">):</span>
        <span class="n">xfer_modes</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">mode_id</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">modes</span> <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;WALK&quot;</span><span class="p">]</span>
        <span class="n">tp_tclass</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time_period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">transit_class_name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;EXTENDED_TRANSIT_MATRIX_RESULTS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;by_mode_subset&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;modes&quot;</span><span class="p">:</span> <span class="n">xfer_modes</span><span class="p">,</span>
                <span class="s2">&quot;actual_aux_transit_times&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">tp_tclass</span><span class="si">}</span><span class="s1">_XFERWALK&quot;&#39;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">matrix_results</span><span class="p">(</span>
            <span class="n">spec</span><span class="p">,</span>
            <span class="n">class_name</span><span class="o">=</span><span class="n">transit_class_name</span><span class="p">,</span>
            <span class="n">scenario</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scenarios</span><span class="p">[</span><span class="n">time_period</span><span class="p">],</span>
            <span class="n">num_processors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_processors</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_calc_xfer_wait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_period</span><span class="p">,</span> <span class="n">transit_class_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate transfer wait from total wait time and initial wait time and add to Emmebank.</span>

<span class="sd">        TODO convert this type of calculation to numpy</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tp_tclass</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time_period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">transit_class_name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;MATRIX_CALCULATION&quot;</span><span class="p">,</span>
            <span class="s2">&quot;constraint&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;by_value&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;od_values&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">tp_tclass</span><span class="si">}</span><span class="s1">_WAIT&quot;&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;interval_min&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="s2">&quot;interval_max&quot;</span><span class="p">:</span> <span class="mi">9999999</span><span class="p">,</span>
                    <span class="s2">&quot;condition&quot;</span><span class="p">:</span> <span class="s2">&quot;INCLUDE&quot;</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">tp_tclass</span><span class="si">}</span><span class="s1">_XWAIT&quot;&#39;</span><span class="p">,</span>
            <span class="s2">&quot;expression&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;(mf&quot;</span><span class="si">{</span><span class="n">tp_tclass</span><span class="si">}</span><span class="s1">_WAIT&quot; - mf&quot;</span><span class="si">{</span><span class="n">tp_tclass</span><span class="si">}</span><span class="s1">_IWAIT&quot;).max.0&#39;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">matrix_calculator</span><span class="p">(</span>
            <span class="n">spec</span><span class="p">,</span>
            <span class="n">scenario</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scenarios</span><span class="p">[</span><span class="n">time_period</span><span class="p">],</span>
            <span class="n">num_processors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_processors</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_calc_boardings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">transit_class_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate # boardings from # of transfers and add to Emmebank.</span>

<span class="sd">        TODO convert this type of calculation to numpy</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_tp_tclass</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time_period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">transit_class_name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;PNR_TRN_WLK&quot;</span> <span class="ow">in</span> <span class="n">_tp_tclass</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s2">&quot;WLK_TRN_PNR&quot;</span> <span class="ow">in</span> <span class="n">_tp_tclass</span><span class="p">):</span>
            <span class="n">spec</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;MATRIX_CALCULATION&quot;</span><span class="p">,</span>
                <span class="s2">&quot;constraint&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;by_value&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;od_values&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_BOARDS&quot;&#39;</span><span class="p">,</span>
                        <span class="s2">&quot;interval_min&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="s2">&quot;interval_max&quot;</span><span class="p">:</span> <span class="mi">9999999</span><span class="p">,</span>
                        <span class="s2">&quot;condition&quot;</span><span class="p">:</span> <span class="s2">&quot;INCLUDE&quot;</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="c1"># CHECK should this be BOARDS or similar, not xfers?</span>
                <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_BOARDS&quot;&#39;</span><span class="p">,</span>
                <span class="s2">&quot;expression&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;(mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_BOARDS&quot; - 1).max.0&#39;</span><span class="p">,</span>
            <span class="p">}</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">matrix_calculator</span><span class="p">(</span>
                <span class="n">spec</span><span class="p">,</span>
                <span class="n">scenario</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scenarios</span><span class="p">[</span><span class="n">time_period</span><span class="p">],</span>
                <span class="n">num_processors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_processors</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_calc_fares</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">transit_class_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate fares as sum in-vehicle cost and boarding cost to get the fare paid and add to Emmebank.</span>

<span class="sd">        TODO convert this type of calculation to numpy</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_tp_tclass</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time_period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">transit_class_name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;MATRIX_CALCULATION&quot;</span><span class="p">,</span>
            <span class="s2">&quot;constraint&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_FARE&quot;&#39;</span><span class="p">,</span>
            <span class="s2">&quot;expression&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;(mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_FARE&quot; + mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_IN_VEHICLE_COST&quot;)&#39;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">matrix_calculator</span><span class="p">(</span>
            <span class="n">spec</span><span class="p">,</span>
            <span class="n">scenario</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scenarios</span><span class="p">[</span><span class="n">time_period</span><span class="p">],</span>
            <span class="n">num_processors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_processors</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_segments_with_modes</span><span class="p">(</span><span class="n">_network</span><span class="p">,</span> <span class="n">_modes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">]):</span>
        <span class="n">_modes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">_modes</span><span class="p">)</span>
        <span class="n">segments</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">li</span><span class="o">.</span><span class="n">segments</span><span class="p">()</span> <span class="k">for</span> <span class="n">li</span> <span class="ow">in</span> <span class="n">_network</span><span class="o">.</span><span class="n">transit_lines</span><span class="p">()</span> <span class="k">if</span> <span class="n">li</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="n">_modes</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="n">segments</span>

    <span class="k">def</span> <span class="nf">_invehicle_time_by_mode_ccr</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">mode_combinations</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate in-vehicle travel time by mode using CCR and store results in Emmebank.</span>

<span class="sd">        Args:</span>
<span class="sd">            time_period (_type_): time period abbreviation</span>
<span class="sd">            transit_class (_type_): transit class name</span>
<span class="sd">            mode_combinations (_type_): TODO</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of matrix names in Emmebank to sum together to get total in-vehicle travel time.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">_network</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">time_period</span><span class="p">]</span>
        <span class="n">_scenario</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scenarios</span><span class="p">[</span><span class="n">time_period</span><span class="p">]</span>
        <span class="n">_tp_tclass</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time_period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">transit_class</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">_total_ivtt_expr</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">create_temps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">temp_attributes_and_restore</span>
        <span class="n">temp_attrs</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;TRANSIT_SEGMENT&quot;</span><span class="p">,</span> <span class="s2">&quot;@mode_timtr&quot;</span><span class="p">,</span> <span class="s2">&quot;base time by mode&quot;</span><span class="p">]]</span>
        <span class="k">with</span> <span class="n">create_temps</span><span class="p">(</span><span class="n">_scenario</span><span class="p">,</span> <span class="n">temp_attrs</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">_mode_name</span><span class="p">,</span> <span class="n">_modes</span> <span class="ow">in</span> <span class="n">mode_combinations</span><span class="p">:</span>
                <span class="n">_network</span><span class="o">.</span><span class="n">create_attribute</span><span class="p">(</span><span class="s2">&quot;TRANSIT_SEGMENT&quot;</span><span class="p">,</span> <span class="s2">&quot;@mode_timtr&quot;</span><span class="p">)</span>
                <span class="n">_li_segs_with_mode</span> <span class="o">=</span> <span class="n">TransitSkim</span><span class="o">.</span><span class="n">_segments_with_modes</span><span class="p">(</span><span class="n">_network</span><span class="p">,</span> <span class="n">_modes</span><span class="p">)</span>
                <span class="c1"># set temp attribute @mode_timtr to contain the non-congested in-vehicle</span>
                <span class="c1"># times for segments of the mode of interest</span>
                <span class="k">for</span> <span class="n">line_segment</span> <span class="ow">in</span> <span class="n">_li_segs_with_mode</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="n">line_segment</span><span class="p">:</span>
                        <span class="n">segment</span><span class="p">[</span><span class="s2">&quot;@mode_timtr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">segment</span><span class="p">[</span><span class="s2">&quot;@base_timtr&quot;</span><span class="p">]</span>
                <span class="c1"># not sure why we to copy this if we are deleting it in next line? - ES</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">copy_attribute_values</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">time_period</span><span class="p">],</span>
                    <span class="n">_scenario</span><span class="p">,</span>
                    <span class="p">{</span><span class="s2">&quot;TRANSIT_SEGMENT&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;@mode_timtr&quot;</span><span class="p">]},</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">time_period</span><span class="p">]</span><span class="o">.</span><span class="n">delete_attribute</span><span class="p">(</span>
                    <span class="s2">&quot;TRANSIT_SEGMENT&quot;</span><span class="p">,</span> <span class="s2">&quot;@mode_timtr&quot;</span>
                <span class="p">)</span>
                <span class="n">_ivtt_matrix_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_IVT</span><span class="si">{</span><span class="n">_mode_name</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
                <span class="n">_total_ivtt_expr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_ivtt_matrix_name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_run_strategy_analysis</span><span class="p">(</span>
                    <span class="n">time_period</span><span class="p">,</span>
                    <span class="n">transit_class</span><span class="p">,</span>
                    <span class="p">{</span><span class="s2">&quot;in_vehicle&quot;</span><span class="p">:</span> <span class="s2">&quot;@mode_timtr&quot;</span><span class="p">},</span>
                    <span class="sa">f</span><span class="s2">&quot;IVT</span><span class="si">{</span><span class="n">_mode_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">_total_ivtt_expr</span>

    <span class="k">def</span> <span class="nf">_invehicle_time_by_mode_no_ccr</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">mode_combinations</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate in-vehicle travel time by without CCR and store results in Emmebank.</span>

<span class="sd">        Args:</span>
<span class="sd">            time_period (_type_): time period abbreviation</span>
<span class="sd">            transit_class (_type_): transit class name</span>
<span class="sd">            mode_combinations (_type_): TODO</span>

<span class="sd">        Returns: List of matrix names in Emmebank to sum together to get total in-vehicle travel time.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_tp_tclass</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time_period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">transit_class</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">_total_ivtt_expr</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_mode_name</span><span class="p">,</span> <span class="n">modes</span> <span class="ow">in</span> <span class="n">mode_combinations</span><span class="p">:</span>
            <span class="n">_ivtt_matrix_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_IVT</span><span class="si">{</span><span class="n">_mode_name</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
            <span class="n">_total_ivtt_expr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_ivtt_matrix_name</span><span class="p">)</span>
            <span class="n">spec</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;EXTENDED_TRANSIT_MATRIX_RESULTS&quot;</span><span class="p">,</span>
                <span class="s2">&quot;by_mode_subset&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;modes&quot;</span><span class="p">:</span> <span class="n">modes</span><span class="p">,</span>
                    <span class="s2">&quot;actual_in_vehicle_times&quot;</span><span class="p">:</span> <span class="n">_ivtt_matrix_name</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">matrix_results</span><span class="p">(</span>
                <span class="n">spec</span><span class="p">,</span>
                <span class="n">class_name</span><span class="o">=</span><span class="n">transit_class</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">scenario</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scenarios</span><span class="p">[</span><span class="n">time_period</span><span class="p">],</span>
                <span class="n">num_processors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_processors</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">_total_ivtt_expr</span>

    <span class="k">def</span> <span class="nf">skim_invehicle_time_by_mode</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">use_ccr</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Skim in-vehicle by mode for a time period and transit class and store results in Emmebank.</span>

<span class="sd">        Args:</span>
<span class="sd">            time_period (str): time period abbreviation</span>
<span class="sd">            transit_class (str): transit class name</span>
<span class="sd">            use_ccr (bool): if True, will use crowding, capacity, and reliability (ccr).</span>
<span class="sd">                Defaults to False</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mode_combinations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_emme_mode_ids</span><span class="p">(</span><span class="n">transit_class</span><span class="p">,</span> <span class="n">time_period</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">use_ccr</span><span class="p">:</span>
            <span class="n">total_ivtt_expr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_invehicle_time_by_mode_ccr</span><span class="p">(</span>
                <span class="n">time_period</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">,</span> <span class="n">mode_combinations</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">total_ivtt_expr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_invehicle_time_by_mode_no_ccr</span><span class="p">(</span>
                <span class="n">time_period</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">,</span> <span class="n">mode_combinations</span>
            <span class="p">)</span>
        <span class="c1"># sum total ivtt across all modes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_calc_total_ivt</span><span class="p">(</span><span class="n">time_period</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">,</span> <span class="n">total_ivtt_expr</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_calc_total_ivt</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">total_ivtt_expr</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sums matrices to get total in vehicle time and stores in the Emmebank.</span>

<span class="sd">        Args:</span>
<span class="sd">            time_period (str): time period abbreviation</span>
<span class="sd">            transit_class (str): transit class name</span>
<span class="sd">            total_ivtt_expr (list[str]): List of matrix names in Emmebank which have IVT to sum to get total.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_tp_tclass</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time_period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">transit_class</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;MATRIX_CALCULATION&quot;</span><span class="p">,</span>
            <span class="s2">&quot;constraint&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="w"> </span><span class="si">}</span><span class="s1">_IVT&quot;&#39;</span><span class="p">,</span>
            <span class="s2">&quot;expression&quot;</span><span class="p">:</span> <span class="s2">&quot;+&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">total_ivtt_expr</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">matrix_calculator</span><span class="p">(</span>
            <span class="n">spec</span><span class="p">,</span>
            <span class="n">scenario</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scenarios</span><span class="p">[</span><span class="n">time_period</span><span class="p">],</span>
            <span class="n">num_processors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_processors</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">skim_drive_walk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
        <span class="n">_tp_tclass</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time_period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">transit_class</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="c1"># _network = self.networks[time_period]</span>

        <span class="c1"># drive time here is perception factor*(drive time + toll penalty),</span>
        <span class="c1"># will calculate the actual drive time and substract toll penalty in the following steps</span>
        <span class="n">spec1</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;EXTENDED_TRANSIT_MATRIX_RESULTS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;by_mode_subset&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;modes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;D&quot;</span><span class="p">],</span>
                <span class="s2">&quot;actual_aux_transit_times&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_DTIME&quot;&#39;</span><span class="p">,</span>
                <span class="s2">&quot;distance&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_DDIST&quot;&#39;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">}</span>
        <span class="c1"># skim walk distance in walk time matrices first,</span>
        <span class="c1"># will calculate the actual walk time and overwrite the distance in the following steps</span>
        <span class="n">spec2</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;EXTENDED_TRANSIT_MATRIX_RESULTS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;by_mode_subset&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;modes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;w&quot;</span><span class="p">],</span>
                <span class="s2">&quot;distance&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_WAUX&quot;&#39;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">}</span>
        <span class="n">spec3</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;EXTENDED_TRANSIT_MATRIX_RESULTS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;by_mode_subset&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;modes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">],</span>
                <span class="s2">&quot;distance&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_WACC&quot;&#39;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">}</span>
        <span class="n">spec4</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;EXTENDED_TRANSIT_MATRIX_RESULTS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;by_mode_subset&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;modes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;e&quot;</span><span class="p">],</span>
                <span class="s2">&quot;distance&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_WEGR&quot;&#39;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">transit_class</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;WLK_TRN_WLK&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">matrix_results</span><span class="p">(</span>
                <span class="n">spec1</span><span class="p">,</span>
                <span class="n">class_name</span><span class="o">=</span><span class="n">transit_class</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">scenario</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scenarios</span><span class="p">[</span><span class="n">time_period</span><span class="p">],</span>
                <span class="n">num_processors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_processors</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">matrix_results</span><span class="p">(</span>
            <span class="n">spec2</span><span class="p">,</span>
            <span class="n">class_name</span><span class="o">=</span><span class="n">transit_class</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">scenario</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scenarios</span><span class="p">[</span><span class="n">time_period</span><span class="p">],</span>
            <span class="n">num_processors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_processors</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">transit_class</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;PNR_TRN_WLK&#39;</span><span class="p">,</span><span class="s1">&#39;KNR_TRN_WLK&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">matrix_results</span><span class="p">(</span>
                <span class="n">spec3</span><span class="p">,</span>
                <span class="n">class_name</span><span class="o">=</span><span class="n">transit_class</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">scenario</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scenarios</span><span class="p">[</span><span class="n">time_period</span><span class="p">],</span>
                <span class="n">num_processors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_processors</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">transit_class</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;WLK_TRN_PNR&#39;</span><span class="p">,</span><span class="s1">&#39;WLK_TRN_KNR&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">matrix_results</span><span class="p">(</span>
                <span class="n">spec4</span><span class="p">,</span>
                <span class="n">class_name</span><span class="o">=</span><span class="n">transit_class</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">scenario</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scenarios</span><span class="p">[</span><span class="n">time_period</span><span class="p">],</span>
                <span class="n">num_processors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_processors</span><span class="p">,</span>
            <span class="p">)</span>


        <span class="n">drive_perception_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">drive_perception_factor</span>
        <span class="n">walk_speed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">walk_speed</span>
        <span class="n">vot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">value_of_time</span>
        <span class="c1"># divide drive time by mode specific perception factor to get the actual time</span>
        <span class="c1"># for walk time, use walk distance/walk speed</span>
        <span class="c1"># because the mode specific perception factors are hardcoded in the mode definition</span>
        <span class="n">spec_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;MATRIX_CALCULATION&quot;</span><span class="p">,</span>
                <span class="s2">&quot;constraint&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_DTIME&quot;&#39;</span><span class="p">,</span>
                <span class="s2">&quot;expression&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_DTIME&quot;/</span><span class="si">{</span><span class="n">drive_perception_factor</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;MATRIX_CALCULATION&quot;</span><span class="p">,</span>
                <span class="s2">&quot;constraint&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_DTIME&quot;&#39;</span><span class="p">,</span>
                <span class="s2">&quot;expression&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_DTIME&quot;&#39;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;MATRIX_CALCULATION&quot;</span><span class="p">,</span>
                <span class="s2">&quot;constraint&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_WAUX&quot;&#39;</span><span class="p">,</span>
                <span class="s2">&quot;expression&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_WAUX&quot;/(</span><span class="si">{</span><span class="n">walk_speed</span><span class="si">}</span><span class="s1">/60)&#39;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;MATRIX_CALCULATION&quot;</span><span class="p">,</span>
                <span class="s2">&quot;constraint&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_WACC&quot;&#39;</span><span class="p">,</span>
                <span class="s2">&quot;expression&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_WACC&quot;/(</span><span class="si">{</span><span class="n">walk_speed</span><span class="si">}</span><span class="s1">/60)&#39;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;MATRIX_CALCULATION&quot;</span><span class="p">,</span>
                <span class="s2">&quot;constraint&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_WEGR&quot;&#39;</span><span class="p">,</span>
                <span class="s2">&quot;expression&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_WEGR&quot;/(</span><span class="si">{</span><span class="n">walk_speed</span><span class="si">}</span><span class="s1">/60)&#39;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">matrix_calculator</span><span class="p">(</span>
            <span class="n">spec_list</span><span class="p">,</span>
            <span class="n">scenario</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scenarios</span><span class="p">[</span><span class="n">time_period</span><span class="p">],</span>
            <span class="n">num_processors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_processors</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">skim_penalty_toll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
        <span class="c1"># transfer boarding time penalty</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_run_strategy_analysis</span><span class="p">(</span>
            <span class="n">time_period</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;boarding&quot;</span><span class="p">:</span> <span class="s2">&quot;@xboard_nodepen&quot;</span><span class="p">},</span> <span class="s2">&quot;XBOATIME&quot;</span>
        <span class="p">)</span>

        <span class="n">_tp_tclass</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time_period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">transit_class</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;PNR_TRN_WLK&quot;</span> <span class="ow">in</span> <span class="n">_tp_tclass</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s2">&quot;WLK_TRN_PNR&quot;</span> <span class="ow">in</span> <span class="n">_tp_tclass</span><span class="p">):</span>
            <span class="n">spec</span> <span class="o">=</span> <span class="p">{</span>  <span class="c1"># subtract PNR boarding from total transfer boarding time penalty</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;MATRIX_CALCULATION&quot;</span><span class="p">,</span>
                <span class="s2">&quot;constraint&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;by_value&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;od_values&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_XBOATIME&quot;&#39;</span><span class="p">,</span>
                        <span class="s2">&quot;interval_min&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="s2">&quot;interval_max&quot;</span><span class="p">:</span> <span class="mi">9999999</span><span class="p">,</span>
                        <span class="s2">&quot;condition&quot;</span><span class="p">:</span> <span class="s2">&quot;INCLUDE&quot;</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_XBOATIME&quot;&#39;</span><span class="p">,</span>
                <span class="s2">&quot;expression&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;(mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_XBOATIME&quot; - 1).max.0&#39;</span><span class="p">,</span>
            <span class="p">}</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">matrix_calculator</span><span class="p">(</span>
                <span class="n">spec</span><span class="p">,</span>
                <span class="n">scenario</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scenarios</span><span class="p">[</span><span class="n">time_period</span><span class="p">],</span>
                <span class="n">num_processors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_processors</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># drive toll</span>
        <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;PNR_TRN_WLK&quot;</span> <span class="ow">in</span> <span class="n">_tp_tclass</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s2">&quot;KNR_TRN_WLK&quot;</span> <span class="ow">in</span> <span class="n">_tp_tclass</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_run_path_analysis</span><span class="p">(</span>
                <span class="n">time_period</span><span class="p">,</span>
                <span class="n">transit_class</span><span class="p">,</span>
                <span class="s2">&quot;ORIGIN_TO_INITIAL_BOARDING&quot;</span><span class="p">,</span>
                <span class="p">{</span><span class="s2">&quot;aux_transit&quot;</span><span class="p">:</span> <span class="s2">&quot;@drive_toll&quot;</span><span class="p">},</span>
                <span class="s2">&quot;DTOLL&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="s2">&quot;WLK_TRN_PNR&quot;</span> <span class="ow">in</span> <span class="n">_tp_tclass</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s2">&quot;WLK_TRN_KNR&quot;</span> <span class="ow">in</span> <span class="n">_tp_tclass</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_run_path_analysis</span><span class="p">(</span>
                <span class="n">time_period</span><span class="p">,</span>
                <span class="n">transit_class</span><span class="p">,</span>
                <span class="s2">&quot;FINAL_ALIGHTING_TO_DESTINATION&quot;</span><span class="p">,</span>
                <span class="p">{</span><span class="s2">&quot;aux_transit&quot;</span><span class="p">:</span> <span class="s2">&quot;@drive_toll&quot;</span><span class="p">},</span>
                <span class="s2">&quot;DTOLL&quot;</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_emme_mode_ids</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">,</span> <span class="n">time_period</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the Emme mode IDs used in the assignment.</span>

<span class="sd">        Loads the #src_mode attribute on lines if fares are used, and the</span>
<span class="sd">        @base_timtr on segments if ccr is used.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of tuples of two items, the original mode name (from config)</span>
<span class="sd">            to a list of mode IDs used in the Emme assignment. This list</span>
<span class="sd">            will be one item if fares are not used, but will contain the fare</span>
<span class="sd">            modes used in the journey levels mode-to-mode transfer table</span>
<span class="sd">            generated from Apply fares.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">use_fares</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">copy_attribute_values</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scenarios</span><span class="p">[</span><span class="n">time_period</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">time_period</span><span class="p">],</span>
                <span class="p">{</span><span class="s2">&quot;TRANSIT_LINE&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;#src_mode&quot;</span><span class="p">]},</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">use_ccr</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">copy_attribute_values</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scenarios</span><span class="p">[</span><span class="n">time_period</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">time_period</span><span class="p">],</span>
                <span class="p">{</span><span class="s2">&quot;TRANSIT_SEGMENT&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;@base_timtr&quot;</span><span class="p">]},</span>
            <span class="p">)</span>
        <span class="n">valid_modes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">mode</span>
            <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">modes</span>
            <span class="k">if</span> <span class="n">mode</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="n">transit_class</span><span class="o">.</span><span class="n">mode_types</span>
            <span class="ow">and</span> <span class="n">mode</span><span class="o">.</span><span class="n">assign_type</span> <span class="o">==</span> <span class="s2">&quot;TRANSIT&quot;</span>
            <span class="ow">and</span> <span class="n">mode</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s2">&quot;PNR_dummy&quot;</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">use_fares</span><span class="p">:</span>
            <span class="c1"># map to used modes in apply fares case</span>
            <span class="n">fare_modes</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="nb">set</span><span class="p">([]))</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">time_period</span><span class="p">]</span><span class="o">.</span><span class="n">transit_lines</span><span class="p">():</span>
                <span class="n">fare_modes</span><span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="s2">&quot;#src_mode&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="n">emme_mode_ids</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="n">mode</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">fare_modes</span><span class="p">[</span><span class="n">mode</span><span class="o">.</span><span class="n">mode_id</span><span class="p">]))</span>
                <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">valid_modes</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">fare_modes</span><span class="p">[</span><span class="n">mode</span><span class="o">.</span><span class="n">mode_id</span><span class="p">]))</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">emme_mode_ids</span> <span class="o">=</span> <span class="p">[(</span><span class="n">mode</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="p">[</span><span class="n">mode</span><span class="o">.</span><span class="n">mode_id</span><span class="p">])</span> <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">valid_modes</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">emme_mode_ids</span>

    <span class="k">def</span> <span class="nf">skim_reliability_crowding_capacity</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">transit_class</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate skim results for CCR assignment and stores results in Emmebank.</span>

<span class="sd">        Generates the following:</span>
<span class="sd">        1. Link Unreliability: LINKREL</span>
<span class="sd">        2. Crowding penalty: CROWD</span>
<span class="sd">        3. Extra added wait time: EAWT</span>
<span class="sd">        4. Capacity penalty: CAPPEN</span>

<span class="sd">        Args:</span>
<span class="sd">            time_period (str): time period abbreviation</span>
<span class="sd">            transit_class: transit class</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Link unreliability</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_run_strategy_analysis</span><span class="p">(</span>
            <span class="n">time_period</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;in_vehicle&quot;</span><span class="p">:</span> <span class="s2">&quot;ul1&quot;</span><span class="p">},</span> <span class="s2">&quot;LINKREL&quot;</span>
        <span class="p">)</span>
        <span class="c1"># Crowding penalty</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_run_strategy_analysis</span><span class="p">(</span>
            <span class="n">time_period</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;in_vehicle&quot;</span><span class="p">:</span> <span class="s2">&quot;@ccost&quot;</span><span class="p">},</span> <span class="s2">&quot;CROWD&quot;</span>
        <span class="p">)</span>
        <span class="c1"># skim node reliability, extra added wait time (EAWT)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_run_strategy_analysis</span><span class="p">(</span>
            <span class="n">time_period</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;boarding&quot;</span><span class="p">:</span> <span class="s2">&quot;@eawt&quot;</span><span class="p">},</span> <span class="s2">&quot;EAWT&quot;</span>
        <span class="p">)</span>
        <span class="c1"># skim capacity penalty</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_run_strategy_analysis</span><span class="p">(</span>
            <span class="n">time_period</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;boarding&quot;</span><span class="p">:</span> <span class="s2">&quot;@capacity_penalty&quot;</span><span class="p">},</span> <span class="s2">&quot;CAPPEN&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">skim_crowding</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
        <span class="c1"># Crowding penalty</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_run_strategy_analysis</span><span class="p">(</span>
            <span class="n">time_period</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;in_vehicle&quot;</span><span class="p">:</span> <span class="s2">&quot;@ccost&quot;</span><span class="p">},</span> <span class="s2">&quot;CROWD&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_run_strategy_analysis</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">transit_class</span><span class="p">,</span>
        <span class="n">components</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">matrix_name_suffix</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Runs strategy analysis in Emme and stores results in emmebank.</span>

<span class="sd">        Args:</span>
<span class="sd">            time_period (str): Time period name abbreviation</span>
<span class="sd">            transit_class (_type_): _description_</span>
<span class="sd">            components (Dict[str, str]): _description_</span>
<span class="sd">            matrix_name_suffix (str): Appended to time period and transit class name to create output matrix name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_tp_tclass</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time_period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">transit_class</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">_matrix_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">matrix_name_suffix</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
        <span class="n">strategy_analysis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span>
            <span class="s2">&quot;inro.emme.transit_assignment.extended.strategy_based_analysis&quot;</span>
        <span class="p">)</span>

        <span class="n">spec</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;trip_components&quot;</span><span class="p">:</span> <span class="n">components</span><span class="p">,</span>
            <span class="s2">&quot;sub_path_combination_operator&quot;</span><span class="p">:</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sub_strategy_combination_operator&quot;</span><span class="p">:</span> <span class="s2">&quot;average&quot;</span><span class="p">,</span>
            <span class="s2">&quot;selected_demand_and_transit_volumes&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;sub_strategies_to_retain&quot;</span><span class="p">:</span> <span class="s2">&quot;ALL&quot;</span><span class="p">,</span>
                <span class="s2">&quot;selection_threshold&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;lower&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">999999</span><span class="p">,</span> <span class="s2">&quot;upper&quot;</span><span class="p">:</span> <span class="mi">999999</span><span class="p">},</span>
            <span class="p">},</span>
            <span class="s2">&quot;analyzed_demand&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;mfTRN_</span><span class="si">{</span><span class="n">transit_class</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">time_period</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;constraint&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;strategy_values&quot;</span><span class="p">:</span> <span class="n">_matrix_name</span><span class="p">},</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;EXTENDED_TRANSIT_STRATEGY_ANALYSIS&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">strategy_analysis</span><span class="p">(</span>
            <span class="n">spec</span><span class="p">,</span>
            <span class="n">class_name</span><span class="o">=</span><span class="n">transit_class</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">scenario</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scenarios</span><span class="p">[</span><span class="n">time_period</span><span class="p">],</span>
            <span class="n">num_processors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_processors</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_run_path_analysis</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">transit_class</span><span class="p">,</span>
        <span class="n">portion_of_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">components</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">matrix_name_suffix</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Runs path analysis in Emme and stores results in emmebank.</span>

<span class="sd">        Args:</span>
<span class="sd">            time_period (str): Time period name abbreviation</span>
<span class="sd">            transit_class (_type_): _description_</span>
<span class="sd">            components (Dict[str, str]): _description_</span>
<span class="sd">            matrix_name_suffix (str): Appended to time period and transit class name to create output matrix name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_tp_tclass</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time_period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">transit_class</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">_matrix_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">matrix_name_suffix</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
        <span class="n">path_analysis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span>
            <span class="s2">&quot;inro.emme.transit_assignment.extended.path_based_analysis&quot;</span>
        <span class="p">)</span>

        <span class="n">spec</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;portion_of_path&quot;</span><span class="p">:</span> <span class="n">portion_of_path</span><span class="p">,</span>
            <span class="s2">&quot;trip_components&quot;</span><span class="p">:</span> <span class="n">components</span><span class="p">,</span>
            <span class="s2">&quot;path_operator&quot;</span><span class="p">:</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span>
            <span class="s2">&quot;path_selection_threshold&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;lower&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">999999</span><span class="p">,</span> <span class="s2">&quot;upper&quot;</span><span class="p">:</span> <span class="mi">999999</span><span class="p">},</span>
            <span class="s2">&quot;path_to_od_aggregation&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="s2">&quot;average&quot;</span><span class="p">,</span>
                <span class="s2">&quot;aggregated_path_values&quot;</span><span class="p">:</span> <span class="n">_matrix_name</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;analyzed_demand&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;constraint&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;EXTENDED_TRANSIT_PATH_ANALYSIS&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">path_analysis</span><span class="p">(</span>
            <span class="n">spec</span><span class="p">,</span>
            <span class="n">class_name</span><span class="o">=</span><span class="n">transit_class</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">scenario</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scenarios</span><span class="p">[</span><span class="n">time_period</span><span class="p">],</span>
            <span class="n">num_processors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_processors</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">mask_if_not_required_modes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enforce the `required_mode_combo` parameter by setting IVTs to 0 if don&#39;t have required modes.</span>

<span class="sd">        Args:</span>
<span class="sd">            time_period (str): Time period name abbreviation</span>
<span class="sd">            transit_class (_type_): _description_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">transit_class</span><span class="o">.</span><span class="n">required_mode_combo</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">_ivt_skims</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">transit_class</span><span class="o">.</span><span class="n">required_mode_combo</span><span class="p">:</span>
            <span class="n">transit_modes</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">modes</span> <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">mode</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">transit_mode</span> <span class="ow">in</span> <span class="n">transit_modes</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_ivt_skims</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">_ivt_skims</span><span class="p">[</span><span class="n">mode</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">matrix_cache</span><span class="p">[</span><span class="n">time_period</span><span class="p">]</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">time_period</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">transit_class</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">transit_mode</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">IVTT&quot;&#39;</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">_ivt_skims</span><span class="p">[</span><span class="n">mode</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">matrix_cache</span><span class="p">[</span><span class="n">time_period</span><span class="p">]</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">time_period</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">transit_class</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">transit_mode</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">IVTT&quot;&#39;</span>
                    <span class="p">)</span>

        <span class="c1"># multiply all IVT skims together and see if they are greater than zero</span>
        <span class="n">has_all</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">_ivt_skims</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">has_all</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">has_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">has_all</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">has_all</span> <span class="o">=</span> <span class="n">value</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_mask_skim_set</span><span class="p">(</span><span class="n">time_period</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">,</span> <span class="n">has_all</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">mask_above_max_transfers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reset skims to 0 if number of transfers is greater than max_transfers.</span>

<span class="sd">        Args:</span>
<span class="sd">            time_period (str): Time period name abbreviation</span>
<span class="sd">            transit_class (_type_): _description_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">max_transfers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_transfers</span>
        <span class="n">xfers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">matrix_cache</span><span class="p">[</span><span class="n">time_period</span><span class="p">]</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">time_period</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">transit_class</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">_XFERS&quot;&#39;</span>
        <span class="p">)</span>
        <span class="n">xfer_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">less_equal</span><span class="p">(</span><span class="n">xfers</span><span class="p">,</span> <span class="n">max_transfers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mask_skim_set</span><span class="p">(</span><span class="n">time_period</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">,</span> <span class="n">xfer_mask</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_mask_skim_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">,</span> <span class="n">mask_array</span><span class="p">:</span> <span class="n">NumpyArray</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Mask a skim set (set of skims for a given time period and transit class) based on an array.</span>

<span class="sd">        Array values of &gt;0 are kept. Zero are not.</span>

<span class="sd">        TODO add in checks for mask_array dimensions and values</span>

<span class="sd">        Args:</span>
<span class="sd">            time_period (str): Time period name abbreviation</span>
<span class="sd">            transit_class (_type_): _description_</span>
<span class="sd">            mask_array (NumpyArray): _description_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mask_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">greater</span><span class="p">(</span><span class="n">mask_array</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">mask_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">less</span><span class="p">(</span><span class="n">mask_array</span><span class="p">,</span> <span class="n">inf</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">skim_key</span><span class="p">,</span> <span class="n">skim</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">emmebank_skim_matrices</span><span class="p">(</span>
            <span class="n">time_periods</span><span class="o">=</span><span class="p">[</span><span class="n">time_period</span><span class="p">],</span> <span class="n">transit_classes</span><span class="o">=</span><span class="p">[</span><span class="n">transit_class</span><span class="p">]</span>
        <span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">skim_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">matrix_cache</span><span class="p">[</span><span class="n">time_period</span><span class="p">]</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">skim</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">matrix_cache</span><span class="p">[</span><span class="n">time_period</span><span class="p">]</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">skim</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">skim_data</span> <span class="o">*</span> <span class="n">mask_array</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_export_skims</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Export skims to OMX files by period.&quot;&quot;&quot;</span>
        <span class="c1"># NOTE: skims in separate file by period</span>
        <span class="n">output_skim_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">output_skim_path</span><span class="p">)</span>
        <span class="n">omx_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">output_skim_path</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">output_skim_filename_tmpl</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">time_period</span><span class="o">=</span><span class="n">time_period</span><span class="p">,</span> <span class="n">tclass</span><span class="o">=</span><span class="n">transit_class</span><span class="o">.</span><span class="n">name</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">omx_file_path</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">_matrices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emmebank_skim_matrices</span><span class="p">(</span>
            <span class="n">time_periods</span><span class="o">=</span><span class="p">[</span><span class="n">time_period</span><span class="p">],</span> 
            <span class="n">transit_classes</span><span class="o">=</span><span class="p">[</span><span class="n">transit_class</span><span class="p">],</span>
            <span class="n">skim_properties</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">skim_outputs</span>

        <span class="p">)</span>

        <span class="k">with</span> <span class="n">OMXManager</span><span class="p">(</span>
            <span class="n">omx_file_path</span><span class="p">,</span>
            <span class="s2">&quot;w&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scenarios</span><span class="p">[</span><span class="n">time_period</span><span class="p">],</span>
            <span class="n">matrix_cache</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">matrix_cache</span><span class="p">[</span><span class="n">time_period</span><span class="p">],</span>
            <span class="n">mask_max_value</span><span class="o">=</span><span class="mf">1e7</span><span class="p">,</span>
            <span class="n">growth_factor</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">omx_file</span><span class="p">:</span>
            <span class="n">omx_file</span><span class="o">.</span><span class="n">write_matrices</span><span class="p">(</span><span class="n">_matrices</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_log_debug_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_time_period</span><span class="p">):</span>
        <span class="n">num_zones</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scenarios</span><span class="p">[</span><span class="n">_time_period</span><span class="p">]</span><span class="o">.</span><span class="n">zone_numbers</span><span class="p">)</span>
        <span class="n">num_cells</span> <span class="o">=</span> <span class="n">num_zones</span> <span class="o">*</span> <span class="n">num_zones</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Transit impedance summary for period </span><span class="si">{</span><span class="n">_time_period</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Number of zones: </span><span class="si">{</span><span class="n">num_zones</span><span class="si">}</span><span class="s2">. Number of O-D pairs: </span><span class="si">{</span><span class="n">num_cells</span><span class="si">}</span><span class="s2">. &quot;</span>
            <span class="s2">&quot;Values outside -9999999, 9999999 are masked in summaries.&quot;</span><span class="p">,</span>
            <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
            <span class="s2">&quot;name                            min       max      mean           sum&quot;</span><span class="p">,</span>
            <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emmebank_skim_matrices</span><span class="p">(</span><span class="n">time_periods</span><span class="o">=</span><span class="p">[</span><span class="n">_time_period</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">matrix_name</span> <span class="ow">in</span> <span class="n">temp</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">matrix_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">matrix_name</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
            <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">matrix_cache</span><span class="p">[</span><span class="n">_time_period</span><span class="p">]</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">matrix_name</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_outside</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="o">-</span><span class="mi">9999999</span><span class="p">,</span> <span class="mi">9999999</span><span class="p">)</span>
            <span class="n">stats</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">matrix_name</span><span class="si">:</span><span class="s2">25</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">9.4g</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">9.4g</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">9.4g</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">:</span><span class="s2"> 13.7g</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_copy_attribute_values</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">attributes</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">domain</span><span class="p">,</span> <span class="n">attrs</span> <span class="ow">in</span> <span class="n">attributes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">get_attribute_values</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
            <span class="n">dst</span><span class="o">.</span><span class="n">set_attribute_values</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="tm2py.components.network.transit.transit_skim.TransitSkim.skim_outputs" class="doc doc-heading">
            <code class=" language-python"><span class="n">skim_outputs</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.components.network.transit.transit_skim.TransitSkim.skim_outputs" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>List of Skim Property named tuples: name, description.</p>
<p>TODO put these in config.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tm2py.components.network.transit.transit_skim.TransitSkim.skim_properties" class="doc doc-heading">
            <code class=" language-python"><span class="n">skim_properties</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.components.network.transit.transit_skim.TransitSkim.skim_properties" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>List of Skim Property named tuples: name, description.</p>
<p>TODO put these in config.</p>
    </div>

</div>



<div class="doc doc-object doc-function">


<h3 id="tm2py.components.network.transit.transit_skim.TransitSkim.__init__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span></code>

<a href="#tm2py.components.network.transit.transit_skim.TransitSkim.__init__" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Constructor for TransitSkim class.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>controller</code></td>
            <td>
                  <code>&#39;RunController&#39;</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The RunController instance.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/network/transit/transit_skim.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="s2">&quot;RunController&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Constructor for TransitSkim class.</span>

<span class="sd">    Args:</span>
<span class="sd">        controller: The RunController instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">transit</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_num_processors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">num_processors_transit_skim</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_networks</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_scenarios</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_skim_properties</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_skim_matrices</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">k</span><span class="p">:</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">skim_properties</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_skim_outputs</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.network.transit.transit_skim.TransitSkim.emmebank_skim_matrices" class="doc doc-heading">
            <code class=" language-python"><span class="n">emmebank_skim_matrices</span><span class="p">(</span><span class="n">time_periods</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">transit_classes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">skim_properties</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#tm2py.components.network.transit.transit_skim.TransitSkim.emmebank_skim_matrices" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Gets skim matrices from emmebank, or lazily creates them if they don&rsquo;t already exist.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/network/transit/transit_skim.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">emmebank_skim_matrices</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">time_periods</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">transit_classes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">skim_properties</span><span class="p">:</span> <span class="n">Skimproperty</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets skim matrices from emmebank, or lazily creates them if they don&#39;t already exist.&quot;&quot;&quot;</span>
    <span class="n">create_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span>
        <span class="s2">&quot;inro.emme.data.matrix.create_matrix&quot;</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">time_periods</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">time_periods</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">time_periods</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;time_periods (</span><span class="si">{</span><span class="n">time_periods</span><span class="si">}</span><span class="s2">) must be subset of time_period_names (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="si">}</span><span class="s2">).&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">transit_classes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">transit_classes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">transit_classes</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;time_periods (</span><span class="si">{</span><span class="n">transit_classes</span><span class="si">}</span><span class="s2">) must be subset of time_period_names (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">transit_classes</span><span class="si">}</span><span class="s2">).&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">skim_properties</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">skim_properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">skim_properties</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">skim_properties</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">skim_properties</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;time_periods (</span><span class="si">{</span><span class="n">skim_properties</span><span class="si">}</span><span class="s2">) must be subset of time_period_names (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">skim_properties</span><span class="si">}</span><span class="s2">).&quot;</span>
        <span class="p">)</span>

    <span class="n">_tp_tclass_skprop</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span>
        <span class="n">time_periods</span><span class="p">,</span> <span class="n">transit_classes</span><span class="p">,</span> <span class="n">skim_properties</span>
    <span class="p">)</span>
    <span class="n">_tp_tclass_skprop_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">_tp</span><span class="p">,</span> <span class="n">_tclass</span><span class="p">,</span> <span class="n">_skprop</span> <span class="ow">in</span> <span class="n">_tp_tclass_skprop</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_tp</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">_tclass</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">_skprop</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">_desc</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_tp</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">_tclass</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">_skprop</span><span class="o">.</span><span class="n">desc</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scenarios</span><span class="p">[</span><span class="n">_tp</span><span class="p">]</span><span class="o">.</span><span class="n">emmebank</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_name</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_matrix</span><span class="p">:</span>
            <span class="n">_matrix</span> <span class="o">=</span> <span class="n">create_matrix</span><span class="p">(</span>
                <span class="s2">&quot;mf&quot;</span><span class="p">,</span> <span class="n">_name</span><span class="p">,</span> <span class="n">_desc</span><span class="p">,</span> <span class="n">scenario</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scenarios</span><span class="p">[</span><span class="n">_tp</span><span class="p">],</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_matrix</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">_desc</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_skim_matrices</span><span class="p">[</span><span class="n">_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">_matrix</span>
        <span class="n">_tp_tclass_skprop_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_name</span><span class="p">)</span>

    <span class="n">skim_matrices</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">k</span><span class="p">:</span> <span class="n">v</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skim_matrices</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">_tp_tclass_skprop_list</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">skim_matrices</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.network.transit.transit_skim.TransitSkim.mask_above_max_transfers" class="doc doc-heading">
            <code class=" language-python"><span class="n">mask_above_max_transfers</span><span class="p">(</span><span class="n">time_period</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">)</span></code>

<a href="#tm2py.components.network.transit.transit_skim.TransitSkim.mask_above_max_transfers" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Reset skims to 0 if number of transfers is greater than max_transfers.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>time_period</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time period name abbreviation</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>transit_class</code></td>
            <td>
                  <code><span title="_type_">_type_</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><em>description</em></p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/network/transit/transit_skim.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">mask_above_max_transfers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reset skims to 0 if number of transfers is greater than max_transfers.</span>

<span class="sd">    Args:</span>
<span class="sd">        time_period (str): Time period name abbreviation</span>
<span class="sd">        transit_class (_type_): _description_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">max_transfers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_transfers</span>
    <span class="n">xfers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">matrix_cache</span><span class="p">[</span><span class="n">time_period</span><span class="p">]</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span>
        <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">time_period</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">transit_class</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">_XFERS&quot;&#39;</span>
    <span class="p">)</span>
    <span class="n">xfer_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">less_equal</span><span class="p">(</span><span class="n">xfers</span><span class="p">,</span> <span class="n">max_transfers</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_mask_skim_set</span><span class="p">(</span><span class="n">time_period</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">,</span> <span class="n">xfer_mask</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.network.transit.transit_skim.TransitSkim.mask_if_not_required_modes" class="doc doc-heading">
            <code class=" language-python"><span class="n">mask_if_not_required_modes</span><span class="p">(</span><span class="n">time_period</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">)</span></code>

<a href="#tm2py.components.network.transit.transit_skim.TransitSkim.mask_if_not_required_modes" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Enforce the <code>required_mode_combo</code> parameter by setting IVTs to 0 if don&rsquo;t have required modes.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>time_period</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time period name abbreviation</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>transit_class</code></td>
            <td>
                  <code><span title="_type_">_type_</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><em>description</em></p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/network/transit/transit_skim.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">mask_if_not_required_modes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Enforce the `required_mode_combo` parameter by setting IVTs to 0 if don&#39;t have required modes.</span>

<span class="sd">    Args:</span>
<span class="sd">        time_period (str): Time period name abbreviation</span>
<span class="sd">        transit_class (_type_): _description_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">transit_class</span><span class="o">.</span><span class="n">required_mode_combo</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="n">_ivt_skims</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">transit_class</span><span class="o">.</span><span class="n">required_mode_combo</span><span class="p">:</span>
        <span class="n">transit_modes</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">modes</span> <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">mode</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">transit_mode</span> <span class="ow">in</span> <span class="n">transit_modes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_ivt_skims</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">_ivt_skims</span><span class="p">[</span><span class="n">mode</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">matrix_cache</span><span class="p">[</span><span class="n">time_period</span><span class="p">]</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">time_period</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">transit_class</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">transit_mode</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">IVTT&quot;&#39;</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_ivt_skims</span><span class="p">[</span><span class="n">mode</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">matrix_cache</span><span class="p">[</span><span class="n">time_period</span><span class="p">]</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">time_period</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">transit_class</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">transit_mode</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">IVTT&quot;&#39;</span>
                <span class="p">)</span>

    <span class="c1"># multiply all IVT skims together and see if they are greater than zero</span>
    <span class="n">has_all</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">_ivt_skims</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">has_all</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">has_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">has_all</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">has_all</span> <span class="o">=</span> <span class="n">value</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_mask_skim_set</span><span class="p">(</span><span class="n">time_period</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">,</span> <span class="n">has_all</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.network.transit.transit_skim.TransitSkim.run" class="doc doc-heading">
            <code class=" language-python"><span class="n">run</span><span class="p">()</span></code>

<a href="#tm2py.components.network.transit.transit_skim.TransitSkim.run" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Run transit skims.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/network/transit/transit_skim.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@LogStartEnd</span><span class="p">(</span><span class="s2">&quot;Transit skims&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run transit skims.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">emmebank_skim_matrices</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">skim_properties</span>
    <span class="p">)</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log_start_end</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;period transit skims&quot;</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">_time_period</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">logbook_trace</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Transit skims for period </span><span class="si">{</span><span class="n">_time_period</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">):</span>
                <span class="k">for</span> <span class="n">_transit_class</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">run_skim_set</span><span class="p">(</span><span class="n">_time_period</span><span class="p">,</span> <span class="n">_transit_class</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_export_skims</span><span class="p">(</span><span class="n">_time_period</span><span class="p">,</span> <span class="n">_transit_class</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug_enabled</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_log_debug_report</span><span class="p">(</span><span class="n">_time_period</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.network.transit.transit_skim.TransitSkim.run_skim_set" class="doc doc-heading">
            <code class=" language-python"><span class="n">run_skim_set</span><span class="p">(</span><span class="n">time_period</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">)</span></code>

<a href="#tm2py.components.network.transit.transit_skim.TransitSkim.run_skim_set" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Run the transit skim calculations for a given time period and assignment class.</p>
<p>Results are stored in transit emmebank.</p>


<details class="steps" open>
  <summary>Steps</summary>
  <ol>
<li>determine if using transit capacity constraint</li>
<li>skim walk, wait time, boardings, and fares</li>
<li>skim in vehicle time by mode</li>
<li>mask transfers above max amount</li>
<li>mask if doesn&rsquo;t have required modes</li>
</ol>
</details>
            <details class="quote">
              <summary>Source code in <code>tm2py/components/network/transit/transit_skim.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_skim_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run the transit skim calculations for a given time period and assignment class.</span>

<span class="sd">    Results are stored in transit emmebank.</span>

<span class="sd">    Steps:</span>
<span class="sd">        1. determine if using transit capacity constraint</span>
<span class="sd">        2. skim walk, wait time, boardings, and fares</span>
<span class="sd">        3. skim in vehicle time by mode</span>
<span class="sd">        4. mask transfers above max amount</span>
<span class="sd">        5. mask if doesn&#39;t have required modes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">use_ccr</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">congested_transit_assignment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">congested_transit_assignment</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">iteration</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">use_ccr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">use_ccr</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">logbook_trace</span><span class="p">(</span>
        <span class="s2">&quot;First and total wait time, number of boardings, &quot;</span>
        <span class="s2">&quot;fares, and total and transfer walk time&quot;</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skim_walk_wait_boards_fares</span><span class="p">(</span><span class="n">time_period</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">)</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">logbook_trace</span><span class="p">(</span><span class="s2">&quot;In-vehicle time by mode&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skim_invehicle_time_by_mode</span><span class="p">(</span><span class="n">time_period</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">,</span> <span class="n">use_ccr</span><span class="p">)</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">logbook_trace</span><span class="p">(</span>
        <span class="s2">&quot;Drive distance and time&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Walk auxiliary time, walk access time and walk egress time&quot;</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skim_drive_walk</span><span class="p">(</span><span class="n">time_period</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">)</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">logbook_trace</span><span class="p">(</span><span class="s2">&quot;Calculate crowding&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skim_crowding</span><span class="p">(</span><span class="n">time_period</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">use_ccr</span><span class="p">:</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">logbook_trace</span><span class="p">(</span><span class="s2">&quot;CCR related skims&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">skim_reliability_crowding_capacity</span><span class="p">(</span><span class="n">time_period</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.network.transit.transit_skim.TransitSkim.skim_crowding" class="doc doc-heading">
            <code class=" language-python"><span class="n">skim_crowding</span><span class="p">(</span><span class="n">time_period</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">)</span></code>

<a href="#tm2py.components.network.transit.transit_skim.TransitSkim.skim_crowding" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      

            <details class="quote">
              <summary>Source code in <code>tm2py/components/network/transit/transit_skim.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">skim_crowding</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
    <span class="c1"># Crowding penalty</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_run_strategy_analysis</span><span class="p">(</span>
        <span class="n">time_period</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;in_vehicle&quot;</span><span class="p">:</span> <span class="s2">&quot;@ccost&quot;</span><span class="p">},</span> <span class="s2">&quot;CROWD&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.network.transit.transit_skim.TransitSkim.skim_drive_walk" class="doc doc-heading">
            <code class=" language-python"><span class="n">skim_drive_walk</span><span class="p">(</span><span class="n">time_period</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">)</span></code>

<a href="#tm2py.components.network.transit.transit_skim.TransitSkim.skim_drive_walk" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      

            <details class="quote">
              <summary>Source code in <code>tm2py/components/network/transit/transit_skim.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">skim_drive_walk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
    <span class="n">_tp_tclass</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time_period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">transit_class</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="c1"># _network = self.networks[time_period]</span>

    <span class="c1"># drive time here is perception factor*(drive time + toll penalty),</span>
    <span class="c1"># will calculate the actual drive time and substract toll penalty in the following steps</span>
    <span class="n">spec1</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;EXTENDED_TRANSIT_MATRIX_RESULTS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;by_mode_subset&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;modes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;D&quot;</span><span class="p">],</span>
            <span class="s2">&quot;actual_aux_transit_times&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_DTIME&quot;&#39;</span><span class="p">,</span>
            <span class="s2">&quot;distance&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_DDIST&quot;&#39;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>
    <span class="c1"># skim walk distance in walk time matrices first,</span>
    <span class="c1"># will calculate the actual walk time and overwrite the distance in the following steps</span>
    <span class="n">spec2</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;EXTENDED_TRANSIT_MATRIX_RESULTS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;by_mode_subset&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;modes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;w&quot;</span><span class="p">],</span>
            <span class="s2">&quot;distance&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_WAUX&quot;&#39;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>
    <span class="n">spec3</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;EXTENDED_TRANSIT_MATRIX_RESULTS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;by_mode_subset&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;modes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">],</span>
            <span class="s2">&quot;distance&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_WACC&quot;&#39;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>
    <span class="n">spec4</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;EXTENDED_TRANSIT_MATRIX_RESULTS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;by_mode_subset&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;modes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;e&quot;</span><span class="p">],</span>
            <span class="s2">&quot;distance&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_WEGR&quot;&#39;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="n">transit_class</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;WLK_TRN_WLK&#39;</span><span class="p">]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">matrix_results</span><span class="p">(</span>
            <span class="n">spec1</span><span class="p">,</span>
            <span class="n">class_name</span><span class="o">=</span><span class="n">transit_class</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">scenario</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scenarios</span><span class="p">[</span><span class="n">time_period</span><span class="p">],</span>
            <span class="n">num_processors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_processors</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">matrix_results</span><span class="p">(</span>
        <span class="n">spec2</span><span class="p">,</span>
        <span class="n">class_name</span><span class="o">=</span><span class="n">transit_class</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="n">scenario</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scenarios</span><span class="p">[</span><span class="n">time_period</span><span class="p">],</span>
        <span class="n">num_processors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_processors</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">transit_class</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;PNR_TRN_WLK&#39;</span><span class="p">,</span><span class="s1">&#39;KNR_TRN_WLK&#39;</span><span class="p">]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">matrix_results</span><span class="p">(</span>
            <span class="n">spec3</span><span class="p">,</span>
            <span class="n">class_name</span><span class="o">=</span><span class="n">transit_class</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">scenario</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scenarios</span><span class="p">[</span><span class="n">time_period</span><span class="p">],</span>
            <span class="n">num_processors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_processors</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">transit_class</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;WLK_TRN_PNR&#39;</span><span class="p">,</span><span class="s1">&#39;WLK_TRN_KNR&#39;</span><span class="p">]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">matrix_results</span><span class="p">(</span>
            <span class="n">spec4</span><span class="p">,</span>
            <span class="n">class_name</span><span class="o">=</span><span class="n">transit_class</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">scenario</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scenarios</span><span class="p">[</span><span class="n">time_period</span><span class="p">],</span>
            <span class="n">num_processors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_processors</span><span class="p">,</span>
        <span class="p">)</span>


    <span class="n">drive_perception_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">drive_perception_factor</span>
    <span class="n">walk_speed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">walk_speed</span>
    <span class="n">vot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">value_of_time</span>
    <span class="c1"># divide drive time by mode specific perception factor to get the actual time</span>
    <span class="c1"># for walk time, use walk distance/walk speed</span>
    <span class="c1"># because the mode specific perception factors are hardcoded in the mode definition</span>
    <span class="n">spec_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;MATRIX_CALCULATION&quot;</span><span class="p">,</span>
            <span class="s2">&quot;constraint&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_DTIME&quot;&#39;</span><span class="p">,</span>
            <span class="s2">&quot;expression&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_DTIME&quot;/</span><span class="si">{</span><span class="n">drive_perception_factor</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;MATRIX_CALCULATION&quot;</span><span class="p">,</span>
            <span class="s2">&quot;constraint&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_DTIME&quot;&#39;</span><span class="p">,</span>
            <span class="s2">&quot;expression&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_DTIME&quot;&#39;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;MATRIX_CALCULATION&quot;</span><span class="p">,</span>
            <span class="s2">&quot;constraint&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_WAUX&quot;&#39;</span><span class="p">,</span>
            <span class="s2">&quot;expression&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_WAUX&quot;/(</span><span class="si">{</span><span class="n">walk_speed</span><span class="si">}</span><span class="s1">/60)&#39;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;MATRIX_CALCULATION&quot;</span><span class="p">,</span>
            <span class="s2">&quot;constraint&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_WACC&quot;&#39;</span><span class="p">,</span>
            <span class="s2">&quot;expression&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_WACC&quot;/(</span><span class="si">{</span><span class="n">walk_speed</span><span class="si">}</span><span class="s1">/60)&#39;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;MATRIX_CALCULATION&quot;</span><span class="p">,</span>
            <span class="s2">&quot;constraint&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_WEGR&quot;&#39;</span><span class="p">,</span>
            <span class="s2">&quot;expression&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_WEGR&quot;/(</span><span class="si">{</span><span class="n">walk_speed</span><span class="si">}</span><span class="s1">/60)&#39;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">matrix_calculator</span><span class="p">(</span>
        <span class="n">spec_list</span><span class="p">,</span>
        <span class="n">scenario</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scenarios</span><span class="p">[</span><span class="n">time_period</span><span class="p">],</span>
        <span class="n">num_processors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_processors</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.network.transit.transit_skim.TransitSkim.skim_invehicle_time_by_mode" class="doc doc-heading">
            <code class=" language-python"><span class="n">skim_invehicle_time_by_mode</span><span class="p">(</span><span class="n">time_period</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">,</span> <span class="n">use_ccr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#tm2py.components.network.transit.transit_skim.TransitSkim.skim_invehicle_time_by_mode" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Skim in-vehicle by mode for a time period and transit class and store results in Emmebank.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>time_period</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>time period abbreviation</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>transit_class</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>transit class name</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>use_ccr</code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if True, will use crowding, capacity, and reliability (ccr).
Defaults to False</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/network/transit/transit_skim.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">skim_invehicle_time_by_mode</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">use_ccr</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Skim in-vehicle by mode for a time period and transit class and store results in Emmebank.</span>

<span class="sd">    Args:</span>
<span class="sd">        time_period (str): time period abbreviation</span>
<span class="sd">        transit_class (str): transit class name</span>
<span class="sd">        use_ccr (bool): if True, will use crowding, capacity, and reliability (ccr).</span>
<span class="sd">            Defaults to False</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mode_combinations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_emme_mode_ids</span><span class="p">(</span><span class="n">transit_class</span><span class="p">,</span> <span class="n">time_period</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">use_ccr</span><span class="p">:</span>
        <span class="n">total_ivtt_expr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_invehicle_time_by_mode_ccr</span><span class="p">(</span>
            <span class="n">time_period</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">,</span> <span class="n">mode_combinations</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">total_ivtt_expr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_invehicle_time_by_mode_no_ccr</span><span class="p">(</span>
            <span class="n">time_period</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">,</span> <span class="n">mode_combinations</span>
        <span class="p">)</span>
    <span class="c1"># sum total ivtt across all modes</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_calc_total_ivt</span><span class="p">(</span><span class="n">time_period</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">,</span> <span class="n">total_ivtt_expr</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.network.transit.transit_skim.TransitSkim.skim_penalty_toll" class="doc doc-heading">
            <code class=" language-python"><span class="n">skim_penalty_toll</span><span class="p">(</span><span class="n">time_period</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">)</span></code>

<a href="#tm2py.components.network.transit.transit_skim.TransitSkim.skim_penalty_toll" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      

            <details class="quote">
              <summary>Source code in <code>tm2py/components/network/transit/transit_skim.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">skim_penalty_toll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
    <span class="c1"># transfer boarding time penalty</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_run_strategy_analysis</span><span class="p">(</span>
        <span class="n">time_period</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;boarding&quot;</span><span class="p">:</span> <span class="s2">&quot;@xboard_nodepen&quot;</span><span class="p">},</span> <span class="s2">&quot;XBOATIME&quot;</span>
    <span class="p">)</span>

    <span class="n">_tp_tclass</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time_period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">transit_class</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;PNR_TRN_WLK&quot;</span> <span class="ow">in</span> <span class="n">_tp_tclass</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s2">&quot;WLK_TRN_PNR&quot;</span> <span class="ow">in</span> <span class="n">_tp_tclass</span><span class="p">):</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="p">{</span>  <span class="c1"># subtract PNR boarding from total transfer boarding time penalty</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;MATRIX_CALCULATION&quot;</span><span class="p">,</span>
            <span class="s2">&quot;constraint&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;by_value&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;od_values&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_XBOATIME&quot;&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;interval_min&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="s2">&quot;interval_max&quot;</span><span class="p">:</span> <span class="mi">9999999</span><span class="p">,</span>
                    <span class="s2">&quot;condition&quot;</span><span class="p">:</span> <span class="s2">&quot;INCLUDE&quot;</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_XBOATIME&quot;&#39;</span><span class="p">,</span>
            <span class="s2">&quot;expression&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;(mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_XBOATIME&quot; - 1).max.0&#39;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">matrix_calculator</span><span class="p">(</span>
            <span class="n">spec</span><span class="p">,</span>
            <span class="n">scenario</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scenarios</span><span class="p">[</span><span class="n">time_period</span><span class="p">],</span>
            <span class="n">num_processors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_processors</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># drive toll</span>
    <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;PNR_TRN_WLK&quot;</span> <span class="ow">in</span> <span class="n">_tp_tclass</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s2">&quot;KNR_TRN_WLK&quot;</span> <span class="ow">in</span> <span class="n">_tp_tclass</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_run_path_analysis</span><span class="p">(</span>
            <span class="n">time_period</span><span class="p">,</span>
            <span class="n">transit_class</span><span class="p">,</span>
            <span class="s2">&quot;ORIGIN_TO_INITIAL_BOARDING&quot;</span><span class="p">,</span>
            <span class="p">{</span><span class="s2">&quot;aux_transit&quot;</span><span class="p">:</span> <span class="s2">&quot;@drive_toll&quot;</span><span class="p">},</span>
            <span class="s2">&quot;DTOLL&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="s2">&quot;WLK_TRN_PNR&quot;</span> <span class="ow">in</span> <span class="n">_tp_tclass</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s2">&quot;WLK_TRN_KNR&quot;</span> <span class="ow">in</span> <span class="n">_tp_tclass</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_run_path_analysis</span><span class="p">(</span>
            <span class="n">time_period</span><span class="p">,</span>
            <span class="n">transit_class</span><span class="p">,</span>
            <span class="s2">&quot;FINAL_ALIGHTING_TO_DESTINATION&quot;</span><span class="p">,</span>
            <span class="p">{</span><span class="s2">&quot;aux_transit&quot;</span><span class="p">:</span> <span class="s2">&quot;@drive_toll&quot;</span><span class="p">},</span>
            <span class="s2">&quot;DTOLL&quot;</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.network.transit.transit_skim.TransitSkim.skim_reliability_crowding_capacity" class="doc doc-heading">
            <code class=" language-python"><span class="n">skim_reliability_crowding_capacity</span><span class="p">(</span><span class="n">time_period</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">)</span></code>

<a href="#tm2py.components.network.transit.transit_skim.TransitSkim.skim_reliability_crowding_capacity" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Generate skim results for CCR assignment and stores results in Emmebank.</p>
<p>Generates the following:
1. Link Unreliability: LINKREL
2. Crowding penalty: CROWD
3. Extra added wait time: EAWT
4. Capacity penalty: CAPPEN</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>time_period</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>time period abbreviation</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>transit_class</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>transit class</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/network/transit/transit_skim.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">skim_reliability_crowding_capacity</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">transit_class</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate skim results for CCR assignment and stores results in Emmebank.</span>

<span class="sd">    Generates the following:</span>
<span class="sd">    1. Link Unreliability: LINKREL</span>
<span class="sd">    2. Crowding penalty: CROWD</span>
<span class="sd">    3. Extra added wait time: EAWT</span>
<span class="sd">    4. Capacity penalty: CAPPEN</span>

<span class="sd">    Args:</span>
<span class="sd">        time_period (str): time period abbreviation</span>
<span class="sd">        transit_class: transit class</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Link unreliability</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_run_strategy_analysis</span><span class="p">(</span>
        <span class="n">time_period</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;in_vehicle&quot;</span><span class="p">:</span> <span class="s2">&quot;ul1&quot;</span><span class="p">},</span> <span class="s2">&quot;LINKREL&quot;</span>
    <span class="p">)</span>
    <span class="c1"># Crowding penalty</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_run_strategy_analysis</span><span class="p">(</span>
        <span class="n">time_period</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;in_vehicle&quot;</span><span class="p">:</span> <span class="s2">&quot;@ccost&quot;</span><span class="p">},</span> <span class="s2">&quot;CROWD&quot;</span>
    <span class="p">)</span>
    <span class="c1"># skim node reliability, extra added wait time (EAWT)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_run_strategy_analysis</span><span class="p">(</span>
        <span class="n">time_period</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;boarding&quot;</span><span class="p">:</span> <span class="s2">&quot;@eawt&quot;</span><span class="p">},</span> <span class="s2">&quot;EAWT&quot;</span>
    <span class="p">)</span>
    <span class="c1"># skim capacity penalty</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_run_strategy_analysis</span><span class="p">(</span>
        <span class="n">time_period</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;boarding&quot;</span><span class="p">:</span> <span class="s2">&quot;@capacity_penalty&quot;</span><span class="p">},</span> <span class="s2">&quot;CAPPEN&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.network.transit.transit_skim.TransitSkim.skim_walk_wait_boards_fares" class="doc doc-heading">
            <code class=" language-python"><span class="n">skim_walk_wait_boards_fares</span><span class="p">(</span><span class="n">time_period</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">)</span></code>

<a href="#tm2py.components.network.transit.transit_skim.TransitSkim.skim_walk_wait_boards_fares" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Skim wait, walk, board, and fares for a given time period and transit assignment class.</p>
<p>Skim the first and total wait time, number of boardings, (transfers + 1)
fares, total walk time, total in-vehicle time.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/network/transit/transit_skim.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">skim_walk_wait_boards_fares</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">transit_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Skim wait, walk, board, and fares for a given time period and transit assignment class.</span>

<span class="sd">    Skim the first and total wait time, number of boardings, (transfers + 1)</span>
<span class="sd">    fares, total walk time, total in-vehicle time.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_tp_tclass</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time_period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">transit_class</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">_network</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">time_period</span><span class="p">]</span>
    <span class="n">_transit_mode_ids</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">m</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">_network</span><span class="o">.</span><span class="n">modes</span><span class="p">()</span> <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;TRANSIT&quot;</span><span class="p">,</span> <span class="s2">&quot;AUX_TRANSIT&quot;</span><span class="p">]</span>
    <span class="p">]</span>
    <span class="n">spec</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;EXTENDED_TRANSIT_MATRIX_RESULTS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;actual_first_waiting_times&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_IWAIT&quot;&#39;</span><span class="p">,</span>
        <span class="s2">&quot;actual_total_waiting_times&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_WAIT&quot;&#39;</span><span class="p">,</span>
        <span class="s2">&quot;by_mode_subset&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;modes&quot;</span><span class="p">:</span> <span class="n">_transit_mode_ids</span><span class="p">,</span>
            <span class="s2">&quot;avg_boardings&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_BOARDS&quot;&#39;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">use_fares</span><span class="p">:</span>
        <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;by_mode_subset&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;actual_in_vehicle_costs&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_IN_VEHICLE_COST&quot;&#39;</span><span class="p">,</span>
                <span class="s2">&quot;actual_total_boarding_costs&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">_tp_tclass</span><span class="si">}</span><span class="s1">_FARE&quot;&#39;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">matrix_results</span><span class="p">(</span>
        <span class="n">spec</span><span class="p">,</span>
        <span class="n">class_name</span><span class="o">=</span><span class="n">transit_class</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="n">scenario</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scenarios</span><span class="p">[</span><span class="n">time_period</span><span class="p">],</span>
        <span class="n">num_processors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_processors</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_calc_xfer_wait</span><span class="p">(</span><span class="n">time_period</span><span class="p">,</span> <span class="n">transit_class</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_calc_boardings</span><span class="p">(</span><span class="n">time_period</span><span class="p">,</span> <span class="n">transit_class</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">use_fares</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_calc_fares</span><span class="p">(</span><span class="n">time_period</span><span class="p">,</span> <span class="n">transit_class</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.components.network.transit.transit_skim.TransitSkim.validate_inputs" class="doc doc-heading">
            <code class=" language-python"><span class="n">validate_inputs</span><span class="p">()</span></code>

<a href="#tm2py.components.network.transit.transit_skim.TransitSkim.validate_inputs" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Validate inputs.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/components/network/transit/transit_skim.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate inputs.&quot;&quot;&quot;</span>
    <span class="c1"># TODO add input validation</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<a id="tm2py.config.TransitModeConfig"></a>
    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Transit mode definition (see also mode in the Emme API).</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TransitModeConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Transit mode definition (see also mode in the Emme API).&quot;&quot;&quot;</span>

    <span class="nb">type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span>
        <span class="s2">&quot;WALK&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ACCESS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;EGRESS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;LOCAL&quot;</span><span class="p">,</span>
        <span class="s2">&quot;PREMIUM&quot;</span><span class="p">,</span>
        <span class="s2">&quot;DRIVE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;PNR_dummy&quot;</span><span class="p">,</span>
        <span class="s2">&quot;KNR_dummy&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">assign_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;TRANSIT&quot;</span><span class="p">,</span> <span class="s2">&quot;AUX_TRANSIT&quot;</span><span class="p">]</span>
    <span class="n">mode_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">in_vehicle_perception_factor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">speed_or_time_factor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">initial_boarding_penalty</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">transfer_boarding_penalty</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">headway_fraction</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">transfer_wait_perception_factor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">eawt_factor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;in_vehicle_perception_factor&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">in_vehicle_perception_factor_valid</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate in_vehicle_perception_factor exists if assign_type is TRANSIT.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;assign_type&quot;</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assign_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;TRANSIT&quot;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;must be specified when assign_type==TRANSIT&quot;</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;speed_or_time_factor&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">speed_or_time_factor_valid</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate speed_or_time_factor exists if assign_type is AUX_TRANSIT.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;assign_type&quot;</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assign_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;AUX_TRANSIT&quot;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;must be specified when assign_type==AUX_TRANSIT&quot;</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;initial_boarding_penalty&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">initial_boarding_penalty_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate initial_boarding_penalty exists if assign_type is TRANSIT.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;assign_type&quot;</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assign_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;TRANSIT&quot;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;must be specified when assign_type==TRANSIT&quot;</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;transfer_boarding_penalty&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">transfer_boarding_penalty_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate transfer_boarding_penalty exists if assign_type is TRANSIT.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;assign_type&quot;</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assign_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;TRANSIT&quot;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;must be specified when assign_type==TRANSIT&quot;</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;headway_fraction&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">headway_fraction_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate headway_fraction exists if assign_type is TRANSIT.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;assign_type&quot;</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assign_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;TRANSIT&quot;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;must be specified when assign_type==TRANSIT&quot;</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;transfer_wait_perception_factor&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">transfer_wait_perception_factor_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate transfer_wait_perception_factor exists if assign_type is TRANSIT.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;assign_type&quot;</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assign_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;TRANSIT&quot;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;must be specified when assign_type==TRANSIT&quot;</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@classmethod</span>
    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;mode_id&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">mode_id_valid</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate mode_id.&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;mode_id must be one character&quot;</span>
        <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="tm2py.config.TransitModeConfig.headway_fraction_valid" class="doc doc-heading">
            <code class=" language-python"><span class="n">headway_fraction_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>

<a href="#tm2py.config.TransitModeConfig.headway_fraction_valid" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">

      <p>Validate headway_fraction exists if assign_type is TRANSIT.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/config.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;headway_fraction&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">headway_fraction_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate headway_fraction exists if assign_type is TRANSIT.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;assign_type&quot;</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assign_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;TRANSIT&quot;</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;must be specified when assign_type==TRANSIT&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tm2py.config.TransitModeConfig.in_vehicle_perception_factor_valid" class="doc doc-heading">
            <code class=" language-python"><span class="n">in_vehicle_perception_factor_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>

<a href="#tm2py.config.TransitModeConfig.in_vehicle_perception_factor_valid" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">

      <p>Validate in_vehicle_perception_factor exists if assign_type is TRANSIT.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/config.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;in_vehicle_perception_factor&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">in_vehicle_perception_factor_valid</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate in_vehicle_perception_factor exists if assign_type is TRANSIT.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;assign_type&quot;</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assign_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;TRANSIT&quot;</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;must be specified when assign_type==TRANSIT&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tm2py.config.TransitModeConfig.initial_boarding_penalty_valid" class="doc doc-heading">
            <code class=" language-python"><span class="n">initial_boarding_penalty_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>

<a href="#tm2py.config.TransitModeConfig.initial_boarding_penalty_valid" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">

      <p>Validate initial_boarding_penalty exists if assign_type is TRANSIT.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/config.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;initial_boarding_penalty&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">initial_boarding_penalty_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate initial_boarding_penalty exists if assign_type is TRANSIT.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;assign_type&quot;</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assign_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;TRANSIT&quot;</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;must be specified when assign_type==TRANSIT&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tm2py.config.TransitModeConfig.mode_id_valid" class="doc doc-heading">
            <code class=" language-python"><span class="n">mode_id_valid</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#tm2py.config.TransitModeConfig.mode_id_valid" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">

      <p>Validate mode_id.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/config.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;mode_id&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">mode_id_valid</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate mode_id.&quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;mode_id must be one character&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tm2py.config.TransitModeConfig.speed_or_time_factor_valid" class="doc doc-heading">
            <code class=" language-python"><span class="n">speed_or_time_factor_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>

<a href="#tm2py.config.TransitModeConfig.speed_or_time_factor_valid" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">

      <p>Validate speed_or_time_factor exists if assign_type is AUX_TRANSIT.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/config.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;speed_or_time_factor&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">speed_or_time_factor_valid</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate speed_or_time_factor exists if assign_type is AUX_TRANSIT.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;assign_type&quot;</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assign_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;AUX_TRANSIT&quot;</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;must be specified when assign_type==AUX_TRANSIT&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tm2py.config.TransitModeConfig.transfer_boarding_penalty_valid" class="doc doc-heading">
            <code class=" language-python"><span class="n">transfer_boarding_penalty_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>

<a href="#tm2py.config.TransitModeConfig.transfer_boarding_penalty_valid" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">

      <p>Validate transfer_boarding_penalty exists if assign_type is TRANSIT.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/config.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;transfer_boarding_penalty&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">transfer_boarding_penalty_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate transfer_boarding_penalty exists if assign_type is TRANSIT.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;assign_type&quot;</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assign_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;TRANSIT&quot;</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;must be specified when assign_type==TRANSIT&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tm2py.config.TransitModeConfig.transfer_wait_perception_factor_valid" class="doc doc-heading">
            <code class=" language-python"><span class="n">transfer_wait_perception_factor_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>

<a href="#tm2py.config.TransitModeConfig.transfer_wait_perception_factor_valid" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">

      <p>Validate transfer_wait_perception_factor exists if assign_type is TRANSIT.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/config.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;transfer_wait_perception_factor&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">transfer_wait_perception_factor_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate transfer_wait_perception_factor exists if assign_type is TRANSIT.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;assign_type&quot;</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assign_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;TRANSIT&quot;</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;must be specified when assign_type==TRANSIT&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<a id="tm2py.config.TransitConfig"></a>
    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Transit assignment parameters.</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TransitConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Transit assignment parameters.&quot;&quot;&quot;</span>

    <span class="n">modes</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">TransitModeConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
    <span class="n">classes</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">TransitClassConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
    <span class="n">journey_levels</span><span class="p">:</span> <span class="n">TransitJourneyLevelsConfig</span>
    <span class="n">apply_msa_demand</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">value_of_time</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">walk_speed</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">transit_speed</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">effective_headway_source</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">initial_wait_perception_factor</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">transfer_wait_perception_factor</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">walk_perception_factor</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">walk_perception_factor</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">walk_perception_factor_cbd</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">drive_perception_factor</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">max_transfers</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">use_fares</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">fare_2015_to_2000_deflator</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">fares_path</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">fare_matrix_path</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">fare_max_transfer_distance_miles</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">override_connector_times</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">use_ccr</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">ccr_stop_criteria</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AssignmentStoppingCriteriaConfig</span><span class="p">]</span>
    <span class="n">ccr_weights</span><span class="p">:</span> <span class="n">CcrWeightsConfig</span>
    <span class="n">eawt_weights</span><span class="p">:</span> <span class="n">EawtWeightsConfig</span>
    <span class="n">congested_transit_assignment</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">congested</span><span class="p">:</span> <span class="n">CongestedAssnConfig</span>
    <span class="n">congested_weights</span><span class="p">:</span> <span class="n">CongestedWeightsConfig</span>
    <span class="n">output_skim_path</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">output_skim_filename_tmpl</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">output_skim_matrixname_tmpl</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">output_stop_usage_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">output_transit_boardings_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">output_transit_segment_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">output_station_to_station_flow_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">output_transfer_at_station_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">timed_transfer_nodes</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">output_transfer_at_station_node_ids</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">max_ccr_iterations</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">split_connectors_to_prevent_walk</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">input_connector_access_times_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">input_connector_egress_times_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">vehicles</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TransitVehicleConfig</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="n">TransitVehicleConfig</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div><h3 id="active-network-components">Active Network Components<a class="headerlink" href="#active-network-components" title="Permanent link"> </a></h3>
<p>To come.</p>
<h2 id="emme-wrappers">Emme Wrappers<a class="headerlink" href="#emme-wrappers" title="Permanent link"> </a></h2>


<div class="doc doc-object doc-module">



<a id="tm2py.emme"></a>
    <div class="doc doc-contents first">

      <p>Emme components module.</p>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<a id="tm2py.config.EmmeConfig"></a>
    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ConfigItem (tm2py.config.ConfigItem)" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>


      <p>Emme-specific parameters.</p>


<details class="properties" open>
  <summary>Properties</summary>
  
</details>
              <details class="quote">
                <summary>Source code in <code>tm2py/config.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">EmmeConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Emme-specific parameters.</span>

<span class="sd">    Properties:</span>
<span class="sd">        all_day_scenario_id: scenario ID to use for all day</span>
<span class="sd">            (initial imported) scenario with all time period data</span>
<span class="sd">        project_path: relative path from run_dir to Emme desktop project (.emp)</span>
<span class="sd">        highway_database_path: relative path to highway Emmebank</span>
<span class="sd">        active_north_database_path:  relative paths to active mode Emmebank for north bay</span>
<span class="sd">        active_south_database_path:  relative paths to active mode Emmebank for south bay</span>
<span class="sd">        transit_database_path: relative path to transit Emmebank</span>
<span class="sd">        num_processors: the number of processors to use in Emme procedures,</span>
<span class="sd">            either as an integer, or value MAX, MAX-N. Typically recommend</span>
<span class="sd">            using MAX-1 (on desktop systems) or MAX-2 (on servers with many</span>
<span class="sd">            logical processors) to leave capacity for background / other tasks.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">all_day_scenario_id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">project_path</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">highway_database_path</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">active_north_database_path</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">active_south_database_path</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">transit_database_path</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">num_processors</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;^MAX$|^MAX-\d+$|^\d+$|^MAX/\d+$&quot;</span><span class="p">)</span>
    <span class="n">num_processors_transit_skim</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;^MAX$|^MAX-\d+$|^\d+$|^MAX/\d+$&quot;</span><span class="p">)</span>
    <span class="n">highway_distribution</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">HighwayDistribution</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div><h2 id="errata">Errata<a class="headerlink" href="#errata" title="Permanent link"> </a></h2>


<div class="doc doc-object doc-module">



<a id="tm2py.logger"></a>
    <div class="doc doc-contents first">

      <p>Logging module.</p>
<p>Note the general definition of logging levels as used in tm2py:</p>


<details class="trace" open>
  <summary>highly detailed level information which would rarely be of interest</summary>
  <p>except for detailed debugging by a developer</p>
</details>      



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="tm2py.logger.BaseLogger" class="doc doc-heading">
            <code>BaseLogger</code>


<a href="#tm2py.logger.BaseLogger" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">


      <p>Base class for logging. Not to be constructed directly.</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/logger.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BaseLogger</span><span class="p">:</span>
    <span class="s2">&quot;Base class for logging. Not to be constructed directly.&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log_formatters</span><span class="p">,</span> <span class="n">log_cache_file</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_indentation</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_cache</span> <span class="o">=</span> <span class="n">LogCache</span><span class="p">(</span><span class="n">log_cache_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_formatters</span> <span class="o">=</span> <span class="n">log_formatters</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_log_cache</span><span class="p">]</span>

        <span class="c1"># these will be set later via set_emme_manager()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_emme_manager</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_use_emme_logbook</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">for</span> <span class="n">log_formatter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_formatters</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">log_formatter</span><span class="p">,</span> <span class="s2">&quot;open&quot;</span><span class="p">):</span>
                <span class="n">log_formatter</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">set_emme_manager</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">emme_manager</span><span class="p">:</span> <span class="n">EmmeManagerLight</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">use_emme_logbook</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">has_emme</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_emme_manager</span> <span class="o">=</span> <span class="n">emme_manager</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_use_emme_logbook</span> <span class="o">=</span> <span class="n">emme_manager</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Destructor for logger object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_formatters</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">log_formatter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_formatters</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">log_formatter</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">):</span>
                    <span class="n">log_formatter</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="n">LogLevel</span> <span class="o">=</span> <span class="s2">&quot;INFO&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Log text to file and display depending upon log level and config.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): text to log</span>
<span class="sd">            level (str): logging level</span>
<span class="sd">            indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">-%b-%Y (%H:%M:%S) &quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">log_formatter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_formatters</span><span class="p">:</span>
            <span class="n">log_formatter</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">LEVELS_STR_TO_INT</span><span class="p">[</span><span class="n">level</span><span class="p">],</span> <span class="n">indent</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_emme_logbook</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_emme_manager</span><span class="o">.</span><span class="n">logbook_write</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Log text with level=TRACE.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): text to log</span>
<span class="sd">            indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;TRACE&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">debug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Log text with level=DEBUG.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): text to log</span>
<span class="sd">            indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">detail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Log text with level=DETAIL.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): text to log</span>
<span class="sd">            indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;DETAIL&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Log text with level=INFO.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): text to log</span>
<span class="sd">            indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;INFO&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Log text with level=STATUS.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): text to log</span>
<span class="sd">            indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;STATUS&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">warn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Log text with level=WARN.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): text to log</span>
<span class="sd">            indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;WARN&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Log text with level=ERROR.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): text to log</span>
<span class="sd">            indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;ERROR&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">fatal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Log text with level=FATAL.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): text to log</span>
<span class="sd">            indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;FATAL&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">log_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Log message with timestamp&quot;&quot;&quot;</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">-%b-%Y (%H:%M:%S)&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">indent</span><span class="p">:</span>
            <span class="n">indent</span> <span class="o">=</span> <span class="s2">&quot;  &quot;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indentation</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">indent</span><span class="si">}{</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_log_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="n">LogLevel</span> <span class="o">=</span> <span class="s2">&quot;INFO&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Log message with timestamp and &#39;Start&#39;.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): message text</span>
<span class="sd">            level (str): logging level</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Start </span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">log_formatter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_formatters</span><span class="p">:</span>
            <span class="n">log_formatter</span><span class="o">.</span><span class="n">increase_indent</span><span class="p">(</span><span class="n">LEVELS_STR_TO_INT</span><span class="p">[</span><span class="n">level</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_log_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="n">LogLevel</span> <span class="o">=</span> <span class="s2">&quot;INFO&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Log message with timestamp and &#39;End&#39;.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): message text</span>
<span class="sd">            level (str): logging level</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">log_formatter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_formatters</span><span class="p">:</span>
            <span class="n">log_formatter</span><span class="o">.</span><span class="n">decrease_indent</span><span class="p">(</span><span class="n">LEVELS_STR_TO_INT</span><span class="p">[</span><span class="n">level</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;End </span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@_context</span>
    <span class="k">def</span> <span class="nf">log_start_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="n">LogLevel</span> <span class="o">=</span> <span class="s2">&quot;STATUS&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Use with &#39;with&#39; statement to log the start and end time with message.</span>

<span class="sd">        If using the Emme logbook (config.logging.use_emme_logbook is True), will</span>
<span class="sd">        also create a logbook nest in the tree view using logbook_trace.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): message text</span>
<span class="sd">            level (str): logging level</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skip_emme_logging</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_start</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_emme_logbook</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emme_manager</span><span class="o">.</span><span class="n">logbook_trace</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
                <span class="k">yield</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">yield</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skip_emme_logging</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_end</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">log_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mapping</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="n">LogLevel</span> <span class="o">=</span> <span class="s2">&quot;DEBUG&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Format dictionary to string and log as text.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">pformat</span><span class="p">(</span><span class="n">mapping</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">120</span><span class="p">),</span> <span class="n">level</span><span class="p">)</span>

    <span class="nd">@_context</span>
    <span class="k">def</span> <span class="nf">_skip_emme_logging</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Temporary disable Emme logging (if enabled) and restore on exit.</span>

<span class="sd">        Intended use is with the log_start_end context and LogStartEnd decorator</span>
<span class="sd">        to allow use of the Emme context without double logging of the</span>
<span class="sd">        messages in the Emme logbook.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_use_emme_logbook</span><span class="p">,</span> <span class="n">use_emme</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_emme_logbook</span>
        <span class="k">yield</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_use_emme_logbook</span> <span class="o">=</span> <span class="n">use_emme</span>

    <span class="k">def</span> <span class="nf">clear_msg_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Clear all log messages from cache.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">debug_enabled</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns True if DEBUG is currently filtered for display or print to file.</span>

<span class="sd">        Can be used to enable / disable debug logging which may have a performance</span>
<span class="sd">        impact.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">debug</span> <span class="o">=</span> <span class="n">LEVELS_STR_TO_INT</span><span class="p">[</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">log_formatter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_formatters</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">log_formatter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_cache</span> <span class="ow">and</span> <span class="n">log_formatter</span><span class="o">.</span><span class="n">level</span> <span class="o">&lt;=</span> <span class="n">debug</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">trace_enabled</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns True if TRACE is currently filtered for display or print to file.</span>

<span class="sd">        Can be used to enable / disable trace logging which may have a performance</span>
<span class="sd">        impact.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">trace</span> <span class="o">=</span> <span class="n">LEVELS_STR_TO_INT</span><span class="p">[</span><span class="s2">&quot;TRACE&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">log_formatter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_formatters</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">log_formatter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_cache</span> <span class="ow">and</span> <span class="n">log_formatter</span><span class="o">.</span><span class="n">level</span> <span class="o">&lt;=</span> <span class="n">trace</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="tm2py.logger.BaseLogger.debug_enabled" class="doc doc-heading">
            <code class=" language-python"><span class="n">debug_enabled</span><span class="p">:</span> <span class="nb">bool</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.logger.BaseLogger.debug_enabled" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Returns True if DEBUG is currently filtered for display or print to file.</p>
<p>Can be used to enable / disable debug logging which may have a performance
impact.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tm2py.logger.BaseLogger.trace_enabled" class="doc doc-heading">
            <code class=" language-python"><span class="n">trace_enabled</span><span class="p">:</span> <span class="nb">bool</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.logger.BaseLogger.trace_enabled" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Returns True if TRACE is currently filtered for display or print to file.</p>
<p>Can be used to enable / disable trace logging which may have a performance
impact.</p>
    </div>

</div>



<div class="doc doc-object doc-function">


<h3 id="tm2py.logger.BaseLogger.__del__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__del__</span><span class="p">()</span></code>

<a href="#tm2py.logger.BaseLogger.__del__" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Destructor for logger object</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/logger.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Destructor for logger object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_formatters</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">log_formatter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_formatters</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">log_formatter</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">):</span>
                <span class="n">log_formatter</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.logger.BaseLogger.clear_msg_cache" class="doc doc-heading">
            <code class=" language-python"><span class="n">clear_msg_cache</span><span class="p">()</span></code>

<a href="#tm2py.logger.BaseLogger.clear_msg_cache" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Clear all log messages from cache.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/logger.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">clear_msg_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Clear all log messages from cache.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_log_cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.logger.BaseLogger.debug" class="doc doc-heading">
            <code class=" language-python"><span class="n">debug</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#tm2py.logger.BaseLogger.debug" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Log text with level=DEBUG.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>text</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>text to log</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>indent</code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if true indent text based on the number of open contexts</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/logger.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">debug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Log text with level=DEBUG.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): text to log</span>
<span class="sd">        indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.logger.BaseLogger.detail" class="doc doc-heading">
            <code class=" language-python"><span class="n">detail</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#tm2py.logger.BaseLogger.detail" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Log text with level=DETAIL.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>text</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>text to log</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>indent</code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if true indent text based on the number of open contexts</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/logger.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">detail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Log text with level=DETAIL.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): text to log</span>
<span class="sd">        indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;DETAIL&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.logger.BaseLogger.error" class="doc doc-heading">
            <code class=" language-python"><span class="n">error</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#tm2py.logger.BaseLogger.error" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Log text with level=ERROR.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>text</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>text to log</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>indent</code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if true indent text based on the number of open contexts</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/logger.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Log text with level=ERROR.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): text to log</span>
<span class="sd">        indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;ERROR&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.logger.BaseLogger.fatal" class="doc doc-heading">
            <code class=" language-python"><span class="n">fatal</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#tm2py.logger.BaseLogger.fatal" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Log text with level=FATAL.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>text</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>text to log</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>indent</code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if true indent text based on the number of open contexts</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/logger.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fatal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Log text with level=FATAL.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): text to log</span>
<span class="sd">        indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;FATAL&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.logger.BaseLogger.info" class="doc doc-heading">
            <code class=" language-python"><span class="n">info</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#tm2py.logger.BaseLogger.info" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Log text with level=INFO.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>text</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>text to log</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>indent</code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if true indent text based on the number of open contexts</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/logger.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Log text with level=INFO.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): text to log</span>
<span class="sd">        indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;INFO&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.logger.BaseLogger.log" class="doc doc-heading">
            <code class=" language-python"><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;INFO&#39;</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#tm2py.logger.BaseLogger.log" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Log text to file and display depending upon log level and config.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>text</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>text to log</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>level</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>logging level</p>
              </div>
            </td>
            <td>
                  <code>&#39;INFO&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>indent</code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if true indent text based on the number of open contexts</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/logger.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="n">LogLevel</span> <span class="o">=</span> <span class="s2">&quot;INFO&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Log text to file and display depending upon log level and config.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): text to log</span>
<span class="sd">        level (str): logging level</span>
<span class="sd">        indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">-%b-%Y (%H:%M:%S) &quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">log_formatter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_formatters</span><span class="p">:</span>
        <span class="n">log_formatter</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">LEVELS_STR_TO_INT</span><span class="p">[</span><span class="n">level</span><span class="p">],</span> <span class="n">indent</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_emme_logbook</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_emme_manager</span><span class="o">.</span><span class="n">logbook_write</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.logger.BaseLogger.log_dict" class="doc doc-heading">
            <code class=" language-python"><span class="n">log_dict</span><span class="p">(</span><span class="n">mapping</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span></code>

<a href="#tm2py.logger.BaseLogger.log_dict" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Format dictionary to string and log as text.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/logger.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">log_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mapping</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="n">LogLevel</span> <span class="o">=</span> <span class="s2">&quot;DEBUG&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Format dictionary to string and log as text.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">pformat</span><span class="p">(</span><span class="n">mapping</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">120</span><span class="p">),</span> <span class="n">level</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.logger.BaseLogger.log_start_end" class="doc doc-heading">
            <code class=" language-python"><span class="n">log_start_end</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;STATUS&#39;</span><span class="p">)</span></code>

<a href="#tm2py.logger.BaseLogger.log_start_end" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Use with &lsquo;with&rsquo; statement to log the start and end time with message.</p>
<p>If using the Emme logbook (config.logging.use_emme_logbook is True), will
also create a logbook nest in the tree view using logbook_trace.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>text</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>message text</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>level</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>logging level</p>
              </div>
            </td>
            <td>
                  <code>&#39;STATUS&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/logger.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@_context</span>
<span class="k">def</span> <span class="nf">log_start_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="n">LogLevel</span> <span class="o">=</span> <span class="s2">&quot;STATUS&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Use with &#39;with&#39; statement to log the start and end time with message.</span>

<span class="sd">    If using the Emme logbook (config.logging.use_emme_logbook is True), will</span>
<span class="sd">    also create a logbook nest in the tree view using logbook_trace.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): message text</span>
<span class="sd">        level (str): logging level</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skip_emme_logging</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_start</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_emme_logbook</span><span class="p">:</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emme_manager</span><span class="o">.</span><span class="n">logbook_trace</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
            <span class="k">yield</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">yield</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skip_emme_logging</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_end</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.logger.BaseLogger.log_time" class="doc doc-heading">
            <code class=" language-python"><span class="n">log_time</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#tm2py.logger.BaseLogger.log_time" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Log message with timestamp</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/logger.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">log_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Log message with timestamp&quot;&quot;&quot;</span>
    <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">-%b-%Y (%H:%M:%S)&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">indent</span><span class="p">:</span>
        <span class="n">indent</span> <span class="o">=</span> <span class="s2">&quot;  &quot;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indentation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">indent</span><span class="si">}{</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.logger.BaseLogger.status" class="doc doc-heading">
            <code class=" language-python"><span class="n">status</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#tm2py.logger.BaseLogger.status" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Log text with level=STATUS.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>text</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>text to log</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>indent</code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if true indent text based on the number of open contexts</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/logger.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Log text with level=STATUS.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): text to log</span>
<span class="sd">        indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;STATUS&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.logger.BaseLogger.trace" class="doc doc-heading">
            <code class=" language-python"><span class="n">trace</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#tm2py.logger.BaseLogger.trace" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Log text with level=TRACE.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>text</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>text to log</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>indent</code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if true indent text based on the number of open contexts</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/logger.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Log text with level=TRACE.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): text to log</span>
<span class="sd">        indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;TRACE&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.logger.BaseLogger.warn" class="doc doc-heading">
            <code class=" language-python"><span class="n">warn</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#tm2py.logger.BaseLogger.warn" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Log text with level=WARN.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>text</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>text to log</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>indent</code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if true indent text based on the number of open contexts</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/logger.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">warn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Log text with level=WARN.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): text to log</span>
<span class="sd">        indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;WARN&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.logger.LogCache" class="doc doc-heading">
            <code>LogCache</code>


<a href="#tm2py.logger.LogCache" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="LogFormatter (tm2py.logger.LogFormatter)" href="#tm2py.logger.LogFormatter">LogFormatter</a></code></p>


      <p>Caches all messages for later recording in on error logfile.</p>


<details class="properties" open>
  <summary>Properties</summary>
  <ul>
<li>file_path: the absolute file path to write to</li>
</ul>
</details>
              <details class="quote">
                <summary>Source code in <code>tm2py/logger.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">LogCache</span><span class="p">(</span><span class="n">LogFormatter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Caches all messages for later recording in on error logfile.</span>

<span class="sd">    Properties:</span>
<span class="sd">        - file_path: the absolute file path to write to</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor for LogCache object.</span>

<span class="sd">        Args:</span>
<span class="sd">            file_path (str): the absolute file path to write to.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_path</span> <span class="o">=</span> <span class="n">file_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_msg_cache</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize log file (remove).&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Format and store text for later recording.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): text to log</span>
<span class="sd">            level (int): logging level</span>
<span class="sd">            indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">            timestamp (str): formatted datetime as a string or None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_msg_cache</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">))</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">write_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write all cached messages.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">level</span><span class="p">,</span> <span class="n">text</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msg_cache</span><span class="p">:</span>
                <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">LEVELS_INT_TO_STR</span><span class="p">[</span><span class="n">level</span><span class="p">]</span><span class="si">:</span><span class="s2">6</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Clear message cache.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_msg_cache</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tm2py.logger.LogCache.__init__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span></code>

<a href="#tm2py.logger.LogCache.__init__" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Constructor for LogCache object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>file_path</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the absolute file path to write to.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/logger.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Constructor for LogCache object.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_path (str): the absolute file path to write to.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">file_path</span> <span class="o">=</span> <span class="n">file_path</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_msg_cache</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.logger.LogCache.clear" class="doc doc-heading">
            <code class=" language-python"><span class="n">clear</span><span class="p">()</span></code>

<a href="#tm2py.logger.LogCache.clear" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Clear message cache.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/logger.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Clear message cache.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_msg_cache</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.logger.LogCache.log" class="doc doc-heading">
            <code class=" language-python"><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">)</span></code>

<a href="#tm2py.logger.LogCache.log" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Format and store text for later recording.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>text</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>text to log</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>level</code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>logging level</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>indent</code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if true indent text based on the number of open contexts</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>timestamp</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>formatted datetime as a string or None</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/logger.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Format and store text for later recording.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): text to log</span>
<span class="sd">        level (int): logging level</span>
<span class="sd">        indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">        timestamp (str): formatted datetime as a string or None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_msg_cache</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">))</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.logger.LogCache.open" class="doc doc-heading">
            <code class=" language-python"><span class="nb">open</span><span class="p">()</span></code>

<a href="#tm2py.logger.LogCache.open" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Initialize log file (remove).</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/logger.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize log file (remove).&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.logger.LogCache.write_cache" class="doc doc-heading">
            <code class=" language-python"><span class="n">write_cache</span><span class="p">()</span></code>

<a href="#tm2py.logger.LogCache.write_cache" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Write all cached messages.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/logger.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">write_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Write all cached messages.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">level</span><span class="p">,</span> <span class="n">text</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msg_cache</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">LEVELS_INT_TO_STR</span><span class="p">[</span><span class="n">level</span><span class="p">]</span><span class="si">:</span><span class="s2">6</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.logger.LogDisplay" class="doc doc-heading">
            <code>LogDisplay</code>


<a href="#tm2py.logger.LogDisplay" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="LogFormatter (tm2py.logger.LogFormatter)" href="#tm2py.logger.LogFormatter">LogFormatter</a></code></p>


      <p>Format and print log text to console / Notebook.</p>


<details class="properties" open>
  <summary>Properties</summary>
  <ul>
<li>level: the log level as an int</li>
</ul>
</details>
              <details class="quote">
                <summary>Source code in <code>tm2py/logger.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">LogDisplay</span><span class="p">(</span><span class="n">LogFormatter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Format and print log text to console / Notebook.</span>

<span class="sd">    Properties:</span>
<span class="sd">        - level: the log level as an int</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Format and display text on screen (print).</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): text to log</span>
<span class="sd">            level (int): logging level</span>
<span class="sd">            indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">            timestamp (str): formatted datetime as a string or None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">level</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_format_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tm2py.logger.LogDisplay.log" class="doc doc-heading">
            <code class=" language-python"><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">)</span></code>

<a href="#tm2py.logger.LogDisplay.log" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Format and display text on screen (print).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>text</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>text to log</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>level</code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>logging level</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>indent</code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if true indent text based on the number of open contexts</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>timestamp</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>formatted datetime as a string or None</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/logger.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Format and display text on screen (print).</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): text to log</span>
<span class="sd">        level (int): logging level</span>
<span class="sd">        indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">        timestamp (str): formatted datetime as a string or None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">level</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_format_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.logger.LogFile" class="doc doc-heading">
            <code>LogFile</code>


<a href="#tm2py.logger.LogFile" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="LogFormatter (tm2py.logger.LogFormatter)" href="#tm2py.logger.LogFormatter">LogFormatter</a></code></p>


      <p>Format and write log text to file.</p>


<details class="properties" open>
  <summary>Properties</summary>
  <ul>
<li>level: the log level as an int</li>
<li>file_path: the absolute file path to write to</li>
</ul>
</details>
              <details class="quote">
                <summary>Source code in <code>tm2py/logger.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">LogFile</span><span class="p">(</span><span class="n">LogFormatter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Format and write log text to file.</span>

<span class="sd">    Properties:</span>
<span class="sd">        - level: the log level as an int</span>
<span class="sd">        - file_path: the absolute file path to write to</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor for LogFile object.</span>

<span class="sd">        Args:</span>
<span class="sd">            level (int): the log level as an int.</span>
<span class="sd">            file_path (str): the absolute file path to write to.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_path</span> <span class="o">=</span> <span class="n">file_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Open the log file for writing.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Log text to file and display depending upon log level and config.</span>

<span class="sd">        Note that log will not write to file until opened with a context.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): text to log</span>
<span class="sd">            level (int): logging level</span>
<span class="sd">            indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">            timestamp (str): formatted datetime as a string or None for timestamp</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">level</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Close the open log file.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tm2py.logger.LogFile.__init__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span></code>

<a href="#tm2py.logger.LogFile.__init__" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Constructor for LogFile object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>level</code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the log level as an int.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>file_path</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the absolute file path to write to.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/logger.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Constructor for LogFile object.</span>

<span class="sd">    Args:</span>
<span class="sd">        level (int): the log level as an int.</span>
<span class="sd">        file_path (str): the absolute file path to write to.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">file_path</span> <span class="o">=</span> <span class="n">file_path</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.logger.LogFile.close" class="doc doc-heading">
            <code class=" language-python"><span class="n">close</span><span class="p">()</span></code>

<a href="#tm2py.logger.LogFile.close" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Close the open log file.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/logger.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Close the open log file.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.logger.LogFile.log" class="doc doc-heading">
            <code class=" language-python"><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">)</span></code>

<a href="#tm2py.logger.LogFile.log" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Log text to file and display depending upon log level and config.</p>
<p>Note that log will not write to file until opened with a context.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>text</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>text to log</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>level</code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>logging level</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>indent</code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if true indent text based on the number of open contexts</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>timestamp</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>formatted datetime as a string or None for timestamp</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/logger.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Log text to file and display depending upon log level and config.</span>

<span class="sd">    Note that log will not write to file until opened with a context.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): text to log</span>
<span class="sd">        level (int): logging level</span>
<span class="sd">        indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">        timestamp (str): formatted datetime as a string or None for timestamp</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">level</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.logger.LogFile.open" class="doc doc-heading">
            <code class=" language-python"><span class="nb">open</span><span class="p">()</span></code>

<a href="#tm2py.logger.LogFile.open" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Open the log file for writing.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/logger.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Open the log file for writing.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.logger.LogFileLevelOverride" class="doc doc-heading">
            <code>LogFileLevelOverride</code>


<a href="#tm2py.logger.LogFileLevelOverride" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="LogFile (tm2py.logger.LogFile)" href="#tm2py.logger.LogFile">LogFile</a></code></p>


      <p>Format and write log text to file.</p>


<details class="properties" open>
  <summary>Properties</summary>
  <ul>
<li>level: the log level as an int</li>
<li>file_path: the absolute file path to write to</li>
<li>iter_component_level: TODO</li>
<li>controller: TODO</li>
</ul>
</details>
              <details class="quote">
                <summary>Source code in <code>tm2py/logger.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">LogFileLevelOverride</span><span class="p">(</span><span class="n">LogFile</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Format and write log text to file.</span>

<span class="sd">    Properties:</span>
<span class="sd">        - level: the log level as an int</span>
<span class="sd">        - file_path: the absolute file path to write to</span>
<span class="sd">        - iter_component_level: TODO</span>
<span class="sd">        - controller: TODO</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">iter_component_level</span><span class="p">,</span> <span class="n">controller</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor for LogFileLevelOverride object.</span>

<span class="sd">        Args:</span>
<span class="sd">            level (_type_): TODO</span>
<span class="sd">            file_path (_type_): TODO</span>
<span class="sd">            iter_component_level (_type_): TODO</span>
<span class="sd">            controller (_type_): TODO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iter_component_level</span> <span class="o">=</span> <span class="n">iter_component_level</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span> <span class="o">=</span> <span class="n">controller</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">level</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Current log level with iter_component_level config override.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_component_level</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">iter_component</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_level</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="tm2py.logger.LogFileLevelOverride.level" class="doc doc-heading">
            <code class=" language-python"><span class="n">level</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.logger.LogFileLevelOverride.level" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Current log level with iter_component_level config override.</p>
    </div>

</div>



<div class="doc doc-object doc-function">


<h3 id="tm2py.logger.LogFileLevelOverride.__init__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">iter_component_level</span><span class="p">,</span> <span class="n">controller</span><span class="p">)</span></code>

<a href="#tm2py.logger.LogFileLevelOverride.__init__" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Constructor for LogFileLevelOverride object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>level</code></td>
            <td>
                  <code><span title="_type_">_type_</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>TODO</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>file_path</code></td>
            <td>
                  <code><span title="_type_">_type_</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>TODO</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>iter_component_level</code></td>
            <td>
                  <code><span title="_type_">_type_</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>TODO</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>controller</code></td>
            <td>
                  <code><span title="_type_">_type_</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>TODO</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/logger.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">iter_component_level</span><span class="p">,</span> <span class="n">controller</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Constructor for LogFileLevelOverride object.</span>

<span class="sd">    Args:</span>
<span class="sd">        level (_type_): TODO</span>
<span class="sd">        file_path (_type_): TODO</span>
<span class="sd">        iter_component_level (_type_): TODO</span>
<span class="sd">        controller (_type_): TODO</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">iter_component_level</span> <span class="o">=</span> <span class="n">iter_component_level</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">controller</span> <span class="o">=</span> <span class="n">controller</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.logger.LogFormatter" class="doc doc-heading">
            <code>LogFormatter</code>


<a href="#tm2py.logger.LogFormatter" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">


      <p>Base class for recording text to log.</p>


<details class="properties" open>
  <summary>Properties</summary>
  
</details>
              <details class="quote">
                <summary>Source code in <code>tm2py/logger.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">LogFormatter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for recording text to log.</span>

<span class="sd">    Properties:</span>
<span class="sd">        indent: current indentation level for the LogFormatter</span>
<span class="sd">        level: log filter level (as an int)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor for LogFormatter.</span>

<span class="sd">        Args:</span>
<span class="sd">            level (int): log filter level (as an int)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_level</span> <span class="o">=</span> <span class="n">level</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indent</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">level</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The current filter level for the LogFormatter.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_level</span>

    <span class="k">def</span> <span class="nf">increase_indent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Increase current indent if the log level is filtered in.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">level</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">indent</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">decrease_indent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Decrease current indent if the log level is filtered in.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">level</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">indent</span> <span class="o">-=</span> <span class="mi">1</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">timestamp</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Format and log message text.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): text to log</span>
<span class="sd">            level (int): logging level</span>
<span class="sd">            indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">            timestamp (str): formatted datetime as a string or None</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_format_text</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">timestamp</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Format text for logging.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): text to format</span>
<span class="sd">            level (int): logging level</span>
<span class="sd">            indent (bool): if true indent text based on the number of open contexts and</span>
<span class="sd">                timestamp width</span>
<span class="sd">            timestamp (str): formatted datetime as a string or None for timestamp</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">timestamp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">timestamp</span> <span class="o">=</span> <span class="s2">&quot;                        &quot;</span> <span class="k">if</span> <span class="n">indent</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">indent</span><span class="p">:</span>
            <span class="n">num_indents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indent</span>
            <span class="n">indent</span> <span class="o">=</span> <span class="s2">&quot;  &quot;</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="n">num_indents</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">indent</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}{</span><span class="n">LEVELS_INT_TO_STR</span><span class="p">[</span><span class="n">level</span><span class="p">]</span><span class="si">:</span><span class="s2">&gt;6</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">indent</span><span class="si">}{</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="tm2py.logger.LogFormatter.level" class="doc doc-heading">
            <code class=" language-python"><span class="n">level</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.logger.LogFormatter.level" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>The current filter level for the LogFormatter.</p>
    </div>

</div>



<div class="doc doc-object doc-function">


<h3 id="tm2py.logger.LogFormatter.__init__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">level</span><span class="p">)</span></code>

<a href="#tm2py.logger.LogFormatter.__init__" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Constructor for LogFormatter.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>level</code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>log filter level (as an int)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/logger.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Constructor for LogFormatter.</span>

<span class="sd">    Args:</span>
<span class="sd">        level (int): log filter level (as an int)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_level</span> <span class="o">=</span> <span class="n">level</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">indent</span> <span class="o">=</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.logger.LogFormatter.decrease_indent" class="doc doc-heading">
            <code class=" language-python"><span class="n">decrease_indent</span><span class="p">(</span><span class="n">level</span><span class="p">)</span></code>

<a href="#tm2py.logger.LogFormatter.decrease_indent" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Decrease current indent if the log level is filtered in.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/logger.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">decrease_indent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Decrease current indent if the log level is filtered in.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">level</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indent</span> <span class="o">-=</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.logger.LogFormatter.increase_indent" class="doc doc-heading">
            <code class=" language-python"><span class="n">increase_indent</span><span class="p">(</span><span class="n">level</span><span class="p">)</span></code>

<a href="#tm2py.logger.LogFormatter.increase_indent" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Increase current indent if the log level is filtered in.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/logger.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">increase_indent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Increase current indent if the log level is filtered in.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">level</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indent</span> <span class="o">+=</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.logger.LogFormatter.log" class="doc doc-heading">
            <code class=" language-python"><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

<a href="#tm2py.logger.LogFormatter.log" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Format and log message text.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>text</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>text to log</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>level</code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>logging level</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>indent</code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if true indent text based on the number of open contexts</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>timestamp</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>formatted datetime as a string or None</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/logger.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span> <span class="nf">log</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">timestamp</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Format and log message text.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): text to log</span>
<span class="sd">        level (int): logging level</span>
<span class="sd">        indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">        timestamp (str): formatted datetime as a string or None</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.logger.LogStartEnd" class="doc doc-heading">
            <code>LogStartEnd</code>


<a href="#tm2py.logger.LogStartEnd" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">


      <p>Log the start and end time with optional message.</p>
<p>Used as a Component method decorator. If msg is not provided a default
message is generated with the object class and method name.</p>
<p>Example::
    @LogStartEnd(&ldquo;Highway assignment and skims&rdquo;, level=&rdquo;STATUS&rdquo;)
    def run(self):
        pass</p>


<details class="properties" open>
  <summary>Properties</summary>
  <p>text (str): message text to use in the start and end record.
level (str): logging level as a string.</p>
</details>
              <details class="quote">
                <summary>Source code in <code>tm2py/logger.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">LogStartEnd</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Log the start and end time with optional message.</span>

<span class="sd">    Used as a Component method decorator. If msg is not provided a default</span>
<span class="sd">    message is generated with the object class and method name.</span>

<span class="sd">    Example::</span>
<span class="sd">        @LogStartEnd(&quot;Highway assignment and skims&quot;, level=&quot;STATUS&quot;)</span>
<span class="sd">        def run(self):</span>
<span class="sd">            pass</span>

<span class="sd">    Properties:</span>
<span class="sd">        text (str): message text to use in the start and end record.</span>
<span class="sd">        level (str): logging level as a string.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;INFO&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor for LogStartEnd object.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str, optional): message text to use in the start and end record.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            level (str, optional): logging level as a string. Defaults to &quot;INFO&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">level</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Ability to call logger.</span>

<span class="sd">        Args:</span>
<span class="sd">            func (_type_): _description_</span>

<span class="sd">        Returns:</span>
<span class="sd">            _type_: _description_</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="n">obj</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="k">with</span> <span class="n">obj</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log_start_end</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">value</span>

        <span class="k">return</span> <span class="n">wrapper</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tm2py.logger.LogStartEnd.__call__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">func</span><span class="p">)</span></code>

<a href="#tm2py.logger.LogStartEnd.__call__" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Ability to call logger.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>func</code></td>
            <td>
                  <code><span title="_type_">_type_</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><em>description</em></p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>_type_</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p><em>description</em></p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/logger.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Ability to call logger.</span>

<span class="sd">    Args:</span>
<span class="sd">        func (_type_): _description_</span>

<span class="sd">    Returns:</span>
<span class="sd">        _type_: _description_</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="n">obj</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">with</span> <span class="n">obj</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log_start_end</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">return</span> <span class="n">wrapper</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.logger.LogStartEnd.__init__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;INFO&#39;</span><span class="p">)</span></code>

<a href="#tm2py.logger.LogStartEnd.__init__" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Constructor for LogStartEnd object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>text</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>message text to use in the start and end record.
Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>level</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>logging level as a string. Defaults to &ldquo;INFO&rdquo;.</p>
              </div>
            </td>
            <td>
                  <code>&#39;INFO&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/logger.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;INFO&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Constructor for LogStartEnd object.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str, optional): message text to use in the start and end record.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        level (str, optional): logging level as a string. Defaults to &quot;INFO&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">level</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.logger.Logger" class="doc doc-heading">
            <code>Logger</code>


<a href="#tm2py.logger.Logger" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="BaseLogger (tm2py.logger.BaseLogger)" href="#tm2py.logger.BaseLogger">BaseLogger</a></code></p>


      <p>Logging of message text for display, text file, and Emme logbook, as well as notify to slack.</p>
<p>The log message levels can be one of:
TRACE, DEBUG, DETAIL, INFO, STATUS, WARN, ERROR, FATAL
Which will filter all messages of that severity and higher.
See module note on use of descriptive level names.</p>
<p>logger.log(&ldquo;a message&rdquo;)
with logger.log_start_end(&ldquo;Running a set of steps&rdquo;):
    logger.log(&ldquo;Message with timestamp&rdquo;)
    logger.log(&ldquo;A debug message&rdquo;, level=&rdquo;DEBUG&rdquo;)
    # equivalently, use the .debug:
    logger.debug(&ldquo;Another debug message&rdquo;)
    if logger.debug_enabled:
        # only generate this report if logging DEBUG
        logger.log(&ldquo;A debug report that takes time to produce&rdquo;, level=&rdquo;DEBUG&rdquo;)
    logger.notify_slack(&ldquo;A slack message&rdquo;)</p>
<p>Methods can also be decorated with LogStartEnd (see class for more).</p>
<p>Note that the Logger should only be initialized once per model run.
In places where the controller is not available, the last Logger
initialized can be obtained from the class method get_logger::</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>logger = Logger.get_logger()
</code></pre></div></td></tr></table></div>


<details class="internal-properties" open>
  <summary>Internal properties</summary>
  
</details>
              <details class="quote">
                <summary>Source code in <code>tm2py/logger.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Logger</span><span class="p">(</span><span class="n">BaseLogger</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Logging of message text for display, text file, and Emme logbook, as well as notify to slack.</span>

<span class="sd">    The log message levels can be one of:</span>
<span class="sd">    TRACE, DEBUG, DETAIL, INFO, STATUS, WARN, ERROR, FATAL</span>
<span class="sd">    Which will filter all messages of that severity and higher.</span>
<span class="sd">    See module note on use of descriptive level names.</span>

<span class="sd">    logger.log(&quot;a message&quot;)</span>
<span class="sd">    with logger.log_start_end(&quot;Running a set of steps&quot;):</span>
<span class="sd">        logger.log(&quot;Message with timestamp&quot;)</span>
<span class="sd">        logger.log(&quot;A debug message&quot;, level=&quot;DEBUG&quot;)</span>
<span class="sd">        # equivalently, use the .debug:</span>
<span class="sd">        logger.debug(&quot;Another debug message&quot;)</span>
<span class="sd">        if logger.debug_enabled:</span>
<span class="sd">            # only generate this report if logging DEBUG</span>
<span class="sd">            logger.log(&quot;A debug report that takes time to produce&quot;, level=&quot;DEBUG&quot;)</span>
<span class="sd">        logger.notify_slack(&quot;A slack message&quot;)</span>

<span class="sd">    Methods can also be decorated with LogStartEnd (see class for more).</span>

<span class="sd">    Note that the Logger should only be initialized once per model run.</span>
<span class="sd">    In places where the controller is not available, the last Logger</span>
<span class="sd">    initialized can be obtained from the class method get_logger::</span>

<span class="sd">        logger = Logger.get_logger()</span>

<span class="sd">    Internal properties:</span>
<span class="sd">        _log_cache: the LogCache object</span>
<span class="sd">        _log_formatters: list of objects that format text and record, either</span>
<span class="sd">            to file, display (print to screen) or cache for log on error</span>
<span class="sd">        _use_emme_logbook: whether Emme logbook is enabled</span>
<span class="sd">        _slack_notifier: SlackNotifier object for sending messages to slack</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># used to cache last initialized Logger</span>
    <span class="n">_instance</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Logger __new__ method override.</span>

<span class="sd">        Args:</span>
<span class="sd">            controller (RunController): Associated RunController instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># pylint: disable=unused-argument</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Logger</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor for Logger object.</span>

<span class="sd">        Args:</span>
<span class="sd">            controller (RunController): Associated RunController instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span> <span class="o">=</span> <span class="n">controller</span>

        <span class="n">log_config</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">logging</span>
        <span class="n">iter_component_level</span> <span class="o">=</span> <span class="n">log_config</span><span class="o">.</span><span class="n">iter_component_level</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="n">iter_component_level</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span> <span class="n">LEVELS_STR_TO_INT</span><span class="p">[</span><span class="n">l</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">iter_component_level</span>
        <span class="p">)</span>
        <span class="n">display_logger</span> <span class="o">=</span> <span class="n">LogDisplay</span><span class="p">(</span><span class="n">LEVELS_STR_TO_INT</span><span class="p">[</span><span class="n">log_config</span><span class="o">.</span><span class="n">display_level</span><span class="p">])</span>
        <span class="n">run_log_formatter</span> <span class="o">=</span> <span class="n">LogFile</span><span class="p">(</span>
            <span class="n">LEVELS_STR_TO_INT</span><span class="p">[</span><span class="n">log_config</span><span class="o">.</span><span class="n">run_file_level</span><span class="p">],</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">controller</span><span class="o">.</span><span class="n">run_dir</span><span class="p">,</span> <span class="n">log_config</span><span class="o">.</span><span class="n">run_file_path</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">standard_log_formatter</span> <span class="o">=</span> <span class="n">LogFileLevelOverride</span><span class="p">(</span>
            <span class="n">LEVELS_STR_TO_INT</span><span class="p">[</span><span class="n">log_config</span><span class="o">.</span><span class="n">log_file_level</span><span class="p">],</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">controller</span><span class="o">.</span><span class="n">run_dir</span><span class="p">,</span> <span class="n">log_config</span><span class="o">.</span><span class="n">log_file_path</span><span class="p">),</span>
            <span class="n">iter_component_level</span><span class="p">,</span>
            <span class="n">controller</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">log_formatters</span> <span class="o">=</span> <span class="p">[</span><span class="n">display_logger</span><span class="p">,</span> <span class="n">run_log_formatter</span><span class="p">,</span> <span class="n">standard_log_formatter</span><span class="p">]</span>
        <span class="n">log_cache_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">controller</span><span class="o">.</span><span class="n">run_dir</span><span class="p">,</span> <span class="n">log_config</span><span class="o">.</span><span class="n">log_on_error_file_path</span>
        <span class="p">)</span>
        <span class="c1"># set this latter via setEmmeManager()</span>
        <span class="n">emme_manager</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">log_formatters</span><span class="p">,</span> <span class="n">log_cache_file</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_slack_notifier</span> <span class="o">=</span> <span class="n">SlackNotifier</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_logger</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the last initialized logger object.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span>

    <span class="k">def</span> <span class="nf">notify_slack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Send message to slack if enabled by config.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): text to send to slack</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">notify_slack</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_slack_notifier</span><span class="o">.</span><span class="n">post_message</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tm2py.logger.Logger.__init__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span></code>

<a href="#tm2py.logger.Logger.__init__" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Constructor for Logger object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>controller</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="RunController (tm2py.controller.RunController)" href="#tm2py.controller.RunController">RunController</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Associated RunController instance.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/logger.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Constructor for Logger object.</span>

<span class="sd">    Args:</span>
<span class="sd">        controller (RunController): Associated RunController instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">controller</span> <span class="o">=</span> <span class="n">controller</span>

    <span class="n">log_config</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">logging</span>
    <span class="n">iter_component_level</span> <span class="o">=</span> <span class="n">log_config</span><span class="o">.</span><span class="n">iter_component_level</span> <span class="ow">or</span> <span class="p">[]</span>
    <span class="n">iter_component_level</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span> <span class="n">LEVELS_STR_TO_INT</span><span class="p">[</span><span class="n">l</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">iter_component_level</span>
    <span class="p">)</span>
    <span class="n">display_logger</span> <span class="o">=</span> <span class="n">LogDisplay</span><span class="p">(</span><span class="n">LEVELS_STR_TO_INT</span><span class="p">[</span><span class="n">log_config</span><span class="o">.</span><span class="n">display_level</span><span class="p">])</span>
    <span class="n">run_log_formatter</span> <span class="o">=</span> <span class="n">LogFile</span><span class="p">(</span>
        <span class="n">LEVELS_STR_TO_INT</span><span class="p">[</span><span class="n">log_config</span><span class="o">.</span><span class="n">run_file_level</span><span class="p">],</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">controller</span><span class="o">.</span><span class="n">run_dir</span><span class="p">,</span> <span class="n">log_config</span><span class="o">.</span><span class="n">run_file_path</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">standard_log_formatter</span> <span class="o">=</span> <span class="n">LogFileLevelOverride</span><span class="p">(</span>
        <span class="n">LEVELS_STR_TO_INT</span><span class="p">[</span><span class="n">log_config</span><span class="o">.</span><span class="n">log_file_level</span><span class="p">],</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">controller</span><span class="o">.</span><span class="n">run_dir</span><span class="p">,</span> <span class="n">log_config</span><span class="o">.</span><span class="n">log_file_path</span><span class="p">),</span>
        <span class="n">iter_component_level</span><span class="p">,</span>
        <span class="n">controller</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">log_formatters</span> <span class="o">=</span> <span class="p">[</span><span class="n">display_logger</span><span class="p">,</span> <span class="n">run_log_formatter</span><span class="p">,</span> <span class="n">standard_log_formatter</span><span class="p">]</span>
    <span class="n">log_cache_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">controller</span><span class="o">.</span><span class="n">run_dir</span><span class="p">,</span> <span class="n">log_config</span><span class="o">.</span><span class="n">log_on_error_file_path</span>
    <span class="p">)</span>
    <span class="c1"># set this latter via setEmmeManager()</span>
    <span class="n">emme_manager</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">log_formatters</span><span class="p">,</span> <span class="n">log_cache_file</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_slack_notifier</span> <span class="o">=</span> <span class="n">SlackNotifier</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.logger.Logger.__new__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__new__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span></code>

<a href="#tm2py.logger.Logger.__new__" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Logger <strong>new</strong> method override.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>controller</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="RunController (tm2py.controller.RunController)" href="#tm2py.controller.RunController">RunController</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Associated RunController instance.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/logger.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Logger __new__ method override.</span>

<span class="sd">    Args:</span>
<span class="sd">        controller (RunController): Associated RunController instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># pylint: disable=unused-argument</span>
    <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Logger</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.logger.Logger.get_logger" class="doc doc-heading">
            <code class=" language-python"><span class="n">get_logger</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#tm2py.logger.Logger.get_logger" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Return the last initialized logger object.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/logger.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">get_logger</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the last initialized logger object.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.logger.Logger.notify_slack" class="doc doc-heading">
            <code class=" language-python"><span class="n">notify_slack</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code>

<a href="#tm2py.logger.Logger.notify_slack" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Send message to slack if enabled by config.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>text</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>text to send to slack</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/logger.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">notify_slack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Send message to slack if enabled by config.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): text to send to slack</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">notify_slack</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_slack_notifier</span><span class="o">.</span><span class="n">post_message</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.logger.ProcessLogger" class="doc doc-heading">
            <code>ProcessLogger</code>


<a href="#tm2py.logger.ProcessLogger" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="BaseLogger (tm2py.logger.BaseLogger)" href="#tm2py.logger.BaseLogger">BaseLogger</a></code></p>


      <p>Logger for running in separate process with no RunController.</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/logger.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ProcessLogger</span><span class="p">(</span><span class="n">BaseLogger</span><span class="p">):</span>
    <span class="s2">&quot;Logger for running in separate process with no RunController.&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run_log_file_path</span><span class="p">,</span> <span class="n">log_on_error_file_path</span><span class="p">,</span> <span class="n">emme_manager</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor for Logger object.</span>

<span class="sd">        Args:</span>
<span class="sd">            run_log_file_path ():</span>
<span class="sd">            log_on_error_file_path ():</span>
<span class="sd">            emme_manager ():</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">run_log_formatter</span> <span class="o">=</span> <span class="n">LogFile</span><span class="p">(</span><span class="n">LEVELS_STR_TO_INT</span><span class="p">[</span><span class="s2">&quot;INFO&quot;</span><span class="p">],</span> <span class="n">run_log_file_path</span><span class="p">)</span>
        <span class="n">log_formatters</span> <span class="o">=</span> <span class="p">[</span><span class="n">run_log_formatter</span><span class="p">]</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">log_formatters</span><span class="p">,</span> <span class="n">log_on_error_file_path</span><span class="p">,</span> <span class="n">emme_manager</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tm2py.logger.ProcessLogger.__init__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">run_log_file_path</span><span class="p">,</span> <span class="n">log_on_error_file_path</span><span class="p">,</span> <span class="n">emme_manager</span><span class="p">)</span></code>

<a href="#tm2py.logger.ProcessLogger.__init__" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Constructor for Logger object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>run_log_file_path</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>log_on_error_file_path</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>emme_manager</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/logger.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run_log_file_path</span><span class="p">,</span> <span class="n">log_on_error_file_path</span><span class="p">,</span> <span class="n">emme_manager</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Constructor for Logger object.</span>

<span class="sd">    Args:</span>
<span class="sd">        run_log_file_path ():</span>
<span class="sd">        log_on_error_file_path ():</span>
<span class="sd">        emme_manager ():</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">run_log_formatter</span> <span class="o">=</span> <span class="n">LogFile</span><span class="p">(</span><span class="n">LEVELS_STR_TO_INT</span><span class="p">[</span><span class="s2">&quot;INFO&quot;</span><span class="p">],</span> <span class="n">run_log_file_path</span><span class="p">)</span>
    <span class="n">log_formatters</span> <span class="o">=</span> <span class="p">[</span><span class="n">run_log_formatter</span><span class="p">]</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">log_formatters</span><span class="p">,</span> <span class="n">log_on_error_file_path</span><span class="p">,</span> <span class="n">emme_manager</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tm2py.logger.SlackNotifier" class="doc doc-heading">
            <code>SlackNotifier</code>


<a href="#tm2py.logger.SlackNotifier" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">


      <p>Notify slack of model run status.</p>
<p>The slack channel can be input directly, or is configured via text file found at
&ldquo;M:\Software\Slack\TravelModel_SlackWebhook.txt&rdquo; (if on MTC server)
rr&rdquo;C:\Software\Slack\TravelModel_SlackWebhook.txt&rdquo; (if local)</p>


<details class="properties" open>
  <summary>Properties</summary>
  <ul>
<li>logger (Logger): object for logging of trace messages</li>
<li>slack_webhook_url (str): optional, url to use for sending the message to slack</li>
</ul>
</details>
              <details class="quote">
                <summary>Source code in <code>tm2py/logger.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SlackNotifier</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Notify slack of model run status.</span>

<span class="sd">    The slack channel can be input directly, or is configured via text file found at</span>
<span class="sd">    &quot;M:\Software\Slack\TravelModel_SlackWebhook.txt&quot; (if on MTC server)</span>
<span class="sd">    rr&quot;C:\Software\Slack\TravelModel_SlackWebhook.txt&quot; (if local)</span>

<span class="sd">    Properties:</span>
<span class="sd">        - logger (Logger): object for logging of trace messages</span>
<span class="sd">        - slack_webhook_url (str): optional, url to use for sending the message to slack</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Logger</span><span class="p">,</span> <span class="n">slack_webhook_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Constructor for SlackNotifier object.</span>

<span class="sd">        Args:</span>
<span class="sd">            logger (Logger): logger instance.</span>
<span class="sd">            slack_webhook_url (str, optional): . Defaults to None, which is replaced by either:</span>
<span class="sd">                - r&quot;M:\Software\Slack\TravelModel_SlackWebhook.txt&quot; (if on MTC server)</span>
<span class="sd">                - r&quot;C:\Software\Slack\TravelModel_SlackWebhook.txt&quot; (otherwise)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">logger</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">notify_slack</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_slack_webhook_url</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">slack_webhook_url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">hostname</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">getfqdn</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">hostname</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.mtc.ca.gov&quot;</span><span class="p">):</span>
                <span class="n">slack_webhook_url_file</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">r</span><span class="s2">&quot;M:\Software\Slack\TravelModel_SlackWebhook.txt&quot;</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;SlackNotifier running on mtc host; using </span><span class="si">{</span><span class="n">slack_webhook_url_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">level</span><span class="o">=</span><span class="s2">&quot;TRACE&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">slack_webhook_url_file</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">r</span><span class="s2">&quot;C:\Software\Slack\TravelModel_SlackWebhook.txt&quot;</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;SlackNotifier running on non-mtc host; using </span><span class="si">{</span><span class="n">slack_webhook_url_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">level</span><span class="o">=</span><span class="s2">&quot;TRACE&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">slack_webhook_url_file</span><span class="p">):</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">slack_webhook_url_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">url_file</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_slack_webhook_url</span> <span class="o">=</span> <span class="n">url_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_slack_webhook_url</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_slack_webhook_url</span> <span class="o">=</span> <span class="n">slack_webhook_url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;SlackNotifier using slack webhook url </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_slack_webhook_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">level</span><span class="o">=</span><span class="s2">&quot;TRACE&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">post_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Posts text to the slack channel via the webhook if slack_webhook_url is found.</span>

<span class="sd">        Args:</span>
<span class="sd">           text: text message to send to slack</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_slack_webhook_url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Content-type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">}</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">text</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sending message to slack: </span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;TRACE&quot;</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_slack_webhook_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Receiving response: </span><span class="si">{</span><span class="n">response</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;TRACE&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tm2py.logger.SlackNotifier.__init__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">logger</span><span class="p">,</span> <span class="n">slack_webhook_url</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#tm2py.logger.SlackNotifier.__init__" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Constructor for SlackNotifier object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>logger</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Logger (tm2py.logger.Logger)" href="#tm2py.logger.Logger">Logger</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>logger instance.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>slack_webhook_url</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>. Defaults to None, which is replaced by either:
- r&rdquo;M:\Software\Slack\TravelModel_SlackWebhook.txt&rdquo; (if on MTC server)
- r&rdquo;C:\Software\Slack\TravelModel_SlackWebhook.txt&rdquo; (otherwise)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/logger.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Logger</span><span class="p">,</span> <span class="n">slack_webhook_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Constructor for SlackNotifier object.</span>

<span class="sd">    Args:</span>
<span class="sd">        logger (Logger): logger instance.</span>
<span class="sd">        slack_webhook_url (str, optional): . Defaults to None, which is replaced by either:</span>
<span class="sd">            - r&quot;M:\Software\Slack\TravelModel_SlackWebhook.txt&quot; (if on MTC server)</span>
<span class="sd">            - r&quot;C:\Software\Slack\TravelModel_SlackWebhook.txt&quot; (otherwise)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">logger</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">notify_slack</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_slack_webhook_url</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="n">slack_webhook_url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">hostname</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">getfqdn</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">hostname</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.mtc.ca.gov&quot;</span><span class="p">):</span>
            <span class="n">slack_webhook_url_file</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">r</span><span class="s2">&quot;M:\Software\Slack\TravelModel_SlackWebhook.txt&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;SlackNotifier running on mtc host; using </span><span class="si">{</span><span class="n">slack_webhook_url_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">level</span><span class="o">=</span><span class="s2">&quot;TRACE&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">slack_webhook_url_file</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">r</span><span class="s2">&quot;C:\Software\Slack\TravelModel_SlackWebhook.txt&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;SlackNotifier running on non-mtc host; using </span><span class="si">{</span><span class="n">slack_webhook_url_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">level</span><span class="o">=</span><span class="s2">&quot;TRACE&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">slack_webhook_url_file</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">slack_webhook_url_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">url_file</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_slack_webhook_url</span> <span class="o">=</span> <span class="n">url_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_slack_webhook_url</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_slack_webhook_url</span> <span class="o">=</span> <span class="n">slack_webhook_url</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;SlackNotifier using slack webhook url </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_slack_webhook_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">level</span><span class="o">=</span><span class="s2">&quot;TRACE&quot;</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.logger.SlackNotifier.post_message" class="doc doc-heading">
            <code class=" language-python"><span class="n">post_message</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code>

<a href="#tm2py.logger.SlackNotifier.post_message" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Posts text to the slack channel via the webhook if slack_webhook_url is found.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>text</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>text message to send to slack</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/logger.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">post_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Posts text to the slack channel via the webhook if slack_webhook_url is found.</span>

<span class="sd">    Args:</span>
<span class="sd">       text: text message to send to slack</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_slack_webhook_url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Content-type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">}</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">text</span><span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sending message to slack: </span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;TRACE&quot;</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_slack_webhook_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Receiving response: </span><span class="si">{</span><span class="n">response</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;TRACE&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="tm2py.tools"></a>
    <div class="doc doc-contents first">

      <p>Tools module for common resources / shared code and &ldquo;utilities&rdquo; in the tm2py package.</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="tm2py.tools.SpatialGridIndex" class="doc doc-heading">
            <code>SpatialGridIndex</code>


<a href="#tm2py.tools.SpatialGridIndex" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">


      <p>Simple spatial grid hash for fast (enough) nearest neighbor / within distance searches of points.</p>

              <details class="quote">
                <summary>Source code in <code>tm2py/tools.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SpatialGridIndex</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simple spatial grid hash for fast (enough) nearest neighbor / within distance searches of points.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            size: the size of the grid to use for the index, relative to the point coordinates</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_size</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_grid_index</span> <span class="o">=</span> <span class="n">_defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[])</span>

    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add new obj with coordinates x and y.</span>
<span class="sd">        Args:</span>
<span class="sd">           obj: any python object, will be returned from search methods &quot;nearest&quot; and &quot;within_distance&quot;</span>
<span class="sd">           x: x-coordinate</span>
<span class="sd">           y: y-coordinate</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">grid_x</span><span class="p">,</span> <span class="n">grid_y</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">y</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_grid_index</span><span class="p">[(</span><span class="n">grid_x</span><span class="p">,</span> <span class="n">grid_y</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">obj</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">nearest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the closest object in index to the specified coordinates</span>
<span class="sd">        Args:</span>
<span class="sd">            x: x-coordinate</span>
<span class="sd">            y: y-coordinate</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_grid_index</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;SpatialGrid is empty.&quot;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">calc_dist</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">sqrt</span><span class="p">((</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">y2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">grid_x</span><span class="p">,</span> <span class="n">grid_y</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">y</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size</span><span class="p">)</span>
        <span class="n">step</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">done</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">found_items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">done</span><span class="p">:</span>
            <span class="n">search_offsets</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">step</span><span class="p">,</span> <span class="n">step</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">search_offsets</span> <span class="o">=</span> <span class="n">_product</span><span class="p">(</span><span class="n">search_offsets</span><span class="p">,</span> <span class="n">search_offsets</span><span class="p">)</span>
            <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">x_offset</span><span class="p">,</span> <span class="n">y_offset</span> <span class="ow">in</span> <span class="n">search_offsets</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x_offset</span><span class="p">)</span> <span class="o">!=</span> <span class="n">step</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y_offset</span><span class="p">)</span> <span class="o">!=</span> <span class="n">step</span><span class="p">:</span>
                    <span class="k">continue</span>  <span class="c1"># already checked this grid tile</span>
                <span class="n">items</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_grid_index</span><span class="p">[</span><span class="n">grid_x</span> <span class="o">+</span> <span class="n">x_offset</span><span class="p">,</span> <span class="n">grid_y</span> <span class="o">+</span> <span class="n">y_offset</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">found_items</span><span class="p">:</span>
                <span class="n">done</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">found_items</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
            <span class="n">step</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">min_dist</span> <span class="o">=</span> <span class="mf">1e400</span>
        <span class="n">closest</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">yi</span> <span class="ow">in</span> <span class="n">found_items</span><span class="p">:</span>
            <span class="n">dist</span> <span class="o">=</span> <span class="n">calc_dist</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dist</span> <span class="o">&lt;</span> <span class="n">min_dist</span><span class="p">:</span>
                <span class="n">closest</span> <span class="o">=</span> <span class="n">i</span>
                <span class="n">min_dist</span> <span class="o">=</span> <span class="n">dist</span>
        <span class="k">return</span> <span class="n">closest</span>

    <span class="k">def</span> <span class="nf">within_distance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">distance</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return all objects in index within the distance of the specified coordinates</span>
<span class="sd">        Args:</span>
<span class="sd">            x: x-coordinate</span>
<span class="sd">            y: y-coordinate</span>
<span class="sd">            distance: distance to search in point coordinate units</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">point_in_circle</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">dist</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">sqrt</span><span class="p">((</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">y2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">dist</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_items_on_grid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">point_in_circle</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">within_square</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">distance</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return all objects in index within a square box distance of the specified coordinates.</span>
<span class="sd">        Args:</span>
<span class="sd">            x: x-coordinate</span>
<span class="sd">            y: y-coordinate</span>
<span class="sd">            distance: distance to search in point coordinate units</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">point_in_box</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">dist</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x2</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">dist</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">y2</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">dist</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_items_on_grid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">point_in_box</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_items_on_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">filter_func</span><span class="p">):</span>
        <span class="n">grid_x</span><span class="p">,</span> <span class="n">grid_y</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">y</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size</span><span class="p">)</span>
        <span class="n">num_search_grids</span> <span class="o">=</span> <span class="n">ceil</span><span class="p">(</span><span class="n">distance</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size</span><span class="p">)</span>
        <span class="n">search_offsets</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">num_search_grids</span><span class="p">,</span> <span class="n">num_search_grids</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">search_offsets</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">_product</span><span class="p">(</span><span class="n">search_offsets</span><span class="p">,</span> <span class="n">search_offsets</span><span class="p">))</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">x_offset</span><span class="p">,</span> <span class="n">y_offset</span> <span class="ow">in</span> <span class="n">search_offsets</span><span class="p">:</span>
            <span class="n">items</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_grid_index</span><span class="p">[</span><span class="n">grid_x</span> <span class="o">+</span> <span class="n">x_offset</span><span class="p">,</span> <span class="n">grid_y</span> <span class="o">+</span> <span class="n">y_offset</span><span class="p">])</span>
        <span class="n">filtered_items</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">yi</span> <span class="ow">in</span> <span class="n">items</span> <span class="k">if</span> <span class="n">filter_func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">distance</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="n">filtered_items</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tm2py.tools.SpatialGridIndex.__init__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">size</span><span class="p">)</span></code>

<a href="#tm2py.tools.SpatialGridIndex.__init__" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>size</code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the size of the grid to use for the index, relative to the point coordinates</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/tools.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        size: the size of the grid to use for the index, relative to the point coordinates</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_size</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_grid_index</span> <span class="o">=</span> <span class="n">_defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.tools.SpatialGridIndex.insert" class="doc doc-heading">
            <code class=" language-python"><span class="n">insert</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span></code>

<a href="#tm2py.tools.SpatialGridIndex.insert" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Add new obj with coordinates x and y.
Args:
   obj: any python object, will be returned from search methods &ldquo;nearest&rdquo; and &ldquo;within_distance&rdquo;
   x: x-coordinate
   y: y-coordinate</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/tools.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add new obj with coordinates x and y.</span>
<span class="sd">    Args:</span>
<span class="sd">       obj: any python object, will be returned from search methods &quot;nearest&quot; and &quot;within_distance&quot;</span>
<span class="sd">       x: x-coordinate</span>
<span class="sd">       y: y-coordinate</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">grid_x</span><span class="p">,</span> <span class="n">grid_y</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">y</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_grid_index</span><span class="p">[(</span><span class="n">grid_x</span><span class="p">,</span> <span class="n">grid_y</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">obj</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.tools.SpatialGridIndex.nearest" class="doc doc-heading">
            <code class=" language-python"><span class="n">nearest</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span></code>

<a href="#tm2py.tools.SpatialGridIndex.nearest" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Return the closest object in index to the specified coordinates
Args:
    x: x-coordinate
    y: y-coordinate</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/tools.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">nearest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the closest object in index to the specified coordinates</span>
<span class="sd">    Args:</span>
<span class="sd">        x: x-coordinate</span>
<span class="sd">        y: y-coordinate</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_grid_index</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;SpatialGrid is empty.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">calc_dist</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sqrt</span><span class="p">((</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">y2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">grid_x</span><span class="p">,</span> <span class="n">grid_y</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">y</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size</span><span class="p">)</span>
    <span class="n">step</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">done</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">found_items</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">done</span><span class="p">:</span>
        <span class="n">search_offsets</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">step</span><span class="p">,</span> <span class="n">step</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">search_offsets</span> <span class="o">=</span> <span class="n">_product</span><span class="p">(</span><span class="n">search_offsets</span><span class="p">,</span> <span class="n">search_offsets</span><span class="p">)</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">x_offset</span><span class="p">,</span> <span class="n">y_offset</span> <span class="ow">in</span> <span class="n">search_offsets</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x_offset</span><span class="p">)</span> <span class="o">!=</span> <span class="n">step</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y_offset</span><span class="p">)</span> <span class="o">!=</span> <span class="n">step</span><span class="p">:</span>
                <span class="k">continue</span>  <span class="c1"># already checked this grid tile</span>
            <span class="n">items</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_grid_index</span><span class="p">[</span><span class="n">grid_x</span> <span class="o">+</span> <span class="n">x_offset</span><span class="p">,</span> <span class="n">grid_y</span> <span class="o">+</span> <span class="n">y_offset</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">found_items</span><span class="p">:</span>
            <span class="n">done</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">found_items</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="n">step</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">min_dist</span> <span class="o">=</span> <span class="mf">1e400</span>
    <span class="n">closest</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">yi</span> <span class="ow">in</span> <span class="n">found_items</span><span class="p">:</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="n">calc_dist</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dist</span> <span class="o">&lt;</span> <span class="n">min_dist</span><span class="p">:</span>
            <span class="n">closest</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">min_dist</span> <span class="o">=</span> <span class="n">dist</span>
    <span class="k">return</span> <span class="n">closest</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.tools.SpatialGridIndex.within_distance" class="doc doc-heading">
            <code class=" language-python"><span class="n">within_distance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">distance</span><span class="p">)</span></code>

<a href="#tm2py.tools.SpatialGridIndex.within_distance" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Return all objects in index within the distance of the specified coordinates
Args:
    x: x-coordinate
    y: y-coordinate
    distance: distance to search in point coordinate units</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/tools.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">within_distance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">distance</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return all objects in index within the distance of the specified coordinates</span>
<span class="sd">    Args:</span>
<span class="sd">        x: x-coordinate</span>
<span class="sd">        y: y-coordinate</span>
<span class="sd">        distance: distance to search in point coordinate units</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">point_in_circle</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">dist</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sqrt</span><span class="p">((</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">y2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">dist</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_items_on_grid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">point_in_circle</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tm2py.tools.SpatialGridIndex.within_square" class="doc doc-heading">
            <code class=" language-python"><span class="n">within_square</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">distance</span><span class="p">)</span></code>

<a href="#tm2py.tools.SpatialGridIndex.within_square" class="headerlink" title="Permanent link"> </a></h3>


    <div class="doc doc-contents ">

      <p>Return all objects in index within a square box distance of the specified coordinates.
Args:
    x: x-coordinate
    y: y-coordinate
    distance: distance to search in point coordinate units</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/tools.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">within_square</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">distance</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return all objects in index within a square box distance of the specified coordinates.</span>
<span class="sd">    Args:</span>
<span class="sd">        x: x-coordinate</span>
<span class="sd">        y: y-coordinate</span>
<span class="sd">        distance: distance to search in point coordinate units</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">point_in_box</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">dist</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x2</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">dist</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">y2</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">dist</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_items_on_grid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">point_in_box</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="tm2py.tools.download_unzip" class="doc doc-heading">
            <code class=" language-python"><span class="n">download_unzip</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">out_base_dir</span><span class="p">,</span> <span class="n">target_dir</span><span class="p">,</span> <span class="n">zip_filename</span><span class="o">=</span><span class="s1">&#39;test_data.zip&#39;</span><span class="p">)</span></code>

<a href="#tm2py.tools.download_unzip" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">

      <p>Download and unzips a file from a URL. The zip file is removed after extraction.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>url</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Full URL do download from.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>out_base_dir</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Where to unzip the file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>target_dir</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>What to unzip the file as.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>zip_filename</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Filename to store zip file as. Defaults to &ldquo;test_data.zip&rdquo;.</p>
              </div>
            </td>
            <td>
                  <code>&#39;test_data.zip&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/tools.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_unzip</span><span class="p">(</span>
    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">out_base_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">zip_filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;test_data.zip&quot;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Download and unzips a file from a URL. The zip file is removed after extraction.</span>

<span class="sd">    Args:</span>
<span class="sd">        url (str): Full URL do download from.</span>
<span class="sd">        out_base_dir (str): Where to unzip the file.</span>
<span class="sd">        target_dir (str): What to unzip the file as.</span>
<span class="sd">        zip_filename (str, optional): Filename to store zip file as. Defaults to &quot;test_data.zip&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">target_zip</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_base_dir</span><span class="p">,</span> <span class="n">zip_filename</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">out_base_dir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">out_base_dir</span><span class="p">)</span>
    <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">_download</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">target_zip</span><span class="p">)</span>
    <span class="n">_unzip</span><span class="p">(</span><span class="n">target_zip</span><span class="p">,</span> <span class="n">target_dir</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">target_zip</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tm2py.tools.emme_context" class="doc doc-heading">
            <code class=" language-python"><span class="n">emme_context</span><span class="p">()</span></code>

<a href="#tm2py.tools.emme_context" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">

      <p>Return True if Emme is installed.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/tools.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">emme_context</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return True if Emme is installed.&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">pkg_resources</span>

    <span class="n">_inro_package</span> <span class="o">=</span> <span class="s2">&quot;inro-emme&quot;</span>
    <span class="n">_avail_packages</span> <span class="o">=</span> <span class="p">[</span><span class="n">pkg</span><span class="o">.</span><span class="n">key</span> <span class="k">for</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="n">pkg_resources</span><span class="o">.</span><span class="n">working_set</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">_inro_package</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_avail_packages</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Inro not found. Skipping inro setup.&quot;</span><span class="p">)</span>
        <span class="n">mocked_inro_context</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">inro</span>

        <span class="k">if</span> <span class="s2">&quot;MagicMock&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">inro</span><span class="p">)):</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tm2py.tools.interpolate_dfs" class="doc doc-heading">
            <code class=" language-python"><span class="n">interpolate_dfs</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">ref_points</span><span class="p">,</span> <span class="n">target_point</span><span class="p">,</span> <span class="n">ref_col_name</span><span class="o">=</span><span class="s1">&#39;ends_with&#39;</span><span class="p">)</span></code>

<a href="#tm2py.tools.interpolate_dfs" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">

      <p>Interpolate for the model year assuming linear growth between the reference years.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>df</code></td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dataframe to interpolate on, with ref points contained in column
name per ref_col_name.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>ref_points</code></td>
            <td>
                  <code><span title="typing.Collection">Collection</span>[<span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="int">int</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>reference years to interpolate between</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>target_point</code></td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>target year</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>ref_col_name</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>column name to use for reference years.
Defaults to &ldquo;ends_with&rdquo;.</p>
              </div>
            </td>
            <td>
                  <code>&#39;ends_with&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/tools.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">interpolate_dfs</span><span class="p">(</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">ref_points</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span>
    <span class="n">target_point</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
    <span class="n">ref_col_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ends_with&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Interpolate for the model year assuming linear growth between the reference years.</span>

<span class="sd">    Args:</span>
<span class="sd">        df (pd.DataFrame): dataframe to interpolate on, with ref points contained in column</span>
<span class="sd">            name per ref_col_name.</span>
<span class="sd">        ref_points (Collection[Union[float,int]]): reference years to interpolate between</span>
<span class="sd">        target_point (Union[float,int]): target year</span>
<span class="sd">        ref_col_name (str, optional): column name to use for reference years.</span>
<span class="sd">            Defaults to &quot;ends_with&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ref_col_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ends_with&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ref_col_name</span><span class="si">}</span><span class="s2"> not implemented&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ref_points</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ref_points</span><span class="si">}</span><span class="s2"> reference points not implemented&quot;</span><span class="p">)</span>

    <span class="n">_ref_points</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">ref_points</span><span class="p">))</span>
    <span class="n">_target_point</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">target_point</span><span class="p">)</span>

    <span class="n">_ref_points</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="n">_start_point</span><span class="p">,</span> <span class="n">_end_point</span> <span class="o">=</span> <span class="n">_ref_points</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_start_point</span> <span class="o">&lt;=</span> <span class="n">_target_point</span> <span class="o">&lt;=</span> <span class="n">_end_point</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Target Point: </span><span class="si">{</span><span class="n">_target_point</span><span class="si">}</span><span class="s2"> not within range of </span><span class="se">\</span>
<span class="s2">            Reference Points: </span><span class="si">{</span><span class="n">_ref_points</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="n">_start_ref_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_start_point</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">_end_ref_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_end_point</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_start_ref_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">_end_ref_df</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_start_point</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">_end_point</span><span class="si">}</span><span class="s2"> have different number of columns:</span><span class="se">\n\</span>
<span class="s2">           </span><span class="si">{</span><span class="n">_start_point</span><span class="si">}</span><span class="s2"> Columns: </span><span class="si">{</span><span class="n">_start_ref_df</span><span class="o">.</span><span class="n">columns</span><span class="si">}</span><span class="se">\n\</span>
<span class="s2">           </span><span class="si">{</span><span class="n">_end_point</span><span class="si">}</span><span class="s2"> Columns: </span><span class="si">{</span><span class="n">_end_ref_df</span><span class="o">.</span><span class="n">columns</span><span class="si">}</span><span class="se">\</span>
<span class="s2">        &quot;</span>
        <span class="p">)</span>

    <span class="n">_start_ref_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
        <span class="n">columns</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">_start_point</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="n">_end_ref_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">_end_point</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">_scale_factor</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">target_point</span> <span class="o">-</span> <span class="n">_start_point</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">_end_point</span> <span class="o">-</span> <span class="n">_start_point</span><span class="p">)</span>

    <span class="n">interpolated_df</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">_scale_factor</span><span class="p">)</span> <span class="o">*</span> <span class="n">_start_ref_df</span> <span class="o">+</span> <span class="n">_scale_factor</span> <span class="o">*</span> <span class="n">_end_ref_df</span>

    <span class="k">return</span> <span class="n">interpolated_df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tm2py.tools.mocked_inro_context" class="doc doc-heading">
            <code class=" language-python"><span class="n">mocked_inro_context</span><span class="p">()</span></code>

<a href="#tm2py.tools.mocked_inro_context" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">

      <p>Mocking of modules which need to be mocked for tests.</p>

            <details class="quote">
              <summary>Source code in <code>tm2py/tools.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">mocked_inro_context</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Mocking of modules which need to be mocked for tests.&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">sys</span>
    <span class="kn">from</span> <span class="nn">unittest.mock</span> <span class="kn">import</span> <span class="n">MagicMock</span>

    <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;inro.emme.database.emmebank&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;inro.emme.database.emmebank.path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;inro.emme.network.link&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;inro.emme.network.mode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;inro.emme.network.node&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;inro.emme.network&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;inro.emme.database.scenario&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;inro.emme.database.matrix&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;inro.emme.network.node&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;inro.emme.desktop.app&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;inro&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;inro.modeller&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;tm2py.emme.manager.EmmeManager.project&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;tm2py.emme.manager.EmmeManager.emmebank&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;tm2py.emme.manager&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tm2py.tools.run_process" class="doc doc-heading">
            <code class=" language-python"><span class="n">run_process</span><span class="p">(</span><span class="n">commands</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

<a href="#tm2py.tools.run_process" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">

      <p>Run system level commands as blocking process and log output and error messages.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>commands</code></td>
            <td>
                  <code><span title="typing.Collection">Collection</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of one or more commands to execute</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>name</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>optional name to use for the temp bat file</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/tools.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_process</span><span class="p">(</span><span class="n">commands</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run system level commands as blocking process and log output and error messages.</span>

<span class="sd">    Args:</span>
<span class="sd">        commands: list of one or more commands to execute</span>
<span class="sd">        name: optional name to use for the temp bat file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># when merged with develop_logging branch can use get_logger</span>
    <span class="c1"># logger = Logger.get_logger</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">with</span> <span class="n">temp_file</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.bat&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="p">(</span><span class="n">bat_file</span><span class="p">,</span> <span class="n">bat_file_path</span><span class="p">):</span>
        <span class="n">bat_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">commands</span><span class="p">))</span>
        <span class="n">bat_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">logger</span><span class="p">:</span>
            <span class="c1"># temporary file to capture output error messages generated by Java</span>
            <span class="c1"># Note: temp file created in the current working directory</span>
            <span class="k">with</span> <span class="n">temp_file</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w+&quot;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;_error.log&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="p">(</span><span class="n">err_file</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">output</span> <span class="o">=</span> <span class="n">_subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span>
                        <span class="n">bat_file_path</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">err_file</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span>
                    <span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span>
                <span class="k">except</span> <span class="n">_subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
                    <span class="k">raise</span>
                <span class="k">finally</span><span class="p">:</span>
                    <span class="n">err_file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">error_msg</span> <span class="o">=</span> <span class="n">err_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">error_msg</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_subprocess</span><span class="o">.</span><span class="n">check_call</span><span class="p">(</span><span class="n">bat_file_path</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tm2py.tools.temp_file" class="doc doc-heading">
            <code class=" language-python"><span class="n">temp_file</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w+&#39;</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

<a href="#tm2py.tools.temp_file" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">

      <p>Temp file wrapper to return open file handle and named path.</p>
<p>A named temporary file (using mkstemp) with specified prefix and
suffix is created and opened with the specified mode. The file
handle and path are returned. The file is closed and deleted on exit.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>mode</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>mode to open file, [rw][+][b]</p>
              </div>
            </td>
            <td>
                  <code>&#39;w+&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>prefix</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>optional text to start temp file name</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>suffix</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>optional text to end temp file name</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/tools.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@_context</span>
<span class="k">def</span> <span class="nf">temp_file</span><span class="p">(</span><span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;w+&quot;</span><span class="p">,</span> <span class="n">prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">suffix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Temp file wrapper to return open file handle and named path.</span>

<span class="sd">    A named temporary file (using mkstemp) with specified prefix and</span>
<span class="sd">    suffix is created and opened with the specified mode. The file</span>
<span class="sd">    handle and path are returned. The file is closed and deleted on exit.</span>

<span class="sd">    Args:</span>
<span class="sd">        mode: mode to open file, [rw][+][b]</span>
<span class="sd">        prefix: optional text to start temp file name</span>
<span class="sd">        suffix: optional text to end temp file name</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">file_ref</span><span class="p">,</span> <span class="n">file_path</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkstemp</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="n">suffix</span><span class="p">)</span>
    <span class="n">file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">fdopen</span><span class="p">(</span><span class="n">file_ref</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">file</span><span class="p">,</span> <span class="n">file_path</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">file</span><span class="o">.</span><span class="n">closed</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tm2py.tools.zonal_csv_to_matrices" class="doc doc-heading">
            <code class=" language-python"><span class="n">zonal_csv_to_matrices</span><span class="p">(</span><span class="n">csv_file</span><span class="p">,</span> <span class="n">i_column</span><span class="o">=</span><span class="s1">&#39;ORIG&#39;</span><span class="p">,</span> <span class="n">j_column</span><span class="o">=</span><span class="s1">&#39;DEST&#39;</span><span class="p">,</span> <span class="n">value_columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;VALUE&#39;</span><span class="p">],</span> <span class="n">default_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">fill_zones</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">max_zone</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span></code>

<a href="#tm2py.tools.zonal_csv_to_matrices" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">

      <p>Read a CSV file with zonal data and into dataframes.</p>
<p>Input CSV file should have a header row specifying the I, J, and Value column names.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>csv_file</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><em>description</em></p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>i_column</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of j zone column. Defaults to &ldquo;ORIG&rdquo;.</p>
              </div>
            </td>
            <td>
                  <code>&#39;ORIG&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>j_column</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of i zone column. Defaults to &ldquo;DEST&rdquo;.</p>
              </div>
            </td>
            <td>
                  <code>&#39;DEST&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>value_columns</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of columns to turn into matrices.
Defaults to [&ldquo;VALUE&rdquo;].</p>
              </div>
            </td>
            <td>
                  <code>[&#39;VALUE&#39;]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>default_value</code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Value to fill empty cells with. Defaults to 0.0.</p>
              </div>
            </td>
            <td>
                  <code>0.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>fill_zones</code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If true, will fill zones without values to max zone with
default value. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>max_zone</code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If fill_zones is True, used to determine matrix size.
Defaults to max(I, J).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>delimiter</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input file delimeter. Defaults to &ldquo;,&rdquo;.</p>
              </div>
            </td>
            <td>
                  <code>&#39;,&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
                  <code><span title="typing.Mapping">Mapping</span>[<span title="str">str</span>, <span title="pandas.DataFrame">DataFrame</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary of Pandas dataframes with matrix names as keys.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/tools.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">zonal_csv_to_matrices</span><span class="p">(</span>
    <span class="n">csv_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">i_column</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ORIG&quot;</span><span class="p">,</span>
    <span class="n">j_column</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;DEST&quot;</span><span class="p">,</span>
    <span class="n">value_columns</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;VALUE&quot;</span><span class="p">],</span>
    <span class="n">default_value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">fill_zones</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">max_zone</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">delimiter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Read a CSV file with zonal data and into dataframes.</span>

<span class="sd">    Input CSV file should have a header row specifying the I, J, and Value column names.</span>

<span class="sd">    Args:</span>
<span class="sd">        csv_file (str): _description_</span>
<span class="sd">        i_column (str, optional): Name of j zone column. Defaults to &quot;ORIG&quot;.</span>
<span class="sd">        j_column (str, optional): Name of i zone column. Defaults to &quot;DEST&quot;.</span>
<span class="sd">        value_columns (str, optional): List of columns to turn into matrices.</span>
<span class="sd">            Defaults to [&quot;VALUE&quot;].</span>
<span class="sd">        default_value (float, optional): Value to fill empty cells with. Defaults to 0.0.</span>
<span class="sd">        fill_zones (bool, optional): If true, will fill zones without values to max zone with</span>
<span class="sd">            default value. Defaults to False.</span>
<span class="sd">        max_zone (int, optional): If fill_zones is True, used to determine matrix size.</span>
<span class="sd">            Defaults to max(I, J).</span>
<span class="sd">        delimiter (str, optional): Input file delimeter. Defaults to &quot;,&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Dictionary of Pandas dataframes with matrix names as keys.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO Create a test</span>
    <span class="n">_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">csv_file</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span><span class="p">)</span>
    <span class="n">_df_idx</span> <span class="o">=</span> <span class="n">_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="n">i_column</span><span class="p">,</span> <span class="n">j_column</span><span class="p">])</span>

    <span class="n">_dfs_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">_df_idx</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value_columns</span><span class="p">}</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">fill_zones</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_dfs_dict</span>

    <span class="k">if</span> <span class="n">max_zone</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">max_zone</span> <span class="o">=</span> <span class="n">_df</span><span class="p">[[</span><span class="n">i_column</span><span class="p">,</span> <span class="n">j_column</span><span class="p">]]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

    <span class="n">_zone_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_zone</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">_df</span> <span class="ow">in</span> <span class="n">_dfs_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">_df</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">_zone_list</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">_zone_list</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">default_value</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_dfs_dict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="tm2py.examples"></a>
    <div class="doc doc-contents first">

      <p>Download and unzip examples for tm2py, used in tests.</p>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="tm2py.examples.get_example" class="doc doc-heading">
            <code class=" language-python"><span class="n">get_example</span><span class="p">(</span><span class="n">example_name</span><span class="o">=</span><span class="n">_DEFAULT_EXAMPLE_NAME</span><span class="p">,</span> <span class="n">example_subdir</span><span class="o">=</span><span class="n">_DEFAULT_EXAMPLE_SUBDIR</span><span class="p">,</span> <span class="n">root_dir</span><span class="o">=</span><span class="n">_ROOT_DIR</span><span class="p">,</span> <span class="n">retrieval_url</span><span class="o">=</span><span class="n">_DEFAULT_EXAMPLE_URL</span><span class="p">)</span></code>

<a href="#tm2py.examples.get_example" class="headerlink" title="Permanent link"> </a></h2>


    <div class="doc doc-contents ">

      <p>Returns example directory; downloads if necessary from retrieval URL.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>example_name</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Used to retrieve sub-folder or create it if doesn&rsquo;t exist.
Defaults to _DEFAULT_EXAMPLE_NAME.</p>
              </div>
            </td>
            <td>
                  <code><span title="tm2py.examples._DEFAULT_EXAMPLE_NAME">_DEFAULT_EXAMPLE_NAME</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>example_subdir</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Where to find examples within root dir. Defaults
to _DEFAULT_EXAMPLE_SUBDIR.</p>
              </div>
            </td>
            <td>
                  <code><span title="tm2py.examples._DEFAULT_EXAMPLE_SUBDIR">_DEFAULT_EXAMPLE_SUBDIR</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>root_dir</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Root dir of project. Defaults to _ROOT_DIR.</p>
              </div>
            </td>
            <td>
                  <code><span title="tm2py.examples._ROOT_DIR">_ROOT_DIR</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>retrieval_url</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>URL to retrieve example data zip from. Defaults
to _DEFAULT_EXAMPLE_URL.</p>
              </div>
            </td>
            <td>
                  <code><span title="tm2py.examples._DEFAULT_EXAMPLE_URL">_DEFAULT_EXAMPLE_URL</span></code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="FileNotFoundError">FileNotFoundError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If can&rsquo;t find the files after trying to download it.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to example data.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tm2py/examples.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_example</span><span class="p">(</span>
    <span class="n">example_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">_DEFAULT_EXAMPLE_NAME</span><span class="p">,</span>
    <span class="n">example_subdir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">_DEFAULT_EXAMPLE_SUBDIR</span><span class="p">,</span>
    <span class="n">root_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">_ROOT_DIR</span><span class="p">,</span>
    <span class="n">retrieval_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">_DEFAULT_EXAMPLE_URL</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns example directory; downloads if necessary from retrieval URL.</span>

<span class="sd">    Args:</span>
<span class="sd">        example_name (str, optional): Used to retrieve sub-folder or create it if doesn&#39;t exist.</span>
<span class="sd">            Defaults to _DEFAULT_EXAMPLE_NAME.</span>
<span class="sd">        example_subdir (str, optional): Where to find examples within root dir. Defaults</span>
<span class="sd">            to _DEFAULT_EXAMPLE_SUBDIR.</span>
<span class="sd">        root_dir (str, optional): Root dir of project. Defaults to _ROOT_DIR.</span>
<span class="sd">        retrieval_url (str, optional): URL to retrieve example data zip from. Defaults</span>
<span class="sd">            to _DEFAULT_EXAMPLE_URL.</span>

<span class="sd">    Raises:</span>
<span class="sd">        FileNotFoundError: If can&#39;t find the files after trying to download it.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Path to example data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_example_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_dir</span><span class="p">,</span> <span class="n">example_subdir</span><span class="p">)</span>
    <span class="n">_this_example_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_example_dir</span><span class="p">,</span> <span class="n">example_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">_this_example_dir</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_this_example_dir</span>

    <span class="n">download_unzip</span><span class="p">(</span><span class="n">retrieval_url</span><span class="p">,</span> <span class="n">_example_dir</span><span class="p">,</span> <span class="n">_this_example_dir</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">_this_example_dir</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;example </span><span class="si">{</span><span class="n">_this_example_dir</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">_this_example_dir</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.1e8ae164.min.js"></script>
      
    
  </body>
</html>